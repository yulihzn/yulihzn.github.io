window.__require=function t(e,o,i){function a(s,r){if(!o[s]){if(!e[s]){var c=s.split("/");if(c=c[c.length-1],!e[c]){var l="function"==typeof __require&&__require;if(!r&&l)return l(c,!0);if(n)return n(c,!0);throw new Error("Cannot find module '"+s+"'")}}var h=o[s]={exports:{}};e[s][0].call(h.exports,function(t){return a(e[s][1][t]||t)},h,h.exports,t,e,o,i)}return o[s].exports}for(var n="function"==typeof __require&&__require,s=0;s<i.length;s++)a(i[s]);return a}({AmmoCount:[function(t,e,o){"use strict";cc._RF.push(e,"6a3014RzCdLroOkSBlm8HS/","AmmoCount"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("./Logic"),a=cc._decorator,n=a.ccclass,s=a.property,r=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.label=null,e}return __extends(e,t),e.prototype.onLoad=function(){},e.prototype.start=function(){},e.prototype.update=function(t){this.label&&(this.label.string=""+i.default.ammo)},__decorate([s(cc.Label)],e.prototype,"label",void 0),e=__decorate([n],e)}(cc.Component);o.default=r,cc._RF.pop()},{"./Logic":"Logic"}],BoxData:[function(t,e,o){"use strict";cc._RF.push(e,"9dffcnB2sFH8Y3GL3+iALBZ","BoxData"),Object.defineProperty(o,"__esModule",{value:!0});var i=function(){return function(){}}();o.default=i,cc._RF.pop()},{}],Box:[function(t,e,o){"use strict";cc._RF.push(e,"84b7dB47rlIALRzq2ZvOGc3","Box"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("../Dungeon"),a=t("../Data/BoxData"),n=t("../Logic"),s=cc._decorator,r=s.ccclass,c=(s.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.timeDelay=0,e.isBreaking=!1,e.data=new a.default,e}return __extends(e,t),e.prototype.onLoad=function(){this.anim=this.getComponent(cc.Animation),this.anim.play("BoxShow")},e.prototype.start=function(){},e.prototype.changeRes=function(t){var e=this.node.getChildByName("sprite").getComponent(cc.Sprite),o=n.default.spriteFrames[t];e.spriteFrame=o},e.prototype.setPos=function(t){this.data.pos=t,this.node.position=i.default.getPosInMap(this.data.pos),this.node.zIndex=3e3+100*(i.default.HEIGHT_SIZE-t.y)+1},e.prototype.BreakingFinish=function(){this.reset()},e.prototype.breakBox=function(){this.isBreaking||(this.anim||(this.anim=this.getComponent(cc.Animation)),this.anim.play("BoxBroken"),this.isBreaking=!0)},e.prototype.reset=function(){this.node.position=i.default.getPosInMap(this.data.defaultPos),this.isBreaking=!1},e.prototype.update=function(t){if(this.timeDelay+=t,this.timeDelay>.2){this.data.pos=i.default.getIndexInMap(this.node.position),this.data.position=this.node.position;var e=n.default.getCurrentMapBoxes();if(e)for(var o=0,a=e;o<a.length;o++){var s=a[o];s.defaultPos.equals(this.data.defaultPos)&&(s.pos=this.data.pos,s.position=this.data.position)}this.node.zIndex=3e3+100*(i.default.HEIGHT_SIZE-this.data.pos.y)+1}},e=__decorate([r],e)}(cc.Component));o.default=c,cc._RF.pop()},{"../Data/BoxData":"BoxData","../Dungeon":"Dungeon","../Logic":"Logic"}],Bullet:[function(t,e,o){"use strict";cc._RF.push(e,"d243aeNu+tEJJbz1ng6i61f","Bullet"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("../Monster"),a=t("../Player"),n=t("../Boss/Kraken"),s=t("../MeleeWeapon"),r=t("../Boss/Captain"),c=cc._decorator,l=c.ccclass,h=c.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.label=null,e.damage=1,e.speed=500,e.isMelee=!1,e.dir=0,e.tagetPos=cc.v2(0,0),e.hv=cc.v2(0,0),e.isFromPlayer=!1,e.KEEP_LIST=["Monster","Kraken","Captain"],e}return __extends(e,t),e.prototype.onLoad=function(){this.anim=this.getComponent(cc.Animation),this.rigidBody=this.getComponent(cc.RigidBody)},e.prototype.onEnable=function(){this.tagetPos=cc.v2(0,0),this.rigidBody.linearVelocity=cc.v2(0,0),this.sprite=this.node.getChildByName("sprite"),this.sprite.opacity=255,this.light=this.node.getChildByName("light"),this.light.opacity=0},e.prototype.MeleeFinish=function(){cc.director.emit("destorybullet",{detail:{bulletNode:this.node}})},e.prototype.showBullet=function(t){this.hv=t,this.isMelee&&this.anim.play(this.node.name+"Show"),this.fire(this.hv)},e.prototype.BulletDestory=function(){cc.director.emit("destorybullet",{detail:{bulletNode:this.node}})},e.prototype.fire=function(t){this.rigidBody||(this.rigidBody=this.getComponent(cc.RigidBody)),this.rigidBody.linearVelocity=cc.v2(this.speed*t.x,this.speed*t.y)},e.prototype.start=function(){},e.prototype.onBeginContact=function(t,e,o){var i=!0;e.body.node.name==o.body.node.name&&(i=!1);for(var a=0,n=this.KEEP_LIST;a<n.length;a++){var s=n[a];o.body.node.name==s&&(i=!1)}"Player"==o.body.node.name&&(i=!1),o.sensor&&(i=!1),2==o.tag&&(i=!1),i&&this.anim&&(this.rigidBody.linearVelocity=cc.v2(0,0),this.anim.play("Bullet001Hit"))},e.prototype.onCollisionEnter=function(t,e){for(var o=!0,i=0,a=this.KEEP_LIST;i<a.length;i++){var n=a[i];this.isFromPlayer||t.node.name!=n||(o=!1)}this.isFromPlayer&&"Player"==t.node.name&&(o=!1),o&&this.attacking(t.node)},e.prototype.attacking=function(t){if(t){var e=this.damage,o=!1,c=t.getComponent(i.default);c&&!c.isDied&&(c.takeDamage(e),o=!0);var l=t.getComponent(a.default);l&&!l.isDied&&(l.takeDamage(e),o=!0);var h=t.getComponent(n.default);h&&!h.isDied&&(h.takeDamage(e),o=!0);var p=t.getComponent(r.default);p&&!p.isDied&&(p.takeDamage(e),o=!0);var d=t.getComponent(s.default);d&&d.isAttacking&&(o=!0),o&&this.anim&&!this.anim.getAnimationState("Bullet001Hit").isPlaying&&(this.rigidBody.linearVelocity=cc.v2(0,0),this.anim.play("Bullet001Hit"))}},e.prototype.update=function(t){},__decorate([h(cc.Label)],e.prototype,"label",void 0),__decorate([h],e.prototype,"damage",void 0),__decorate([h],e.prototype,"speed",void 0),__decorate([h],e.prototype,"isMelee",void 0),e=__decorate([l],e)}(cc.Component);o.default=p,cc._RF.pop()},{"../Boss/Captain":"Captain","../Boss/Kraken":"Kraken","../MeleeWeapon":"MeleeWeapon","../Monster":"Monster","../Player":"Player"}],CameraControl:[function(t,e,o){"use strict";cc._RF.push(e,"aaca098lw9M94SueX+ajVM7","CameraControl"),Object.defineProperty(o,"__esModule",{value:!0});var i=cc._decorator,a=i.ccclass,n=i.property,s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.target=null,e}return __extends(e,t),e.prototype.onLoad=function(){this.camera=this.getComponent(cc.Camera)},e.prototype.onEnable=function(){},e.prototype.onDisable=function(){},e.prototype.start=function(){},e.prototype.lateUpdate=function(){var t=this.target.convertToWorldSpaceAR(cc.Vec2.ZERO);this.node.position=this.lerp(this.node.position,this.node.parent.convertToNodeSpaceAR(t),.1)},e.prototype.lerp=function(t,e,o){var i=cc.v2(0,0),a=t.x,n=t.y;return i.x=a+(e.x-a)*o,i.y=n+(e.y-n)*o,i},__decorate([n(cc.Node)],e.prototype,"target",void 0),e=__decorate([a],e)}(cc.Component);o.default=s,cc._RF.pop()},{}],CaptainSword:[function(t,e,o){"use strict";cc._RF.push(e,"e541b/KaoRBdL9VgXHoN6dM","CaptainSword"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("../EventConstant"),a=t("../Player"),n=cc._decorator,s=n.ccclass,r=n.property,c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.damage=2,e.isShow=!1,e}return __extends(e,t),e.prototype.start=function(){this.isShow=!1},e.prototype.onCollisionEnter=function(t,e){t.node.getComponent(a.default)&&this.isShow&&this.node.active&&(this.isShow=!1,cc.director.emit(i.EventConstant.PLAYER_TAKEDAMAGE,{detail:{damage:this.damage}}))},__decorate([r],e.prototype,"damage",void 0),e=__decorate([s],e)}(cc.Component);o.default=c,cc._RF.pop()},{"../EventConstant":"EventConstant","../Player":"Player"}],Captain:[function(t,e,o){"use strict";cc._RF.push(e,"6d826iFR+pBDJHGFIoYZ400","Captain"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("./CaptainSword"),a=t("../Data/MonsterData"),n=t("../Dungeon"),s=t("../Logic"),r=t("../Player"),c=t("../EventConstant"),l=t("../Shooter"),h=t("../Manager/EquipmentManager"),p=cc._decorator,d=p.ccclass,u=p.property,m=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.sword=null,e.healthBar=null,e.data=new a.default,e.isDied=!1,e.isShow=!1,e.pos=cc.v2(0,0),e.isJumping=!1,e.isFaceRight=!0,e.isMoving=!1,e.isAttacking=!1,e.timeDelay=0,e.isHurt=!1,e.isFall=!1,e.shooter=null,e}return __extends(e,t),e.prototype.onLoad=function(){this.isAttacking=!1,this.isDied=!1,this.anim=this.getComponent(cc.Animation),this.rigidbody=this.getComponent(cc.RigidBody),this.shooter=this.node.getChildByName("Shooter").getComponent(l.default),this.updatePlayerPos()},e.prototype.start=function(){var t=this;this.changeZIndex(),setTimeout(function(){t.healthBar&&t.healthBar.refreshHealth(t.data.currentHealth,t.data.maxHealth)},100)},e.prototype.AttackDamageStart=function(){this.sword.isShow=!0},e.prototype.AttackDamageFinish=function(){this.sword.isShow=!1},e.prototype.AttackStart=function(){this.isAttacking=!0},e.prototype.AttackFinish=function(){this.isAttacking=!1},e.prototype.JumpStart=function(){this.isJumping=!0,this.getComponent(cc.PhysicsBoxCollider).sensor=!0,this.getComponent(cc.PhysicsBoxCollider).apply()},e.prototype.JumpFinish=function(){var t=this;if(this.isJumping=!1,this.isFall=!0,setTimeout(function(){t.isFall=!1},100),this.getComponent(cc.PhysicsBoxCollider).sensor=!1,this.getComponent(cc.PhysicsBoxCollider).apply(),this.dungeon&&this.shooter){this.fireWithAngles([0,45,90,135,180,225,270,315])}},e.prototype.fireWithAngles=function(t){if(this.dungeon&&this.shooter){var e=this.dungeon.player.node.position.sub(this.node.position);if(!e.equals(cc.Vec2.ZERO)){e=e.normalizeSelf(),this.shooter.setHv(e),this.shooter.dungeon=this.dungeon;for(var o=0,i=t;o<i.length;o++){var a=i[o];this.shooter.fireBullet(a)}}}},e.prototype.OpenFire=function(){var t=this;if(this.dungeon&&this.shooter){var e=[5,10,-10],o=[-5,20,-20,-40,40];this.fireWithAngles([0,-30,30]),this.data.currentHealth<this.data.maxHealth/2&&(setTimeout(function(){t.fireWithAngles(e)},100),setTimeout(function(){t.fireWithAngles(o)},200))}},e.prototype.onCollisionStay=function(t,e){t.getComponent(r.default)&&1==e.tag&&this.isFall&&(this.isFall=!1,cc.director.emit(c.EventConstant.PLAYER_TAKEDAMAGE,{detail:{damage:2}}))},e.prototype.transportPlayer=function(t,e){this.pos.x=t,this.pos.y=e,this.changeZIndex(),this.updatePlayerPos()},e.prototype.changeZIndex=function(){this.node.zIndex=3e3+100*(n.default.HEIGHT_SIZE-this.pos.y-1)+2},e.prototype.updatePlayerPos=function(){this.node.x=64*this.pos.x+32,this.node.y=64*this.pos.y+32},e.prototype.update=function(t){(this.healthBar.node.active=!this.isDied,this.timeDelay+=t,this.timeDelay>.016&&(this.timeDelay=0,this.bossAction(),this.JumpMove()),this.dungeon)&&(this.getNearPlayerDistance(this.dungeon.player.node)<64&&!this.isHurt&&(this.rigidbody.linearVelocity=cc.v2(0,0)));this.isDied&&(this.rigidbody.linearVelocity=cc.Vec2.ZERO),this.healthBar.node.active=!this.isDied,this.data.currentHealth<1&&this.killed(),this.node.scaleX=this.isFaceRight?1:-1},e.prototype.takeDamage=function(t){var e=this.anim.getAnimationState("CaptainJump").isPlaying;this.isDied||e||(this.data.currentHealth-=t,this.data.currentHealth>this.data.maxHealth&&(this.data.currentHealth=this.data.maxHealth),this.anim.play("CaptainHit"),this.isAttacking=!1,this.healthBar.refreshHealth(this.data.currentHealth,this.data.maxHealth))},e.prototype.killed=function(){var t=this;this.isDied||(this.isDied=!0,this.anim.play("CaptainDie"),this.getComponent("cc.PhysicsCollider").sensor=!0,setTimeout(function(){t.node&&(t.node.active=!1)},5e3),this.dungeon&&(cc.director.emit(c.EventConstant.DUNGEON_ADD_COIN,{detail:{pos:this.node.position,count:19}}),cc.director.emit(c.EventConstant.DUNGEON_ADD_HEART,{detail:{pos:this.node.position}}),cc.director.emit(c.EventConstant.DUNGEON_ADD_AMMO,{detail:{pos:this.node.position}}),this.dungeon.addEquipment(h.default.equipments[s.default.getRandomNum(0,h.default.equipments.length-1)],this.pos,null,3)))},e.prototype.bossAction=function(){if(!this.isDied&&this.dungeon){this.node.position=n.default.fixOuterMap(this.node.position),this.pos=n.default.getIndexInMap(this.node.position),this.changeZIndex();var t=this.dungeon.player.pos.clone(),e=n.default.getPosInMap(t).sub(this.node.position),o=this.getNearPlayerDistance(this.dungeon.player.node),i=this.anim.getAnimationState("CaptainJump").isPlaying,a=this.anim.getAnimationState("CaptainFire").isPlaying,r=e.x,c=e.y;Math.abs(r),Math.abs(c);if(this.isFaceRight=r>0,!i&&!a)if(o<140&&!this.dungeon.player.isDied)this.isAttacking||this.anim.play("CaptainAttack");else{var l=200;o>300&&(s.default.getHalfChance()?(this.anim.play("CaptainJump"),i=!0):(l=50,this.anim.play("CaptainFire"))),e.equals(cc.Vec2.ZERO)||i||this.isAttacking||(e=e.normalizeSelf(),this.move(e,l))}}},e.prototype.getNearPlayerDistance=function(t){return s.default.getDistance(this.node.position,t.position)},e.prototype.JumpMove=function(){if(this.dungeon&&this.isJumping){var t=this.dungeon.player.pos.clone(),e=n.default.getPosInMap(t).sub(this.node.position);e.equals(cc.Vec2.ZERO)||(this.pos=n.default.getIndexInMap(this.node.position),e=e.normalizeSelf());var o=e.x,i=e.y,a=(Math.abs(o),Math.abs(i),cc.v2(o,i)),s=200;this.data.currentHealth<this.data.maxHealth/2&&(s=240),a=a.mul(s),this.rigidbody.linearVelocity=a,this.isMoving=0!=o||0!=i}},e.prototype.move=function(t,e){if(this.isDied||this.isHurt)this.isHurt=!1;else{this.isAttacking&&!t.equals(cc.Vec2.ZERO)&&(t=t.mul(.5)),t.equals(cc.Vec2.ZERO)||(this.pos=n.default.getIndexInMap(this.node.position));var o=t.x,i=t.y,a=(Math.abs(o),Math.abs(i),cc.v2(o,i));a=a.mul(e),this.rigidbody.linearVelocity=a,this.isMoving=0!=o||0!=i,this.isMoving&&(this.isFaceRight=o>0),this.isMoving?this.anim.getAnimationState("CaptainMove").isPlaying||this.anim.playAdditive("CaptainMove"):this.anim.getAnimationState("CaptainMove").isPlaying&&this.anim.play("CaptainIdle"),this.changeZIndex()}},__decorate([u(i.default)],e.prototype,"sword",void 0),e=__decorate([d],e)}(cc.Component);o.default=m,cc._RF.pop()},{"../Data/MonsterData":"MonsterData","../Dungeon":"Dungeon","../EventConstant":"EventConstant","../Logic":"Logic","../Manager/EquipmentManager":"EquipmentManager","../Player":"Player","../Shooter":"Shooter","./CaptainSword":"CaptainSword"}],Chapter:[function(t,e,o){"use strict";cc._RF.push(e,"e966c6tQ3FASbN1WCJi24PI","Chapter"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("./Logic"),a=cc._decorator,n=a.ccclass,s=a.property,r=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.chapter00=null,e.chapter01=null,e.chapter02=null,e.chapter03=null,e.chapter04=null,e.timeDelay=0,e}return __extends(e,t),e.prototype.start=function(){cc.view.enableAntiAlias(!1)},e.prototype.clickChapter=function(t,e){e&&(i.default.chapterName=e,i.default.resetData()),cc.director.loadScene("loading")},e.prototype.isTimeDelay=function(t){return this.timeDelay+=t,this.timeDelay>.016&&(this.timeDelay=0,!0)},e.prototype.update=function(t){this.isTimeDelay(t)},__decorate([s(cc.Button)],e.prototype,"chapter00",void 0),__decorate([s(cc.Button)],e.prototype,"chapter01",void 0),__decorate([s(cc.Button)],e.prototype,"chapter02",void 0),__decorate([s(cc.Button)],e.prototype,"chapter03",void 0),__decorate([s(cc.Button)],e.prototype,"chapter04",void 0),e=__decorate([n],e)}(cc.Component);o.default=r,cc._RF.pop()},{"./Logic":"Logic"}],Chest:[function(t,e,o){"use strict";cc._RF.push(e,"a259fOC11hFpJCy2hycs7kH","Chest"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("../Dungeon"),a=t("../Manager/EquipmentManager"),n=t("../Logic"),s=cc._decorator,r=s.ccclass,c=s.property,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.openSpriteFrame=null,e.closeSpriteFrame=null,e.isOpen=!1,e.pos=cc.v2(0,0),e.timeDelay=0,e.quality=1,e}return __extends(e,t),e.prototype.onLoad=function(){this.sprite=this.node.getChildByName("sprite")},e.prototype.start=function(){},e.prototype.setQuality=function(t,e){this.quality=t,this.isOpen=e,this.sprite||(this.sprite=this.node.getChildByName("sprite"));var o="chest001",i="chestopen001";switch(t){case 1:o="chest001",i="chestopen001";break;case 2:o="chest003",i="chestopen003";break;case 3:o="chest002",i="chestopen002"}var a=n.default.spriteFrames[o],s=n.default.spriteFrames[i];this.openSpriteFrame=a,this.closeSpriteFrame=s,this.sprite.getComponent(cc.Sprite).spriteFrame=this.openSpriteFrame,e&&(this.sprite.getComponent(cc.Sprite).spriteFrame=this.closeSpriteFrame)},e.prototype.setPos=function(t){this.pos=t,this.node.position=i.default.getPosInMap(t),this.node.zIndex=3e3+100*(i.default.HEIGHT_SIZE-t.y)+1},e.prototype.openChest=function(){var t=this;if(!this.isOpen){this.isOpen=!0;var e=cc.sequence(cc.moveTo(.1,5,16),cc.moveTo(.1,-5,0),cc.moveTo(.1,5,0),cc.moveTo(.1,-5,0),cc.moveTo(.1,0,0),cc.callFunc(function(){if(t.sprite.getComponent(cc.Sprite).spriteFrame=t.closeSpriteFrame,t.node.parent){var e=t.node.parent.getComponent(i.default);e&&e.addEquipment(a.default.equipments[n.default.getRandomNum(0,a.default.equipments.length-1)],t.pos,null,t.quality)}}));this.sprite.runAction(e)}},e.prototype.onCollisionStay=function(t,e){3==t.tag&&(this.isOpen||this.openChest())},e.prototype.update=function(t){},__decorate([c(cc.SpriteFrame)],e.prototype,"openSpriteFrame",void 0),__decorate([c(cc.SpriteFrame)],e.prototype,"closeSpriteFrame",void 0),e=__decorate([r],e)}(cc.Component);o.default=l,cc._RF.pop()},{"../Dungeon":"Dungeon","../Logic":"Logic","../Manager/EquipmentManager":"EquipmentManager"}],CoinCount:[function(t,e,o){"use strict";cc._RF.push(e,"91131vqXzhODZpby3U0hjQL","CoinCount"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("./Logic"),a=t("./EventConstant"),n=cc._decorator,s=n.ccclass,r=n.property,c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.label=null,e}return __extends(e,t),e.prototype.onLoad=function(){var t=this;this.anim=this.getComponent(cc.Animation),cc.director.on(a.EventConstant.HUD_ADD_COIN,function(e){t.addCount(e.detail.count)})},e.prototype.start=function(){},e.prototype.addCount=function(t){this.anim&&(i.default.coins+=t)},e.prototype.update=function(t){this.label&&(this.label.string=""+i.default.coins)},__decorate([r(cc.Label)],e.prototype,"label",void 0),e=__decorate([s],e)}(cc.Component);o.default=c,cc._RF.pop()},{"./EventConstant":"EventConstant","./Logic":"Logic"}],CoinManager:[function(t,e,o){"use strict";cc._RF.push(e,"9211357HjhKqavyVFqZ4zof","CoinManager"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("../Item/Coin"),a=cc._decorator,n=a.ccclass,s=a.property,r=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.coin=null,e}return __extends(e,t),e.prototype.onLoad=function(){var t=this;this.coinPool=new cc.NodePool,cc.director.on("destorycoin",function(e){t.destroyCoin(e.detail.coinNode)})},e.prototype.getValueCoin=function(t,e,o){for(var i=t%10,a=0;a<i;a++)this.getCoin(1,e,o);var n=(t-i)/10;for(a=0;a<n;a++)this.getCoin(10,e,o)},e.prototype.getCoin=function(t,e,o){var a=null;this.coinPool.size()>0&&(a=this.coinPool.get()),a&&!a.active||(a=cc.instantiate(this.coin)),a.parent=o,a.position=e;var n=a.getComponent(i.default);n.changeValue(t),n.node.zIndex=4e3,a.active=!0},e.prototype.destroyCoin=function(t){t.active=!1;t.getComponent(i.default);this.coinPool&&this.coinPool.put(t)},e.prototype.start=function(){},__decorate([s(cc.Prefab)],e.prototype,"coin",void 0),e=__decorate([n],e)}(cc.Component);o.default=r,cc._RF.pop()},{"../Item/Coin":"Coin"}],Coin:[function(t,e,o){"use strict";cc._RF.push(e,"586a7ZPuVJNUIhnMRyd39J4","Coin"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("../Player"),a=t("../Logic"),n=t("../EventConstant"),s=cc._decorator,r=s.ccclass,c=(s.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.value=0,e.valueRes=["gem01","gem02","gem03","gem04"],e.isReady=!1,e}return __extends(e,t),e.prototype.onLoad=function(){},e.prototype.onEnable=function(){var t=this;this.anim=this.getComponent(cc.Animation),this.rigidBody=this.getComponent(cc.RigidBody);var e=Math.random()*(a.default.getHalfChance()?1:-1)*800,o=Math.random()*(a.default.getHalfChance()?1:-1)*800;this.rigidBody.linearVelocity=cc.v2(e,o),this.isReady=!1,setTimeout(function(){t.isReady=!0},1e3)},e.prototype.changeValue=function(t){this.value=t;var e=1;e=10==this.value?3:1,this.node.getChildByName("sprite").getComponent(cc.Sprite).spriteFrame=a.default.spriteFrames[this.valueRes[e]]},e.prototype.start=function(){},e.prototype.onCollisionStay=function(t,e){var o=t.node.getComponent(i.default);if(o&&this.node.active&&this.isReady){var a=o.node.position.clone();a.y+=10;var s=a.sub(this.node.position);s.equals(cc.Vec2.ZERO)||(s=(s=s.normalizeSelf()).mul(400),this.rigidBody.linearVelocity=s)}1==e.tag&&o&&this.node.active&&this.isReady&&o&&this.node.active&&this.isReady&&(this.isReady=!1,cc.director.emit(n.EventConstant.HUD_ADD_COIN,{detail:{count:this.value}}),cc.director.emit("destorycoin",{detail:{coinNode:this.node}}))},e.prototype.update=function(t){},e=__decorate([r],e)}(cc.Component));o.default=c,cc._RF.pop()},{"../EventConstant":"EventConstant","../Logic":"Logic","../Player":"Player"}],Controller:[function(t,e,o){"use strict";cc._RF.push(e,"12f66EVamVPmoXVKYdoGHk5","Controller"),Object.defineProperty(o,"__esModule",{value:!0});var i=cc._decorator,a=i.ccclass,n=i.property,s=t("./EventConstant"),r=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.player=null,e.mainAction=null,e.mainActionTouched=!1,e.secondAction=null,e.secondActionTouched=!1,e.thirdActionTouched=!1,e.timeDelay=0,e.thirdTimeDelay=0,e}return __extends(e,t),e.prototype.onLoad=function(){this.mainAction.on(cc.Node.EventType.TOUCH_START,function(t){this.mainActionTouched=!0},this),this.mainAction.on(cc.Node.EventType.TOUCH_END,function(t){this.mainActionTouched=!1},this),this.mainAction.on(cc.Node.EventType.TOUCH_CANCEL,function(t){this.mainActionTouched=!1},this),this.secondAction.on(cc.Node.EventType.TOUCH_START,function(t){this.secondActionTouched=!0},this),this.secondAction.on(cc.Node.EventType.TOUCH_END,function(t){this.secondActionTouched=!1},this),this.secondAction.on(cc.Node.EventType.TOUCH_CANCEL,function(t){this.secondActionTouched=!1},this)},e.prototype.thirdAction=function(){this.thirdActionTouched||(this.thirdActionTouched=!0,cc.director.emit(s.EventConstant.PLAYER_USEITEM))},e.prototype.move=function(t,e){e=parseInt(e),cc.director.emit(s.EventConstant.PLAYER_MOVE,{detail:{dir:e}})},e.prototype.isTimeDelay=function(t){return this.timeDelay+=t,this.timeDelay>.016&&(this.timeDelay=0,!0)},e.prototype.isThirdTimeDelay=function(t){return this.thirdTimeDelay+=t,this.thirdTimeDelay>.2&&(this.thirdTimeDelay=0,this.thirdActionTouched=!1,!0)},e.prototype.update=function(t){this.isThirdTimeDelay(t),this.isTimeDelay(t)&&(this.mainActionTouched&&cc.director.emit(s.EventConstant.PLAYER_ATTACK),this.secondActionTouched&&cc.director.emit(s.EventConstant.PLAYER_REMOTEATTACK))},__decorate([n(cc.Node)],e.prototype,"player",void 0),__decorate([n(cc.Node)],e.prototype,"mainAction",void 0),__decorate([n(cc.Node)],e.prototype,"secondAction",void 0),e=__decorate([a],e)}(cc.Component);o.default=r,cc._RF.pop()},{"./EventConstant":"EventConstant"}],Door:[function(t,e,o){"use strict";cc._RF.push(e,"f14f52tIg1Ivb0Rnl80O8tL","Door"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("../Player"),a=t("../EventConstant"),n=cc._decorator,s=n.ccclass,r=n.property,c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isOpen=!1,e.isDoor=!0,e.dir=0,e.wall=null,e}return __extends(e,t),e.prototype.onLoad=function(){this.anim=this.getComponent(cc.Animation)},e.prototype.start=function(){this.anim=this.getComponent(cc.Animation)},e.prototype.setOpen=function(t){this.isDoor?(this.wall.active=!1,t?this.openGate():this.closeGate()):this.wall.active=!0},e.prototype.openGate=function(){this.isOpen||(this.isOpen=!0,this.anim||(this.anim=this.getComponent(cc.Animation)),this.getComponent("cc.PhysicsBoxCollider").enabled=!1,this.anim.play("DoorOpen"))},e.prototype.closeGate=function(){this.isOpen&&(this.isOpen=!1,this.anim||(this.anim=this.getComponent(cc.Animation)),this.getComponent("cc.PhysicsBoxCollider").enabled=!0,this.anim.play("DoorClose"))},e.prototype.onCollisionEnter=function(t,e){t.node.getComponent(i.default)&&this.isOpen&&cc.director.emit(a.EventConstant.LOADINGROOM,{detail:{dir:this.dir}})},__decorate([r(cc.Node)],e.prototype,"wall",void 0),e=__decorate([s],e)}(cc.Component);o.default=c,cc._RF.pop()},{"../EventConstant":"EventConstant","../Player":"Player"}],DungeonStyleData:[function(t,e,o){"use strict";cc._RF.push(e,"6e0bc4Ume5FZZHLhQzz4NXv","DungeonStyleData"),Object.defineProperty(o,"__esModule",{value:!0});var i=function(){return function(t,e,o,i,a,n,s){this.background=t,this.topwall=e,this.bottomwall=o,this.sidewall=i,this.door=a,this.d1=n,this.d2=s}}();o.default=i,cc._RF.pop()},{}],DungeonStyleManager:[function(t,e,o){"use strict";cc._RF.push(e,"96118QtbixO743MdRQKBctE","DungeonStyleManager"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("../Logic"),a=t("../Building/Door"),n=t("../Dungeon"),s=t("../Data/DungeonStyleData"),r=cc._decorator,c=r.ccclass,l=r.property,h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.background01=null,e.background02=null,e.wallTopDecoration=null,e.wallBottomDecoration=null,e.wallLeftDecoration=null,e.doorDecoration=null,e.doorRes=null,e.doors=new Array,e}return __extends(e,t),e.prototype.onLoad=function(){},e.prototype.start=function(){},e.prototype.addDecorations=function(){switch(i.default.chapterName){case"chapter00":this.styleData=new s.default(null,"restwall","restwall","restsides","restdoor","restdecoration01",null);break;case"chapter01":this.styleData=new s.default("sea","shipwall","shipwall","handrail","shipdoor","swimring","swimring");break;case"chapter02":this.styleData=new s.default("sea","junglewall1","junglewall","junglesides","jungledoor",null,null);break;case"chapter03":this.styleData=new s.default("sandsea","pyramidwall","pyramidwall","pyramidsides","dungeondoor",null,null);break;case"chapter04":this.styleData=new s.default("magmasea","dungeonwall","dungeonwall","dungeonsides","dungeondoor",null,null)}if(this.styleData){this.doors=new Array(4);for(var t=0;t<n.default.WIDTH_SIZE;t++){var e=cc.instantiate(this.wallTopDecoration);e.parent=this.node;var o=n.default.getPosInMap(cc.v2(t,n.default.HEIGHT_SIZE));e.setPosition(cc.v2(o.x,o.y+32)),e.zIndex=2500,e.getComponent(cc.Sprite).spriteFrame=this.styleData.topwall?i.default.spriteFrames[this.styleData.topwall]:null;var r=cc.instantiate(this.wallBottomDecoration);r.parent=this.node;var c=n.default.getPosInMap(cc.v2(t,-1));if(r.setScale(4,2),r.setPosition(cc.v2(c.x,c.y)),r.zIndex=2500,r.getComponent("cc.PhysicsBoxCollider").tag=0,r.getComponent(cc.Sprite).spriteFrame=this.styleData.topwall?i.default.spriteFrames[this.styleData.bottomwall]:null,t==Math.floor(n.default.WIDTH_SIZE/2)){this.doors[0]=cc.instantiate(this.doorDecoration),this.doors[0].parent=this.node;var l=n.default.getPosInMap(cc.v2(t,n.default.HEIGHT_SIZE));this.doors[0].setPosition(cc.v2(l.x,l.y+32)),this.doors[0].zIndex=2e3,this.doors[0].getComponent(a.default).wall=e,this.doors[0].getComponent(a.default).dir=0,this.doors[1]=cc.instantiate(this.doorDecoration),this.doors[1].parent=this.node;var h=n.default.getPosInMap(cc.v2(t,-1));this.doors[1].setPosition(cc.v2(h.x,h.y)),this.doors[1].setScale(4,2),this.doors[1].zIndex=2e3,this.doors[1].getComponent(a.default).wall=r,this.doors[1].getComponent(a.default).dir=1}}for(var p=-1;p<n.default.HEIGHT_SIZE+2;p++){var d=cc.instantiate(this.wallLeftDecoration);d.parent=this.node;var u=n.default.getPosInMap(cc.v2(-1,p));d.setPosition(cc.v2(u.x,u.y)),d.zIndex=2500,d.getComponent(cc.Sprite).spriteFrame=this.styleData.sidewall?i.default.spriteFrames[this.styleData.sidewall]:null;var m=cc.instantiate(this.wallLeftDecoration);m.parent=this.node;var y=n.default.getPosInMap(cc.v2(n.default.WIDTH_SIZE,p));if(m.setPosition(cc.v2(y.x,y.y)),m.zIndex=2500,m.setScale(-4,4),m.getComponent(cc.Sprite).spriteFrame=this.styleData.sidewall?i.default.spriteFrames[this.styleData.sidewall]:null,p==Math.floor(n.default.HEIGHT_SIZE/2)){this.doors[2]=cc.instantiate(this.doorDecoration),this.doors[2].parent=this.node;var f=n.default.getPosInMap(cc.v2(-1,p));this.doors[2].setPosition(cc.v2(f.x,f.y)),this.doors[2].zIndex=2e3,this.doors[2].rotation=-90,this.doors[2].setScale(4,2),this.doors[2].getComponent(a.default).wall=d,this.doors[2].getComponent(a.default).dir=2,this.doors[3]=cc.instantiate(this.doorDecoration),this.doors[3].parent=this.node;var g=n.default.getPosInMap(cc.v2(n.default.WIDTH_SIZE,p));this.doors[3].setPosition(cc.v2(g.x,g.y)),this.doors[3].zIndex=2e3,this.doors[3].setScale(4,2),this.doors[3].rotation=90,this.doors[3].getComponent(a.default).wall=m,this.doors[3].getComponent(a.default).dir=3}}this.background01.getComponent(cc.Sprite).spriteFrame=this.styleData.background?i.default.spriteFrames[this.styleData.background]:null,this.background02.getComponent(cc.Sprite).spriteFrame=this.styleData.background?i.default.spriteFrames[this.styleData.background]:null}},e.prototype.setDoor=function(t,e,o){var n=this.styleData.door;this.doors[t].getChildByName("sprite").getComponent(cc.Sprite).spriteFrame=n?i.default.spriteFrames[n]:null;var s=this.doors[t].getComponent(a.default);s&&(s.isDoor=e,s.setOpen(o))},__decorate([l(cc.Node)],e.prototype,"background01",void 0),__decorate([l(cc.Node)],e.prototype,"background02",void 0),__decorate([l(cc.Prefab)],e.prototype,"wallTopDecoration",void 0),__decorate([l(cc.Prefab)],e.prototype,"wallBottomDecoration",void 0),__decorate([l(cc.Prefab)],e.prototype,"wallLeftDecoration",void 0),__decorate([l(cc.Prefab)],e.prototype,"doorDecoration",void 0),e=__decorate([c],e)}(cc.Component);o.default=h,cc._RF.pop()},{"../Building/Door":"Door","../Data/DungeonStyleData":"DungeonStyleData","../Dungeon":"Dungeon","../Logic":"Logic"}],Dungeon:[function(t,e,o){"use strict";cc._RF.push(e,"6dd52klzMJJgafrk2kw2YVi","Dungeon"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("./Player"),a=t("./Tile"),n=t("./Logic"),s=t("./EventConstant"),r=t("./Manager/MonsterManager"),c=t("./Building/Portal"),l=t("./Building/Wall"),h=t("./Building/Trap"),p=t("./Manager/EquipmentManager"),d=t("./Manager/DungeonStyleManager"),u=t("./Rect/RectRoom"),m=t("./Rect/RectDungeon"),y=t("./Building/Chest"),f=t("./Building/ShopTable"),g=t("./Manager/CoinManager"),v=t("./Building/Box"),_=t("./Building/FootBoard"),E=t("./HealthBar"),D=t("./Building/FallStone"),R=cc._decorator,C=R.ccclass,M=R.property,S=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.tile=null,e.wall=null,e.trap=null,e.fallStone=null,e.footboard=null,e.chest=null,e.box=null,e.heart=null,e.ammo=null,e.shop=null,e.shoptable=null,e.floorDecoration=null,e.player=null,e.portalPrefab=null,e.portal=null,e.fog=null,e.bossHealthBar=null,e.map=new Array,e.wallmap=new Array,e.trapmap=new Array,e.footboards=new Array,e.timeDelay=0,e.npcTimeDelay=0,e.monsterReswpanPoints={},e.monsterManager=null,e.equipmentManager=null,e.dungeonStyleManager=null,e.coinManager=null,e}var o;return __extends(e,t),o=e,e.prototype.onLoad=function(){var t=this;this.anim=this.getComponent(cc.Animation),cc.director.on(s.EventConstant.PLAYER_MOVE,function(e){t.playerAction(e.detail.dir,e.detail.pos,e.detail.dt)}),cc.director.on(s.EventConstant.DUNGEON_SETEQUIPMENT,function(e){t.addEquipment(e.detail.equipmentData.img,e.detail.pos,e.detail.equipmentData)}),cc.director.on(s.EventConstant.DUNGEON_ADD_COIN,function(e){t.addCoin(e.detail.pos,e.detail.count)}),cc.director.on(s.EventConstant.DUNGEON_ADD_HEART,function(e){t.addHeart(e.detail.pos)}),cc.director.on(s.EventConstant.DUNGEON_ADD_FALLSTONE,function(e){t.addFallStone(e.detail.pos,e.detail.isAuto)}),cc.director.on(s.EventConstant.DUNGEON_ADD_AMMO,function(e){t.addAmmo(e.detail.pos)}),cc.director.on(s.EventConstant.DUNGEON_SHAKEONCE,function(e){t.anim&&t.anim.play("DungeonShakeOnce")}),this.fog.zIndex=9e3;var e=n.default.getCurrentMapData().map;this.monsterManager=this.getComponent(r.default),this.equipmentManager=this.getComponent(p.default),this.coinManager=this.getComponent(g.default),this.dungeonStyleManager=this.getComponent(d.default),this.dungeonStyleManager.addDecorations(),this.player.node.parent=this.node,this.monsters=new Array,this.map=new Array,this.wallmap=new Array,this.trapmap=new Array,this.footboards=new Array;for(var i=new Array,E=new Array,D=0;D<o.WIDTH_SIZE;D++){this.map[D]=new Array(D),this.wallmap[D]=new Array(D),this.trapmap[D]=new Array(D);for(var R=0;R<o.HEIGHT_SIZE;R++){var C=cc.instantiate(this.tile);if(C.parent=this.node,C.position=o.getPosInMap(cc.v2(D,R)),C.zIndex=1e3+100*(o.HEIGHT_SIZE-R),this.map[D][R]=C.getComponent(a.default),this.map[D][R].isAutoShow=!1,"#"==e[D][R]&&(this.map[D][R].isAutoShow=!0),"W"==e[D][R]){var M=cc.instantiate(this.wall);M.parent=this.node,M.position=o.getPosInMap(cc.v2(D,R)),M.zIndex=3e3+100*(o.HEIGHT_SIZE-R),M.opacity=255,this.wallmap[D][R]=M.getComponent(l.default)}if("T"==e[D][R]){var S=cc.instantiate(this.trap);S.parent=this.node,S.position=o.getPosInMap(cc.v2(D,R)),S.zIndex=3e3+100*(o.HEIGHT_SIZE-R),this.trapmap[D][R]=S.getComponent(h.default)}if("D"==e[D][R]&&this.addFallStone(o.getPosInMap(cc.v2(D,R)),!1),"+"==e[D][R]){var P=cc.instantiate(this.floorDecoration);P.parent=this.node,P.position=o.getPosInMap(cc.v2(D,R)),P.zIndex=2e3+100*(o.HEIGHT_SIZE-R)}if("F"==e[D][R]){var T=cc.instantiate(this.footboard);T.parent=this.node,T.position=o.getPosInMap(cc.v2(D,R)),T.zIndex=3e3+100*(o.HEIGHT_SIZE-R),this.footboards.push(T.getComponent(_.default))}if("C"==e[D][R]){var O=cc.instantiate(this.chest);O.parent=this.node;var A=O.getComponent(y.default);A.setPos(cc.v2(D,R)),A.setQuality(n.default.getRandomNum(1,3),n.default.mapManger.currentRectRoom.state==u.default.STATE_CLEAR)}if("B"==e[D][R]){var b,L;(b=cc.instantiate(this.box)).parent=this.node,(L=b.getComponent(v.default)).data.defaultPos=cc.v2(D,R),L.setPos(cc.v2(D,R));var x=n.default.getCurrentMapBoxes();if(x)for(var I=0,k=x;I<k.length;I++){var F=k[I];F.defaultPos.equals(L.data.defaultPos)&&(L.setPos(F.pos),L.node.position=F.position.clone())}else i.push(L.data)}if("G"==e[D][R])(b=cc.instantiate(this.box)).parent=this.node,(L=b.getComponent(v.default)).data.defaultPos=cc.v2(D,R),L.setPos(cc.v2(D,R)),L.changeRes("plant");if("H"==e[D][R]){var N=cc.instantiate(this.heart);N.parent=this.node,N.position=o.getPosInMap(cc.v2(D,R)),N.zIndex=3e3+100*(o.HEIGHT_SIZE-R)+3}if("A"==e[D][R]){var H=cc.instantiate(this.ammo);H.parent=this.node,H.position=o.getPosInMap(cc.v2(D,R)),H.zIndex=3e3+100*(o.HEIGHT_SIZE-R)+3}if("M"==e[D][R]){var B=cc.instantiate(this.shoptable);B.parent=this.node;var w=B.getComponent(f.default);w.setPos(cc.v2(D,R));var q=n.default.getCurrentMapShopTables();if(q)for(var G=0,V=q;G<V.length;G++){var Z=V[G];Z.pos.equals(w.data.pos)&&(w.data.equipdata=Z.equipdata.clone(),w.data.isSaled=Z.isSaled,w.data.price=Z.price)}else E.push(w.data);w.showItem()}if("S"==e[D][R]){var K=cc.instantiate(this.shop);K.parent=this.node,K.position=o.getPosInMap(cc.v2(D,R)),K.zIndex=3e3+100*(o.HEIGHT_SIZE-R)+1}if(n.default.mapManger.currentRectRoom.state!=u.default.STATE_CLEAR){if("s"==e[D][R]){var W=n.default.getHalfChance()?r.default.MONSTER_SAILOR:r.default.MONSTER_STRONGSAILOR;this.addMonsterFromData(W,D,R)}"p"==e[D][R]&&this.addMonsterFromData(r.default.MONSTER_PIRATE,D,R),"o"==e[D][R]&&this.addMonsterFromData(r.default.MONSTER_OCTOPUS,D,R),"a"==e[D][R]&&this.addMonsterFromData(r.default.MONSTER_SLIME,D,R),"g"==e[D][R]&&this.addMonsterFromData(r.default.MONSTER_GOBLIN,D,R),"d"==e[D][R]&&this.addMonsterFromData(r.default.MONSTER_ANUBIS,D,R),"m"==e[D][R]&&this.addMonsterFromData(r.default.MONSTER_MUMMY,D,R),"k"==e[D][R]&&this.addMonsterFromData(r.default.MONSTER_KILLER,D,R),"b"==e[D][R]&&(this.bossIndex=cc.v2(D,R))}if("P"==e[D][R]){var z=!0;if(n.default.level!=m.default.LEVEL_5&&n.default.level!=m.default.LEVEL_3||n.default.mapManger.currentRectRoom.roomType!=m.default.END_ROOM||(z=!1),z){var Y=cc.instantiate(this.portalPrefab);Y.parent=this.node,this.portal=Y.getComponent(c.default),this.portal&&this.portal.setPos(cc.v2(D,R))}}}}!n.default.getCurrentMapBoxes()&&i.length>0&&n.default.mapManger.setCurrentBoxesArr(i),!n.default.getCurrentMapShopTables()&&E.length>0&&n.default.mapManger.setCurrentShopTableArr(E),this.addBoss()},e.prototype.addHeart=function(t){if(this.heart){var e=cc.instantiate(this.heart);e.parent=this.node,e.position=t;var i=o.getIndexInMap(t);e.zIndex=3e3+100*(o.HEIGHT_SIZE-i.y)+3}},e.prototype.addFallStone=function(t,e){if(this.fallStone){var i=cc.instantiate(this.fallStone),a=i.getComponent(D.default);a.isAuto=e,i.parent=this.node,i.position=t;var n=o.getIndexInMap(t);i.zIndex=2e3+100*(o.HEIGHT_SIZE-n.y)+3,a.isAuto&&a.fall()}},e.prototype.addAmmo=function(t){if(this.ammo){var e=cc.instantiate(this.ammo);e.parent=this.node,e.position=t;var i=o.getIndexInMap(t);e.zIndex=3e3+100*(o.HEIGHT_SIZE-i.y)+3}},e.prototype.addCoin=function(t,e){this.coinManager&&this.coinManager.getValueCoin(e,t,this.node)},e.prototype.addEquipment=function(t,e,o,i,a){this.equipmentManager&&this.equipmentManager.getEquipment(t,e,this.node,o,i,a)},e.prototype.addMonsterFromData=function(t,e,o){this.addMonster(this.monsterManager.getMonster(t,this),cc.v2(e,o))},e.prototype.breakHalfTiles=function(){for(var t=this,e=function(e){for(var a=function(o){i.map[e][o].isAutoShow=!1,i.breakTile(cc.v2(e,o)),setTimeout(function(){t.breakTile(cc.v2(e,o))},100*Math.random())},n=6;n<o.HEIGHT_SIZE;n++)a(n)},i=this,a=0;a<o.WIDTH_SIZE;a++)e(a)},e.prototype.addBoss=function(){this.bossIndex&&(n.default.mapManger.currentRectRoom.roomType==m.default.BOSS_ROOM?this.addBossKraken():this.addBossCaptain())},e.prototype.addBossCaptain=function(){this.bossCaptain=this.monsterManager.getCaptain(this,this.bossIndex)},e.prototype.addBossKraken=function(){var t=this;this.bossKraken=this.monsterManager.getKraken(this,this.bossIndex),this.anim.playAdditive("DungeonShakeOnce"),setTimeout(function(){t.anim.playAdditive("DungeonShakeOnce")},1e3),setTimeout(function(){t.anim.playAdditive("DungeonShakeOnce")},2e3),this.breakHalfTiles(),setTimeout(function(){t.bossKraken.showBoss(),t.anim.play("DungeonWave")},3500)},e.prototype.addMonster=function(t,e){t.node.active=!0,t.pos=e,t.node.position=o.getPosInMap(e),this.monsters.push(t)},e.getPosInMap=function(t){var e=o.MAPX+t.x*o.TILE_SIZE,i=o.MAPY+t.y*o.TILE_SIZE;return cc.v2(e,i)},e.getIndexInMap=function(t,e){var i=(t.x-o.MAPX)/o.TILE_SIZE,a=(t.y-o.MAPY)/o.TILE_SIZE;return i=Math.round(i),a=Math.round(a),e||(i<0&&(i=0),i>=o.WIDTH_SIZE&&(i=o.WIDTH_SIZE-1),a<0&&(a=0),a>=o.HEIGHT_SIZE&&(a=o.HEIGHT_SIZE-1)),cc.v2(i,a)},e.fixOuterMap=function(t){var e=(t.x-o.MAPX)/o.TILE_SIZE,i=(t.y-o.MAPY)/o.TILE_SIZE;e=Math.round(e),i=Math.round(i);var a=!1;return e<0&&(e=0,a=!0),e>=o.WIDTH_SIZE&&(e=o.WIDTH_SIZE-1,a=!0),i<0&&(i=0,a=!0),i>=o.HEIGHT_SIZE&&(i=o.HEIGHT_SIZE-1,a=!0),a?o.getPosInMap(cc.v2(e,i)):t},e.prototype.start=function(){cc.director.emit(s.EventConstant.CHANGE_MIMIMAP,{detail:{x:n.default.mapManger.currentRectRoom.x,y:n.default.mapManger.currentRectRoom.y}});for(var t=0,e=n.default.mapManger.currentRectRoom.doors;t<e.length;t++){var o=e[t];this.dungeonStyleManager.setDoor(o.dir,o.isDoor,!1)}},e.prototype.breakTile=function(t){var e=this.map[t.x][t.y];e.isBroken||e.breakTile()},e.prototype.playerAction=function(t,e,o){this.player&&this.player.playerAction(t,e,o,this)},e.prototype.monstersAction=function(){for(var t=!1,e=0,o=0,i=this.monsters;o<i.length;o++){i[o].isDied&&e++}t=e>=this.monsters.length,this.bossKraken&&!this.bossKraken.isDied&&(t=!1),this.bossCaptain&&!this.bossCaptain.isDied&&(t=!1);for(var a=0,n=this.footboards;a<n.length;a++){n[a].isOpen||(t=!1)}t&&(this.portal&&this.portal.openGate(),this.openDoors())},e.prototype.openDoors=function(){for(var t=0,e=n.default.mapManger.currentRectRoom.doors;t<e.length;t++){var o=e[t];n.default.mapManger.currentRectRoom.state=u.default.STATE_CLEAR;var i=!1;if(m.default.isRoomEqual(n.default.mapManger.currentRectRoom,n.default.mapManger.rectDungeon.startRoom))if(n.default.mapManger.rectDungeon.endRoom.state!=u.default.STATE_CLEAR)n.default.mapManger.rectDungeon.getNeighborRoomType(n.default.mapManger.currentRectRoom.x,n.default.mapManger.currentRectRoom.y,o.dir).roomType==m.default.END_ROOM&&n.default.level!=m.default.LEVEL_5&&n.default.level!=m.default.LEVEL_3&&(i=!0);1==n.default.level&&(i=!1),i||this.dungeonStyleManager.setDoor(o.dir,o.isDoor,!0)}},e.prototype.checkPlayerPos=function(t){this.fog.setPosition(this.lerp(this.fog.position,this.player.node.position,3*t));var e=o.getIndexInMap(this.player.node.position),i=this.map[e.x][e.y];i.isBroken&&this.player.fall(),i.isAutoShow&&this.breakTile(e)},e.prototype.lerp=function(t,e,o){var i=cc.v2(0,0),a=t.x,n=t.y;return i.x=a+(e.x-a)*o,i.y=n+(e.y-n)*o,i},e.prototype.checkMonstersPos=function(){for(var t=0,e=this.monsters;t<e.length;t++){var o=e[t];if(o.isDied)return;this.map[o.pos.x][o.pos.y].isBroken&&o.fall()}},e.prototype.isTimeDelay=function(t){return this.timeDelay+=t,this.timeDelay>.016&&(this.timeDelay=0,!0)},e.prototype.isNpcTimeDelay=function(t){return this.npcTimeDelay+=t,this.npcTimeDelay>1&&(this.npcTimeDelay=0,!0)},e.prototype.update=function(t){this.isTimeDelay(t)&&this.checkPlayerPos(t),this.isNpcTimeDelay(t)&&(this.monstersAction(),this.bossKraken&&this.bossKraken.bossAction(this))},e.WIDTH_SIZE=15,e.HEIGHT_SIZE=9,e.MAPX=32,e.MAPY=32,e.TILE_SIZE=64,__decorate([M(cc.Prefab)],e.prototype,"tile",void 0),__decorate([M(cc.Prefab)],e.prototype,"wall",void 0),__decorate([M(cc.Prefab)],e.prototype,"trap",void 0),__decorate([M(cc.Prefab)],e.prototype,"fallStone",void 0),__decorate([M(cc.Prefab)],e.prototype,"footboard",void 0),__decorate([M(cc.Prefab)],e.prototype,"chest",void 0),__decorate([M(cc.Prefab)],e.prototype,"box",void 0),__decorate([M(cc.Prefab)],e.prototype,"heart",void 0),__decorate([M(cc.Prefab)],e.prototype,"ammo",void 0),__decorate([M(cc.Prefab)],e.prototype,"shop",void 0),__decorate([M(cc.Prefab)],e.prototype,"shoptable",void 0),__decorate([M(cc.Prefab)],e.prototype,"floorDecoration",void 0),__decorate([M(i.default)],e.prototype,"player",void 0),__decorate([M(cc.Prefab)],e.prototype,"portalPrefab",void 0),__decorate([M(cc.Node)],e.prototype,"fog",void 0),__decorate([M(E.default)],e.prototype,"bossHealthBar",void 0),e=o=__decorate([C],e)}(cc.Component);o.default=S,cc._RF.pop()},{"./Building/Box":"Box","./Building/Chest":"Chest","./Building/FallStone":"FallStone","./Building/FootBoard":"FootBoard","./Building/Portal":"Portal","./Building/ShopTable":"ShopTable","./Building/Trap":"Trap","./Building/Wall":"Wall","./EventConstant":"EventConstant","./HealthBar":"HealthBar","./Logic":"Logic","./Manager/CoinManager":"CoinManager","./Manager/DungeonStyleManager":"DungeonStyleManager","./Manager/EquipmentManager":"EquipmentManager","./Manager/MonsterManager":"MonsterManager","./Player":"Player","./Rect/RectDungeon":"RectDungeon","./Rect/RectRoom":"RectRoom","./Tile":"Tile"}],EquipmentData:[function(t,e,o){"use strict";cc._RF.push(e,"a5970exQi1ISK2QZd4VAwv9","EquipmentData"),Object.defineProperty(o,"__esModule",{value:!0});var i=function(){function t(){this.nameCn="",this.nameEn="",this.equipmetType="empty",this.equipmetTypeCn="",this.prefix="",this.desc="",this.damageMin=0,this.damageMax=0,this.criticalStrikeRate=0,this.defence=0,this.lifeDrain=0,this.lifeRecovery=0,this.moveSpeed=0,this.attackSpeed=0,this.dodge=0,this.health=0,this.color="#ffffff",this.titlecolor="#ffffff",this.img="emptyequipment",this.level=0,this.stab=0,this.far=0,this.isLocked=0,this.trouserslong=0}return t.prototype.valueCopy=function(t){this.nameCn=t.nameCn?t.nameCn:this.nameCn,this.nameEn=t.nameEn,this.equipmetType=t.equipmetType,this.equipmetTypeCn=t.equipmetTypeCn,this.prefix=t.prefix,this.desc=t.desc,this.damageMin=t.damageMin,this.damageMax=t.damageMax,this.criticalStrikeRate=t.criticalStrikeRate,this.defence=t.defence,this.lifeDrain=t.lifeDrain,this.lifeRecovery=t.lifeRecovery,this.moveSpeed=t.moveSpeed,this.attackSpeed=t.attackSpeed,this.dodge=t.dodge,this.health=t.health,this.color=t.color,this.titlecolor=t.titlecolor,this.img=t.img,this.stab=t.stab,this.far=t.far,this.isLocked=t.isLocked,this.level=t.level,this.trouserslong=t.trouserslong},t.prototype.clone=function(){var e=new t;return e.nameCn=this.nameCn,e.nameEn=this.nameEn,e.equipmetType=this.equipmetType,e.equipmetTypeCn=this.equipmetTypeCn,e.prefix=this.prefix,e.desc=this.desc,e.damageMin=this.damageMin,e.damageMax=this.damageMax,e.criticalStrikeRate=this.criticalStrikeRate,e.defence=this.defence,e.lifeDrain=this.lifeDrain,e.lifeRecovery=this.lifeRecovery,e.moveSpeed=this.moveSpeed,e.attackSpeed=this.attackSpeed,e.dodge=this.dodge,e.health=this.health,e.color=this.color,e.titlecolor=this.titlecolor,e.img=this.img,e.stab=this.stab,e.far=this.far,e.isLocked=this.isLocked,e.level=this.level,e.trouserslong=this.trouserslong,e},t}();o.default=i,cc._RF.pop()},{}],EquipmentDescData:[function(t,e,o){"use strict";cc._RF.push(e,"d7742jFusdGiIE+18obcC2k","EquipmentDescData"),Object.defineProperty(o,"__esModule",{value:!0});var i=function(){return function(){this.nameCn="",this.nameEn="",this.damageMin=0,this.damageMax=0,this.criticalStrikeRate=0,this.defence=0,this.lifeDrain=0,this.lifeRecovery=0,this.moveSpeed=0,this.attackSpeed=0,this.dodge=0,this.health=0,this.titlecolor="#ffffff",this.color="#ffffff",this.prefix="",this.level=0}}();o.default=i,cc._RF.pop()},{}],EquipmentDialog:[function(t,e,o){"use strict";cc._RF.push(e,"9bf82hBG9BGv4V/KYPwSFw+","EquipmentDialog"),Object.defineProperty(o,"__esModule",{value:!0});var i=cc._decorator,a=i.ccclass,n=i.property,s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.nametag=null,e.desc=null,e.damage=null,e.criticalStrikeRate=null,e.defence=null,e.lifeDrain=null,e.moveSpeed=null,e.attackSpeed=null,e.dodge=null,e.health=null,e.lifeRecovery=null,e.alpha=0,e.showSpeed=3,e}return __extends(e,t),e.prototype.start=function(){this.alpha=0,this.node.opacity=0,this.showSpeed=30},e.prototype.refreshDialog=function(t){this.nametag.string=t.prefix+" "+t.nameEn,this.nametag.node.color=this.nametag.node.color.fromHEX(t.titlecolor),this.desc.string=t.desc,this.damage.string=t.damageMin+"-"+t.damageMax,this.attackSpeed.string=t.attackSpeed+"%",this.moveSpeed.string=t.moveSpeed+"%",this.dodge.string=t.dodge+"%",this.lifeDrain.string=t.lifeDrain+"%",this.lifeRecovery.string=t.lifeRecovery+"",this.health.string=t.health+"",this.defence.string=t.defence+"",this.criticalStrikeRate.string=t.criticalStrikeRate+"%"},e.prototype.showDialog=function(){this.showSpeed=3,this.node.opacity=255},e.prototype.hideDialog=function(){this.showSpeed=30,this.node.opacity=0},e.prototype.update=function(t){},e.prototype.lerp=function(t,e,o){return t+(e-t)*o},__decorate([n(cc.Label)],e.prototype,"nametag",void 0),__decorate([n(cc.Label)],e.prototype,"desc",void 0),__decorate([n(cc.Label)],e.prototype,"damage",void 0),__decorate([n(cc.Label)],e.prototype,"criticalStrikeRate",void 0),__decorate([n(cc.Label)],e.prototype,"defence",void 0),__decorate([n(cc.Label)],e.prototype,"lifeDrain",void 0),__decorate([n(cc.Label)],e.prototype,"moveSpeed",void 0),__decorate([n(cc.Label)],e.prototype,"attackSpeed",void 0),__decorate([n(cc.Label)],e.prototype,"dodge",void 0),__decorate([n(cc.Label)],e.prototype,"health",void 0),__decorate([n(cc.Label)],e.prototype,"lifeRecovery",void 0),e=__decorate([a],e)}(cc.Component);o.default=s,cc._RF.pop()},{}],EquipmentManager:[function(t,e,o){"use strict";cc._RF.push(e,"29c053rRnlLqrw1VkMXkISC","EquipmentManager"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("../Dungeon"),a=t("../Logic"),n=t("../Data/EquipmentData"),s=t("../Data/EquipmentDescData"),r=t("../Equipment/Equipment"),c=cc._decorator,l=c.ccclass,h=c.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.equipment=null,e}var o;return __extends(e,t),o=e,e.prototype.onLoad=function(){},e.prototype.getRandomDesc=function(t,e){var i=new s.default,a=0,n=this.getRandomQuality(0,100-t.criticalStrikeRate,e);a=n.y>a?n.y:a,i.prefix+=n.y>2?"criticalstrike ":"",i.color=this.getMixColor("#000000",n.y>2?o.COLOR_CRITICALSTRIKE:"#000000");var r=this.getRandomQuality(0,5,e);a=r.y>a?r.y:a;var c=this.getRandomQuality(r.x,r.x+5,e);a=c.y>a?c.y:a,i.prefix+=c.y>2?"strong ":"",i.color=this.getMixColor(i.color,c.y>2?o.COLOR_POWERFUL:"#000000");var l=this.getRandomQuality(0,5,e);a=l.y>a?l.y:a,i.prefix+=l.y>2?"stable ":"",i.color=this.getMixColor(i.color,l.y>2?o.COLOR_STABLE:"#000000");var h=this.getRandomQuality(0,100,e);a=h.y>a?h.y:a,i.prefix+=h.y>2?"drain ":"",i.color=this.getMixColor(i.color,h.y>2?o.COLOR_LIFEDRAIN:"#000000");var p=Math.random()<.1?this.getRandomQuality(0,5,e):cc.v2(0,0);a=p.y>a?p.y:a,i.prefix+=p.y>2?"recovery ":"",i.color=this.getMixColor(i.color,p.y>2?o.COLOR_RECOVERY:"#000000");var d=this.getRandomQuality(0,300-t.moveSpeed,e);a=d.y>a?d.y:a,i.prefix+=d.y>2?"fast ":"",i.color=this.getMixColor(i.color,d.y>2?o.COLOR_MOVESPEED:"#000000");var u=this.getRandomQuality(0,400-t.attackSpeed,e);a=u.y>a?u.y:a,i.prefix+=u.y>2?"quick ":"",i.color=this.getMixColor(i.color,u.y>2?o.COLOR_ATTACKSPPED:"#000000");var m=this.getRandomQuality(0,60-t.dodge,e);a=m.y>a?m.y:a,i.prefix+=m.y>2?"agile ":"",i.color=this.getMixColor(i.color,m.y>2?o.COLOR_DODGE:"#000000");var y=this.getRandomQuality(0,5,e);return a=y.y>a?y.y:a,i.prefix+=y.y>2?"healthy ":"",i.color=this.getMixColor(i.color,y.y>2?o.COLOR_HEALTHY:"#000000"),i.prefix=["rough","normal","good","excellent","epic","legend"][a]+" "+i.prefix,i.titlecolor=["#dcdcdc","#ffffff","#00ff00","#0000ff","#800080","#ffa500"][a],i.level=a,i.color="#000000"==i.color?"#ffffff":i.color,i.criticalStrikeRate=n.x,i.damageMin=r.x,i.damageMax=c.x,i.defence=l.x,i.lifeDrain=h.x,i.lifeRecovery=p.x,i.moveSpeed=d.x,i.attackSpeed=u.x,i.dodge=m.x,i.health=y.x,i},e.prototype.getRandomQuality=function(t,e,o){var i=(e-t)/5,n=Math.random();if(o&&n>.9)switch(o){case 1:n=Math.random()>.7?.5:.004;break;case 2:n=Math.random()>.7?.06:.08;break;case 3:n=Math.random()>.7?.086:.09}var s=cc.v2(0,0);return n<.005?(s.x=a.default.getRandomNum(0,i),s.y=1):n>=.05&&n<.075?(s.x=a.default.getRandomNum(i,2*i),s.y=2):n>=.075&&n<.085?(s.x=a.default.getRandomNum(2*i,3*i),s.y=3):n>=.085&&n<.09?(s.x=a.default.getRandomNum(3*i,4*i),s.y=4):n>=.09&&n<.091&&(s.x=a.default.getRandomNum(4*i,5*i),s.y=5),s.x=parseFloat(s.x.toFixed(0)),s},e.prototype.getEquipment=function(t,e,o,s,c,l){var h=cc.instantiate(this.equipment);h.parent=o,h.position=i.default.getPosInMap(e),h.zIndex=3e3+100*(i.default.HEIGHT_SIZE-e.y)+3;var p=h.getComponent(r.default);if(p.pos=e,s)l&&(p.shopTable=l,l.data.equipdata=s.clone(),l.data.price=15*(s.level+1)),p.refresh(s);else{var d=new n.default;d.valueCopy(a.default.equipments[t]);var u=this.getRandomDesc(d,c);d.criticalStrikeRate=u.criticalStrikeRate,d.damageMin+=u.damageMin,d.damageMax+=u.damageMax,d.defence+=u.defence,d.lifeDrain+=u.lifeDrain,d.lifeRecovery+=u.lifeRecovery,d.moveSpeed+=u.moveSpeed,d.attackSpeed+=u.attackSpeed,d.dodge+=u.dodge,d.health+=u.health,d.prefix=u.prefix,d.titlecolor=u.titlecolor,"#ffffff"!=u.color&&(d.color=u.color),d.level=u.level,l&&(p.shopTable=l,l.data.equipdata=d.clone(),l.data.price=15*(u.level+1)),p.refresh(d)}return p},e.prototype.start=function(){},e.prototype.getMixColor=function(t,e){var o=cc.color().fromHEX(t),i=cc.color().fromHEX(e),a=cc.color(),n=o.getR()+i.getR(),s=o.getG()+i.getG(),r=o.getB()+i.getB();return a.setR(n>255?255:n),a.setG(s>255?255:s),a.setB(r>255?255:r),"#"+a.toHEX("#rrggbb")},e.EMPTY="emptyequipment",e.WEAPON_KNIFE="weapon001",e.WEAPON_CHOPPER="weapon002",e.WEAPON_HUGEBLADE="weapon003",e.WEAPON_PITCHFORK="weapon004",e.CLOTHES_VEST="clothes001",e.CLOTHES_SHIRT="clothes002",e.CLOTHES_NAVY="clothes003",e.CLOTHES_PIRATE="clothes004",e.CLOTHES_BUCKET="clothes005",e.CLOTHES_REDROBE="clothes006",e.CLOTHES_WHITEROBE="clothes007",e.HELMET_BUCKETHAT="helmet002",e.HELMET_PIRATEHAT="helmet003",e.HELMET_REDHAT="helmet004",e.HELMET_WHITEHAT="helmet005",e.CLOAK_WARRIOR="cloak001",e.TROUSERS_LONG="trousers001",e.TROUSERS_SHORT="trousers002",e.GLOVES_WARRIOR="gloves001",e.GLOVES_DEMON="gloves002",e.GLOVES_BLOODCRAW="gloves003",e.SHOES_WARRIOR="shoes001",e.SHOES_SKATEBOARD="shoes002",e.SHOES_DEMON="shoes003",e.equipments=[o.WEAPON_KNIFE,o.WEAPON_CHOPPER,o.WEAPON_HUGEBLADE,o.CLOTHES_SHIRT,o.CLOTHES_VEST,o.CLOTHES_NAVY,o.CLOTHES_PIRATE,o.CLOTHES_BUCKET,o.CLOTHES_REDROBE,o.CLOTHES_WHITEROBE,o.HELMET_BUCKETHAT,o.HELMET_PIRATEHAT,o.HELMET_REDHAT,o.HELMET_WHITEHAT,o.WEAPON_PITCHFORK,o.CLOAK_WARRIOR,o.TROUSERS_LONG,o.TROUSERS_SHORT,o.GLOVES_WARRIOR,o.SHOES_WARRIOR,o.SHOES_DEMON,o.SHOES_SKATEBOARD,o.GLOVES_BLOODCRAW,o.GLOVES_DEMON],e.COLOR_CRITICALSTRIKE="#DC143C",e.COLOR_ATTACKSPPED="#5F9EA0",e.COLOR_MOVESPEED="#00BFFF",e.COLOR_DODGE="#FFFF00",e.COLOR_STABLE="#DEB887",e.COLOR_POWERFUL="#9370DB",e.COLOR_HEALTHY="#90EE90",e.COLOR_LIFEDRAIN="#FFC0CB",e.COLOR_RECOVERY="#ADFF2F",__decorate([h(cc.Prefab)],e.prototype,"equipment",void 0),e=o=__decorate([l],e)}(cc.Component);o.default=p,cc._RF.pop()},{"../Data/EquipmentData":"EquipmentData","../Data/EquipmentDescData":"EquipmentDescData","../Dungeon":"Dungeon","../Equipment/Equipment":"Equipment","../Logic":"Logic"}],Equipment:[function(t,e,o){"use strict";cc._RF.push(e,"46d3aM6X2VOCJtzuWiGZaWE","Equipment"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("../Logic"),a=t("./EquipmentDialog"),n=t("../Data/EquipmentData"),s=t("../EventConstant"),r=t("../Player"),c=cc._decorator,l=c.ccclass,h=c.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.data=new n.default,e.equipmentDialog=null,e.pos=cc.v2(0,0),e.isTaken=!1,e}return __extends(e,t),e.prototype.onLoad=function(){this.isTaken=!1,this.sprite=this.node.getChildByName("sprite")},e.prototype.refresh=function(t){this.data.valueCopy(t),this.equipmentDialog.refreshDialog(this.data);var e=i.default.spriteFrames[this.data.img];"trousers"==t.equipmetType&&(e=1==t.trouserslong?i.default.spriteFrames.idle002:i.default.spriteFrames.idle001),this.sprite.getComponent(cc.Sprite).spriteFrame=e,this.sprite.width=e.getRect().width,this.sprite.height=e.getRect().height;var o=cc.color(255,255,255).fromHEX(this.data.color);this.sprite.color=o},e.prototype.start=function(){this.anim=this.getComponent(cc.Animation)},e.prototype.onEnable=function(){},e.prototype.taken=function(){var t=this;this.isTaken=!0,this.anim.play("EquipmentTaken"),cc.director.emit(s.EventConstant.PLAYER_CHANGEEQUIPMENT,{detail:{equipData:this.data}}),this.node.getChildByName("shadow").active=!1,this.equipmentDialog.node.active=!1,setTimeout(function(){t.node&&t.destroy()},1e3)},e.prototype.onBeginContact=function(t,e,o){o.body.node.getComponent(r.default)&&this.equipmentDialog.showDialog()},e.prototype.onEndContact=function(t,e,o){o.body.node.getComponent(r.default)&&this.equipmentDialog.hideDialog()},__decorate([h(a.default)],e.prototype,"equipmentDialog",void 0),e=__decorate([l],e)}(cc.Component);o.default=p,cc._RF.pop()},{"../Data/EquipmentData":"EquipmentData","../EventConstant":"EventConstant","../Logic":"Logic","../Player":"Player","./EquipmentDialog":"EquipmentDialog"}],EventConstant:[function(t,e,o){"use strict";cc._RF.push(e,"4128feS00VLAILEQToHDge5","EventConstant"),Object.defineProperty(o,"__esModule",{value:!0});var i=cc._decorator,a=i.ccclass,n=(i.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.PLAYER_MOVE="PLAYER_MOVE",e.PLAYER_ROTATE="PLAYER_ROTATE",e.PLAYER_USEITEM="PLAYER_USEITEM",e.PLAYER_ATTACK="PLAYER_ATTACK",e.PLAYER_REMOTEATTACK="PLAYER_REMOTEATTACK",e.PLAYER_GETITEM="PLAYER_GETITEM",e.PLAYER_TAKEDAMAGE="PLAYER_TAKEDAMAGE",e.INVENTORY_CHANGEITEM="INVENTORY_CHANGEITEM",e.PLAYER_CHANGEWEAPON="PLAYER_CHANGEWEAPON",e.PLAYER_CHANGEEQUIPMENT="PLAYER_CHANGEEQUIPMENT",e.LOADINGNEXTLEVEL="LOADINGNEXTLEVEL",e.CHANGE_MIMIMAP="CHANGE_MIMIMAP",e.LOADINGROOM="LOADINGROOM",e.DUNGEON_SETEQUIPMENT="DUNGEON_SETEQUIPMENT",e.DUNGEON_SHAKEONCE="DUNGEON_SHAKEONCE",e.HUD_ADD_COIN="HUD_ADD_COIN",e.DUNGEON_ADD_COIN="DUNGEON_ADD_COIN",e.DUNGEON_ADD_HEART="DUNGEON_ADD_HEART",e.DUNGEON_ADD_AMMO="DUNGEON_ADD_AMMO",e.DUNGEON_ADD_FALLSTONE="DUNGEON_ADD_FALLSTONE",e.eventHandler=new cc.Node,e=__decorate([a],e)}(cc.Component));o.EventConstant=n,cc._RF.pop()},{}],FallStone:[function(t,e,o){"use strict";cc._RF.push(e,"606fd8guh5COozFgkmej6tZ","FallStone"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("../Player"),a=t("../EventConstant"),n=cc._decorator,s=n.ccclass,r=(n.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isFall=!1,e.isAuto=!0,e.isFalling=!1,e}return __extends(e,t),e.prototype.onLoad=function(){this.isFall=!1},e.prototype.fall=function(){this.anim=this.getComponent(cc.Animation),this.anim.play(),this.isFalling=!0},e.prototype.FallFinish=function(){var t=this;this.isFall=!0,setTimeout(function(){t.isFall=!1},100),setTimeout(function(){t.node&&t.node.destroy()},2e3)},e.prototype.start=function(){},e.prototype.onCollisionEnter=function(t,e){!t.getComponent(i.default)||this.isAuto||this.isFalling||this.fall()},e.prototype.onCollisionStay=function(t,e){t.getComponent(i.default)&&this.isFall&&this.isValid&&(this.isFall=!1,cc.director.emit(a.EventConstant.PLAYER_TAKEDAMAGE,{detail:{damage:2}}))},e=__decorate([s],e)}(cc.Component));o.default=r,cc._RF.pop()},{"../EventConstant":"EventConstant","../Player":"Player"}],FootBoard:[function(t,e,o){"use strict";cc._RF.push(e,"a20d6iwPAJLg7AtbBgYX0yS","FootBoard"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("../Dungeon"),a=t("../Player"),n=t("./Box"),s=cc._decorator,r=s.ccclass,c=s.property,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.openSpriteFrame=null,e.closeSpriteFrame=null,e.isOpen=!1,e.pos=cc.v2(0,0),e.timeDelay=0,e}return __extends(e,t),e.prototype.onLoad=function(){this.spriteNode=this.node.getChildByName("sprite"),this.sprite=this.spriteNode.getComponent(cc.Sprite)},e.prototype.start=function(){},e.prototype.setPos=function(t){this.pos=t,this.node.position=i.default.getPosInMap(t),this.node.zIndex=3e3+100*(i.default.HEIGHT_SIZE-t.y)+1},e.prototype.openTrap=function(){this.isOpen||(this.isOpen=!0,this.sprite.spriteFrame=this.isOpen?this.openSpriteFrame:this.closeSpriteFrame)},e.prototype.onCollisionStay=function(t,e){t.node.getComponent(n.default)&&(this.isOpen=!0),t.node.getComponent(a.default)&&(this.isOpen=!0)},e.prototype.onCollisionEnter=function(t,e){t.node.getComponent(n.default)&&(this.isOpen=!0),t.node.getComponent(a.default)&&(this.isOpen=!0)},e.prototype.onCollisionExit=function(t,e){t.node.getComponent(n.default)&&(this.isOpen=!1),t.node.getComponent(a.default)&&(this.isOpen=!1)},e.prototype.update=function(t){this.timeDelay+=t,this.timeDelay>.16&&(this.sprite.spriteFrame=this.isOpen?this.openSpriteFrame:this.closeSpriteFrame)},__decorate([c(cc.SpriteFrame)],e.prototype,"openSpriteFrame",void 0),__decorate([c(cc.SpriteFrame)],e.prototype,"closeSpriteFrame",void 0),e=__decorate([r],e)}(cc.Component);o.default=l,cc._RF.pop()},{"../Dungeon":"Dungeon","../Player":"Player","./Box":"Box"}],GameFinish:[function(t,e,o){"use strict";cc._RF.push(e,"98577N+o/RGi4cE+Wsz8Pp4","GameFinish"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("./Logic"),a=cc._decorator,n=a.ccclass,s=(a.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.start=function(){},e.prototype.retry=function(){i.default.resetData(),cc.director.loadScene("loading")},e.prototype.home=function(){cc.director.loadScene("start")},e=__decorate([n],e)}(cc.Component));o.default=s,cc._RF.pop()},{"./Logic":"Logic"}],GameOver:[function(t,e,o){"use strict";cc._RF.push(e,"0e28bkl25dNTqUQmquXpqGi","GameOver"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("./Logic"),a=cc._decorator,n=a.ccclass,s=a.property,r=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.label=null,e}return __extends(e,t),e.prototype.start=function(){},e.prototype.retry=function(){i.default.resetData(),cc.director.loadScene("loading")},e.prototype.home=function(){cc.director.loadScene("start")},__decorate([s(cc.Label)],e.prototype,"label",void 0),e=__decorate([n],e)}(cc.Component);o.default=r,cc._RF.pop()},{"./Logic":"Logic"}],Game:[function(t,e,o){"use strict";cc._RF.push(e,"c30ffLX6hVIjoNslRhRCM7w","Game"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("./Logic"),a=cc._decorator,n=a.ccclass,s=a.property,r=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.label=null,e}return __extends(e,t),e.prototype.start=function(){},e.prototype.update=function(t){this.label&&(this.label.string="Level "+i.default.level)},__decorate([s(cc.Label)],e.prototype,"label",void 0),e=__decorate([n],e)}(cc.Component);o.default=r,cc._RF.pop()},{"./Logic":"Logic"}],HealthBar:[function(t,e,o){"use strict";cc._RF.push(e,"4298eVZsIJFhKykTJYXRBP0","HealthBar"),Object.defineProperty(o,"__esModule",{value:!0});var i=cc._decorator,a=i.ccclass,n=i.property,s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.backbar=null,e.label=null,e.timeDelay=0,e}return __extends(e,t),e.prototype.onLoad=function(){this.progressBar=this.getComponent(cc.ProgressBar),this.progressBar.progress=1},e.prototype.start=function(){},e.prototype.refreshHealth=function(t,e){this.progressBar&&(this.progressBar.progress=t/e,this.label&&(this.label.string=parseFloat(t.toFixed(1))+"/"+e))},e.prototype.update=function(t){this.timeDelay+=t,this.timeDelay>.016&&(this.timeDelay=0),this.backbar.width=this.lerp(this.backbar.width,this.progressBar.barSprite.node.width,5*t)},e.prototype.lerp=function(t,e,o){return t+(e-t)*o},__decorate([n(cc.Node)],e.prototype,"backbar",void 0),__decorate([n(cc.Label)],e.prototype,"label",void 0),e=__decorate([a],e)}(cc.Component);o.default=s,cc._RF.pop()},{}],InventoryData:[function(t,e,o){"use strict";cc._RF.push(e,"1dc08IgWM1D6q2nqBDxwhzD","InventoryData"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("./EquipmentData"),a=function(){function t(){this.weapon=new i.default,this.helmet=new i.default,this.clothes=new i.default,this.trousers=new i.default,this.gloves=new i.default,this.shoes=new i.default,this.cloak=new i.default,this.buffer=new i.default}return t.prototype.getMoveSpeed=function(t){var e=0;return(e=this.weapon.moveSpeed+this.helmet.moveSpeed+this.clothes.moveSpeed+this.trousers.moveSpeed+this.gloves.moveSpeed+this.shoes.moveSpeed+this.cloak.moveSpeed+this.buffer.moveSpeed)>300&&(e=300),e<-290&&(e=-290),t+e},t.prototype.getAttackSpeed=function(){return this.weapon.attackSpeed+this.helmet.attackSpeed+this.clothes.attackSpeed+this.trousers.attackSpeed+this.gloves.attackSpeed+this.shoes.attackSpeed+this.cloak.attackSpeed+this.buffer.attackSpeed},t.prototype.getAttackPoint=function(t){var e=cc.v2(t,t);return e.x+=this.weapon.damageMin+this.helmet.damageMin+this.clothes.damageMin+this.trousers.damageMin+this.gloves.damageMin+this.shoes.damageMin+this.cloak.damageMin+this.buffer.damageMin,e.y+=this.weapon.damageMax+this.helmet.damageMax+this.clothes.damageMax+this.trousers.damageMax+this.gloves.damageMax+this.shoes.damageMax+this.cloak.damageMax+this.buffer.damageMax,e},t.prototype.getFinalAttackPoint=function(t){var e=this.getAttackPoint(t),o=this.getCriticalStrikeRate(),i=Math.random()>o?e.x:e.x+e.y;return i<0&&(i=0),i},t.prototype.getCriticalStrikeRate=function(){var t=1-(1-this.weapon.criticalStrikeRate/100)*(1-this.helmet.criticalStrikeRate/100)*(1-this.clothes.criticalStrikeRate/100)*(1-this.trousers.criticalStrikeRate/100)*(1-this.gloves.criticalStrikeRate/100)*(1-this.shoes.criticalStrikeRate/100)*(1-this.buffer.criticalStrikeRate/100);return t<0&&(t=0),t},t.prototype.getDamage=function(t){var e=t,o=this.getDefence();return e*=1-.06*o/(.06*o+1)},t.prototype.getDodge=function(){var t=1-(1-this.weapon.dodge/100)*(1-this.helmet.dodge/100)*(1-this.clothes.dodge/100)*(1-this.trousers.dodge/100)*(1-this.gloves.dodge/100)*(1-this.shoes.dodge/100)*(1-this.cloak.dodge/100)*(1-this.buffer.dodge/100);return t<0&&(t=0),t},t.prototype.getDefence=function(){return this.weapon.defence+this.helmet.defence+this.clothes.defence+this.trousers.defence+this.gloves.defence+this.shoes.defence+this.cloak.defence+this.buffer.lifeRecovery},t.prototype.getRecovery=function(){return this.weapon.lifeRecovery+this.helmet.lifeRecovery+this.clothes.lifeRecovery+this.trousers.lifeRecovery+this.gloves.lifeRecovery+this.shoes.lifeRecovery+this.cloak.lifeRecovery+this.buffer.lifeRecovery},t.prototype.getLifeDrain=function(){var t=this.getCriticalStrikeRate(),e=1-(1-this.weapon.lifeDrain/100)*(1-this.helmet.lifeDrain/100)*(1-this.clothes.lifeDrain/100)*(1-this.trousers.lifeDrain/100)*(1-this.gloves.lifeDrain/100)*(1-this.shoes.lifeDrain/100)*(1-this.cloak.lifeDrain/100)*(1-this.buffer.lifeDrain/100),o=0;return Math.random()<e&&(o=1,Math.random()<t&&(o=2)),o},t.prototype.getHealth=function(t,e){var o=1,i=e+this.weapon.health+this.helmet.health+this.clothes.health+this.trousers.health+this.gloves.health+this.shoes.health+this.cloak.health+this.buffer.health;return i>0?(o=t.x/i,cc.v2(i*o,i)):cc.v2(1,1)},t}();o.default=a,cc._RF.pop()},{"./EquipmentData":"EquipmentData"}],Inventory:[function(t,e,o){"use strict";cc._RF.push(e,"3b411lPIzZAv7ApO4pixeng","Inventory"),Object.defineProperty(o,"__esModule",{value:!0});var i=cc._decorator,a=i.ccclass,n=i.property,s=t("./EventConstant"),r=t("./Logic"),c=t("./Data/EquipmentData"),l=t("./Player"),h=t("./Equipment/EquipmentDialog"),p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.tabselect=null,e.player=null,e.selectIndex=0,e.weapon=null,e.helmet=null,e.clothes=null,e.trousers=null,e.gloves=null,e.shoes=null,e.cloak=null,e.equipmentDialog=null,e}return __extends(e,t),e.prototype.onLoad=function(){var t=this;this.inventoryData=r.default.inventoryData,cc.director.on(s.EventConstant.PLAYER_CHANGEEQUIPMENT,function(e){t.refreshEquipment(e.detail.equipData,!0)})},e.prototype.start=function(){this.tabselect.x=0,this.weapon.spriteFrame=null,this.helmet.spriteFrame=null,this.clothes.spriteFrame=null,this.trousers.spriteFrame=null,this.gloves.spriteFrame=null,this.shoes.spriteFrame=null,this.cloak.spriteFrame=null,this.addSpriteTouchEvent(this.weapon,"weapon"),this.addSpriteTouchEvent(this.helmet,"helmet"),this.addSpriteTouchEvent(this.clothes,"clothes"),this.addSpriteTouchEvent(this.trousers,"trousers"),this.addSpriteTouchEvent(this.gloves,"gloves"),this.addSpriteTouchEvent(this.shoes,"shoes"),this.addSpriteTouchEvent(this.cloak,"cloak"),this.refreshEquipment(this.inventoryData.weapon,!1),this.refreshEquipment(this.inventoryData.helmet,!1),this.refreshEquipment(this.inventoryData.clothes,!1),this.refreshEquipment(this.inventoryData.trousers,!1),this.refreshEquipment(this.inventoryData.gloves,!1),this.refreshEquipment(this.inventoryData.shoes,!1),this.refreshEquipment(this.inventoryData.cloak,!1)},e.prototype.addSpriteTouchEvent=function(t,e){var o=this;t.node.on(cc.Node.EventType.TOUCH_START,function(){if(null!=t.spriteFrame){var i=new c.default;switch(e){case"weapon":i=o.inventoryData.weapon.clone();break;case"helmet":i=o.inventoryData.helmet.clone();break;case"clothes":i=o.inventoryData.clothes.clone();break;case"trousers":i=o.inventoryData.trousers.clone();break;case"gloves":i=o.inventoryData.gloves.clone();break;case"shoes":i=o.inventoryData.shoes.clone();break;case"cloak":i=o.inventoryData.cloak.clone()}o.equipmentDialog.refreshDialog(i),o.equipmentDialog.showDialog()}}),t.node.on(cc.Node.EventType.TOUCH_END,function(){o.equipmentDialog.hideDialog()}),t.node.on(cc.Node.EventType.TOUCH_CANCEL,function(){o.equipmentDialog.hideDialog()})},e.prototype.select=function(t,e){var o=parseInt(e);this.tabselect.y=64*o;var i=t.currentTarget;cc.director.emit(s.EventConstant.INVENTORY_CHANGEITEM,{detail:{spriteFrame:i.getComponentInChildren(cc.Sprite).spriteFrame}})},e.prototype.setEquipment=function(t,e,o){if(e.equipmetType==t.equipmetType){var i=this.player.getComponent(l.default).pos.clone();i.y<1?i.y+=1:i.y-=1,o&&cc.director.emit(s.EventConstant.DUNGEON_SETEQUIPMENT,{detail:{pos:i,equipmentData:e}})}},e.prototype.refreshEquipment=function(t,e){if(t&&this.weapon){var o=cc.color(255,255,255).fromHEX(t.color),i=r.default.spriteFrames[t.img];switch(t.equipmetType){case"weapon":this.weapon.spriteFrame=i,this.weapon.node.color=o,this.setEquipment(t,this.inventoryData.weapon,e),this.inventoryData.weapon.valueCopy(t);break;case"helmet":this.helmet.spriteFrame=i,this.helmet.node.color=o,this.setEquipment(t,this.inventoryData.helmet,e),this.inventoryData.helmet.valueCopy(t);break;case"clothes":this.clothes.spriteFrame=i,this.clothes.node.color=o,this.setEquipment(t,this.inventoryData.clothes,e),this.inventoryData.clothes.valueCopy(t);break;case"trousers":this.trousers.spriteFrame=1==t.trouserslong?r.default.spriteFrames.idle002:r.default.spriteFrames.idle001,this.trousers.node.color=o,this.setEquipment(t,this.inventoryData.trousers,e),this.inventoryData.trousers.valueCopy(t);break;case"gloves":this.gloves.spriteFrame=i,this.gloves.node.color=o,this.setEquipment(t,this.inventoryData.gloves,e),this.inventoryData.gloves.valueCopy(t);break;case"shoes":this.shoes.spriteFrame=i,this.shoes.node.color=o,this.setEquipment(t,this.inventoryData.shoes,e),this.inventoryData.shoes.valueCopy(t);break;case"cloak":this.shoes.spriteFrame=i,this.cloak.node.color=o,this.setEquipment(t,this.inventoryData.cloak,e),this.inventoryData.cloak.valueCopy(t)}this.player&&(this.player.getComponent(l.default).inventoryData=this.inventoryData,this.player.getComponent(l.default).changeEquipment(t,i))}},__decorate([n(cc.Node)],e.prototype,"tabselect",void 0),__decorate([n(cc.Node)],e.prototype,"player",void 0),__decorate([n(cc.Sprite)],e.prototype,"weapon",void 0),__decorate([n(cc.Sprite)],e.prototype,"helmet",void 0),__decorate([n(cc.Sprite)],e.prototype,"clothes",void 0),__decorate([n(cc.Sprite)],e.prototype,"trousers",void 0),__decorate([n(cc.Sprite)],e.prototype,"gloves",void 0),__decorate([n(cc.Sprite)],e.prototype,"shoes",void 0),__decorate([n(cc.Sprite)],e.prototype,"cloak",void 0),__decorate([n(h.default)],e.prototype,"equipmentDialog",void 0),e=__decorate([a],e)}(cc.Component);o.default=p,cc._RF.pop()},{"./Data/EquipmentData":"EquipmentData","./Equipment/EquipmentDialog":"EquipmentDialog","./EventConstant":"EventConstant","./Logic":"Logic","./Player":"Player"}],Item:[function(t,e,o){"use strict";cc._RF.push(e,"ce4de5SY9BKg5Ay5wKpP9r7","Item"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("../EventConstant"),a=t("../Player"),n=t("../Logic"),s=cc._decorator,r=s.ccclass,c=s.property,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.damage=-1,e.ammo=0,e.isTaken=!1,e}return __extends(e,t),e.prototype.start=function(){this.anim=this.getComponent(cc.Animation)},e.prototype.taken=function(){var t=this;this.isTaken||(this.anim.play("ItemTaken"),this.isTaken=!0,0!=this.damage&&cc.director.emit(i.EventConstant.PLAYER_TAKEDAMAGE,{detail:{damage:this.damage}}),0!=this.ammo&&(n.default.ammo+=this.ammo),setTimeout(function(){t.node&&(t.node.active=!1)},3e3))},e.prototype.onCollisionEnter=function(t,e){t.node.getComponent(a.default)&&this.taken()},__decorate([c],e.prototype,"damage",void 0),__decorate([c],e.prototype,"ammo",void 0),e=__decorate([r],e)}(cc.Component);o.default=l,cc._RF.pop()},{"../EventConstant":"EventConstant","../Logic":"Logic","../Player":"Player"}],JoyController:[function(t,e,o){"use strict";cc._RF.push(e,"246e3R5w7RM/68kAxSEZZAX","JoyController"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("./EventConstant"),a=cc._decorator,n=a.ccclass,s=a.property,r=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.anglePreDirQuadrant=23,e.fixedPoint=null,e.movePoint=null,e.movePointMoveRadius=100,e.timeDelay=0,e}return __extends(e,t),e.prototype.onLoad=function(){var t=this.node.getContentSize();this.touchArea=new cc.Vec2(t.width,t.height),this.fixedPointMoveCenterPos=cc.v2(0,0),this.fixedPointMoveRadius=this.touchArea.x/2-this.movePointMoveRadius,this.node.on(cc.Node.EventType.TOUCH_START,function(t){if(-1==this.touchID){var e=t.getLocation(),o=new cc.Vec2(e.x,e.y);o.subSelf(this.node.position);var i=this.clampPos(o,this.fixedPointMoveCenterPos,this.fixedPointMoveRadius);this.movePointMoveCenterPos=i,this.setFixedPointPos(i),this.touchID=t.getID()}},this),this.node.on(cc.Node.EventType.TOUCH_MOVE,function(t){if(this.touchID==t.getID()){var e=t.getLocation(),o=new cc.Vec2(e.x,e.y);o.subSelf(this.node.position);var i=this.clampPos(o,this.movePointMoveCenterPos,this.movePointMoveRadius);console.log(i),this.setMovePointPos(i)}},this),this.node.on(cc.Node.EventType.TOUCH_END,function(t){this.init(),cc.director.emit(i.EventConstant.PLAYER_ATTACK)},this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,function(t){this.init(),cc.director.emit(i.EventConstant.PLAYER_ATTACK)},this),this.init()},e.prototype.init=function(){this.touchID=-1,this.joystickInputDir=new cc.Vec2,this.setFixedPointPos(this.fixedPointMoveCenterPos),this.setMovePointPos(this.fixedPointMoveCenterPos)},e.prototype.setFixedPointPos=function(t){this.fixedPoint.setPosition(cc.v2(0,0))},e.prototype.getFixedPointPos=function(){return this.fixedPoint.getPosition()},e.prototype.setMovePointPos=function(t){this.movePoint.setPosition(t)},e.prototype.getMovePointPos=function(){return this.movePoint.getPosition()},e.prototype.clampPos=function(t,e,o){var i=t.sub(e);return i.mag()>o?i.normalize().mul(o).add(e):t},e.prototype.getInputDir=function(){var t=this.movePoint.getPosition().sub(this.fixedPoint.getPosition());return t.mag()>0&&t.normalizeSelf(),t},e.prototype.getInputQuadrantDir=function(){return this.getVec2ByQuadrant(this.getDirQuadrant(this.getInputDir()))},e.prototype.getDirQuadrant=function(t){var e=null;return t.mag()>0&&(e=Math.floor(this.getAngleByVec2(t)/this.anglePreDirQuadrant)),e},e.prototype.getAngleByVec2=function(t){return 180*-Math.atan2(t.y,t.x)/Math.PI+this.anglePreDirQuadrant/2},e.prototype.getVec2ByAngle=function(t){var e=new cc.Vec2,o=(this.anglePreDirQuadrant/2-t)*(Math.PI/180);return e.x=Math.cos(o),e.y=Math.sin(o),e.normalizeSelf()},e.prototype.getVec2ByQuadrant=function(t){if(null!=t){var e=t*this.anglePreDirQuadrant;return e+=this.anglePreDirQuadrant/2,this.getVec2ByAngle(e)}return cc.Vec2.ZERO},e.prototype.sendMoveMessageToPlayer=function(t){var e=this.getInputQuadrantDir(),o=4;Math.abs(e.x)<Math.abs(e.y)&&(e.y>.3&&(o=0),e.y<-.3&&(o=1)),Math.abs(e.x)>Math.abs(e.y)&&(e.x<-.3&&(o=2),e.x>.3&&(o=3));var a=this.getInputDir();cc.director.emit(i.EventConstant.PLAYER_ROTATE,{detail:{dir:o,pos:a,dt:t}})},e.prototype.isTimeDelay=function(t){return this.timeDelay+=t,this.timeDelay>.016&&(this.timeDelay=0,!0)},e.prototype.update=function(t){this.isTimeDelay(t)&&this.sendMoveMessageToPlayer(t)},__decorate([s(cc.Integer)],e.prototype,"anglePreDirQuadrant",void 0),__decorate([s(cc.Node)],e.prototype,"fixedPoint",void 0),__decorate([s(cc.Node)],e.prototype,"movePoint",void 0),__decorate([s],e.prototype,"movePointMoveRadius",void 0),e=__decorate([n],e)}(cc.Component);o.default=r,cc._RF.pop()},{"./EventConstant":"EventConstant"}],Joystick:[function(t,e,o){"use strict";cc._RF.push(e,"a3868eVgi9Ewpbgxpufia3p","Joystick"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("./EventConstant"),a=cc._decorator,n=a.ccclass,s=a.property,r=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.anglePreDirQuadrant=23,e.fixedPoint=null,e.movePoint=null,e.movePointMoveRadius=100,e.stopCount=0,e.timeDelay=0,e}return __extends(e,t),e.prototype.onLoad=function(){var t=this.node.getContentSize();this.touchArea=new cc.Vec2(t.width,t.height),this.fixedPointMoveCenterPos=this.touchArea.div(0,this.touchArea),this.fixedPointMoveRadius=this.touchArea.x/2-this.movePointMoveRadius,this.node.on(cc.Node.EventType.TOUCH_START,function(t){if(-1==this.touchID){var e=t.getLocation(),o=new cc.Vec2(e.x,e.y);o.subSelf(this.node.position);var i=this.clampPos(o,this.fixedPointMoveCenterPos,this.fixedPointMoveRadius);this.movePointMoveCenterPos=i,this.setFixedPointPos(i),this.setMovePointPos(i),this.touchID=t.getID()}},this),this.node.on(cc.Node.EventType.TOUCH_MOVE,function(t){if(this.touchID==t.getID()){var e=t.getLocation(),o=new cc.Vec2(e.x,e.y);o.subSelf(this.node.position);var i=this.clampPos(o,this.movePointMoveCenterPos,this.movePointMoveRadius);this.setMovePointPos(i)}},this),this.node.on(cc.Node.EventType.TOUCH_END,function(t){this.init()},this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,function(t){this.init()},this),this.init()},e.prototype.init=function(){this.touchID=-1,this.joystickInputDir=new cc.Vec2,this.setFixedPointPos(this.fixedPointMoveCenterPos),this.setMovePointPos(this.fixedPointMoveCenterPos)},e.prototype.setFixedPointPos=function(t){this.fixedPoint.setPosition(t)},e.prototype.getFixedPointPos=function(){return this.fixedPoint.getPosition()},e.prototype.setMovePointPos=function(t){this.movePoint.setPosition(t)},e.prototype.getMovePointPos=function(){return this.movePoint.getPosition()},e.prototype.clampPos=function(t,e,o){var i=t.sub(e);return i.mag()>o?i.normalize().mul(o).add(e):t},e.prototype.getInputDir=function(){var t=this.movePoint.getPosition().sub(this.fixedPoint.getPosition());return(isNaN(t.x)||isNaN(t.y))&&(t=cc.v2(0,0)),t.mag()>0&&t.normalizeSelf(),t},e.prototype.getInputQuadrantDir=function(){return this.getVec2ByQuadrant(this.getDirQuadrant(this.getInputDir()))},e.prototype.getDirQuadrant=function(t){var e=null;return t.mag()>0&&(e=Math.floor(this.getAngleByVec2(t)/this.anglePreDirQuadrant)),e},e.prototype.getAngleByVec2=function(t){return 180*-Math.atan2(t.y,t.x)/Math.PI+this.anglePreDirQuadrant/2},e.prototype.getVec2ByAngle=function(t){var e=new cc.Vec2,o=(this.anglePreDirQuadrant/2-t)*(Math.PI/180);return e.x=Math.cos(o),e.y=Math.sin(o),e.normalizeSelf()},e.prototype.getVec2ByQuadrant=function(t){if(null!=t){var e=t*this.anglePreDirQuadrant;return e+=this.anglePreDirQuadrant/2,this.getVec2ByAngle(e)}return cc.Vec2.ZERO},e.prototype.sendMoveMessageToPlayer=function(t){var e=this.getInputQuadrantDir(),o=4;Math.abs(e.x)<Math.abs(e.y)&&(e.y>.3&&(o=0),e.y<-.3&&(o=1)),Math.abs(e.x)>Math.abs(e.y)&&(e.x<-.3&&(o=2),e.x>.3&&(o=3));var a=this.getInputDir();a.equals(cc.Vec2.ZERO)?this.stopCount++:this.stopCount=0,this.stopCount<2&&cc.director.emit(i.EventConstant.PLAYER_MOVE,{detail:{dir:o,pos:a,dt:t}})},e.prototype.isTimeDelay=function(t){return this.timeDelay+=t,this.timeDelay>.016&&(this.timeDelay=0,!0)},e.prototype.update=function(t){this.isTimeDelay(t)&&this.sendMoveMessageToPlayer(t)},__decorate([s(cc.Integer)],e.prototype,"anglePreDirQuadrant",void 0),__decorate([s(cc.Node)],e.prototype,"fixedPoint",void 0),__decorate([s(cc.Node)],e.prototype,"movePoint",void 0),__decorate([s],e.prototype,"movePointMoveRadius",void 0),e=__decorate([n],e)}(cc.Component);o.default=r,cc._RF.pop()},{"./EventConstant":"EventConstant"}],KeyboardController:[function(t,e,o){"use strict";cc._RF.push(e,"b57f7ePcl9JD6/oAh/+vpUg","KeyboardController"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("./EventConstant"),a=cc._decorator,n=a.ccclass,s=(a.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.stopCount=0,e.isUp=!1,e.isDown=!1,e.isLeft=!1,e.isRight=!1,e.isA=!1,e.isB=!1,e.isC=!1,e.timeDelay=0,e}return __extends(e,t),e.prototype.onLoad=function(){cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this)},e.prototype.start=function(){},e.prototype.onKeyDown=function(t){switch(t.keyCode){case cc.macro.KEY.w:this.isUp=!0;break;case cc.macro.KEY.s:this.isDown=!0;break;case cc.macro.KEY.a:this.isLeft=!0;break;case cc.macro.KEY.d:this.isRight=!0;break;case cc.macro.KEY.j:this.isA=!0;break;case cc.macro.KEY.k:this.isB=!0;break;case cc.macro.KEY.l:this.isC=!0}},e.prototype.onKeyUp=function(t){switch(t.keyCode){case cc.macro.KEY.w:this.isUp=!1;break;case cc.macro.KEY.s:this.isDown=!1;break;case cc.macro.KEY.a:this.isLeft=!1;break;case cc.macro.KEY.d:this.isRight=!1;break;case cc.macro.KEY.j:this.isA=!1;break;case cc.macro.KEY.k:this.isB=!1;break;case cc.macro.KEY.l:this.isC=!1}},e.prototype.update=function(t){this.isTimeDelay(t)&&this.sendMoveMessageToPlayer(t)},e.prototype.sendMoveMessageToPlayer=function(t){var e=cc.v2(0,0);this.isUp&&e.addSelf(cc.v2(0,.9)),this.isDown&&e.addSelf(cc.v2(0,-.9)),this.isLeft&&e.addSelf(cc.v2(-.9,0)),this.isRight&&e.addSelf(cc.v2(.9,0)),e.mag()>0&&e.normalizeSelf();var o=4;Math.abs(e.x)<Math.abs(e.y)&&(e.y>.3&&(o=0),e.y<-.3&&(o=1)),Math.abs(e.x)>Math.abs(e.y)&&(e.x<-.3&&(o=2),e.x>.3&&(o=3)),e.equals(cc.Vec2.ZERO)?this.stopCount++:this.stopCount=0,this.stopCount<2&&cc.director.emit(i.EventConstant.PLAYER_MOVE,{detail:{dir:o,pos:e,dt:t}}),this.isA&&cc.director.emit(i.EventConstant.PLAYER_ATTACK),this.isB&&cc.director.emit(i.EventConstant.PLAYER_REMOTEATTACK),this.isC&&cc.director.emit(i.EventConstant.PLAYER_USEITEM)},e.prototype.isTimeDelay=function(t){return this.timeDelay+=t,this.timeDelay>.016&&(this.timeDelay=0,!0)},e=__decorate([n],e)}(cc.Component));o.default=s,cc._RF.pop()},{"./EventConstant":"EventConstant"}],KrakenSwingHand:[function(t,e,o){"use strict";cc._RF.push(e,"15ea4rtPQxD8pcJLX7yPozV","KrakenSwingHand"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("../EventConstant"),a=t("../Player"),n=cc._decorator,s=n.ccclass,r=n.property,c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.damage=2,e.isShow=!1,e}return __extends(e,t),e.prototype.start=function(){this.isShow=!1},e.prototype.onCollisionEnter=function(t,e){t.node.getComponent(a.default)&&this.isShow&&this.node.active&&(this.node.stopAllActions(),cc.director.emit(i.EventConstant.PLAYER_TAKEDAMAGE,{detail:{damage:this.damage}}))},__decorate([r],e.prototype,"damage",void 0),e=__decorate([s],e)}(cc.Component);o.default=c,cc._RF.pop()},{"../EventConstant":"EventConstant","../Player":"Player"}],Kraken:[function(t,e,o){"use strict";cc._RF.push(e,"cbbb1U+Yy5Jtb8PV4hyvH/c","Kraken"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("../HealthBar"),a=t("../Data/MonsterData"),n=t("../Shooter"),s=t("./KrakenSwingHand"),r=t("../Dungeon"),c=cc._decorator,l=c.ccclass,h=c.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.pos=cc.v2(0,0),e.label=null,e.healthBar=null,e.hand1=null,e.hand2=null,e.isDied=!1,e.isShow=!1,e.timeDelay=0,e.data=new a.default,e}return __extends(e,t),e.prototype.onLoad=function(){this.isDied=!1,this.isShow=!1,this.anim=this.getComponent(cc.Animation),this.sprite=this.node.getChildByName("sprite"),this.sprite.opacity=0,this.shooter=this.getComponentInChildren(n.default)},e.prototype.updatePlayerPos=function(){this.node.x=64*this.pos.x+32,this.node.y=64*this.pos.y+70},e.prototype.transportPlayer=function(t,e){this.pos.x=t,this.pos.y=e,this.changeZIndex()},e.prototype.changeZIndex=function(){this.node.zIndex=1e3+100*(r.default.HEIGHT_SIZE-this.pos.y-1)+2,this.isShow&&!this.isDied&&(this.node.zIndex=3e3+100*(r.default.HEIGHT_SIZE-this.pos.y-1)+2)},e.prototype.attack=function(t,e){var o=this;if(!this.isDied){var i=0,a=0;switch(t){case 0:a+=32;break;case 1:a-=32;break;case 2:i-=32;break;case 3:i+=32}var n=cc.sequence(cc.moveBy(.1,i,a),cc.callFunc(function(){e&&e(o.data.attackPoint)}),cc.moveTo(.1,0,0));this.sprite.runAction(n)}},e.prototype.start=function(){this.changeZIndex(),this.healthBar&&this.healthBar.refreshHealth(this.data.currentHealth,this.data.maxHealth)},e.prototype.takeDamage=function(t){if(!this.isDied&&this.isShow&&(this.data.currentHealth-=t,this.data.currentHealth>this.data.maxHealth&&(this.data.currentHealth=this.data.maxHealth),this.anim.playAdditive("KrakenHit"),this.healthBar.refreshHealth(this.data.currentHealth,this.data.maxHealth),this.dungeon)){var e=this.dungeon.player.pos;e.x>this.pos.x&&!this.anim.getAnimationState("KrakenSwingRight").isPlaying?this.anim.playAdditive("KrakenSwingRight"):e.x<this.pos.x&&!this.anim.getAnimationState("KrakenSwingLeft").isPlaying&&this.anim.playAdditive("KrakenSwingLeft")}},e.prototype.killed=function(){if(!this.isDied){this.isDied=!0,this.changeZIndex();for(var t=0,e=this.getComponentsInChildren(s.default);t<e.length;t++){e[t].isShow=!1}this.anim.play("KrakenDie")}},e.prototype.BossShow=function(){this.isShow=!0;for(var t=0,e=this.getComponentsInChildren(s.default);t<e.length;t++){e[t].isShow=!0}this.anim.play("KrakenIdle"),this.changeZIndex()},e.prototype.BossHit=function(){},e.prototype.showBoss=function(){this.anim.play("KrakenShow"),this.healthBar&&(this.healthBar.refreshHealth(this.data.currentHealth,this.data.maxHealth),this.healthBar.node.active=!this.isDied)},e.prototype.update=function(t){this.timeDelay+=t,this.timeDelay>.016&&(this.timeDelay=0,this.updatePlayerPos()),this.data.currentHealth<1&&(this.killed(),this.hand1.isShow=!1,this.hand2.isShow=!1),this.label&&(this.label.string=""+this.node.zIndex),this.healthBar.node.active=!this.isDied},e.prototype.bossAction=function(t){if(!this.isDied&&this.isShow){if(this.dungeon=t,this.changeZIndex(),this.shooter&&t){var e=this.node.position.clone().add(this.shooter.node.position),o=t.player.node.position.sub(e);o.equals(cc.Vec2.ZERO)||(o=o.normalizeSelf(),this.shooter.setHv(o),this.shooter.dungeon=t,this.shooter.fireBullet())}t&&this.data.currentHealth<this.data.maxHealth/2&&t.addFallStone(t.player.node.position,!0)}},__decorate([h(cc.Vec2)],e.prototype,"pos",void 0),__decorate([h(cc.Label)],e.prototype,"label",void 0),__decorate([h(i.default)],e.prototype,"healthBar",void 0),__decorate([h(s.default)],e.prototype,"hand1",void 0),__decorate([h(s.default)],e.prototype,"hand2",void 0),e=__decorate([l],e)}(cc.Component);o.default=p,cc._RF.pop()},{"../Data/MonsterData":"MonsterData","../Dungeon":"Dungeon","../HealthBar":"HealthBar","../Shooter":"Shooter","./KrakenSwingHand":"KrakenSwingHand"}],Loading:[function(t,e,o){"use strict";cc._RF.push(e,"a2246gAT5JKc4YhD10URG7K","Loading"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("./Logic"),a=cc._decorator,n=a.ccclass,s=a.property,r=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.label=null,e.timeDelay=0,e.isEquipmentLoaded=!1,e.isMonsterLoaded=!1,e.isLevelLoaded=!1,e.isSpriteFramesLoaded=!1,e}return __extends(e,t),e.prototype.start=function(){this.label.string="Level "+i.default.level,this.isLevelLoaded=!1,this.isEquipmentLoaded=!1,this.isMonsterLoaded=!1,this.loadMap(),this.loadEquipment(),this.loadSpriteFrames(),this.loadMonsters()},e.prototype.loadMap=function(){i.default.mapManger.isloaded=!1,i.default.mapManger.loadMap()},e.prototype.loadEquipment=function(){var t=this;i.default.equipments?this.isEquipmentLoaded=!0:cc.loader.loadRes("Data/Equipment/equipment",function(e,o){e?cc.error(e):(i.default.equipments=o.json,t.isEquipmentLoaded=!0)})},e.prototype.loadMonsters=function(){var t=this;i.default.monsters?this.isMonsterLoaded=!0:cc.loader.loadRes("Data/Monster/monsters",function(e,o){e?cc.error(e):(i.default.monsters=o.json,t.isMonsterLoaded=!0)})},e.prototype.loadSpriteFrames=function(){var t=this;i.default.spriteFrames?this.isSpriteFramesLoaded=!0:cc.loader.loadResDir("Texture",cc.SpriteFrame,function(e,o){i.default.spriteFrames={};for(var a=0,n=o;a<n.length;a++){var s=n[a];i.default.spriteFrames[s.name]=s}t.isSpriteFramesLoaded=!0})},e.prototype.update=function(t){this.timeDelay+=t,this.isLevelLoaded=i.default.mapManger.isloaded,this.timeDelay>.16&&this.isLevelLoaded&&this.isEquipmentLoaded&&this.isSpriteFramesLoaded&&this.isMonsterLoaded&&(this.timeDelay=0,this.isLevelLoaded=!1,this.isEquipmentLoaded=!1,this.isSpriteFramesLoaded=!1,cc.director.loadScene("game"))},__decorate([s(cc.Label)],e.prototype,"label",void 0),e=__decorate([n],e)}(cc.Component);o.default=r,cc._RF.pop()},{"./Logic":"Logic"}],Logic:[function(t,e,o){"use strict";cc._RF.push(e,"2225fYJ0sRMTZjuD7WFmbVi","Logic"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("./Data/PlayerData"),a=t("./EventConstant"),n=t("./Data/InventoryData"),s=t("./Manager/MapManager"),r=t("./Dungeon"),c=cc._decorator,l=c.ccclass,h=(c.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}var o;return __extends(e,t),o=e,e.prototype.onLoad=function(){var t=this;cc.game.setFrameRate(60),cc.game.addPersistRootNode(this.node),cc.director.getCollisionManager().enabled=!0,cc.director.getPhysicsManager().enabled=!0,cc.director.on(a.EventConstant.LOADINGNEXTLEVEL,function(e){t.loadingNextLevel()}),cc.director.on(a.EventConstant.LOADINGROOM,function(e){t.loadingNextRoom(e.detail.dir)})},e.prototype.start=function(){},e.resetData=function(){o.level=1,o.playerData=new i.default,o.inventoryData=new n.default,o.mapManger.reset(o.level),o.coins=0,o.ammo=30},e.changeDungeonSize=function(){var t=o.getCurrentMapData().map;t&&t.length>0&&(r.default.WIDTH_SIZE=t.length,r.default.HEIGHT_SIZE=t[0].length)},e.prototype.loadingNextRoom=function(t){if(o.mapManger.loadingNextRoom(t)){switch(o.changeDungeonSize(),t){case 0:o.playerData.pos=cc.v2(Math.round(r.default.WIDTH_SIZE/2-1),0);break;case 1:o.playerData.pos=cc.v2(Math.round(r.default.WIDTH_SIZE/2-1),r.default.HEIGHT_SIZE-1);break;case 2:o.playerData.pos=cc.v2(r.default.WIDTH_SIZE-1,Math.round(r.default.HEIGHT_SIZE/2-1));break;case 3:o.playerData.pos=cc.v2(0,Math.round(r.default.HEIGHT_SIZE/2-1))}cc.director.loadScene("loading")}},e.prototype.loadingNextLevel=function(){o.level++,o.level>5?cc.director.loadScene("gamefinish"):(o.mapManger.reset(o.level),o.changeDungeonSize(),o.playerData.pos=cc.v2(Math.round(r.default.WIDTH_SIZE/2-1),Math.round(r.default.HEIGHT_SIZE/2-1)),cc.director.loadScene("loading"))},e.getCurrentMapData=function(){return o.mapManger.getCurrentMapData()},e.getCurrentMapBoxes=function(){return o.mapManger.getCurrentMapBoxes()},e.getCurrentMapShopTables=function(){return o.mapManger.getCurrentMapShopTables()},e.isBossLevel=function(t){return t==o.BOSS_LEVEL_1},e.getRandomNum=function(t,e){return t+Math.round(Math.random()*(e-t))},e.getHalfChance=function(){return Math.random()>.5},e.getDistance=function(t,e){var o=t.x-e.x,i=t.y-e.y;return Math.sqrt(o*o+i*i)},e.BOSS_LEVEL_1=10,e.level=1,e.playerData=new i.default,e.inventoryData=new n.default,e.roomStrs=["startroom","endroom","traproom","lootroom","dangerroom","puzzleroom","merchantroom","bossroom"],e.mapManger=new s.default,e.chapterName="chapter01",e.equipments=null,e.monsters=null,e.spriteFrames=null,e.currentDir=0,e.coins=0,e.ammo=30,e.killCount=0,e=o=__decorate([l],e)}(cc.Component));o.default=h,cc._RF.pop()},{"./Data/InventoryData":"InventoryData","./Data/PlayerData":"PlayerData","./Dungeon":"Dungeon","./EventConstant":"EventConstant","./Manager/MapManager":"MapManager"}],MapData:[function(t,e,o){"use strict";cc._RF.push(e,"9d7bcZhUYBIzJR0A6/ryRxj","MapData"),Object.defineProperty(o,"__esModule",{value:!0});var i=function(){function t(t){this.map=new Array,this.init(t)}return t.prototype.init=function(t){var e=(t=t.substring(2,t.length-2)).split("\r\n");this.map=new Array;for(var o=0;o<e.length;o++)this.map[o]=new Array;for(o=0;o<e.length;o++)for(var i=e[e.length-1-o].split(""),a=0;a<i.length;a++)this.map[o][a]=i[a];var n=new Array;for(o=0;o<this.map[0].length;o++){n[o]=new Array;for(a=0;a<this.map.length;a++)n[o][a]=this.map[a][o]}this.map=n},t}();o.default=i,cc._RF.pop()},{}],MapManager:[function(t,e,o){"use strict";cc._RF.push(e,"3b0b2KGAWdGI6jcP8eIcPHE","MapManager"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("../Data/MapData"),a=t("../Rect/RectDungeon"),n=t("../Logic"),s=function(){function t(){this.allfileRooms={},this.roomStrs=["startroom","endroom","traproom","lootroom","dangerroom","puzzleroom","merchantroom","bossroom"],this.isloaded=!1,this.rectDungeon=new a.default(1),this.currentRectRoom=null,this.boxes={},this.shopTables={},this.init()}return t.prototype.init=function(){this.isloaded=!1},t.prototype.reset=function(t){this.rectDungeon=new a.default(t),cc.log(this.rectDungeon.getDisPlay()),this.resetRooms(),this.currentRectRoom=this.rectDungeon.startRoom,this.changeRoomsIsFound(this.currentRectRoom.x,this.currentRectRoom.y),this.boxes={},this.shopTables={}},t.prototype.loadingNextRoom=function(t){var e=this.rectDungeon.getNeighborRoomType(this.currentRectRoom.x,this.currentRectRoom.y,t);return e&&0!=e.roomType&&(this.currentRectRoom=e,this.changeRoomsIsFound(e.x,e.y)),e},t.prototype.changeRoomsIsFound=function(t,e){this.rectDungeon.changeRoomIsFound(t,e),this.rectDungeon.changeRoomIsFound(t+1,e),this.rectDungeon.changeRoomIsFound(t-1,e),this.rectDungeon.changeRoomIsFound(t,e+1),this.rectDungeon.changeRoomIsFound(t,e-1)},t.prototype.getCurrentMapData=function(){return this.currentRectRoom.map},t.prototype.getCurrentMapBoxes=function(){return this.boxes["x="+this.currentRectRoom.x+"y="+this.currentRectRoom.y]},t.prototype.setCurrentBoxesArr=function(t){this.boxes["x="+this.currentRectRoom.x+"y="+this.currentRectRoom.y]=t},t.prototype.getCurrentMapShopTables=function(){return this.shopTables["x="+this.currentRectRoom.x+"y="+this.currentRectRoom.y]},t.prototype.setCurrentShopTableArr=function(t){this.shopTables["x="+this.currentRectRoom.x+"y="+this.currentRectRoom.y]=t},t.prototype.loadMap=function(){var t=this;this.rectDungeon.startRoom.map?this.isloaded=!0:cc.loader.loadRes("Data/Rooms/rooms",function(e,o){if(e)cc.error(e);else{for(var a=o.text.split("room"),n=0,s=0;s<a.length;s++){var r=a[s],c=null;if(r&&(c=(r=r.substring(r.indexOf("=")+1,r.length-3)).split("$")),c){for(var l=new Array,h=0;h<c.length;h++){var p=c[h];l.push(new i.default(p))}t.allfileRooms[t.roomStrs[n]]=l,n++}}t.resetRooms(),t.isloaded=!0}})},t.prototype.resetRooms=function(){if(this.allfileRooms&&this.allfileRooms[this.roomStrs[0]])for(var t=0;t<this.rectDungeon.map.length;t++)for(var e=0;e<this.rectDungeon.map[0].length;e++){var o=this.rectDungeon.map[t][e],i=o.roomType-1;if(i>=0){var a=this.allfileRooms[this.roomStrs[i]];o.map=a[n.default.getRandomNum(0,a.length-1)]}}},t}();o.default=s,cc._RF.pop()},{"../Data/MapData":"MapData","../Logic":"Logic","../Rect/RectDungeon":"RectDungeon"}],MeleeWeaponChild:[function(t,e,o){"use strict";cc._RF.push(e,"81ac4Ib50VMBoiaBfrNyVFU","MeleeWeaponChild"),Object.defineProperty(o,"__esModule",{value:!0});var i=cc._decorator,a=i.ccclass,n=(i.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.meleeWeapon=null,e}return __extends(e,t),e.prototype.onLoad=function(){this.getComponent(cc.Sprite).spriteFrame},e.prototype.start=function(){},e=__decorate([a],e)}(cc.Component));o.default=n,cc._RF.pop()},{}],MeleeWeapon:[function(t,e,o){"use strict";cc._RF.push(e,"8747dgi/6dFupzO0r46t7Ya","MeleeWeapon"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("./Player"),a=t("./Monster"),n=t("./Boss/Kraken"),s=t("./Building/Box"),r=t("./Logic"),c=t("./MeleeWeaponChild"),l=t("./Boss/Captain"),h=cc._decorator,p=h.ccclass,d=h.property,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.playerNode=null,e.player=null,e.stabWeapon=null,e.waveWeapon=null,e.isReverse=!1,e.isAttacking=!1,e.hv=cc.v2(1,0),e.isStab=!0,e.isFar=!1,e}return __extends(e,t),e.prototype.onLoad=function(){this.anim=this.getComponent(cc.Animation),this.player=this.playerNode.getComponent(i.default)},e.prototype.setHv=function(t){var e=this.hasNearEnemy();e.equals(cc.Vec2.ZERO)?this.hv=t:(this.rotateColliderManager(cc.v2(this.node.position.x+e.x,this.node.position.y+e.y)),this.hv=e)},e.prototype.getHv=function(){return this.hv},e.prototype.attack=function(t){if(!this.isAttacking){this.isAttacking=!0;var e=1+t/1e3;e<.2&&(e=.2),e>3&&(e=3),this.anim&&(this.anim.play(this.getAttackAnimName()),this.anim.getAnimationState(this.getAttackAnimName()).speed=e)}},e.prototype.getAttackAnimName=function(){return!this.isFar&&this.isStab?"MeleeAttackStab":this.isFar&&this.isStab?"MeleeAttackStabFar":this.isFar&&!this.isStab?this.isReverse?"MeleeAttackFarReverse":"MeleeAttackFar":this.isReverse?"MeleeAttackReverse":"MeleeAttack"},e.prototype.MeleeAttackFinish=function(t){this.isAttacking=!1,this.isReverse=!t},e.prototype.start=function(){},e.prototype.getRandomNum=function(t,e){return t+Math.round(Math.random()*(e-t))},e.prototype.update=function(t){var e=this.hasNearEnemy();if(e.equals(cc.Vec2.ZERO)){if((0!=this.hv.x||0!=this.hv.y)&&!this.isAttacking){this.node.position=cc.v2(25,45);var o=cc.v2(this.node.position.x+this.hv.x,this.node.position.y+this.hv.y);this.rotateColliderManager(o)}}else this.rotateColliderManager(cc.v2(this.node.position.x+e.x,this.node.position.y+e.y)),this.hv=e},e.prototype.hasNearEnemy=function(){var t=1e3,e=cc.v2(0,0);if(this.dungeon){for(var o=0,i=this.dungeon.monsters;o<i.length;o++){var a=i[o],n=r.default.getDistance(this.node.parent.position,a.node.position);if(n<200&&n<t&&!a.isDied){t=n;var s=this.node.position.clone();s.x=1==this.node.scaleX?s.x:-s.x,e=a.node.position.sub(this.node.parent.position.add(s))}}1e3!=t&&(e=e.normalizeSelf())}return e},e.prototype.rotateColliderManager=function(t){var e=t.sub(this.node.position),o=360/(2*Math.PI),i=360-Math.atan2(e.x,e.y)*o;this.node.scaleX=this.node.parent.scaleX,i+=90,this.node.rotation=-1==this.node.scaleX?i:-i},e.prototype.onBeginContact=function(t,e,o){},e.prototype.onCollisionEnter=function(t,e){this.attacking(t)},e.prototype.beatBack=function(t){var e=t.getComponent(cc.RigidBody),o=this.getHv().clone();o.equals(cc.Vec2.ZERO)&&(o=cc.v2(1,0));!this.isFar&&this.isStab||(this.isFar&&this.isStab||(this.isFar||this.isStab)),o=o.normalizeSelf().mul(640);cc.moveBy(.1,o.x,o.y);e.applyLinearImpulse(o,e.getLocalCenter(),!0)},e.prototype.attacking=function(t){if(t&&this.isAttacking){var e=0;this.player&&(e=this.player.inventoryData.getFinalAttackPoint(this.player.baseAttackPoint));var o=!1,i=t.node.getComponent(a.default);i&&!i.isDied&&(o=i.takeDamage(e))&&this.beatBack(i.node);var r=t.node.getComponent(n.default);r&&!r.isDied&&(r.takeDamage(e),o=!0);var c=t.node.getComponent(l.default);c&&!c.isDied&&(c.takeDamage(e),o=!0);var h=t.node.getComponent(s.default);h&&h.breakBox();var p=this.player.inventoryData.getLifeDrain();p>0&&o&&this.player.takeDamage(-p)}},__decorate([d(cc.Node)],e.prototype,"playerNode",void 0),__decorate([d(c.default)],e.prototype,"stabWeapon",void 0),__decorate([d(c.default)],e.prototype,"waveWeapon",void 0),e=__decorate([p],e)}(cc.Component);o.default=u,cc._RF.pop()},{"./Boss/Captain":"Captain","./Boss/Kraken":"Kraken","./Building/Box":"Box","./Logic":"Logic","./MeleeWeaponChild":"MeleeWeaponChild","./Monster":"Monster","./Player":"Player"}],MiniMap:[function(t,e,o){"use strict";cc._RF.push(e,"b8f7e0qah9Ot5qnGbL59sxK","MiniMap"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("./Logic"),a=t("./Rect/RectDungeon"),n=t("./Rect/RectRoom"),s=t("./EventConstant"),r=cc._decorator,c=r.ccclass,l=r.property,h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.miniTile=null,e.size=0,e}var o;return __extends(e,t),o=e,e.prototype.onLoad=function(){var t=this;cc.director.on(s.EventConstant.CHANGE_MIMIMAP,function(e){t.changeMap(e.detail.x,e.detail.y)}),this.size=i.default.level+2;var e=a.default.LEVEL_5-i.default.level;e=Math.round(e/2),this.map=new Array;for(var o=0;o<this.size;o++){this.map[o]=new Array;for(var n=0;n<this.size;n++){var r=cc.instantiate(this.miniTile);this.map[o][n]=r,this.map[o][n].parent=this.node,this.map[o][n].position=cc.v2(o*r.width,n*r.height),this.map[o][n].color=cc.Color.BLACK,this.map[o][n].opacity=0}}},e.prototype.start=function(){},e.prototype.changeMap=function(t,e){if(this.map)for(var s=0;s<this.size;s++)for(var r=0;r<this.size;r++){var c=i.default.mapManger.rectDungeon.map[r][s].isFound,l=i.default.mapManger.rectDungeon.map[r][s].state,h=i.default.mapManger.rectDungeon.map[r][s].roomType;i.default.mapManger.rectDungeon.map[r][s].isPrimary;this.map[r][s].color=this.getColor(o.ColorLevel.HIDE),c&&(this.map[r][s].color=this.getColor(o.ColorLevel.NORMAL),this.map[r][s].opacity=255,l!=n.default.STATE_SLEEP&&l!=n.default.STATE_ACTIVE||(this.map[r][s].color=this.getColor(o.ColorLevel.NORMAL),h==a.default.BOSS_ROOM&&(this.map[r][s].color=this.getColor(o.ColorLevel.NORMAL_BOSS)),h==a.default.LOOT_ROOM&&(this.map[r][s].color=this.getColor(o.ColorLevel.NORMAL_LOOT)),h==a.default.END_ROOM&&i.default.level!=a.default.LEVEL_3&&i.default.level!=a.default.LEVEL_5&&(this.map[r][s].color=this.getColor(o.ColorLevel.NORMAL_END))),h==a.default.START_ROOM&&(this.map[r][s].color=this.getColor(o.ColorLevel.NORMAL_START)),h==a.default.MERCHANT_ROOM&&(this.map[r][s].color=this.getColor(o.ColorLevel.CLEAR_MERCHANT)),l==n.default.STATE_CLEAR&&(this.map[r][s].color=this.getColor(o.ColorLevel.CLEAR),h==a.default.BOSS_ROOM&&(this.map[r][s].color=this.getColor(o.ColorLevel.CLEAR_BOSS)),h==a.default.END_ROOM&&i.default.level!=a.default.LEVEL_3&&i.default.level!=a.default.LEVEL_5&&(this.map[r][s].color=this.getColor(o.ColorLevel.CLEAR_END)),h==a.default.LOOT_ROOM&&(this.map[r][s].color=this.getColor(o.ColorLevel.CLEAR_LOOT))),r==t&&s==e&&(this.map[t][e].color=this.getColor(o.ColorLevel.PLAYER)))}},e.prototype.getColor=function(t){var e=new cc.Color(0,0,0);switch(t){case o.ColorLevel.HIDE:e=new cc.Color(0,0,0);break;case o.ColorLevel.NORMAL:e=new cc.Color(128,128,128);break;case o.ColorLevel.CLEAR:e=new cc.Color(255,255,255);break;case o.ColorLevel.PLAYER:e=new cc.Color(0,255,0);break;case o.ColorLevel.NORMAL_START:e=new cc.Color(144,238,144);break;case o.ColorLevel.NORMAL_END:e=new cc.Color(100,149,237);break;case o.ColorLevel.NORMAL_BOSS:e=new cc.Color(128,0,128);break;case o.ColorLevel.NORMAL_LOOT:e=new cc.Color(255,215,0);break;case o.ColorLevel.CLEAR_LOOT:e=new cc.Color(240,230,140);break;case o.ColorLevel.CLEAR_BOSS:e=new cc.Color(75,0,130);break;case o.ColorLevel.CLEAR_END:e=new cc.Color(176,196,222);break;case o.ColorLevel.CLEAR_MERCHANT:e=new cc.Color(139,69,19)}return e},e.prototype.getMixColor=function(t,e){var o=t.clone(),i=e.clone(),a=cc.color(),n=o.getR()+i.getR(),s=o.getG()+i.getG(),r=o.getB()+i.getB();return a.setR(n>255?255:n),a.setG(s>255?255:s),a.setB(r>255?255:r),a},e.ColorLevel={HIDE:0,NORMAL:1,PLAYER:2,CLEAR:3,NORMAL_BOSS:4,CLEAR_MERCHANT:5,CLEAR_END:6,CLEAR_BOSS:7,NORMAL_LOOT:8,CLEAR_LOOT:9,NORMAL_START:10,NORMAL_END:11},__decorate([l(cc.Prefab)],e.prototype,"miniTile",void 0),e=o=__decorate([c],e)}(cc.Component);o.default=h,cc._RF.pop()},{"./EventConstant":"EventConstant","./Logic":"Logic","./Rect/RectDungeon":"RectDungeon","./Rect/RectRoom":"RectRoom"}],MonsterData:[function(t,e,o){"use strict";cc._RF.push(e,"1f11a18691HqqKqLoB//q4B","MonsterData"),Object.defineProperty(o,"__esModule",{value:!0});var i=function(){function t(){this.nameCn="",this.nameEn="",this.resName="",this.chapter=0,this.stageLevel=0,this.movespeed=0,this.maxHealth=0,this.attackPoint=0,this.invisible=0,this.remote=0,this.melee=0,this.dash=0,this.remoterate=0,this.meleerate=0,this.pos=cc.v2(0,0),this.currentHealth=0}return t.prototype.updateHA=function(t,e,o){this.currentHealth=t,this.maxHealth=e,this.attackPoint=o},t.prototype.valueCopy=function(t){this.nameCn=t.nameCn,this.nameEn=t.nameEn,this.resName=t.resName,this.chapter=t.chapter,this.stageLevel=t.stageLevel,this.movespeed=t.movespeed,this.maxHealth=t.maxHealth,this.currentHealth=t.currentHealth,this.attackPoint=t.attackPoint,this.invisible=t.invisible,this.remote=t.remote,this.melee=t.melee,this.dash=t.dash,this.pos=t.pos,this.remoterate=t.remoterate,this.meleerate=t.meleerate},t.prototype.clone=function(){var e=new t;return e.nameCn=this.nameCn,e.nameEn=this.nameEn,e.resName=this.resName,e.chapter=this.chapter,e.stageLevel=this.stageLevel,e.movespeed=this.movespeed,e.maxHealth=this.maxHealth,e.currentHealth=this.currentHealth,e.attackPoint=this.attackPoint,e.invisible=this.invisible,e.remote=this.remote,e.melee=this.melee,e.dash=this.dash,e.pos=this.pos,e.remoterate=this.remoterate,e.meleerate=this.meleerate,e},t}();o.default=i,cc._RF.pop()},{}],MonsterManager:[function(t,e,o){"use strict";cc._RF.push(e,"441f6g4iH9M574s+sdv3n8E","MonsterManager"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("../Monster"),a=t("../Data/MonsterData"),n=t("../Boss/Kraken"),s=t("../Boss/Captain"),r=t("../Logic"),c=cc._decorator,l=c.ccclass,h=c.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.monster=null,e.kraken=null,e.captain=null,e}return __extends(e,t),e.prototype.onLoad=function(){},e.prototype.getMonster=function(t,e){var o=null;(o=cc.instantiate(this.monster)).active=!1,o.parent=e.node;var n=o.getComponent(i.default);n.dungeon=e;var s=new a.default;return s.valueCopy(r.default.monsters[t]),n.changeBodyRes(t),n.data=s,n},e.prototype.getKraken=function(t,e){var o=null;(o=cc.instantiate(this.kraken)).active=!1,o.parent=t.node;var i=o.getComponent(n.default),s=new a.default;return s.updateHA(200,200,2),i.data=s,i.transportPlayer(e.x,e.y),i.healthBar=t.bossHealthBar,i.node.active=!0,i},e.prototype.getCaptain=function(t,e){var o=null;(o=cc.instantiate(this.captain)).active=!1,o.parent=t.node;var i=o.getComponent(s.default);i.dungeon=t;var n=new a.default;return n.updateHA(100,100,2),i.data=n,i.transportPlayer(e.x,e.y),i.healthBar=t.bossHealthBar,i.node.active=!0,i},e.prototype.start=function(){},e.BOSS_KRAKEN="BOSS_KRAKEN",e.MONSTER_SLIME="monster000",e.MONSTER_GOBLIN="monster001",e.MONSTER_MUMMY="monster002",e.MONSTER_ANUBIS="monster003",e.MONSTER_PIRATE="monster004",e.MONSTER_SAILOR="monster005",e.MONSTER_OCTOPUS="monster006",e.MONSTER_KILLER="monster007",e.MONSTER_STRONGSAILOR="monster008",__decorate([h(cc.Prefab)],e.prototype,"monster",void 0),__decorate([h(cc.Prefab)],e.prototype,"kraken",void 0),__decorate([h(cc.Prefab)],e.prototype,"captain",void 0),e=__decorate([l],e)}(cc.Component);o.default=p,cc._RF.pop()},{"../Boss/Captain":"Captain","../Boss/Kraken":"Kraken","../Data/MonsterData":"MonsterData","../Logic":"Logic","../Monster":"Monster"}],Monster:[function(t,e,o){"use strict";cc._RF.push(e,"b7513vXKLpHGrSf+utaohLs","Monster"),Object.defineProperty(o,"__esModule",{value:!0});var i=cc._decorator,a=i.ccclass,n=i.property,s=t("./EventConstant"),r=t("./HealthBar"),c=t("./Logic"),l=t("./Data/MonsterData"),h=t("./Dungeon"),p=t("./Shooter"),d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.pos=cc.v2(0,0),e.label=null,e.healthBar=null,e.isFaceRight=!0,e.isMoving=!1,e.isAttacking=!1,e.isDied=!1,e.isFall=!1,e.timeDelay=0,e.data=new l.default,e.shooter=null,e.isHurt=!1,e.isDashing=!1,e}return __extends(e,t),e.prototype.onLoad=function(){this.isAttacking=!1,this.isDied=!1,this.anim=this.getComponent(cc.Animation),this.sprite=this.node.getChildByName("sprite"),this.rigidbody=this.getComponent(cc.RigidBody),this.shooter=this.node.getChildByName("Shooter").getComponent(p.default),this.updatePlayerPos()},e.prototype.changeBodyRes=function(t){this.sprite||(this.sprite=this.node.getChildByName("sprite"));var e=this.sprite.getChildByName("body"),o=c.default.spriteFrames[t];e.getComponent(cc.Sprite).spriteFrame=o,e.width=o.getRect().width,e.height=o.getRect().height},e.prototype.updatePlayerPos=function(){this.node.x=64*this.pos.x+32,this.node.y=64*this.pos.y+32},e.prototype.transportPlayer=function(t,e){this.sprite.rotation=0,this.sprite.scale=1,this.sprite.opacity=255,this.sprite.x=0,this.sprite.y=0,this.pos.x=t,this.pos.y=e,this.changeZIndex(),this.updatePlayerPos()},e.prototype.changeZIndex=function(){this.node.zIndex=3e3+100*(h.default.HEIGHT_SIZE-this.pos.y)+2},e.prototype.meleeAttack=function(t,e){var o=this;if(!this.isAttacking){this.isAttacking=!0,this.anim.pause(),t.equals(cc.Vec2.ZERO)&&(t=cc.v2(1,0)),t=t.normalizeSelf().mul(32);var i=cc.sequence(cc.moveBy(.2,-t.x/2,-t.y/2),cc.moveBy(.2,t.x,t.y),cc.callFunc(function(){o.isAttacking=!1,o.anim.resume(),e&&e(o.data.attackPoint)}),cc.moveTo(.2,0,0));this.sprite.runAction(i)}},e.prototype.getNearPlayerDistance=function(t){return c.default.getDistance(this.node.position,t.position)},e.prototype.move=function(t,e){if(!(this.isDied||this.isFall||this.isHurt||this.isDashing||t.equals(cc.Vec2.ZERO))){t=t.normalizeSelf(),this.isAttacking&&!t.equals(cc.Vec2.ZERO)&&(t=t.mul(.5)),t.equals(cc.Vec2.ZERO)||(this.pos=h.default.getIndexInMap(this.node.position));var o=t.x,i=t.y,a=Math.abs(o),n=Math.abs(i),s=a>n?a:n;s=0==s?1:s;var r=cc.v2(o,i);r=r.mul(e),this.rigidbody.linearVelocity=r,this.isMoving=0!=o||0!=i,this.isMoving&&(this.isFaceRight=o>0),this.isMoving?this.anim.getAnimationState("PlayerWalk").isPlaying||this.anim.playAdditive("PlayerWalk"):this.anim.getAnimationState("PlayerWalk").isPlaying&&this.anim.play("PlayerIdle"),this.changeZIndex()}},e.prototype.start=function(){this.changeZIndex(),this.healthBar.refreshHealth(this.data.currentHealth,this.data.maxHealth)},e.prototype.fall=function(){this.isFall||(this.isFall=!0,this.isDied=!0,this.getComponent("cc.PhysicsCollider").sensor=!0,this.anim.play("PlayerFall"))},e.prototype.takeDamage=function(t){var e=this;return!(this.data.invisible&&this.sprite.opacity<200&&c.default.getHalfChance())&&(this.isHurt=!0,setTimeout(function(){e.node&&(e.isHurt=!1)},1e3),this.sprite.opacity=255,this.data.currentHealth-=t,this.data.currentHealth>this.data.maxHealth&&(this.data.currentHealth=this.data.maxHealth),this.healthBar.refreshHealth(this.data.currentHealth,this.data.maxHealth),!0)},e.prototype.killed=function(){var t=this;if(!this.isDied){this.isDied=!0,this.anim.play("PlayerDie"),this.getComponent("cc.PhysicsCollider").sensor=!0;var e=Math.random();e<.9?cc.director.emit(s.EventConstant.DUNGEON_ADD_COIN,{detail:{pos:this.node.position,count:c.default.getRandomNum(1,10)}}):e>=.9&&e<.98?cc.director.emit(s.EventConstant.DUNGEON_ADD_HEART,{detail:{pos:this.node.position}}):cc.director.emit(s.EventConstant.DUNGEON_ADD_AMMO,{detail:{pos:this.node.position}}),setTimeout(function(){t.node&&(t.node.active=!1)},5e3)}},e.prototype.monsterAction=function(){var t=this;if(!this.isDied&&this.dungeon&&!this.isHurt){this.node.position=h.default.fixOuterMap(this.node.position),this.pos=h.default.getIndexInMap(this.node.position),this.changeZIndex();var e=cc.v2(0,0);e.x+=c.default.getRandomNum(0,200)-100,e.y+=c.default.getRandomNum(0,200)-100;var o=this.getNearPlayerDistance(this.dungeon.player.node),i=e.clone();if(o<64&&!this.dungeon.player.isDied&&1==this.data.melee&&!this.isDashing&&((i=this.dungeon.player.node.position.sub(this.node.position)).equals(cc.Vec2.ZERO)||(i=i.normalizeSelf()),this.meleeAttack(i,function(e){t.getNearPlayerDistance(t.dungeon.player.node)<64&&t.dungeon.player.takeDamage(e)}),this.sprite.opacity=255),1==this.data.melee&&(i=this.dungeon.player.node.position.sub(this.node.position)),o<600&&1==this.data.remote&&c.default.getRandomNum(0,100)<this.data.remoterate&&this.shooter){var a=this.dungeon.player.node.position.sub(this.node.position);a.equals(cc.Vec2.ZERO)||(a=a.normalizeSelf(),this.shooter.setHv(a),this.shooter.dungeon=this.dungeon,this.shooter.fireBullet())}var n=this.data.movespeed;o<600&&o>100&&!this.dungeon.player.isDied&&1==this.data.dash&&!this.isDashing&&(i=this.dungeon.player.node.position.sub(this.node.position),this.move(i,2*n),this.isDashing=!0,setTimeout(function(){t.node&&(t.isDashing=!1)},2e3)),this.move(i,n)}},e.prototype.lerp=function(t,e,o){return t+(e-t)*o},e.prototype.getPosDir=function(t,e){var o=4;return e.x==t.x&&(o=e.y>t.y?0:1),e.y==t.y&&(o=e.x>t.x?3:2),e.equals(t)&&(o=4),o},e.prototype.getMonsterBestDir=function(t,e){var o=cc.v2(t.x,t.y),i=new Array;t.y+1<h.default.HEIGHT_SIZE&&i.push(cc.v2(t.x,t.y+1)),t.y-1>=0&&i.push(cc.v2(t.x,t.y-1)),t.x-1>=0&&i.push(cc.v2(t.x-1,t.y)),t.x+1<h.default.WIDTH_SIZE&&i.push(cc.v2(t.x+1,t.y)),i.sort(function(){return.5-Math.random()});for(var a=new Array,n=0;n<i.length;n++){var s=i[n];if(!e.map[s.x][s.y].isBroken){var r=!1,c=e.wallmap[s.x][s.y];c&&c.node.active&&(r=!0),r||a.push(s)}}for(n=0;n<a.length;n++){s=a[n];if(!e.map[s.x][s.y].isBreakingNow){o=s;break}}return this.getPosDir(t,o)},e.prototype.update=function(t){(this.timeDelay+=t,this.timeDelay>.2&&(this.timeDelay=0,this.monsterAction()),1==this.data.invisible&&0!=this.sprite.opacity&&(this.sprite.opacity=this.lerp(this.sprite.opacity,0,3*t)),this.dungeon)&&(this.getNearPlayerDistance(this.dungeon.player.node)<64&&!this.isHurt&&this.isDashing&&(this.isDashing=!1,this.rigidbody.linearVelocity=cc.Vec2.ZERO,this.dungeon.player.takeDamage(this.data.attackPoint)));this.isDied&&(this.rigidbody.linearVelocity=cc.Vec2.ZERO),this.label&&(this.label.string=""+this.node.zIndex),this.healthBar.node.active=!this.isDied,this.data.currentHealth<1&&this.killed(),this.node.scaleX=this.isFaceRight?1:-1,this.healthBar.node.scaleX=this.node.scaleX,this.healthBar.node.x=-30*this.node.scaleX},__decorate([n(cc.Vec2)],e.prototype,"pos",void 0),__decorate([n(cc.Label)],e.prototype,"label",void 0),__decorate([n(r.default)],e.prototype,"healthBar",void 0),e=__decorate([a],e)}(cc.Component);o.default=d,cc._RF.pop()},{"./Data/MonsterData":"MonsterData","./Dungeon":"Dungeon","./EventConstant":"EventConstant","./HealthBar":"HealthBar","./Logic":"Logic","./Shooter":"Shooter"}],OilLake:[function(t,e,o){"use strict";cc._RF.push(e,"8cd153I1qFEbb/uteHyUJpM","OilLake"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("./PerlinNoise2D"),a=cc._decorator,n=a.ccclass,s=(a.property,function(){function t(){this.map=new Array;var t,o,a,n,s=new i.default;s.seed(Math.random()),a=20+this.getRandomNum(20),n=20+this.getRandomNum(20),t=this.getRandomNum(9999),o=this.getRandomNum(9999);var r=e.WIDTH,c=e.HEIGHT;this.map=new Array;for(var l=0;l<r;l++){this.map[l]=new Array;for(var h=0;h<c;h++){this.map[l][h]=".";var p=a*l/r+t,d=n*h/c+o,u=s.simplex2(p,d);u>.14?this.map[l][h]="Y":u<-.14&&(this.map[l][h]="~");var m=Math.random();m>=0&&m<.2&&"~"!=this.map[l][h]&&(this.map[l][h]="o"),m>=.2&&m<.25&&"~"!=this.map[l][h]&&(this.map[l][h]="w")}}}var e;return e=t,t.prototype.getRandomNum=function(t){return Math.round(Math.random()*t)},t.prototype.getDisPlay=function(){for(var t="",o=e.HEIGHT-1;o>=0;o--){for(var i=0;i<e.WIDTH;i++)t+=this.map[i][o];t+="\n"}return t},t.WIDTH=64,t.HEIGHT=64,t=e=__decorate([n],t)}());o.default=s,cc._RF.pop()},{"./PerlinNoise2D":"PerlinNoise2D"}],PerlinNoise2D:[function(t,e,o){"use strict";cc._RF.push(e,"59901zRRqlG9KvoKLDTbxq7","PerlinNoise2D"),Object.defineProperty(o,"__esModule",{value:!0});var i=cc._decorator,a=i.ccclass,n=(i.property,function(){function t(){this.grad3=[new s(1,1,0),new s(-1,1,0),new s(1,-1,0),new s(-1,-1,0),new s(1,0,1),new s(-1,0,1),new s(1,0,-1),new s(-1,0,-1),new s(0,1,1),new s(0,-1,1),new s(0,1,-1),new s(0,-1,-1)],this.p=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],this.perm=new Array(512),this.gradP=new Array(512),this.F2=.5*(Math.sqrt(3)-1),this.G2=(3-Math.sqrt(3))/6,this.F3=1/3,this.G3=1/6}return t.prototype.simplex2=function(t,e){var o,i,a=(t+e)*this.F2,n=Math.floor(t+a),s=Math.floor(e+a),r=(n+s)*this.G2,c=t-n+r,l=e-s+r;c>l?(o=1,i=0):(o=0,i=1);var h=c-o+this.G2,p=l-i+this.G2,d=c-1+2*this.G2,u=l-1+2*this.G2;n&=255,s&=255;var m=this.gradP[n+this.perm[s]],y=this.gradP[n+o+this.perm[s+i]],f=this.gradP[n+1+this.perm[s+1]],g=.5-c*c-l*l,v=.5-h*h-p*p,_=.5-d*d-u*u;return 70*((g<0?0:(g*=g)*g*m.dot2(c,l))+(v<0?0:(v*=v)*v*y.dot2(h,p))+(_<0?0:(_*=_)*_*f.dot2(d,u)))},t.prototype.simplex3=function(t,e,o){var i,a,n,s,r,c,l=(t+e+o)*this.F3,h=Math.floor(t+l),p=Math.floor(e+l),d=Math.floor(o+l),u=(h+p+d)*this.G3,m=t-h+u,y=e-p+u,f=o-d+u;m>=y?y>=f?(i=1,a=0,n=0,s=1,r=1,c=0):m>=f?(i=1,a=0,n=0,s=1,r=0,c=1):(i=0,a=0,n=1,s=1,r=0,c=1):y<f?(i=0,a=0,n=1,s=0,r=1,c=1):m<f?(i=0,a=1,n=0,s=0,r=1,c=1):(i=0,a=1,n=0,s=1,r=1,c=0);var g=m-i+this.G3,v=y-a+this.G3,_=f-n+this.G3,E=m-s+2*this.G3,D=y-r+2*this.G3,R=f-c+2*this.G3,C=m-1+3*this.G3,M=y-1+3*this.G3,S=f-1+3*this.G3;h&=255,p&=255,d&=255;var P=this.gradP[h+this.perm[p+this.perm[d]]],T=this.gradP[h+i+this.perm[p+a+this.perm[d+n]]],O=this.gradP[h+s+this.perm[p+r+this.perm[d+c]]],A=this.gradP[h+1+this.perm[p+1+this.perm[d+1]]],b=.6-m*m-y*y-f*f,L=.6-g*g-v*v-_*_,x=.6-E*E-D*D-R*R,I=.6-C*C-M*M-S*S;return 32*((b<0?0:(b*=b)*b*P.dot3(m,y,f))+(L<0?0:(L*=L)*L*T.dot3(g,v,_))+(x<0?0:(x*=x)*x*O.dot3(E,D,R))+(I<0?0:(I*=I)*I*A.dot3(C,M,S)))},t.prototype.perlin2=function(t,e){var o=Math.floor(t),i=Math.floor(e);t-=o,e-=i,o&=255,i&=255;var a=this.gradP[o+this.perm[i]].dot2(t,e),n=this.gradP[o+this.perm[i+1]].dot2(t,e-1),s=this.gradP[o+1+this.perm[i]].dot2(t-1,e),r=this.gradP[o+1+this.perm[i+1]].dot2(t-1,e-1),c=this.fade(t);return this.lerp(this.lerp(a,s,c),this.lerp(n,r,c),this.fade(e))},t.prototype.perlin3=function(t,e,o){var i=Math.floor(t),a=Math.floor(e),n=Math.floor(o);t-=i,e-=a,o-=n,i&=255,a&=255,n&=255;var s=this.gradP[i+this.perm[a+this.perm[n]]].dot3(t,e,o),r=this.gradP[i+this.perm[a+this.perm[n+1]]].dot3(t,e,o-1),c=this.gradP[i+this.perm[a+1+this.perm[n]]].dot3(t,e-1,o),l=this.gradP[i+this.perm[a+1+this.perm[n+1]]].dot3(t,e-1,o-1),h=this.gradP[i+1+this.perm[a+this.perm[n]]].dot3(t-1,e,o),p=this.gradP[i+1+this.perm[a+this.perm[n+1]]].dot3(t-1,e,o-1),d=this.gradP[i+1+this.perm[a+1+this.perm[n]]].dot3(t-1,e-1,o),u=this.gradP[i+1+this.perm[a+1+this.perm[n+1]]].dot3(t-1,e-1,o-1),m=this.fade(t),y=this.fade(e),f=this.fade(o);return this.lerp(this.lerp(this.lerp(s,h,m),this.lerp(r,p,m),f),this.lerp(this.lerp(c,d,m),this.lerp(l,u,m),f),y)},t.prototype.seed=function(t){t>0&&t<1&&(t*=65536),(t=Math.floor(t))<256&&(t|=t<<8);for(var e=0;e<256;e++){var o=void 0;o=1&e?this.p[e]^255&t:this.p[e]^t>>8&255,this.perm[e]=this.perm[e+256]=o,this.gradP[e]=this.gradP[e+256]=this.grad3[o%12]}},t.prototype.lerp=function(t,e,o){return(1-o)*t+o*e},t.prototype.fade=function(t){return t*t*t*(t*(6*t-15)+10)},t=__decorate([a],t)}());o.default=n;var s=function(){function t(t,e,o){this.x=t,this.y=e,this.z=o}return t.prototype.dot2=function(t,e){return this.x*t+this.y*e},t.prototype.dot3=function(t,e,o){return this.x*t+this.y*e+this.z*o},t}();cc._RF.pop()},{}],PlayerData:[function(t,e,o){"use strict";cc._RF.push(e,"802a53ZqslNorozVvKYFivM","PlayerData"),Object.defineProperty(o,"__esModule",{value:!0});var i=function(){function t(){this.name="",this.basehealth=cc.v2(t.DEFAULT_HEALTH,t.DEFAULT_HEALTH),this.attackPoint=1,this.pos=cc.v2(7,4)}return t.prototype.updateHA=function(t,e){return this.basehealth=t,this.attackPoint=e,this},t.DEFAULT_HEALTH=5,t}();o.default=i,cc._RF.pop()},{}],Player:[function(t,e,o){"use strict";cc._RF.push(e,"03570PUzDdNyIu4Asd1jFZT","Player"),Object.defineProperty(o,"__esModule",{value:!0});var i=cc._decorator,a=i.ccclass,n=i.property,s=t("./EventConstant"),r=t("./Shooter"),c=t("./HealthBar"),l=t("./Logic"),h=t("./Dungeon"),p=t("./Equipment/Equipment"),d=t("./MeleeWeapon"),u=t("./Rect/RectDungeon"),m=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.pos=cc.v2(4,4),e.label=null,e.healthBar=null,e.walksmoke=null,e.meleeWeaponNode=null,e.meleeWeapon=null,e.shooterNode=null,e.shooter=null,e.hairSprite=null,e.weaponSprite=null,e.weaponLightSprite=null,e.weaponStabSprite=null,e.weaponStabLightSprite=null,e.helmetSprite=null,e.clothesSprite=null,e.trousersSprite=null,e.glovesLeftSprite=null,e.glovesRightSprite=null,e.shoesLeftSprite=null,e.shoesRightSprite=null,e.cloakSprite=null,e.isMoving=!1,e.isAttacking=!1,e.isDied=!1,e.isFall=!1,e.health=cc.v2(1,1),e.baseAttackPoint=1,e.recoveryTimeDelay=0,e.isFaceRight=!0,e.defaultPos=cc.v2(0,0),e.remoteRate=0,e.smokeTimeDelay=0,e}return __extends(e,t),e.prototype.onLoad=function(){var t=this;this.isAttacking=!1,this.inventoryData=l.default.inventoryData,this.health=this.inventoryData.getHealth(l.default.playerData.basehealth,l.default.playerData.basehealth.y),this.pos=cc.v2(4,4),this.isDied=!1,this.anim=this.getComponent(cc.Animation);var e="PlayerWalkShort";1==this.inventoryData.trousers.trouserslong&&(e="PlayerWalk"),this.anim&&this.anim.play(e),this.rigidbody=this.getComponent(cc.RigidBody),this.sprite=this.node.getChildByName("sprite"),this.playerItemSprite=this.sprite.getChildByName("righthand").getChildByName("item").getComponent(cc.Sprite),this.hairSprite=this.sprite.getChildByName("body").getChildByName("hair").getComponent(cc.Sprite),this.weaponSprite=this.node.getChildByName("MeleeWeapon").getChildByName("sprite").getChildByName("weapon").getComponent(cc.Sprite),this.weaponLightSprite=this.node.getChildByName("MeleeWeapon").getChildByName("sprite").getChildByName("meleelight").getComponent(cc.Sprite),this.weaponStabSprite=this.node.getChildByName("MeleeWeapon").getChildByName("sprite").getChildByName("stabweapon").getComponent(cc.Sprite),this.weaponStabLightSprite=this.node.getChildByName("MeleeWeapon").getChildByName("sprite").getChildByName("stablight").getComponent(cc.Sprite),this.helmetSprite=this.sprite.getChildByName("body").getChildByName("helmet").getComponent(cc.Sprite),this.clothesSprite=this.sprite.getChildByName("body").getChildByName("clothes").getComponent(cc.Sprite),this.trousersSprite=this.sprite.getChildByName("body").getChildByName("trousers").getComponent(cc.Sprite),this.glovesLeftSprite=this.sprite.getChildByName("body").getChildByName("glovesleft").getComponent(cc.Sprite),this.glovesRightSprite=this.sprite.getChildByName("body").getChildByName("glovesright").getComponent(cc.Sprite),this.shoesLeftSprite=this.sprite.getChildByName("body").getChildByName("shoesleft").getComponent(cc.Sprite),this.shoesRightSprite=this.sprite.getChildByName("body").getChildByName("shoesright").getComponent(cc.Sprite),this.cloakSprite=this.sprite.getChildByName("cloak").getComponent(cc.Sprite),cc.director.on(s.EventConstant.INVENTORY_CHANGEITEM,function(e){t.changeItem(e.detail.spriteFrame)}),cc.director.on(s.EventConstant.PLAYER_USEITEM,function(e){t.UseItem()}),cc.director.on(s.EventConstant.PLAYER_ATTACK,function(e){t.meleeAttack()}),cc.director.on(s.EventConstant.PLAYER_REMOTEATTACK,function(e){t.remoteAttack()}),cc.director.on(s.EventConstant.PLAYER_TAKEDAMAGE,function(e){t.takeDamage(e.detail.damage)}),cc.director.on(s.EventConstant.PLAYER_ROTATE,function(e){t.rotatePlayer(e.detail.dir,e.detail.pos,e.detail.dt)}),l.default.mapManger.currentRectRoom.roomType==u.default.BOSS_ROOM&&(l.default.playerData.pos=cc.v2(Math.floor(h.default.WIDTH_SIZE/2),Math.floor(h.default.HEIGHT_SIZE/2))),this.pos=l.default.playerData.pos,this.defaultPos=l.default.playerData.pos.clone(),this.baseAttackPoint=l.default.playerData.attackPoint,this.updatePlayerPos(),this.meleeWeapon=this.meleeWeaponNode.getComponent(d.default),this.shooter=this.shooterNode.getComponent(r.default),this.shooter.player=this,this.smokePool=new cc.NodePool,cc.director.on("destorysmoke",function(e){t.destroySmoke(e.detail.coinNode)})},e.prototype.getWalkSmoke=function(t,e){var o=null;this.smokePool.size()>0&&(o=this.smokePool.get()),o&&!o.active||(o=cc.instantiate(this.walksmoke)),o.parent=t,o.position=e,o.zIndex=4e3,o.opacity=255,o.active=!0},e.prototype.destroySmoke=function(t){t&&(t.active=!1,this.smokePool&&this.smokePool.put(t))},e.prototype.changeItem=function(t){this.playerItemSprite.spriteFrame=t},e.prototype.changeEquipment=function(t,e){switch(t.equipmetType){case"weapon":this.meleeWeapon.isStab=1==t.stab,this.meleeWeapon.isFar=1==t.far,1==t.stab?(this.weaponSprite.spriteFrame=null,this.weaponStabSprite.spriteFrame=e,this.weaponStabLightSprite.spriteFrame=l.default.spriteFrames.stablight):(this.weaponSprite.spriteFrame=e,this.weaponStabSprite.spriteFrame=null);var o=cc.color(255,255,255).fromHEX(this.inventoryData.weapon.color);this.weaponSprite.node.color=o,this.weaponLightSprite.node.color=o,this.weaponStabSprite.node.color=o,this.weaponStabLightSprite.node.color=o;break;case"helmet":this.helmetSprite.spriteFrame=e,this.hairSprite.node.opacity=e?0:255;var i=cc.color(255,255,255).fromHEX(this.inventoryData.helmet.color);this.helmetSprite.node.color=i;break;case"clothes":this.clothesSprite.spriteFrame=e;var a=cc.color(255,255,255).fromHEX(this.inventoryData.clothes.color);this.clothesSprite.node.color=a;break;case"trousers":this.trousersSprite.spriteFrame=1==t.trouserslong?l.default.spriteFrames.idle002:l.default.spriteFrames.idle001;var n=cc.color(255,255,255).fromHEX(this.inventoryData.trousers.color);this.trousersSprite.node.color=n;break;case"gloves":this.glovesLeftSprite.spriteFrame=e;var s=cc.color(255,255,255).fromHEX(this.inventoryData.gloves.color);this.glovesLeftSprite.node.color=s,this.glovesRightSprite.spriteFrame=e;var r=cc.color(255,255,255).fromHEX(this.inventoryData.gloves.color);this.glovesRightSprite.node.color=r;break;case"shoes":this.shoesLeftSprite.spriteFrame=e;var c=cc.color(255,255,255).fromHEX(this.inventoryData.shoes.color);this.shoesLeftSprite.node.color=c,this.shoesRightSprite.spriteFrame=e;var h=cc.color(255,255,255).fromHEX(this.inventoryData.shoes.color);this.shoesRightSprite.node.color=h;break;case"cloak":this.cloakSprite.spriteFrame=e;var p=cc.color(255,255,255).fromHEX(this.inventoryData.cloak.color);this.cloakSprite.node.color=p}this.health=this.inventoryData.getHealth(this.health,l.default.playerData.basehealth.y),this.healthBar&&this.healthBar.refreshHealth(this.health.x,this.health.y)},e.prototype.updatePlayerPos=function(){this.node.x=64*this.pos.x+32,this.node.y=64*this.pos.y+32},e.prototype.transportPlayer=function(t){this.sprite&&(this.sprite.rotation=0,this.sprite.scale=1,this.sprite.opacity=255,this.sprite.x=0,this.sprite.y=0,this.pos=t,this.changeZIndex(this.pos),this.updatePlayerPos())},e.prototype.changeZIndex=function(t){this.node.zIndex=3e3+100*(h.default.HEIGHT_SIZE-t.y)+2},e.prototype.meleeAttack=function(){var t=this;if(this.meleeWeapon&&!this.isAttacking){this.isAttacking=!0;var e=this.meleeWeapon.getHv().clone();e.equals(cc.Vec2.ZERO)&&(e=cc.v2(1,0)),e=e.normalizeSelf().mul(5);var o=300-this.inventoryData.getAttackSpeed();o<0&&(o=0),o>3e3&&(o=3e3);var i=cc.sequence(cc.moveBy(.1,e.x,e.y),cc.moveBy(.1,-e.x,-e.y),cc.callFunc(function(){setTimeout(function(){t.sprite.position=cc.v2(0,0),t.isAttacking=!1},o)},this));this.sprite.runAction(i),this.meleeWeapon.attack(this.inventoryData.getAttackSpeed())}},e.prototype.remoteAttack=function(){var t=Date.now();t-this.remoteRate>400&&(this.remoteRate=t,this.shooter&&this.shooter.fireBullet(0))},e.prototype.rotatePlayer=function(t,e,o){!this.node||this.isDied||this.isFall||this.meleeWeapon&&!e.equals(cc.Vec2.ZERO)&&this.meleeWeapon.setHv(cc.v2(e.x,e.y))},e.prototype.move=function(t,e,o){if(!this.isDied&&!this.isFall){this.isAttacking&&!e.equals(cc.Vec2.ZERO)&&(e=e.mul(.5)),this.shooter&&!e.equals(cc.Vec2.ZERO)&&(this.shooter.setHv(cc.v2(e.x,e.y)),this.pos=h.default.getIndexInMap(this.node.position)),this.meleeWeapon&&!e.equals(cc.Vec2.ZERO)&&this.meleeWeapon.setHv(cc.v2(e.x,e.y));var i=e.x,a=e.y,n=Math.abs(i),s=Math.abs(a),r=n>s?n:s;r=0==r?1:r;var c=cc.v2(i,a),p=this.inventoryData.getMoveSpeed(300);c=c.mul(p),this.rigidbody.linearVelocity=c,this.isMoving=0!=i||0!=a,this.isMoving&&(this.isFaceRight=i>0);var d="PlayerWalkShort",u="idle001";1==this.inventoryData.trousers.trouserslong&&(d="PlayerWalk",u="idle002"),this.isMoving?this.anim.getAnimationState(d).isPlaying||this.anim.playAdditive(d):this.anim.getAnimationState(d).isPlaying&&(this.anim.play("PlayerIdle"),this.trousersSprite.spriteFrame=l.default.spriteFrames[u]),(1==t||0==t)&&this.changeZIndex(this.pos)}},e.prototype.start=function(){this.node&&(this.changeZIndex(this.pos),this.health=this.inventoryData.getHealth(this.health,l.default.playerData.basehealth.y),this.healthBar&&this.healthBar.refreshHealth(this.health.x,this.health.y))},e.prototype.fall=function(){var t=this;this.isFall||(this.isFall=!0,this.anim.play("PlayerFall"),this.isAttacking=!1,setTimeout(function(){t.transportPlayer(t.defaultPos),t.anim.play("PlayerIdle"),t.takeDamage(1),t.isFall=!1},2e3))},e.prototype.takeDamage=function(t){if(this.healthBar){var e=this.inventoryData.getDamage(t),o=this.inventoryData.getDodge(),i=Math.random()<=o&&e>0;e=i?0:e,this.health=this.inventoryData.getHealth(this.health,l.default.playerData.basehealth.y),this.health.x-=e,this.health.x>this.health.y&&(this.health.x=this.health.y),this.healthBar.refreshHealth(this.health.x,this.health.y),l.default.playerData.basehealth.x=this.health.x,this.label&&(this.label.node.opacity=255,this.label.node.scaleX=this.node.scaleX,this.label.node.color=t>0?cc.color(255,0,0):cc.color(0,255,0),this.label.string=""+parseFloat((-t).toFixed(1)),i&&(this.label.node.color=cc.color(255,255,255),this.label.string="miss"),this.label.getComponent(cc.Animation).play("FontFloating")),this.health.x<=0&&this.killed()}},e.prototype.killed=function(){this.isDied||(this.isDied=!0,this.anim.play("PlayerDie"),setTimeout(function(){cc.director.loadScene("gameover")},1e3))},e.prototype.playerAction=function(t,e,o,i){this.meleeWeapon&&!this.meleeWeapon.dungeon&&(this.meleeWeapon.dungeon=i),this.shooter&&!this.shooter.dungeon&&(this.shooter.dungeon=i),this.move(t,e,o)},e.prototype.isRecoveryTimeDelay=function(t){return this.recoveryTimeDelay+=t,this.recoveryTimeDelay>30&&(this.recoveryTimeDelay=0,!0)},e.prototype.isSmokeTimeDelay=function(t){return this.smokeTimeDelay+=t,this.smokeTimeDelay>.2&&(this.smokeTimeDelay=0,!0)},e.prototype.update=function(t){if(this.isRecoveryTimeDelay(t)){var e=this.inventoryData.getRecovery();e>0&&this.takeDamage(-e)}this.isSmokeTimeDelay(t)&&this.isMoving&&this.getWalkSmoke(this.node.parent,this.node.position),this.node.scaleX=this.isFaceRight?1:-1},e.prototype.UseItem=function(){this.touchedEquipment&&!this.touchedEquipment.isTaken&&(this.touchedEquipment.shopTable?l.default.coins>=this.touchedEquipment.shopTable.data.price&&(cc.director.emit(s.EventConstant.HUD_ADD_COIN,{detail:{count:-this.touchedEquipment.shopTable.data.price}}),this.touchedEquipment.taken(),this.touchedEquipment.shopTable.data.isSaled=!0,this.touchedEquipment=null):(this.touchedEquipment.taken(),this.touchedEquipment=null))},e.prototype.AttackFinish=function(){this.isAttacking=!1},e.prototype.onCollisionEnter=function(t,e){this.touchedEquipment=null},e.prototype.onCollisionExit=function(t,e){this.touchedEquipment=null},e.prototype.onCollisionStay=function(t,e){var o=t.node.getComponent(p.default);o&&(this.touchedEquipment=o)},__decorate([n(cc.Vec2)],e.prototype,"pos",void 0),__decorate([n(cc.Label)],e.prototype,"label",void 0),__decorate([n(c.default)],e.prototype,"healthBar",void 0),__decorate([n(cc.Prefab)],e.prototype,"walksmoke",void 0),__decorate([n(cc.Node)],e.prototype,"meleeWeaponNode",void 0),__decorate([n(cc.Node)],e.prototype,"shooterNode",void 0),e=__decorate([a],e)}(cc.Component);o.default=m,cc._RF.pop()},{"./Dungeon":"Dungeon","./Equipment/Equipment":"Equipment","./EventConstant":"EventConstant","./HealthBar":"HealthBar","./Logic":"Logic","./MeleeWeapon":"MeleeWeapon","./Rect/RectDungeon":"RectDungeon","./Shooter":"Shooter"}],Portal:[function(t,e,o){"use strict";cc._RF.push(e,"deb90P3hX5AB5svKZmVAO6Q","Portal"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("../Dungeon"),a=t("../EventConstant"),n=t("../Player"),s=cc._decorator,r=s.ccclass,c=(s.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isOpen=!1,e.pos=cc.v2(4,4),e}return __extends(e,t),e.prototype.start=function(){this.anim=this.getComponent(cc.Animation),this.anim.play("PortalCloseIdle")},e.prototype.setPos=function(t){this.pos=t,this.node.position=i.default.getPosInMap(t),this.node.zIndex=1e3+100*(i.default.HEIGHT_SIZE-t.y)+1},e.prototype.AnimGateClose=function(){this.anim.play("PortalCloseIdle")},e.prototype.AnimGateOpen=function(){this.anim.play("PortalOpenIdle")},e.prototype.openGate=function(){this.isOpen||(this.isOpen=!0,this.anim.play("PortalOpen"))},e.prototype.closeGate=function(){this.isOpen&&(this.isOpen=!1,this.anim.play("PortalClose"))},e.prototype.transportPlayer=function(t){t.x==this.pos.x&&t.y==this.pos.y&&this.isOpen},e.prototype.onBeginContact=function(t,e,o){o.body.node.getComponent(n.default)&&this.isOpen&&(this.closeGate(),cc.director.emit(a.EventConstant.LOADINGNEXTLEVEL))},e=__decorate([r],e)}(cc.Component));o.default=c,cc._RF.pop()},{"../Dungeon":"Dungeon","../EventConstant":"EventConstant","../Player":"Player"}],RectDoor:[function(t,e,o){"use strict";cc._RF.push(e,"d41e5HipSBBVLDWw2G1WR/C","RectDoor"),Object.defineProperty(o,"__esModule",{value:!0});var i=function(){return function(t,e,o){this.isLocked=!1,this.isDoor=!1,this.dir=t,this.isLocked=e,this.isDoor=o}}();o.default=i,cc._RF.pop()},{}],RectDungeon:[function(t,e,o){"use strict";cc._RF.push(e,"3b710jO571KQpPd9DCAmaJb","RectDungeon"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("./RectRoom"),a=function(){function t(t){this.level=1,this.level=t,this.size=t+2,this.primaryRooms=new Array,this.secondaryRooms=new Array,this.buildMap()}return t.prototype.buildMap=function(){this.map=new Array;for(var e=0;e<this.size;e++){this.map[e]=new Array;for(var o=0;o<this.size;o++)this.map[e][o]=null,(1==e||e==this.level)&&o>=1&&o<=this.level||(1==o||o==this.level)&&e>=1&&e<=this.level?this.map[e][o]=new i.default(!0,0,e,o,t.EMPTY_ROOM):this.map[e][o]=new i.default(!1,0,e,o,t.EMPTY_ROOM)}this.addPrimaryRooms(),this.addSecondaryRooms(),this.buildPrimaryRoomsType(),this.buildSecondaryRoomsType(),this.addLootKeys(),this.addDoors()},t.prototype.addPrimaryRooms=function(){for(var t=1,e=1;e<=this.level;e++){var o=1;this.map[e][o].isPrimary&&(this.map[e][o].index=t,this.primaryRooms.push(this.map[e][o]),t++)}for(o=2;o<=this.level;o++){e=this.level;this.map[e][o].isPrimary&&(this.map[e][o].index=t,this.primaryRooms.push(this.map[e][o]),t++)}for(e=this.level-1;e>0;e--){o=this.level;this.map[e][o].isPrimary&&(this.map[e][o].index=t,this.primaryRooms.push(this.map[e][o]),t++)}for(o=this.level-1;o>1;o--){e=1;this.map[e][o].isPrimary&&(this.map[e][o].index=t,this.primaryRooms.push(this.map[e][o]),t++)}},t.prototype.addSecondaryRooms=function(){for(var t=1,e=0;e<this.size;e++)for(var o=0;o<this.size;o++)this.isSecondaryRoom(e,o)&&(this.map[e][o].index=t++,this.secondaryRooms.push(this.map[e][o]))},t.prototype.isSecondaryRoom=function(t,e){return!this.isPrimaryRoom(t,e)&&!!(this.isPrimaryRoom(t+1,e)||this.isPrimaryRoom(t,e+1)||this.isPrimaryRoom(t-1,e)||this.isPrimaryRoom(t,e-1))},t.prototype.isPrimaryRoom=function(t,e){return!!(t<this.size-1&&t>0&&e<this.size-1&&e>0&&this.map[t][e].isPrimary)},t.prototype.buildPrimaryRoomsType=function(){for(var e=[t.TRAP_ROOM,t.DANGER_ROOM],o=0,i=this.primaryRooms;o<i.length;o++){var a=i[o],n=e[this.getRandomNum(0,e.length-1)];a.roomType=n}var s=this.getRandomNum(0,this.primaryRooms.length-1),r=s-1;r<0&&(r=this.primaryRooms.length-1),this.primaryRooms[r].roomType=t.END_ROOM,this.endRoom=this.primaryRooms[r],this.endRoom.lockAllDoors(!0),this.primaryRooms[s].roomType=t.START_ROOM,this.startRoom=this.primaryRooms[s],this.startRoom.lockAllDoors(!1),this.startRoom.isFound=!0},t.prototype.buildSecondaryRoomsType=function(){for(var e=[t.TRAP_ROOM,t.DANGER_ROOM],o=0,i=this.secondaryRooms;o<i.length;o++){var a=i[o],n=e[this.getRandomNum(0,e.length-1)];this.level==t.LEVEL_1?a.roomType=n:this.getHalfChance()&&(a.roomType=n)}var s=this.getRandomNum(0,this.secondaryRooms.length-1);this.level==t.LEVEL_1&&(this.secondaryRooms[s].roomType=t.END_ROOM,this.endRoom=this.secondaryRooms[s],this.endRoom.lockAllDoors(!1)),this.level==t.LEVEL_3&&(this.map[2][2].roomType=t.MERCHANT_ROOM),this.level==t.LEVEL_5&&(this.map[3][3].roomType=t.BOSS_ROOM,this.map[3][4].roomType==t.EMPTY_ROOM&&this.map[3][2].roomType==t.EMPTY_ROOM&&this.map[2][3].roomType==t.EMPTY_ROOM&&this.map[4][3].roomType==t.EMPTY_ROOM&&(this.map[3][4].roomType=this.getHalfChance()?t.DANGER_ROOM:t.TRAP_ROOM),this.addLootRoom()),this.addPuzzleRoom(),this.addLootRoom(),this.addLootRoom()},t.prototype.addPuzzleRoom=function(){var e=this.getRandomNum(0,this.secondaryRooms.length-1);this.secondaryRooms[e].roomType==t.TRAP_ROOM||this.secondaryRooms[e].roomType==t.DANGER_ROOM||this.secondaryRooms[e].roomType==t.EMPTY_ROOM?this.secondaryRooms[e].roomType=t.PUZZLE_ROOM:this.addPuzzleRoom()},t.prototype.addLootRoom=function(){for(var e=0,o=new Array,i=0,a=this.secondaryRooms;i<a.length;i++){var n=a[i];n.roomType!=t.DANGER_ROOM&&n.roomType!=t.TRAP_ROOM&&n.roomType!=t.EMPTY_ROOM||o.push(n),n.roomType==t.LOOT_ROOM&&e++}if(o.length>1&&e<o.length+1){var s=this.getRandomNum(0,o.length-1);o[s].roomType=t.LOOT_ROOM,o[s].lockAllDoors(!0)}},t.prototype.addLootKeys=function(){for(var e=0,o=new Array,i=0,a=this.secondaryRooms;i<a.length;i++){var n=a[i];n.enemyCount!=t.DANGER_ROOM&&n.roomType!=t.TRAP_ROOM||o.push(n),n.roomType==t.LOOT_ROOM&&e++,n.roomType==t.PUZZLE_ROOM&&(n.hasKey=!0)}for(var s=0;s<e;s++)if(o.length>0){var r=this.getRandomNum(0,o.length-1);o[r].hasKey=!0,o.splice(r,1)}},t.prototype.addDoors=function(){for(var e=0;e<this.size;e++)for(var o=0;o<this.size;o++)this.map[e][o].roomType!=t.EMPTY_ROOM&&(this.changeDoor(e,o,i.default.TOPDOOR,!0),this.changeDoor(e,o,i.default.BOTTOMDOOR,!0),this.changeDoor(e,o,i.default.LEFTDOOR,!0),this.changeDoor(e,o,i.default.RIGHTDOOR,!0));for(e=0;e<this.size;e++)for(o=0;o<this.size;o++)this.map[e][o].roomType==t.EMPTY_ROOM&&(this.changeDoor(e,o,i.default.TOPDOOR,!1),this.changeDoor(e,o,i.default.BOTTOMDOOR,!1),this.changeDoor(e,o,i.default.LEFTDOOR,!1),this.changeDoor(e,o,i.default.RIGHTDOOR,!1))},t.prototype.changeDoor=function(t,e,o,a){switch(o){case i.default.TOPDOOR:this.map[t][e].doors[0].isDoor=a,e+1<this.size?this.map[t][e+1].doors[1].isDoor=a:this.map[t][e].doors[0].isDoor=!1;break;case i.default.BOTTOMDOOR:this.map[t][e].doors[1].isDoor=a,e-1>=0?this.map[t][e-1].doors[0].isDoor=a:this.map[t][e].doors[1].isDoor=!1;break;case i.default.LEFTDOOR:this.map[t][e].doors[2].isDoor=a,t-1>=0?this.map[t-1][e].doors[3].isDoor=a:this.map[t][e].doors[2].isDoor=!1;break;case i.default.RIGHTDOOR:this.map[t][e].doors[3].isDoor=a,t+1<this.size?this.map[t+1][e].doors[2].isDoor=a:this.map[t][e].doors[3].isDoor=!1}},t.prototype.getDisPlay=function(){for(var t="",e=this.size-1;e>=0;e--){for(var o=0;o<this.size;o++)t+=this.getTypeStringLog(this.map[o][e].roomType);t+="\n"}return t},t.prototype.getNeighborRoomType=function(t,e,o){var i=t,a=e;return 0==o&&(a+=1),1==o&&(a-=1),2==o&&(i-=1),3==o&&(i+=1),i>=this.size||i<0||a>=this.size||a<0||o<0||o>4?null:this.map[i][a]},t.prototype.changeRoomIsFound=function(e,o){e>=this.size||e<0||o>=this.size||o<0||this.map[e][o].roomType!=t.EMPTY_ROOM&&(this.map[e][o].isFound=!0)},t.isRoomEqual=function(t,e){return t.x==e.x&&t.y==e.y},t.getTypeString=function(e){return e!=t.EMPTY_ROOM?"Room":"RoomEmpty"},t.prototype.getTypeStringLog=function(e){switch(e){case t.EMPTY_ROOM:return"\u3000";case t.START_ROOM:return"\uff33";case t.END_ROOM:return"\uff25";case t.TRAP_ROOM:return"\uff34";case t.LOOT_ROOM:return"\uff2c";case t.DANGER_ROOM:return"\uff24";case t.PUZZLE_ROOM:return"\uff30";case t.MERCHANT_ROOM:return"\uff2d";case t.BOSS_ROOM:return"\uff22"}return"\u3000"},t.prototype.getRandomNum=function(t,e){return t+Math.round(Math.random()*(e-t))},t.prototype.getHalfChance=function(){return Math.random()>.5},t.LEVEL_1=1,t.LEVEL_2=2,t.LEVEL_3=3,t.LEVEL_4=4,t.LEVEL_5=5,t.PRIMARY=1e3,t.SECONDARY=2e3,t.EMPTY_ROOM=0,t.START_ROOM=1,t.END_ROOM=2,t.TRAP_ROOM=3,t.LOOT_ROOM=4,t.DANGER_ROOM=5,t.PUZZLE_ROOM=6,t.MERCHANT_ROOM=7,t.BOSS_ROOM=8,t}();o.default=a,cc._RF.pop()},{"./RectRoom":"RectRoom"}],RectRoom:[function(t,e,o){"use strict";cc._RF.push(e,"d55edjfV4pLuKPki2DqAONx","RectRoom"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("./RectDoor"),a=t("../Logic"),n=t("../Dungeon"),s=function(){function t(e,o,i,a,n){this.isPrimary=!1,this.enemyCount=0,this.state=t.STATE_SLEEP,this.isFound=!1,this.isInit=!0,this.x=i,this.y=a,this.isPrimary=e,this.index=o,this.roomType=n,this.init()}return t.prototype.init=function(){if(this.state=t.STATE_SLEEP,null==this.doors){this.doors=new Array(4);for(var e=0;e<4;e++)this.doors[e]=new i.default(e,!1,!1)}this.randomTiles=new Array;for(e=0;e<t.ROOM_WIDTH;e++){this.randomTiles=new Array(e);for(var o=0;o<t.ROOM_HEIGHT;o++)this.randomTiles.push(cc.v2(e,o))}},t.prototype.lockAllDoors=function(t){for(var e=0;e<4;e++)this.doors[e].isLocked=t},Object.defineProperty(t.prototype,"positionStr",{get:function(){return""+this.x+this.y},enumerable:!0,configurable:!0}),t.prototype.randomTile=function(){if(this.randomTiles.length>0){var t=a.default.getRandomNum(0,this.randomTiles.length-1),e=this.randomTiles[t];return this.randomTiles.splice(t,1),e}return null},t.STATE_SLEEP=0,t.STATE_ACTIVE=1,t.STATE_CLEAR=2,t.ROOM_WIDTH=n.default.WIDTH_SIZE,t.ROOM_HEIGHT=n.default.HEIGHT_SIZE,t.TOPDOOR=0,t.BOTTOMDOOR=1,t.LEFTDOOR=2,t.RIGHTDOOR=3,t}();o.default=s,cc._RF.pop()},{"../Dungeon":"Dungeon","../Logic":"Logic","./RectDoor":"RectDoor"}],Shooter:[function(t,e,o){"use strict";cc._RF.push(e,"f9805u1Wn9OeouYmQSWcHcq","Shooter"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("./Item/Bullet"),a=t("./Logic"),n=cc._decorator,s=n.ccclass,r=n.property,c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.bullet=null,e.auto=!1,e.isAI=!1,e.frequency=1,e.dungeon=null,e.player=null,e.timeDelay=0,e.isAutoAim=!0,e.bulletName="",e.hv=cc.v2(1,0),e}return __extends(e,t),e.prototype.onLoad=function(){var t=this;this.anim=this.getComponent(cc.Animation),this.bulletPool=new cc.NodePool,cc.director.on("destorybullet",function(e){t.destroyBullet(e.detail.bulletNode)})},e.prototype.setHv=function(t){var e=this.hasNearEnemy();e.equals(cc.Vec2.ZERO)?this.hv=t:(this.rotateColliderManager(cc.v2(this.node.position.x+e.x,this.node.position.y+e.y)),this.hv=e)},e.prototype.fireBullet=function(t){this.anim&&this.anim.play(),t||(t=0),this.fire(this.bullet,this.bulletPool,t)},e.prototype.fire=function(t,e,o){if(this.dungeon&&(this.isAI||!(a.default.ammo<=0))){!this.isAI&&a.default.ammo>0&&a.default.ammo--;var n=null;e.size()>0&&(n=e.get()),n&&!n.active||(n=cc.instantiate(t)),n.parent=this.node;var s=this.node.convertToWorldSpace(cc.v2(30,0));s=this.dungeon.node.convertToNodeSpace(s),n.parent=this.dungeon.node,n.position=s,n.scale=1,n.active=!0;var r=n.getComponent(i.default);this.bulletName=r.name,r.node.rotation=-1==this.node.scaleX?-this.node.rotation:this.node.rotation,r.node.scaleY=this.node.scaleX,r.node.zIndex=4e3,r.isFromPlayer=!this.isAI,r.isFromPlayer&&r.isMelee&&this.player&&(r.damage=this.player.inventoryData.getFinalAttackPoint(this.player.baseAttackPoint)),r.showBullet(this.hv.clone().rotateSelf(o*Math.PI/180))}},e.prototype.destroyBullet=function(t){t.active=!1;var e=t.getComponent(i.default);this.bulletPool&&e.name==this.bulletName&&this.bulletPool.put(t)},e.prototype.start=function(){},e.prototype.getRandomNum=function(t,e){return t+Math.round(Math.random()*(e-t))},e.prototype.update=function(t){this.timeDelay+=t,this.timeDelay>this.frequency&&this.auto&&(this.timeDelay=0,this.fireBullet());var e=this.hasNearEnemy();if(e.equals(cc.Vec2.ZERO)){if(0!=this.hv.x||0!=this.hv.y){var o=cc.v2(this.node.position.x+this.hv.x,this.node.position.y+this.hv.y);this.rotateColliderManager(o)}}else this.rotateColliderManager(cc.v2(this.node.position.x+e.x,this.node.position.y+e.y)),this.hv=e},e.prototype.hasNearEnemy=function(){if(!this.isAutoAim)return cc.Vec2.ZERO;var t=1e3,e=cc.v2(0,0);if(this.isAI);else if(this.dungeon){for(var o=0,i=this.dungeon.monsters;o<i.length;o++){var n=i[o],s=a.default.getDistance(this.node.parent.position,n.node.position);if(s<500&&s<t&&!n.isDied){t=s;var r=this.node.position.clone();r.x=1==this.node.scaleX?r.x:-r.x,e=n.node.position.sub(this.node.parent.position.add(r))}}1e3!=t&&(e=e.normalizeSelf())}return e},e.prototype.rotateColliderManager=function(t){var e=t.sub(this.node.position),o=360/(2*Math.PI),i=360-Math.atan2(e.x,e.y)*o;this.node.scaleX=this.node.parent.scaleX,i+=90,this.node.rotation=-1==this.node.scaleX?i:-i},__decorate([r(cc.Prefab)],e.prototype,"bullet",void 0),__decorate([r],e.prototype,"auto",void 0),__decorate([r],e.prototype,"isAI",void 0),__decorate([r],e.prototype,"frequency",void 0),e=__decorate([s],e)}(cc.Component);o.default=c,cc._RF.pop()},{"./Item/Bullet":"Bullet","./Logic":"Logic"}],ShopTableData:[function(t,e,o){"use strict";cc._RF.push(e,"1f67aUHn09Nvaj7spLXjq++","ShopTableData"),Object.defineProperty(o,"__esModule",{value:!0});var i=function(){return function(){this.price=60,this.isSaled=!1}}();o.default=i,cc._RF.pop()},{}],ShopTable:[function(t,e,o){"use strict";cc._RF.push(e,"feb404aValPAJxRKh4uvHLm","ShopTable"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("../Player"),a=t("../Dungeon"),n=t("../Manager/EquipmentManager"),s=t("../Logic"),r=t("../Data/ShopTableData"),c=cc._decorator,l=c.ccclass,h=(c.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.data=new r.default,e.timeDelay=0,e}return __extends(e,t),e.prototype.onLoad=function(){this.info=this.node.getChildByName("info"),this.label=this.info.getComponentInChildren(cc.Label)},e.prototype.start=function(){},e.prototype.showItem=function(){if(this.node.parent&&!this.data.isSaled){var t=this.node.parent.getComponent(a.default);t&&t.addEquipment(n.default.equipments[s.default.getRandomNum(0,n.default.equipments.length-1)],this.data.pos,this.data.equipdata,3,this)}},e.prototype.setPos=function(t){this.data.pos=t,this.node.position=a.default.getPosInMap(t),this.node.zIndex=3e3+100*(a.default.HEIGHT_SIZE-t.y)+1},e.prototype.update=function(t){if(this.timeDelay+=t,this.timeDelay>.2){this.label.string=""+this.data.price,this.info.opacity=this.data.isSaled?0:255;var e=s.default.getCurrentMapShopTables();if(e)for(var o=0,i=e;o<i.length;o++){var a=i[o];a.pos.equals(this.data.pos)&&(a.isSaled=this.data.isSaled,a.price=this.data.price)}}},e.prototype.onCollisionStay=function(t,e){t.node.getComponent(i.default)},e.prototype.onCollisionEnter=function(t,e){t.node.getComponent(i.default)},e.prototype.onCollisionExit=function(t,e){t.node.getComponent(i.default)},e=__decorate([l],e)}(cc.Component));o.default=h,cc._RF.pop()},{"../Data/ShopTableData":"ShopTableData","../Dungeon":"Dungeon","../Logic":"Logic","../Manager/EquipmentManager":"EquipmentManager","../Player":"Player"}],Start:[function(t,e,o){"use strict";cc._RF.push(e,"e1b90/rohdEk4SdmmEZANaD","Start"),Object.defineProperty(o,"__esModule",{value:!0});var i=cc._decorator,a=i.ccclass,n=i.property,s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.label=null,e.text="hello",e}return __extends(e,t),e.prototype.start=function(){cc.view.enableAntiAlias(!1)},e.prototype.startGame=function(){cc.director.loadScene("chapter")},__decorate([n(cc.Label)],e.prototype,"label",void 0),__decorate([n],e.prototype,"text",void 0),e=__decorate([a],e)}(cc.Component);o.default=s,cc._RF.pop()},{}],Tile:[function(t,e,o){"use strict";cc._RF.push(e,"f8047r9sJ5IqqTgIdjYi6dc","Tile"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("./Logic"),a=cc._decorator,n=a.ccclass,s=a.property,r=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.label=null,e.isBroken=!1,e.isAutoShow=!0,e.timeDelay=0,e.isAnimPlaying=!1,e.isBreakingNow=!1,e}return __extends(e,t),e.prototype.onLoad=function(){this.isAutoShow=!0,this.anim=this.getComponent(cc.Animation),this.floor=this.node.getChildByName("sprite").getChildByName("floor").getComponent(cc.Sprite)},e.prototype.start=function(){switch(i.default.chapterName){case"chapter00":this.changeRes("tile000");break;case"chapter01":this.changeRes("tile001");break;case"chapter02":this.changeRes(this.getGrassRes());break;case"chapter03":this.changeRes("tile003");break;case"chapter04":this.changeRes("tile004")}},e.prototype.getGrassRes=function(){var t="tile_grass001";switch(i.default.getRandomNum(0,2)){case 0:t="tile_grass001";break;case 1:t="tile_grass002";break;case 2:t="tile_grass003"}return t},e.prototype.TileBreak=function(){},e.prototype.TileBreakFinish=function(){var t=this;this.isBroken=!0,this.isAnimPlaying=!1,this.isAutoShow&&setTimeout(function(){t.showTile()},2e3)},e.prototype.TileShow=function(){this.isAnimPlaying=!1},e.prototype.breakTile=function(){this.isAnimPlaying||(this.anim.play("TileBreak"),this.isBreakingNow=!0,this.isAnimPlaying=!0)},e.prototype.showTile=function(){!this.isAnimPlaying&&this.anim&&(this.anim.play("TileShow"),this.isBroken=!1,this.isBreakingNow=!1,this.isAnimPlaying=!0)},e.prototype.update=function(t){this.timeDelay+=t,this.timeDelay>1&&(this.timeDelay=0),this.label&&(this.label.string=""+this.node.zIndex)},e.prototype.changeRes=function(t){this.floor.spriteFrame=i.default.spriteFrames[t]},__decorate([s(cc.Label)],e.prototype,"label",void 0),e=__decorate([n],e)}(cc.Component);o.default=r,cc._RF.pop()},{"./Logic":"Logic"}],Trap:[function(t,e,o){"use strict";cc._RF.push(e,"67e3dv84GNOwbSynhs23bOv","Trap"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("../Dungeon"),a=t("../EventConstant"),n=t("../Player"),s=cc._decorator,r=s.ccclass,c=s.property,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.openSpriteFrame=null,e.closeSpriteFrame=null,e.isOpen=!1,e.pos=cc.v2(0,0),e.timeDelay=0,e.isPlayerIn=!1,e}return __extends(e,t),e.prototype.onLoad=function(){this.sprite=this.node.getChildByName("sprite")},e.prototype.start=function(){},e.prototype.setPos=function(t){this.pos=t,this.node.position=i.default.getPosInMap(t),this.node.zIndex=3e3+100*(i.default.HEIGHT_SIZE-t.y)+1},e.prototype.openTrap=function(){var t=this;this.isOpen||(this.isOpen=!0,this.sprite.getComponent(cc.Sprite).spriteFrame=this.openSpriteFrame,setTimeout(function(){t.closeSpriteFrame&&(t.sprite.getComponent(cc.Sprite).spriteFrame=t.closeSpriteFrame,t.isOpen=!1)},500))},e.prototype.onCollisionStay=function(t,e){3==t.tag&&this.isOpen&&this.isPlayerIn&&(this.isOpen=!1,cc.director.emit(a.EventConstant.PLAYER_TAKEDAMAGE,{detail:{damage:1}}))},e.prototype.onBeginContact=function(t,e,o){o.body.node.getComponent(n.default)&&(this.isPlayerIn=!0)},e.prototype.onEndContact=function(t,e,o){o.body.node.getComponent(n.default)&&(this.isPlayerIn=!1)},e.prototype.update=function(t){this.timeDelay+=t,this.timeDelay>2&&(this.openTrap(),this.timeDelay=0)},__decorate([c(cc.SpriteFrame)],e.prototype,"openSpriteFrame",void 0),__decorate([c(cc.SpriteFrame)],e.prototype,"closeSpriteFrame",void 0),e=__decorate([r],e)}(cc.Component);o.default=l,cc._RF.pop()},{"../Dungeon":"Dungeon","../EventConstant":"EventConstant","../Player":"Player"}],WalkSmoke:[function(t,e,o){"use strict";cc._RF.push(e,"d3d56K96jBFs6t/GiwCmf8x","WalkSmoke"),Object.defineProperty(o,"__esModule",{value:!0});var i=cc._decorator,a=i.ccclass,n=(i.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.start=function(){var t=this;setTimeout(function(){cc.director.emit("destorysmoke",{detail:{coinNode:t.node}})},300)},e=__decorate([a],e)}(cc.Component));o.default=n,cc._RF.pop()},{}],Wall:[function(t,e,o){"use strict";cc._RF.push(e,"e7c06zRjp9J+piF+ZsFdjSH","Wall"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("../Dungeon"),a=cc._decorator,n=a.ccclass,s=(a.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.half=!1,e}return __extends(e,t),e.prototype.onLoad=function(){},e.prototype.setPos=function(t){this.pos=t,this.node.position=i.default.getPosInMap(t)},e.prototype.start=function(){this.node.opacity=255},e.prototype.onCollisionEnter=function(t,e){this.node.opacity=255},e.prototype.onCollisionStay=function(t,e){3!=t.tag&&4!=t.tag||(this.node.opacity=128)},e.prototype.onCollisionExit=function(t,e){this.node.opacity=255},e=__decorate([n],e)}(cc.Component));o.default=s,cc._RF.pop()},{"../Dungeon":"Dungeon"}]},{},["AmmoCount","Captain","CaptainSword","Kraken","KrakenSwingHand","Box","Chest","Door","FallStone","FootBoard","Portal","ShopTable","Trap","Wall","CameraControl","Chapter","CoinCount","Controller","BoxData","DungeonStyleData","EquipmentData","EquipmentDescData","InventoryData","MapData","MonsterData","PlayerData","ShopTableData","Dungeon","Equipment","EquipmentDialog","EventConstant","Game","GameFinish","GameOver","HealthBar","Inventory","Bullet","Coin","Item","JoyController","Joystick","KeyboardController","Loading","Logic","CoinManager","DungeonStyleManager","EquipmentManager","MapManager","MonsterManager","MeleeWeapon","MeleeWeaponChild","MiniMap","Monster","OilLake","PerlinNoise2D","Player","RectDoor","RectDungeon","RectRoom","Shooter","Start","Tile","WalkSmoke"]);
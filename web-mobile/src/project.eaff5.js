window.__require=function e(t,i,o){function a(s,r){if(!i[s]){if(!t[s]){var c=s.split("/");if(c=c[c.length-1],!t[c]){var l="function"==typeof __require&&__require;if(!r&&l)return l(c,!0);if(n)return n(c,!0);throw new Error("Cannot find module '"+s+"'")}}var h=i[s]={exports:{}};t[s][0].call(h.exports,function(e){return a(t[s][1][e]||e)},h,h.exports,e,t,i,o)}return i[s].exports}for(var n="function"==typeof __require&&__require,s=0;s<o.length;s++)a(o[s]);return a}({AmmoCount:[function(e,t,i){"use strict";cc._RF.push(t,"6a3014RzCdLroOkSBlm8HS/","AmmoCount"),Object.defineProperty(i,"__esModule",{value:!0});var o=e("./Logic"),a=cc._decorator,n=a.ccclass,s=a.property,r=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.label=null,t}return __extends(t,e),t.prototype.onLoad=function(){},t.prototype.start=function(){},t.prototype.update=function(e){this.label&&(this.label.string=""+o.default.ammo)},__decorate([s(cc.Label)],t.prototype,"label",void 0),t=__decorate([n],t)}(cc.Component);i.default=r,cc._RF.pop()},{"./Logic":"Logic"}],Boss:[function(e,t,i){"use strict";cc._RF.push(t,"27ef0INO8BDnrQF5OkIl5aV","Boss"),Object.defineProperty(i,"__esModule",{value:!0});var o=e("../Logic"),a=e("../Data/MonsterData"),n=e("../Dungeon"),s=e("../Manager/StatusManager"),r=cc._decorator,c=r.ccclass,l=r.property,h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.statusManager=null,t.healthBar=null,t.pos=cc.v2(0,0),t.data=new a.default,t.isDied=!1,t.isShow=!1,t}return __extends(t,e),t.prototype.addStatus=function(e){this.statusManager&&this.statusManager.addStatus(e)},t.prototype.getNearPlayerDistance=function(e){return o.default.getDistance(this.node.position,e.position)},t.prototype.getCenterPosition=function(){return this.node.position.clone().addSelf(cc.v2(0,32*this.node.scaleY))},t.prototype.updatePlayerPos=function(){this.node.x=64*this.pos.x+32,this.node.y=64*this.pos.y+32},t.prototype.transportBoss=function(e,t){this.pos.x=e,this.pos.y=t,this.changeZIndex(),this.updatePlayerPos()},t.prototype.changeZIndex=function(){this.node.zIndex=3e3+100*(n.default.HEIGHT_SIZE-this.pos.y-1)+2},t.prototype.start=function(){var e=this;this.changeZIndex(),setTimeout(function(){e.healthBar&&e.healthBar.refreshHealth(e.data.currentHealth,e.data.Common.maxHealth)},100)},t.prototype.showBoss=function(){},__decorate([l(s.default)],t.prototype,"statusManager",void 0),t=__decorate([c],t)}(cc.Component);i.default=h,cc._RF.pop()},{"../Data/MonsterData":"MonsterData","../Dungeon":"Dungeon","../Logic":"Logic","../Manager/StatusManager":"StatusManager"}],BoxData:[function(e,t,i){"use strict";cc._RF.push(t,"9dffcnB2sFH8Y3GL3+iALBZ","BoxData"),Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function e(){}return e.prototype.valueCopy=function(e){this.pos=e.pos?cc.v2(e.pos.x,e.pos.y):cc.v2(0,0),this.defaultPos=e.defaultPos?cc.v2(e.defaultPos.x,e.defaultPos.y):cc.v2(0,0),this.position=e.position?cc.v2(e.position.x,e.position.y):cc.v2(0,0)},e}();i.default=o,cc._RF.pop()},{}],Box:[function(e,t,i){"use strict";cc._RF.push(t,"84b7dB47rlIALRzq2ZvOGc3","Box"),Object.defineProperty(i,"__esModule",{value:!0});var o=e("../Dungeon"),a=e("../Data/BoxData"),n=e("../Logic"),s=cc._decorator,r=s.ccclass,c=(s.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.timeDelay=0,t.isBreaking=!1,t.boxType=0,t.data=new a.default,t}var i;return __extends(t,e),i=t,t.prototype.onLoad=function(){this.anim=this.getComponent(cc.Animation),this.anim.play("BoxShow")},t.prototype.start=function(){var e="box";switch(this.boxType){case i.BOX:e="box";break;case i.PLANT:e="plant"}switch(n.default.chapterName){case"chapter00":this.changeRes(e+"000");break;case"chapter01":this.changeRes(e+"001");break;case"chapter02":this.changeRes(e+"002");break;case"chapter03":this.changeRes(e+"003");break;case"chapter04":this.changeRes(e+"004")}},t.prototype.changeRes=function(e){var t=this.node.getChildByName("sprite").getComponent(cc.Sprite),i=n.default.spriteFrames[e];t.spriteFrame=i},t.prototype.setPos=function(e){this.data.pos=e,this.node.position=o.default.getPosInMap(this.data.pos),this.node.zIndex=3e3+100*(o.default.HEIGHT_SIZE-e.y)+1},t.prototype.BreakingFinish=function(){this.reset()},t.prototype.breakBox=function(){this.isBreaking||(this.anim||(this.anim=this.getComponent(cc.Animation)),this.anim.play("BoxBroken"),this.isBreaking=!0)},t.prototype.reset=function(){this.node.position=o.default.getPosInMap(this.data.defaultPos),this.isBreaking=!1},t.prototype.update=function(e){if(this.timeDelay+=e,this.timeDelay>.2){this.data.pos=o.default.getIndexInMap(this.node.position),this.data.position=this.node.position;var t=n.default.getCurrentMapBoxes();if(t)for(var i=0,a=t;i<a.length;i++){var s=a[i];s.defaultPos.equals(this.data.defaultPos)&&(s.pos=this.data.pos,s.position=this.data.position)}this.node.zIndex=3e3+100*(o.default.HEIGHT_SIZE-this.data.pos.y)+1}},t.BOX=0,t.PLANT=1,t=i=__decorate([r],t)}(cc.Component));i.default=c,cc._RF.pop()},{"../Data/BoxData":"BoxData","../Dungeon":"Dungeon","../Logic":"Logic"}],BulletData:[function(e,t,i){"use strict";cc._RF.push(t,"081a6xA9tZAiZxbsh2+6iXp","BulletData"),Object.defineProperty(i,"__esModule",{value:!0});var o=e("./DamageData"),a=function(){function e(){this.speed=0,this.isRect=0,this.isRotate=0,this.size=1,this.resName="",this.lightName="",this.lightColor="#ffffff",this.damage=new o.default}return e.prototype.valueCopy=function(e){this.speed=e.speed?e.speed:0,this.isRect=e.isRect?e.isRect:0,this.isRotate=e.isRotate?e.isRotate:0,this.size=e.size?e.size:1,this.resName=e.resName?e.resName:"",this.lightName=e.lightName?e.lightName:"",this.lightColor=e.lightColor?e.lightColor:"#ffffff",this.damage.valueCopy(e.damage)},e.prototype.clone=function(){var t=new e;return t.speed=this.speed,t.isRect=this.isRect,t.isRotate=this.isRotate,t.size=this.size,t.resName=this.resName,t.lightName=this.lightName,t.lightColor=this.lightColor,t.damage=this.damage.clone(),t},e}();i.default=a,cc._RF.pop()},{"./DamageData":"DamageData"}],Bullet:[function(e,t,i){"use strict";cc._RF.push(t,"d243aeNu+tEJJbz1ng6i61f","Bullet"),Object.defineProperty(i,"__esModule",{value:!0});var o=e("../Monster"),a=e("../Player"),n=e("../MeleeWeapon"),s=e("../Data/DamageData"),r=e("../Logic"),c=e("../Boss/Boss"),l=e("../Data/BulletData"),h=cc._decorator,p=h.ccclass,d=(h.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.data=new l.default,t.dir=0,t.tagetPos=cc.v2(0,0),t.hv=cc.v2(0,0),t.isFromPlayer=!1,t}var i;return __extends(t,e),i=t,t.prototype.onLoad=function(){this.anim=this.getComponent(cc.Animation),this.rigidBody=this.getComponent(cc.RigidBody),this.effect=this.node.getChildByName("effect"),this.circleCollider=this.getComponent(cc.CircleCollider),this.boxCollider=this.getComponent(cc.BoxCollider),this.circlePCollider=this.getComponent(cc.PhysicsCircleCollider),this.boxPCollider=this.getComponent(cc.PhysicsBoxCollider),this.sprite=this.node.getChildByName("sprite"),this.sprite.opacity=255,this.light=this.node.getChildByName("light"),this.light.opacity=0},t.prototype.onEnable=function(){this.tagetPos=cc.v2(0,0),this.rigidBody.linearVelocity=cc.v2(0,0),this.sprite=this.node.getChildByName("sprite"),this.sprite.opacity=255,this.light=this.node.getChildByName("light"),this.light.opacity=0},t.prototype.changeBullet=function(e){this.data=e,this.changeRes(e.resName,e.lightName,e.lightColor,e.size),this.circleCollider.enabled=0==e.isRect,this.boxCollider.enabled=1==e.isRect,this.circlePCollider.enabled=0==e.isRect,this.boxPCollider.enabled=1==e.isRect,this.light.position=e.isRect?cc.v2(8,0):cc.v2(0,0),this.node.scale=e.size>0?e.size:1},t.prototype.changeRes=function(e,t,i,o,a){if(this.sprite||(this.sprite=this.node.getChildByName("sprite")),this.sprite&&!(e.length<1)){var n=this.getSpriteFrameByName(e,a),s=this.getSpriteFrameByName(t,a);this.sprite.getComponent(cc.Sprite).spriteFrame=n,this.sprite.width=n.getRect().width*o,this.sprite.height=n.getRect().height*o,this.light.getComponent(cc.Sprite).spriteFrame=s,this.light.width=s.getRect().width*o,this.light.height=s.getRect().height*o;var r=cc.color(255,255,255).fromHEX(this.data.lightColor);this.light.color=r}},t.prototype.getSpriteFrameByName=function(e,t){var i=r.default.spriteFrames[e+t];return i||(i=r.default.spriteFrames[e]),i},t.prototype.MeleeFinish=function(){cc.director.emit("destorybullet",{detail:{bulletNode:this.node}})},t.prototype.showBullet=function(e){this.hv=e,this.fire(this.hv)},t.prototype.BulletDestory=function(){cc.director.emit("destorybullet",{detail:{bulletNode:this.node}})},t.prototype.fire=function(e){this.rigidBody||(this.rigidBody=this.getComponent(cc.RigidBody)),this.rigidBody.linearVelocity=cc.v2(this.data.speed*e.x,this.data.speed*e.y)},t.prototype.start=function(){},t.prototype.onBeginContact=function(e,t,n){var s=!0,r=n.node.getComponent(a.default),l=n.node.getComponent(o.default),h=n.node.getComponent(c.default),p=n.node.getComponent(i);(r||l||h||p)&&(s=!1),n.sensor&&(s=!1),2==n.tag&&(s=!1),s&&this.anim&&(this.rigidBody.linearVelocity=cc.v2(0,0),this.anim.play("Bullet001Hit"))},t.prototype.onCollisionEnter=function(e,t){var n=!0,s=e.node.getComponent(i),r=e.node.getComponent(a.default),l=e.node.getComponent(o.default),h=e.node.getComponent(c.default);this.isFromPlayer||!l&&!h||(n=!1),this.isFromPlayer&&r&&(n=!1),s&&(n=!1),n&&this.attacking(e.node)},t.prototype.attacking=function(e){if(e){var t=new s.default;t.valueCopy(this.data.damage);var i=!1,r=e.getComponent(o.default);r&&!r.isDied&&(r.takeDamage(t),i=!0);var l=e.getComponent(a.default);l&&!l.isDied&&(l.takeDamage(t),i=!0);var h=e.getComponent(c.default);h&&!h.isDied&&(h.takeDamage(t),i=!0);var p=e.getComponent(n.default);p&&p.isAttacking&&(i=!0),i&&this.anim&&!this.anim.getAnimationState("Bullet001Hit").isPlaying&&(this.rigidBody.linearVelocity=cc.v2(0,0),this.anim.play("Bullet001Hit"))}},t.prototype.update=function(e){},t=i=__decorate([p],t)}(cc.Component));i.default=d,cc._RF.pop()},{"../Boss/Boss":"Boss","../Data/BulletData":"BulletData","../Data/DamageData":"DamageData","../Logic":"Logic","../MeleeWeapon":"MeleeWeapon","../Monster":"Monster","../Player":"Player"}],CameraControl:[function(e,t,i){"use strict";cc._RF.push(t,"aaca098lw9M94SueX+ajVM7","CameraControl"),Object.defineProperty(i,"__esModule",{value:!0});var o=cc._decorator,a=o.ccclass,n=o.property,s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.target=null,t}return __extends(t,e),t.prototype.onLoad=function(){this.camera=this.getComponent(cc.Camera)},t.prototype.onEnable=function(){},t.prototype.onDisable=function(){},t.prototype.start=function(){},t.prototype.lateUpdate=function(){var e=this.target.convertToWorldSpaceAR(cc.Vec2.ZERO);this.node.position=this.lerp(this.node.position,this.node.parent.convertToNodeSpaceAR(e),.1)},t.prototype.lerp=function(e,t,i){var o=cc.v2(0,0),a=e.x,n=e.y;return o.x=a+(t.x-a)*i,o.y=n+(t.y-n)*i,o},__decorate([n(cc.Node)],t.prototype,"target",void 0),t=__decorate([a],t)}(cc.Component);i.default=s,cc._RF.pop()},{}],CaptainSword:[function(e,t,i){"use strict";cc._RF.push(t,"e541b/KaoRBdL9VgXHoN6dM","CaptainSword"),Object.defineProperty(i,"__esModule",{value:!0});var o=e("../EventConstant"),a=e("../Player"),n=e("../Data/DamageData"),s=cc._decorator,r=s.ccclass,c=s.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.damage=2,t.isShow=!1,t}return __extends(t,e),t.prototype.start=function(){this.isShow=!1},t.prototype.onCollisionEnter=function(e,t){if(e.node.getComponent(a.default)&&this.isShow&&this.node.active){this.isShow=!1;var i=new n.default;i.physicalDamage=this.damage,cc.director.emit(o.EventConstant.PLAYER_TAKEDAMAGE,{detail:{damage:i}})}},__decorate([c],t.prototype,"damage",void 0),t=__decorate([r],t)}(cc.Component);i.default=l,cc._RF.pop()},{"../Data/DamageData":"DamageData","../EventConstant":"EventConstant","../Player":"Player"}],Captain:[function(e,t,i){"use strict";cc._RF.push(t,"6d826iFR+pBDJHGFIoYZ400","Captain"),Object.defineProperty(i,"__esModule",{value:!0});var o=e("./CaptainSword"),a=e("../Dungeon"),n=e("../Logic"),s=e("../Player"),r=e("../EventConstant"),c=e("../Shooter"),l=e("../Manager/EquipmentManager"),h=e("../Data/DamageData"),p=e("./Boss"),d=cc._decorator,u=d.ccclass,m=d.property,g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.sword=null,t.healthBar=null,t.isJumping=!1,t.isFaceRight=!0,t.isMoving=!1,t.isAttacking=!1,t.timeDelay=0,t.isHurt=!1,t.isFall=!1,t.shooter=null,t}return __extends(t,e),t.prototype.onLoad=function(){this.isAttacking=!1,this.isDied=!1,this.anim=this.getComponent(cc.Animation),this.rigidbody=this.getComponent(cc.RigidBody),this.shooter=this.node.getChildByName("Shooter").getComponent(c.default),this.updatePlayerPos()},t.prototype.start=function(){e.prototype.start.call(this)},t.prototype.AttackDamageStart=function(){this.sword.isShow=!0},t.prototype.AttackDamageFinish=function(){this.sword.isShow=!1},t.prototype.AttackStart=function(){this.isAttacking=!0},t.prototype.AttackFinish=function(){this.isAttacking=!1},t.prototype.JumpStart=function(){this.isJumping=!0,this.getComponent(cc.PhysicsBoxCollider).sensor=!0,this.getComponent(cc.PhysicsBoxCollider).apply()},t.prototype.JumpFinish=function(){var e=this;if(this.isJumping=!1,this.isFall=!0,setTimeout(function(){e.isFall=!1},100),this.getComponent(cc.PhysicsBoxCollider).sensor=!1,this.getComponent(cc.PhysicsBoxCollider).apply(),this.dungeon&&this.shooter){this.fireWithAngles([0,45,90,135,180,225,270,315])}},t.prototype.fireWithAngles=function(e){if(this.dungeon&&this.shooter){var t=this.dungeon.player.getCenterPosition().sub(this.node.position);if(!t.equals(cc.Vec2.ZERO)){t=t.normalizeSelf(),this.shooter.setHv(t),this.shooter.dungeon=this.dungeon,this.shooter.data.bulletType="bullet001";for(var i=0,o=e;i<o.length;i++){var a=o[i];this.shooter.fireBullet(a)}}}},t.prototype.OpenFire=function(){var e=this;if(this.dungeon&&this.shooter){var t=[5,10,-10],i=[-5,20,-20,-40,40];this.fireWithAngles([0,15,-30,-15,30]),this.data.currentHealth<this.data.Common.maxHealth/2&&(setTimeout(function(){e.fireWithAngles(t)},100),setTimeout(function(){e.fireWithAngles(i)},200))}},t.prototype.onCollisionStay=function(e,t){if(e.getComponent(s.default)&&1==t.tag&&this.isFall){this.isFall=!1;var i=new h.default;i.physicalDamage=2,cc.director.emit(r.EventConstant.PLAYER_TAKEDAMAGE,{detail:{damage:i}})}},t.prototype.update=function(e){(this.healthBar.node.active=!this.isDied,this.timeDelay+=e,this.timeDelay>.016&&(this.timeDelay=0,this.bossAction(),this.JumpMove()),this.dungeon)&&(this.getNearPlayerDistance(this.dungeon.player.node)<64&&!this.isHurt&&(this.rigidbody.linearVelocity=cc.v2(0,0)));this.isDied&&(this.rigidbody.linearVelocity=cc.Vec2.ZERO),this.healthBar.node.active=!this.isDied,this.data.currentHealth<1&&this.killed(),this.node.scaleX=this.isFaceRight?1:-1},t.prototype.takeDamage=function(e){var t=this.anim.getAnimationState("CaptainJump").isPlaying;return!this.isDied&&!t&&(this.data.currentHealth-=this.data.getDamage(e).getTotalDamage(),this.data.currentHealth>this.data.Common.maxHealth&&(this.data.currentHealth=this.data.Common.maxHealth),this.isHurt=!0,this.anim.play("CaptainHit"),this.isAttacking=!1,this.healthBar.refreshHealth(this.data.currentHealth,this.data.Common.maxHealth),!0)},t.prototype.killed=function(){var e=this;this.isDied||(this.isDied=!0,this.anim.play("CaptainDie"),this.getComponent("cc.PhysicsCollider").sensor=!0,setTimeout(function(){e.node&&(e.node.active=!1)},5e3),this.dungeon&&(cc.director.emit(r.EventConstant.DUNGEON_ADD_COIN,{detail:{pos:this.node.position,count:19}}),cc.director.emit(r.EventConstant.DUNGEON_ADD_HEART,{detail:{pos:this.node.position}}),cc.director.emit(r.EventConstant.DUNGEON_ADD_AMMO,{detail:{pos:this.node.position}}),this.dungeon.addEquipment(l.default.equipments[n.default.getRandomNum(0,l.default.equipments.length-1)],this.pos,null,3)))},t.prototype.bossAction=function(){if(!this.isDied&&this.dungeon){this.node.position=a.default.fixOuterMap(this.node.position),this.pos=a.default.getIndexInMap(this.node.position),this.changeZIndex();var e=this.dungeon.player.pos.clone(),t=a.default.getPosInMap(e).sub(this.node.position),i=this.getNearPlayerDistance(this.dungeon.player.node),o=this.anim.getAnimationState("CaptainJump").isPlaying,s=this.anim.getAnimationState("CaptainFire").isPlaying,r=t.x,c=t.y;Math.abs(r),Math.abs(c);if(this.isFaceRight=r>0,!o&&!s)if(i<140&&!this.dungeon.player.isDied)this.isAttacking||this.anim.play("CaptainAttack");else{var l=200;i>300&&(n.default.getHalfChance()?(this.anim.play("CaptainJump"),o=!0):(l=50,this.anim.play("CaptainFire"))),t.equals(cc.Vec2.ZERO)||o||this.isAttacking||(t=t.normalizeSelf(),this.move(t,l))}}},t.prototype.JumpMove=function(){if(this.dungeon&&this.isJumping){var e=this.dungeon.player.pos.clone(),t=a.default.getPosInMap(e).sub(this.node.position);t.equals(cc.Vec2.ZERO)||(this.pos=a.default.getIndexInMap(this.node.position),t=t.normalizeSelf());var i=t.x,o=t.y,n=(Math.abs(i),Math.abs(o),cc.v2(i,o)),s=200;this.data.currentHealth<this.data.Common.maxHealth/2&&(s=240),n=n.mul(s),this.rigidbody.linearVelocity=n,this.isMoving=0!=i||0!=o}},t.prototype.move=function(e,t){if(this.isDied||this.isHurt)this.isHurt=!1;else{this.isAttacking&&!e.equals(cc.Vec2.ZERO)&&(e=e.mul(.5)),e.equals(cc.Vec2.ZERO)||(this.pos=a.default.getIndexInMap(this.node.position));var i=e.x,o=e.y,n=(Math.abs(i),Math.abs(o),cc.v2(i,o));n=n.mul(t),this.rigidbody.linearVelocity=n,this.isMoving=0!=i||0!=o,this.isMoving&&(this.isFaceRight=i>0),this.isMoving?this.anim.getAnimationState("CaptainMove").isPlaying||this.anim.playAdditive("CaptainMove"):this.anim.getAnimationState("CaptainMove").isPlaying&&this.anim.play("CaptainIdle"),this.changeZIndex()}},__decorate([m(o.default)],t.prototype,"sword",void 0),t=__decorate([u],t)}(p.default);i.default=g,cc._RF.pop()},{"../Data/DamageData":"DamageData","../Dungeon":"Dungeon","../EventConstant":"EventConstant","../Logic":"Logic","../Manager/EquipmentManager":"EquipmentManager","../Player":"Player","../Shooter":"Shooter","./Boss":"Boss","./CaptainSword":"CaptainSword"}],Chapter:[function(e,t,i){"use strict";cc._RF.push(t,"e966c6tQ3FASbN1WCJi24PI","Chapter"),Object.defineProperty(i,"__esModule",{value:!0});var o=e("./Logic"),a=cc._decorator,n=a.ccclass,s=a.property,r=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.chapter00=null,t.chapter01=null,t.chapter02=null,t.chapter03=null,t.chapter04=null,t.timeDelay=0,t}return __extends(t,e),t.prototype.start=function(){cc.view.enableAntiAlias(!1)},t.prototype.clickChapter=function(e,t){t&&(o.default.chapterName=t,o.default.resetData()),cc.director.loadScene("loading")},t.prototype.isTimeDelay=function(e){return this.timeDelay+=e,this.timeDelay>.016&&(this.timeDelay=0,!0)},t.prototype.update=function(e){this.isTimeDelay(e)},__decorate([s(cc.Button)],t.prototype,"chapter00",void 0),__decorate([s(cc.Button)],t.prototype,"chapter01",void 0),__decorate([s(cc.Button)],t.prototype,"chapter02",void 0),__decorate([s(cc.Button)],t.prototype,"chapter03",void 0),__decorate([s(cc.Button)],t.prototype,"chapter04",void 0),t=__decorate([n],t)}(cc.Component);i.default=r,cc._RF.pop()},{"./Logic":"Logic"}],Chest:[function(e,t,i){"use strict";cc._RF.push(t,"a259fOC11hFpJCy2hycs7kH","Chest"),Object.defineProperty(i,"__esModule",{value:!0});var o=e("../Dungeon"),a=e("../Manager/EquipmentManager"),n=e("../Logic"),s=cc._decorator,r=s.ccclass,c=s.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.openSpriteFrame=null,t.closeSpriteFrame=null,t.isOpen=!1,t.pos=cc.v2(0,0),t.timeDelay=0,t.quality=1,t}return __extends(t,e),t.prototype.onLoad=function(){this.sprite=this.node.getChildByName("sprite")},t.prototype.start=function(){},t.prototype.setQuality=function(e,t){this.quality=e,this.isOpen=t,this.sprite||(this.sprite=this.node.getChildByName("sprite"));var i="chest001",o="chestopen001";switch(e){case 1:i="chest001",o="chestopen001";break;case 2:i="chest003",o="chestopen003";break;case 3:i="chest002",o="chestopen002"}var a=n.default.spriteFrames[i],s=n.default.spriteFrames[o];this.openSpriteFrame=a,this.closeSpriteFrame=s,this.sprite.getComponent(cc.Sprite).spriteFrame=this.openSpriteFrame,t&&(this.sprite.getComponent(cc.Sprite).spriteFrame=this.closeSpriteFrame)},t.prototype.setPos=function(e){this.pos=e,this.node.position=o.default.getPosInMap(e),this.node.zIndex=3e3+100*(o.default.HEIGHT_SIZE-e.y)+1},t.prototype.openChest=function(){var e=this;if(!this.isOpen){this.isOpen=!0;var t=cc.sequence(cc.moveTo(.1,5,16),cc.moveTo(.1,-5,0),cc.moveTo(.1,5,0),cc.moveTo(.1,-5,0),cc.moveTo(.1,0,0),cc.callFunc(function(){if(e.sprite.getComponent(cc.Sprite).spriteFrame=e.closeSpriteFrame,e.node.parent){var t=e.node.parent.getComponent(o.default);t&&(1==n.default.level&&t.addEquipment(a.default.REMOTE_CROSSBOW,e.pos,null,e.quality),t.addEquipment(a.default.equipments[n.default.getRandomNum(0,a.default.equipments.length-1)],e.pos,null,e.quality))}}));this.sprite.runAction(t)}},t.prototype.onCollisionStay=function(e,t){3==e.tag&&(this.isOpen||this.openChest())},t.prototype.update=function(e){},__decorate([c(cc.SpriteFrame)],t.prototype,"openSpriteFrame",void 0),__decorate([c(cc.SpriteFrame)],t.prototype,"closeSpriteFrame",void 0),t=__decorate([r],t)}(cc.Component);i.default=l,cc._RF.pop()},{"../Dungeon":"Dungeon","../Logic":"Logic","../Manager/EquipmentManager":"EquipmentManager"}],CoinCount:[function(e,t,i){"use strict";cc._RF.push(t,"91131vqXzhODZpby3U0hjQL","CoinCount"),Object.defineProperty(i,"__esModule",{value:!0});var o=e("./Logic"),a=e("./EventConstant"),n=cc._decorator,s=n.ccclass,r=n.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.label=null,t}return __extends(t,e),t.prototype.onLoad=function(){var e=this;this.anim=this.getComponent(cc.Animation),cc.director.on(a.EventConstant.HUD_ADD_COIN,function(t){e.addCount(t.detail.count)})},t.prototype.start=function(){},t.prototype.addCount=function(e){this.anim&&(o.default.coins+=parseInt(e),cc.sys.localStorage.setItem("coin",o.default.coins))},t.prototype.update=function(e){this.label&&(this.label.string=""+o.default.coins)},__decorate([r(cc.Label)],t.prototype,"label",void 0),t=__decorate([s],t)}(cc.Component);i.default=c,cc._RF.pop()},{"./EventConstant":"EventConstant","./Logic":"Logic"}],CoinManager:[function(e,t,i){"use strict";cc._RF.push(t,"9211357HjhKqavyVFqZ4zof","CoinManager"),Object.defineProperty(i,"__esModule",{value:!0});var o=e("../Item/Coin"),a=e("../Dungeon"),n=cc._decorator,s=n.ccclass,r=n.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.coin=null,t}return __extends(t,e),t.prototype.onLoad=function(){var e=this;this.coinPool=new cc.NodePool,cc.director.on("destorycoin",function(t){e.destroyCoin(t.detail.coinNode)})},t.prototype.getValueCoin=function(e,t,i){for(var a=o.default.FACE_VALUE,n=e%a,s=0;s<n;s++)this.getCoin(1,t,i);var r=(e-n)/a;for(s=0;s<r;s++)this.getCoin(a,t,i)},t.prototype.getCoin=function(e,t,i){var n,s=i.getComponent(a.default);s&&(n=s.player);var r=null;this.coinPool.size()>0&&(r=this.coinPool.get()),r&&!r.active||(r=cc.instantiate(this.coin)),r.parent=i,r.position=t;var c=r.getComponent(o.default);c.player=n,c.changeValue(e),c.node.zIndex=4e3,r.active=!0},t.prototype.destroyCoin=function(e){e.active=!1;e.getComponent(o.default);this.coinPool&&this.coinPool.put(e)},t.prototype.start=function(){},__decorate([r(cc.Prefab)],t.prototype,"coin",void 0),t=__decorate([s],t)}(cc.Component);i.default=c,cc._RF.pop()},{"../Dungeon":"Dungeon","../Item/Coin":"Coin"}],Coin:[function(e,t,i){"use strict";cc._RF.push(t,"586a7ZPuVJNUIhnMRyd39J4","Coin"),Object.defineProperty(i,"__esModule",{value:!0});var o=e("../Logic"),a=e("../EventConstant"),n=cc._decorator,s=n.ccclass,r=(n.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.value=0,t.valueRes=["gem01","gem02","gem03","gem04"],t.isReady=!1,t.checkTimeDelay=0,t}var i;return __extends(t,e),i=t,t.prototype.onLoad=function(){},t.prototype.onEnable=function(){var e=this;this.anim=this.getComponent(cc.Animation),this.rigidBody=this.getComponent(cc.RigidBody);var t=Math.random()*(o.default.getHalfChance()?1:-1)*800,i=Math.random()*(o.default.getHalfChance()?1:-1)*800;this.rigidBody.linearVelocity=cc.v2(t,i),this.rigidBody.linearDamping=5,this.isReady=!1,setTimeout(function(){e.isReady=!0},1e3)},t.prototype.changeValue=function(e){this.value=e;var t=1;this.value==i.FACE_VALUE?(t=3,this.node.scale=1.2):(t=1,this.node.scale=1),this.node.getChildByName("sprite").getComponent(cc.Sprite).spriteFrame=o.default.spriteFrames[this.valueRes[t]]},t.prototype.start=function(){},t.prototype.isCheckTimeDelay=function(e){return this.checkTimeDelay+=e,this.checkTimeDelay>1&&(this.checkTimeDelay=0,!0)},t.prototype.getNearPlayerDistance=function(e){return o.default.getDistance(this.node.position,e.position.clone().addSelf(cc.v2(0,32)))},t.prototype.update=function(e){if(this.isCheckTimeDelay(e)&&this.player&&this.getNearPlayerDistance(this.player.node)<400&&this.node.active&&this.isReady){var t=this.player.node.position.clone();t.y+=10;var i=t.sub(this.node.position);i.equals(cc.Vec2.ZERO)||(i=(i=i.normalizeSelf()).mul(400),this.rigidBody.linearVelocity=i,this.rigidBody.linearDamping=1)}this.player&&this.getNearPlayerDistance(this.player.node)<64&&this.node.active&&this.isReady&&(this.isReady=!1,cc.director.emit(a.EventConstant.HUD_ADD_COIN,{detail:{count:this.value}}),cc.director.emit("destorycoin",{detail:{coinNode:this.node}}))},t.FACE_VALUE=10,t=i=__decorate([s],t)}(cc.Component));i.default=r,cc._RF.pop()},{"../EventConstant":"EventConstant","../Logic":"Logic"}],CommonData:[function(e,t,i){"use strict";cc._RF.push(t,"b86e6PjawlOxqFoYPp0y0Jk","CommonData"),Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function e(){this.maxHealth=0,this.damageMin=0,this.damageMax=0,this.criticalStrikeRate=0,this.defence=0,this.lifeDrain=0,this.lifeRecovery=0,this.moveSpeed=0,this.attackSpeed=0,this.dodge=0,this.remoteSpeed=0,this.realDamage=0,this.realRate=0,this.iceDamage=0,this.iceDefence=0,this.iceRate=0,this.fireDamage=0,this.fireDefence=0,this.fireRate=0,this.lighteningDamage=0,this.lighteningDefence=0,this.lighteningRate=0,this.toxicDamage=0,this.toxicDefence=0,this.toxicRate=0,this.curseDamage=0,this.curseDefence=0,this.curseRate=0}return e.prototype.valueCopy=function(e){this.maxHealth=e.maxHealth?e.maxHealth:0,this.damageMin=e.damageMin?e.damageMin:0,this.damageMax=e.damageMax?e.damageMax:0,this.criticalStrikeRate=e.criticalStrikeRate?e.criticalStrikeRate:0,this.defence=e.defence?e.defence:0,this.lifeDrain=e.lifeDrain?e.lifeDrain:0,this.lifeRecovery=e.lifeRecovery?e.lifeRecovery:0,this.moveSpeed=e.moveSpeed?e.moveSpeed:0,this.attackSpeed=e.attackSpeed?e.attackSpeed:0,this.remoteSpeed=e.remoteSpeed?e.remoteSpeed:0,this.dodge=e.dodge?e.dodge:0,this.realDamage=e.realDamage?e.realDamage:0,this.realRate=e.realRate?e.realRate:0,this.iceDamage=e.iceDamage?e.iceDamage:0,this.iceDefence=e.iceDefence?e.iceDefence:0,this.iceRate=e.iceRate?e.iceRate:0,this.fireDamage=e.fireDamage?e.fireDamage:0,this.fireDefence=e.fireDefence?e.fireDefence:0,this.fireRate=e.fireRate?e.fireRate:0,this.lighteningDamage=e.lighteningDamage?e.lighteningDamage:0,this.lighteningDefence=e.lighteningDefence?e.lighteningDefence:0,this.lighteningRate=e.lighteningRate?e.lighteningRate:0,this.toxicDamage=e.toxicDamage?e.toxicDamage:0,this.toxicDefence=e.toxicDefence?e.toxicDefence:0,this.toxicRate=e.toxicRate?e.toxicRate:0,this.curseDamage=e.curseDamage?e.curseDamage:0,this.curseDefence=e.curseDefence?e.curseDefence:0,this.curseRate=e.curseRate?e.curseRate:0},e.prototype.clone=function(){var t=new e;return t.maxHealth=this.maxHealth,t.damageMin=this.damageMin,t.damageMax=this.damageMax,t.criticalStrikeRate=this.criticalStrikeRate,t.defence=this.defence,t.lifeDrain=this.lifeDrain,t.lifeRecovery=this.lifeRecovery,t.moveSpeed=this.moveSpeed,t.attackSpeed=this.attackSpeed,t.remoteSpeed=this.remoteSpeed,t.dodge=this.dodge,t.realDamage=this.realDamage,t.realRate=this.realRate,t.iceDamage=this.iceDamage,t.iceDefence=this.iceDefence,t.iceRate=this.iceRate,t.fireDamage=this.fireDamage,t.fireDefence=this.fireDefence,t.fireRate=this.fireRate,t.lighteningDamage=this.lighteningDamage,t.lighteningDefence=this.lighteningDefence,t.lighteningRate=this.lighteningRate,t.toxicDamage=this.toxicDamage,t.toxicDefence=this.toxicDefence,t.toxicRate=this.toxicRate,t.curseDamage=this.curseDamage,t.curseDefence=this.curseDefence,t.curseRate=this.curseRate,t},e}();i.default=o,cc._RF.pop()},{}],Controller:[function(e,t,i){"use strict";cc._RF.push(t,"12f66EVamVPmoXVKYdoGHk5","Controller"),Object.defineProperty(i,"__esModule",{value:!0});var o=cc._decorator,a=o.ccclass,n=o.property,s=e("./EventConstant"),r=e("./Logic"),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.player=null,t.mainAction=null,t.mainActionTouched=!1,t.secondAction=null,t.secondActionTouched=!1,t.thirdActionTouched=!1,t.timeDelay=0,t.thirdTimeDelay=0,t}return __extends(t,e),t.prototype.onLoad=function(){var e=this;this.mainAction.on(cc.Node.EventType.TOUCH_START,function(e){this.mainActionTouched=!0},this),this.mainAction.on(cc.Node.EventType.TOUCH_END,function(e){this.mainActionTouched=!1},this),this.mainAction.on(cc.Node.EventType.TOUCH_CANCEL,function(e){this.mainActionTouched=!1},this),this.secondAction.on(cc.Node.EventType.TOUCH_START,function(e){this.secondActionTouched=!0},this),this.secondAction.on(cc.Node.EventType.TOUCH_END,function(e){this.secondActionTouched=!1},this),this.secondAction.on(cc.Node.EventType.TOUCH_CANCEL,function(e){this.secondActionTouched=!1},this),cc.director.on(s.EventConstant.HUD_DARK_CONTROLLER,function(t){e.changeRes(t.detail.index,!1)}),cc.director.on(s.EventConstant.HUD_DARK_CONTROLLER,function(t){e.changeRes(t.detail.index,!0)})},t.prototype.changeRes=function(e,t){var i="";switch(e){case 0:i=t?"uimeleelight":"uimelee";break;case 1:i=t?"uiremotelight":"uiremote";break;case 2:i=t?"uiswitchlight":"uiswitch"}this.mainAction.getComponent(cc.Button).normalSprite=r.default.spriteFrames[i]},t.prototype.thirdAction=function(){this.thirdActionTouched||(this.thirdActionTouched=!0,cc.director.emit(s.EventConstant.PLAYER_USEITEM))},t.prototype.move=function(e,t){t=parseInt(t),cc.director.emit(s.EventConstant.PLAYER_MOVE,{detail:{dir:t}})},t.prototype.isTimeDelay=function(e){return this.timeDelay+=e,this.timeDelay>.016&&(this.timeDelay=0,!0)},t.prototype.isThirdTimeDelay=function(e){return this.thirdTimeDelay+=e,this.thirdTimeDelay>.2&&(this.thirdTimeDelay=0,this.thirdActionTouched=!1,!0)},t.prototype.update=function(e){this.isThirdTimeDelay(e),this.isTimeDelay(e)&&(this.mainActionTouched&&cc.director.emit(s.EventConstant.PLAYER_ATTACK),this.secondActionTouched&&cc.director.emit(s.EventConstant.PLAYER_REMOTEATTACK))},__decorate([n(cc.Node)],t.prototype,"player",void 0),__decorate([n(cc.Node)],t.prototype,"mainAction",void 0),__decorate([n(cc.Node)],t.prototype,"secondAction",void 0),t=__decorate([a],t)}(cc.Component);i.default=c,cc._RF.pop()},{"./EventConstant":"EventConstant","./Logic":"Logic"}],DamageData:[function(e,t,i){"use strict";cc._RF.push(t,"140ebm8pJ5CBb4RE4tI9c22","DamageData"),Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function e(e){this.realDamage=0,this.physicalDamage=0,this.iceDamage=0,this.fireDamage=0,this.lighteningDamage=0,this.toxicDamage=0,this.curseDamage=0,this.realRate=0,this.iceRate=0,this.fireRate=0,this.lighteningRate=0,this.toxicRate=0,this.curseRate=0,this.realDamage=e||0}return e.prototype.valueCopy=function(e){this.realDamage=e.realDamage?e.realDamage:0,this.physicalDamage=e.physicalDamage?e.physicalDamage:0,this.iceDamage=e.iceDamage?e.iceDamage:0,this.fireDamage=e.fireDamage?e.fireDamage:0,this.lighteningDamage=e.lighteningDamage?e.lighteningDamage:0,this.toxicDamage=e.toxicDamage?e.toxicDamage:0,this.curseDamage=e.curseDamage?e.curseDamage:0,this.realRate=e.realRate?e.realRate:0,this.iceRate=e.iceRate?e.iceRate:0,this.fireRate=e.fireRate?e.fireRate:0,this.lighteningRate=e.lighteningRate?e.lighteningRate:0,this.toxicRate=e.toxicRate?e.toxicRate:0,this.curseRate=e.curseRate?e.curseRate:0},e.prototype.clone=function(){var t=new e;return t.realDamage=this.realDamage,t.physicalDamage=this.physicalDamage,t.iceDamage=this.iceDamage,t.fireDamage=this.fireDamage,t.lighteningDamage=this.lighteningDamage,t.toxicDamage=this.toxicDamage,t.curseDamage=this.curseDamage,t.realRate=this.realRate,t.iceRate=this.iceRate,t.fireRate=this.fireRate,t.lighteningRate=this.lighteningRate,t.toxicRate=this.toxicRate,t.curseRate=this.curseRate,t},e.prototype.getTotalDamage=function(){var e=this.physicalDamage+this.iceDamage+this.fireDamage+this.lighteningDamage+this.toxicDamage+this.curseDamage+this.realDamage;return NaN==e&&console.log(e),e},e}();i.default=o,cc._RF.pop()},{}],DecorateRoom:[function(e,t,i){"use strict";cc._RF.push(t,"7ff045au5pJh7yakGo9+aoy","DecorateRoom"),Object.defineProperty(i,"__esModule",{value:!0});var o=cc._decorator,a=o.ccclass,n=o.property,s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.floor=null,t.walltop=null,t.wallbottom=null,t.wallleft=null,t.wallright=null,t.width=15,t.height=15,t}return __extends(t,e),t.prototype.start=function(){},__decorate([n(cc.Node)],t.prototype,"floor",void 0),__decorate([n(cc.Node)],t.prototype,"walltop",void 0),__decorate([n(cc.Node)],t.prototype,"wallbottom",void 0),__decorate([n(cc.Node)],t.prototype,"wallleft",void 0),__decorate([n(cc.Node)],t.prototype,"wallright",void 0),t=__decorate([a],t)}(cc.Component);i.default=s,cc._RF.pop()},{}],Door:[function(e,t,i){"use strict";cc._RF.push(t,"f14f52tIg1Ivb0Rnl80O8tL","Door"),Object.defineProperty(i,"__esModule",{value:!0});var o=e("../Player"),a=e("../EventConstant"),n=cc._decorator,s=n.ccclass,r=(n.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.isOpen=!1,t.isDoor=!0,t.dir=0,t.wall=null,t.bg=null,t.sprite=null,t}return __extends(t,e),t.prototype.onLoad=function(){this.bg=this.node.getChildByName("bg"),this.bg.zIndex=1e3,this.sprite=this.node.getChildByName("sprite"),this.sprite.zIndex=2e3,this.anim=this.getComponent(cc.Animation)},t.prototype.start=function(){this.anim=this.getComponent(cc.Animation)},t.prototype.setOpen=function(e){if(!this.isDoor)return this.wall.zIndex=3e3,this.wall.getComponent(cc.PhysicsBoxCollider).sensor=!1,void this.wall.getComponent(cc.PhysicsBoxCollider).apply();this.wall.zIndex=500,this.wall.getComponent(cc.PhysicsBoxCollider).sensor=!0,this.wall.getComponent(cc.PhysicsBoxCollider).apply(),e?this.openGate():this.closeGate()},t.prototype.openGate=function(){this.isOpen||(this.isOpen=!0,this.anim||(this.anim=this.getComponent(cc.Animation)),this.getComponent("cc.PhysicsBoxCollider").enabled=!1,this.anim.play("DoorOpen"))},t.prototype.closeGate=function(){this.isOpen&&(this.isOpen=!1,this.anim||(this.anim=this.getComponent(cc.Animation)),this.getComponent("cc.PhysicsBoxCollider").enabled=!0,this.anim.play("DoorClose"))},t.prototype.onCollisionEnter=function(e,t){e.node.getComponent(o.default)&&this.isOpen&&cc.director.emit(a.EventConstant.LOADINGROOM,{detail:{dir:this.dir}})},t=__decorate([s],t)}(cc.Component));i.default=r,cc._RF.pop()},{"../EventConstant":"EventConstant","../Player":"Player"}],DungeonStyleData:[function(e,t,i){"use strict";cc._RF.push(t,"6e0bc4Ume5FZZHLhQzz4NXv","DungeonStyleData"),Object.defineProperty(i,"__esModule",{value:!0});var o=function(){return function(e,t,i,o,a,n,s){this.background=e,this.topwall=t,this.doorframe=a,this.sidewall=i,this.door=o,this.d1=n,this.d2=s}}();i.default=o,cc._RF.pop()},{}],DungeonStyleManager:[function(e,t,i){"use strict";cc._RF.push(t,"96118QtbixO743MdRQKBctE","DungeonStyleManager"),Object.defineProperty(i,"__esModule",{value:!0});var o=e("../Logic"),a=e("../Building/Door"),n=e("../Dungeon"),s=e("../Data/DungeonStyleData"),r=e("../Rect/RectDungeon"),c=e("../Building/ExitDoor"),l=cc._decorator,h=l.ccclass,p=l.property,d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.background01=null,t.wallTopDecoration=null,t.wallBottomDecoration=null,t.wallLeftDecoration=null,t.doorDecoration=null,t.exitdoorPrefab=null,t.decorateRoom=null,t.exitdoor=null,t.doorRes=null,t.doors=new Array,t}return __extends(t,e),t.prototype.onLoad=function(){},t.prototype.start=function(){},t.prototype.runBackgroundAnim=function(e){if(this.background01){var t=o.default.spriteFrames[e],i=o.default.spriteFrames[e+"1"];if(i||(i=o.default.spriteFrames[e]),t){this.background01.stopAllActions();var a=this.background01.getComponent(cc.Sprite),n=cc.repeatForever(cc.sequence(cc.moveBy(.4,0,0),cc.callFunc(function(){a.spriteFrame=t}),cc.moveBy(.4,0,0),cc.callFunc(function(){a.spriteFrame=i})));this.background01.runAction(n)}}},t.prototype.addDecorations=function(){switch(o.default.chapterName){case"chapter00":this.styleData=new s.default("pipeline","restwall","restsides","restdoor","restdoorframe","decorate000",null);break;case"chapter01":this.styleData=new s.default("sea","shipwall","shipsides","shipdoor","shipdoorframe","null","null");break;case"chapter02":this.styleData=new s.default("grass","junglewall","junglesides","jungledoor","jungledoorframe",null,null);break;case"chapter03":this.styleData=new s.default("sandsea","pyramidwall","pyramidsides","pyramiddoor","pyramiddoorframe",null,null);break;case"chapter04":this.styleData=new s.default("magmasea","dungeonwall","dungeonsides","dungeondoor","dungeondoorframe",null,null)}if(this.styleData){this.doors=new Array(4);for(var e=0;e<n.default.WIDTH_SIZE;e++){var t=this.getWallTop(e),i=this.getWallBottom(e);if(e==Math.floor(n.default.WIDTH_SIZE/2)){this.doors[0]=cc.instantiate(this.doorDecoration),this.doors[0].parent=this.node;var r=n.default.getPosInMap(cc.v2(e,n.default.HEIGHT_SIZE));this.doors[0].setPosition(cc.v2(r.x,r.y+32)),this.doors[0].zIndex=2e3,this.doors[0].getComponent(a.default).wall=t,this.doors[0].getComponent(a.default).dir=0,this.doors[1]=cc.instantiate(this.doorDecoration),this.doors[1].parent=this.node;var c=n.default.getPosInMap(cc.v2(e,-1));this.doors[1].setPosition(cc.v2(c.x,c.y)),this.doors[1].setScale(4,2),this.doors[1].zIndex=2e3,this.doors[1].getComponent(a.default).wall=i,this.doors[1].getComponent(a.default).dir=1}this.addExitDoor(e,t)}for(var l=-1;l<n.default.HEIGHT_SIZE+4;l++){var h=this.getWallLeft(l),p=this.getWallRight(l);if(l==Math.floor(n.default.HEIGHT_SIZE/2)){this.doors[2]=cc.instantiate(this.doorDecoration),this.doors[2].parent=this.node;var d=n.default.getPosInMap(cc.v2(-1,l));this.doors[2].setPosition(cc.v2(d.x,d.y)),this.doors[2].zIndex=2e3,this.doors[2].rotation=-90,this.doors[2].setScale(4,2),this.doors[2].getComponent(a.default).wall=h,this.doors[2].getComponent(a.default).dir=2,this.doors[3]=cc.instantiate(this.doorDecoration),this.doors[3].parent=this.node;var u=n.default.getPosInMap(cc.v2(n.default.WIDTH_SIZE,l));this.doors[3].setPosition(cc.v2(u.x,u.y)),this.doors[3].zIndex=2e3,this.doors[3].setScale(4,2),this.doors[3].rotation=90,this.doors[3].getComponent(a.default).wall=p,this.doors[3].getComponent(a.default).dir=3}}this.background01.getComponent(cc.Sprite).spriteFrame=this.styleData.background?o.default.spriteFrames[this.styleData.background]:null,this.runBackgroundAnim(this.styleData.background)}},t.prototype.addExitDoor=function(e,t){var i=n.default.WIDTH_SIZE-3,a=n.default.WIDTH_SIZE-2,s=o.default.mapManger.getCurrentRoomType()==r.default.START_ROOM,l=o.default.mapManger.getCurrentRoomType()==r.default.END_ROOM,h=o.default.mapManger.getCurrentRoomType()==r.default.PUZZLE_ROOM,p=o.default.mapManger.getCurrentRoomType()==r.default.BOSS_ROOM;if((s&&(i=1,a=2),e==i)&&(l||s||h||p)){var d=n.default.getPosInMap(cc.v2(i,n.default.HEIGHT_SIZE)),u=cc.instantiate(this.exitdoorPrefab);u.parent=this.node,u.setPosition(cc.v2(d.x+32,d.y+32)),u.zIndex=2e3,this.exitdoor=u.getComponent(c.default),this.exitdoor.wall1=t,this.exitdoor.hideWall()}e==a&&this.exitdoor&&(this.exitdoor.wall2=t,this.exitdoor.hideWall())},t.prototype.getWallTop=function(e){var t=cc.instantiate(this.wallTopDecoration);t.parent=this.node;var i=n.default.getPosInMap(cc.v2(e,n.default.HEIGHT_SIZE));return t.setPosition(cc.v2(i.x,i.y+32)),t.zIndex=2500,t.getComponent(cc.Sprite).spriteFrame=this.styleData.topwall?o.default.spriteFrames[this.styleData.topwall]:null,t},t.prototype.getWallBottom=function(e){var t=cc.instantiate(this.wallBottomDecoration);t.parent=this.node,t.rotation=-90;var i=n.default.getPosInMap(cc.v2(e,-1));return t.setPosition(cc.v2(i.x,i.y)),t.zIndex=2500,t.getComponent("cc.PhysicsBoxCollider").tag=0,t.getComponent(cc.Sprite).spriteFrame=this.styleData.topwall?o.default.spriteFrames[this.styleData.sidewall]:null,t},t.prototype.getWallLeft=function(e){var t=cc.instantiate(this.wallLeftDecoration);t.parent=this.node;var i=n.default.getPosInMap(cc.v2(-1,e));return t.setPosition(cc.v2(i.x,i.y)),t.zIndex=2500,t.getComponent(cc.Sprite).spriteFrame=this.styleData.sidewall?o.default.spriteFrames[this.styleData.sidewall]:null,t},t.prototype.getWallRight=function(e){var t=cc.instantiate(this.wallLeftDecoration);t.parent=this.node;var i=n.default.getPosInMap(cc.v2(n.default.WIDTH_SIZE,e));return t.setPosition(cc.v2(i.x,i.y)),t.zIndex=2500,t.setScale(-4,4),t.getComponent(cc.Sprite).spriteFrame=this.styleData.sidewall?o.default.spriteFrames[this.styleData.sidewall]:null,t},t.prototype.getDecorateRoom=function(e){var t,i=cc.instantiate(this.decorateRoom);switch(i.parent=this.node,e){case 0:(t=n.default.getPosInMap(cc.v2(n.default.WIDTH_SIZE/2,n.default.HEIGHT_SIZE))).y=t.y+i.height/2*4;break;case 1:(t=n.default.getPosInMap(cc.v2(n.default.WIDTH_SIZE/2,0))).y=t.y-i.height/2*4;break;case 2:(t=n.default.getPosInMap(cc.v2(0,n.default.HEIGHT_SIZE/2))).y=t.x-i.width/2*4;break;case 3:(t=n.default.getPosInMap(cc.v2(n.default.WIDTH_SIZE,n.default.HEIGHT_SIZE/2))).x=t.x+i.width/2*4}return i.setPosition(t),i.zIndex=1e3,i.getComponent(cc.Sprite).spriteFrame=this.styleData.d1?o.default.spriteFrames[this.styleData.d1]:null,i},t.prototype.setDoor=function(e,t,i){var n=this.styleData.door,s=this.styleData.doorframe;this.doors[e].getChildByName("sprite").getComponent(cc.Sprite).spriteFrame=n?o.default.spriteFrames[n]:null,this.doors[e].getChildByName("bg").getChildByName("frame").getComponent(cc.Sprite).spriteFrame=s?o.default.spriteFrames[s]:null;var r=this.doors[e].getComponent(a.default);r&&(r.isDoor=t,r.setOpen(i))},__decorate([p(cc.Node)],t.prototype,"background01",void 0),__decorate([p(cc.Prefab)],t.prototype,"wallTopDecoration",void 0),__decorate([p(cc.Prefab)],t.prototype,"wallBottomDecoration",void 0),__decorate([p(cc.Prefab)],t.prototype,"wallLeftDecoration",void 0),__decorate([p(cc.Prefab)],t.prototype,"doorDecoration",void 0),__decorate([p(cc.Prefab)],t.prototype,"exitdoorPrefab",void 0),__decorate([p(cc.Prefab)],t.prototype,"decorateRoom",void 0),t=__decorate([h],t)}(cc.Component);i.default=d,cc._RF.pop()},{"../Building/Door":"Door","../Building/ExitDoor":"ExitDoor","../Data/DungeonStyleData":"DungeonStyleData","../Dungeon":"Dungeon","../Logic":"Logic","../Rect/RectDungeon":"RectDungeon"}],Dungeon:[function(e,t,i){"use strict";cc._RF.push(t,"6dd52klzMJJgafrk2kw2YVi","Dungeon"),Object.defineProperty(i,"__esModule",{value:!0});var o=e("./Player"),a=e("./Tile"),n=e("./Logic"),s=e("./EventConstant"),r=e("./Manager/MonsterManager"),c=(e("./Building/Portal"),e("./Building/Wall")),l=e("./Building/Trap"),h=e("./Manager/EquipmentManager"),p=e("./Manager/DungeonStyleManager"),d=e("./Rect/RectRoom"),u=e("./Rect/RectDungeon"),m=e("./Building/Chest"),g=e("./Building/ShopTable"),f=e("./Manager/CoinManager"),y=e("./Building/Box"),D=e("./Building/FootBoard"),v=e("./HealthBar"),C=e("./Building/FallStone"),R=e("./Building/Emplacement"),_=e("./Boss/SlimeVenom"),E=cc._decorator,S=E.ccclass,M=E.property,T=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tile=null,t.wall=null,t.trap=null,t.fallStone=null,t.emplacement=null,t.footboard=null,t.chest=null,t.box=null,t.heart=null,t.ammo=null,t.shop=null,t.shoptable=null,t.floorDecoration=null,t.player=null,t.portalPrefab=null,t.portal=null,t.bed=null,t.campFire=null,t.venom=null,t.fog=null,t.bossHealthBar=null,t.map=new Array,t.wallmap=new Array,t.trapmap=new Array,t.footboards=new Array,t.timeDelay=0,t.checkTimeDelay=0,t.monsterManager=null,t.equipmentManager=null,t.dungeonStyleManager=null,t.coinManager=null,t.bosses=[],t.saveTimeDelay=0,t}var i;return __extends(t,e),i=t,t.prototype.onLoad=function(){var e=this;this.anim=this.getComponent(cc.Animation),cc.director.on(s.EventConstant.PLAYER_MOVE,function(t){e.playerAction(t.detail.dir,t.detail.pos,t.detail.dt)}),cc.director.on(s.EventConstant.DUNGEON_SETEQUIPMENT,function(t){e.addEquipment(t.detail.equipmentData.img,t.detail.pos,t.detail.equipmentData)}),cc.director.on(s.EventConstant.DUNGEON_ADD_COIN,function(t){e.addCoin(t.detail.pos,t.detail.count)}),cc.director.on(s.EventConstant.DUNGEON_ADD_HEART,function(t){e.addHeart(t.detail.pos)}),cc.director.on(s.EventConstant.DUNGEON_ADD_FALLSTONE,function(t){e.addFallStone(t.detail.pos,t.detail.isAuto)}),cc.director.on(s.EventConstant.DUNGEON_ADD_AMMO,function(t){e.addAmmo(t.detail.pos)}),cc.director.on(s.EventConstant.DUNGEON_SHAKEONCE,function(t){e.anim&&e.anim.play("DungeonShakeOnce")}),cc.director.on(s.EventConstant.BOSS_ADDSLIME,function(t){e.addBossSlime(t.detail.slimeType,t.detail.posIndex)}),this.fog.zIndex=9e3;var t=n.default.getCurrentMapData().map;this.monsterManager=this.getComponent(r.default),this.equipmentManager=this.getComponent(h.default),this.coinManager=this.getComponent(f.default),this.dungeonStyleManager=this.getComponent(p.default),this.dungeonStyleManager.addDecorations(),this.player.node.parent=this.node,this.bosses=new Array,this.monsters=new Array,this.map=new Array,this.wallmap=new Array,this.trapmap=new Array,this.footboards=new Array;for(var o=new Array,d=new Array,u=0;u<i.WIDTH_SIZE;u++){this.map[u]=new Array(u),this.wallmap[u]=new Array(u),this.trapmap[u]=new Array(u);for(var v=0;v<i.HEIGHT_SIZE;v++){var C=cc.instantiate(this.tile);if(C.parent=this.node,C.position=i.getPosInMap(cc.v2(u,v)),C.zIndex=1e3+100*(i.HEIGHT_SIZE-v),this.map[u][v]=C.getComponent(a.default),this.map[u][v].isAutoShow=!1,"#"==t[u][v]&&(this.map[u][v].isAutoShow=!0),"W"==t[u][v]){var E=cc.instantiate(this.wall);E.parent=this.node,E.position=i.getPosInMap(cc.v2(u,v)),E.zIndex=3e3+100*(i.HEIGHT_SIZE-v),E.opacity=255,this.wallmap[u][v]=E.getComponent(c.default)}if("T"==t[u][v]){var S=cc.instantiate(this.trap);S.parent=this.node,S.position=i.getPosInMap(cc.v2(u,v)),S.zIndex=3e3+100*(i.HEIGHT_SIZE-v),this.trapmap[u][v]=S.getComponent(l.default)}if("E"==t[u][v]){var M=cc.instantiate(this.emplacement);M.parent=this.node,M.position=i.getPosInMap(cc.v2(u,v)),M.zIndex=3e3+100*(i.HEIGHT_SIZE-v),M.getComponent(R.default).dungeon=this}if("D"==t[u][v]&&this.addFallStone(i.getPosInMap(cc.v2(u,v)),!1),"+"==t[u][v]){var T=cc.instantiate(this.floorDecoration);T.parent=this.node,T.position=i.getPosInMap(cc.v2(u,v)),T.zIndex=2e3+100*(i.HEIGHT_SIZE-v)}if("-"==t[u][v]&&"chapter02"==n.default.chapterName){var P=cc.instantiate(this.campFire);P.parent=this.node,P.position=i.getPosInMap(cc.v2(u,v)),P.zIndex=3e3+100*(i.HEIGHT_SIZE-v)-2;var x=P.getChildByName("sprite").getChildByName("shadow");x.position=i.getPosInMap(cc.v2(u,v)),x.position=cc.v2(x.position.x,x.position.y+40),x.parent=this.node,x.zIndex=3e3}if("F"==t[u][v]){var O=cc.instantiate(this.footboard);O.parent=this.node,O.position=i.getPosInMap(cc.v2(u,v)),O.zIndex=3e3+100*(i.HEIGHT_SIZE-v),this.footboards.push(O.getComponent(D.default))}if("V"==t[u][v]){var b=cc.instantiate(this.venom);b.getComponent(_.default).player=this.player,b.getComponent(_.default).isForever=!0,b.parent=this.node,b.position=i.getPosInMap(cc.v2(u,v)),b.zIndex=3e3+100*(i.HEIGHT_SIZE-v)}if("C"==t[u][v]){var A=cc.instantiate(this.chest);A.parent=this.node;var L=A.getComponent(m.default);L.setPos(cc.v2(u,v)),L.setQuality(n.default.getRandomNum(1,3),n.default.mapManger.isCurrentRoomStateClear())}if("B"==t[u][v]){var N,I;(N=cc.instantiate(this.box)).parent=this.node,(I=N.getComponent(y.default)).data.defaultPos=cc.v2(u,v),I.setPos(cc.v2(u,v));var B=n.default.getCurrentMapBoxes();if(B)for(var F=0,w=B;F<w.length;F++){var k=w[F];k.defaultPos.equals(I.data.defaultPos)&&(I.setPos(k.pos),I.node.position=k.position.clone())}else o.push(I.data)}if("G"==t[u][v])(N=cc.instantiate(this.box)).parent=this.node,(I=N.getComponent(y.default)).data.defaultPos=cc.v2(u,v),I.setPos(cc.v2(u,v)),I.boxType=y.default.PLANT;if(!n.default.mapManger.isCurrentRoomStateClear()){if("H"==t[u][v]){var H=cc.instantiate(this.heart);H.parent=this.node,H.position=i.getPosInMap(cc.v2(u,v)),H.zIndex=3e3+100*(i.HEIGHT_SIZE-v)+3}if("A"==t[u][v]){var q=cc.instantiate(this.ammo);q.parent=this.node,q.position=i.getPosInMap(cc.v2(u,v)),q.zIndex=3e3+100*(i.HEIGHT_SIZE-v)+3}}if("M"==t[u][v]){var G=cc.instantiate(this.shoptable);G.parent=this.node;var V=G.getComponent(g.default);V.setPos(cc.v2(u,v));var Z=n.default.getCurrentMapShopTables();if(Z)for(var U=0,z=Z;U<z.length;U++){var W=z[U];W.pos.equals(V.data.pos)&&(V.data.equipdata=W.equipdata.clone(),V.data.isSaled=W.isSaled,V.data.price=W.price)}else d.push(V.data);V.showItem()}if("P"==t[u][v]);if("S"==t[u][v]){var K=cc.instantiate(this.shop);K.parent=this.node,K.position=i.getPosInMap(cc.v2(u,v)),K.zIndex=3e3+100*(i.HEIGHT_SIZE-v)+1}if(!n.default.mapManger.isCurrentRoomStateClear()){if("s"==t[u][v]){var Y=n.default.getHalfChance()?r.default.MONSTER_SAILOR:r.default.MONSTER_STRONGSAILOR;this.addMonsterFromData(Y,u,v)}"p"==t[u][v]&&this.addMonsterFromData(r.default.MONSTER_PIRATE,u,v),"o"==t[u][v]&&this.addMonsterFromData(r.default.MONSTER_OCTOPUS,u,v),"a"==t[u][v]&&this.addMonsterFromData(r.default.MONSTER_SLIME,u,v),"c"==t[u][v]&&this.addMonsterFromData(r.default.MONSTER_CHEST,u,v),"d"==t[u][v]&&this.addMonsterFromData(r.default.MONSTER_ANUBIS,u,v),"e"==t[u][v]&&(this.addMonsterFromData(r.default.MONSTER_SCARAB,u,v),this.addMonsterFromData(r.default.MONSTER_SCARAB,u,v),this.addMonsterFromData(r.default.MONSTER_SCARAB,u,v),this.addMonsterFromData(r.default.MONSTER_SCARAB,u,v),this.addMonsterFromData(r.default.MONSTER_SCARAB,u,v)),"g"==t[u][v]&&this.addMonsterFromData(r.default.MONSTER_GOBLIN,u,v),"m"==t[u][v]&&this.addMonsterFromData(r.default.MONSTER_MUMMY,u,v),"j"==t[u][v]&&this.addMonsterFromData(r.default.MONSTER_CHICKEN,u,v),"k"==t[u][v]&&this.addMonsterFromData(r.default.MONSTER_KILLER,u,v),"y"==t[u][v]&&this.addMonsterFromData(r.default.MONSTER_GARGOYLE,u,v),"b"==t[u][v]&&(this.bossIndex=cc.v2(u,v))}}}!n.default.getCurrentMapBoxes()&&o.length>0&&n.default.mapManger.setCurrentBoxesArr(o),!n.default.getCurrentMapShopTables()&&d.length>0&&n.default.mapManger.setCurrentShopTableArr(d),this.addBoss(),setTimeout(function(){n.default.profile.saveData()},2e3)},t.prototype.addHeart=function(e){if(this.heart){var t=cc.instantiate(this.heart);t.parent=this.node,t.position=e;var o=i.getIndexInMap(e);t.zIndex=3e3+100*(i.HEIGHT_SIZE-o.y)+3}},t.prototype.addFallStone=function(e,t){if(this.fallStone){var o=cc.instantiate(this.fallStone),a=o.getComponent(C.default);a.isAuto=t,o.parent=this.node,o.position=e;var n=i.getIndexInMap(e);o.zIndex=2e3+100*(i.HEIGHT_SIZE-n.y)+3,a.isAuto&&a.fall()}},t.prototype.addAmmo=function(e){if(this.ammo){var t=cc.instantiate(this.ammo);t.parent=this.node,t.position=e;var o=i.getIndexInMap(e);t.zIndex=3e3+100*(i.HEIGHT_SIZE-o.y)+3}},t.prototype.addCoin=function(e,t){this.coinManager&&this.coinManager.getValueCoin(t,e,this.node)},t.prototype.addEquipment=function(e,t,i,o,a){this.equipmentManager&&this.equipmentManager.getEquipment(e,t,this.node,i,o,a)},t.prototype.addMonsterFromData=function(e,t,i){this.addMonster(this.monsterManager.getMonster(e,this),cc.v2(t,i))},t.prototype.breakHalfTiles=function(){for(var e=this,t=function(t){for(var a=function(i){o.map[t][i].isAutoShow=!1,o.breakTile(cc.v2(t,i)),setTimeout(function(){e.breakTile(cc.v2(t,i))},100*Math.random())},n=6;n<i.HEIGHT_SIZE-1;n++)a(n)},o=this,a=1;a<i.WIDTH_SIZE-1;a++)t(a)},t.prototype.addBoss=function(){this.bossIndex&&(n.default.mapManger.getCurrentRoomType()==u.default.BOSS_ROOM?this.addBossKraken():"chapter02"==n.default.chapterName?this.addBossSlime(0,this.bossIndex):this.addBossCaptain())},t.prototype.addBossSlime=function(e,t){if(this.bosses){var i=cc.v2(t.x,t.y);this.bosses.push(this.monsterManager.getSlime(this,i,e))}},t.prototype.addBossCaptain=function(){this.bosses&&this.bosses.push(this.monsterManager.getCaptain(this,this.bossIndex))},t.prototype.addBossKraken=function(){var e=this;if(this.bosses){var t=this.monsterManager.getKraken(this,this.bossIndex);this.bosses.push(t),this.anim.playAdditive("DungeonShakeOnce"),setTimeout(function(){e.anim.playAdditive("DungeonShakeOnce")},1e3),setTimeout(function(){e.anim.playAdditive("DungeonShakeOnce")},2e3),this.breakHalfTiles(),setTimeout(function(){t.showBoss()},3500)}},t.prototype.addMonster=function(e,t){e.node.active=!0,e.pos=t,e.node.position=i.getPosInMap(t),this.monsters.push(e)},t.getPosInMap=function(e){var t=i.MAPX+e.x*i.TILE_SIZE,o=i.MAPY+e.y*i.TILE_SIZE;return cc.v2(t,o)},t.getIndexInMap=function(e,t){var o=(e.x-i.MAPX)/i.TILE_SIZE,a=(e.y-i.MAPY)/i.TILE_SIZE;return o=Math.round(o),a=Math.round(a),t||(o<0&&(o=0),o>=i.WIDTH_SIZE&&(o=i.WIDTH_SIZE-1),a<0&&(a=0),a>=i.HEIGHT_SIZE&&(a=i.HEIGHT_SIZE-1)),cc.v2(o,a)},t.fixOuterMap=function(e){var t=(e.x-i.MAPX)/i.TILE_SIZE,o=(e.y-i.MAPY)/i.TILE_SIZE;t=Math.round(t),o=Math.round(o);var a=!1;return t<0&&(t=0,a=!0),t>=i.WIDTH_SIZE&&(t=i.WIDTH_SIZE-1,a=!0),o<0&&(o=0,a=!0),o>=i.HEIGHT_SIZE&&(o=i.HEIGHT_SIZE-1,a=!0),a?i.getPosInMap(cc.v2(t,o)):e},t.prototype.start=function(){cc.director.emit(s.EventConstant.CHANGE_MINIMAP,{detail:{x:n.default.mapManger.currentPos.x,y:n.default.mapManger.currentPos.y}});for(var e=0,t=n.default.mapManger.getCurrentRoom().doors;e<t.length;e++){var i=t[e];this.dungeonStyleManager.setDoor(i.dir,i.isDoor,!1)}},t.prototype.breakTile=function(e){var t=this.map[e.x][e.y];t.isBroken||t.breakTile()},t.prototype.playerAction=function(e,t,i){this.player&&this.player.playerAction(e,t,i,this)},t.prototype.checkRoomClear=function(){for(var e=!1,t=0,i=0,o=this.monsters;i<o.length;i++){o[i].isDied&&t++}if(e=t>=this.monsters.length,this.bosses.length>0){t=0;for(var a=0,s=this.bosses;a<s.length;a++){s[a].isDied&&t++}e=t>=this.bosses.length}for(var r=0,c=this.footboards;r<c.length;r++){c[r].isOpen||(e=!1)}e&&(this.portal&&this.portal.openGate(),this.dungeonStyleManager&&this.dungeonStyleManager.exitdoor&&this.dungeonStyleManager.exitdoor&&!u.default.isRoomEqual(n.default.mapManger.getCurrentRoom(),n.default.mapManger.rectDungeon.startRoom)&&this.dungeonStyleManager.exitdoor.openGate(),this.openDoors())},t.prototype.openDoors=function(){for(var e=0,t=n.default.mapManger.getCurrentRoom().doors;e<t.length;e++){var i=t[e];n.default.mapManger.setRoomClear(n.default.mapManger.currentPos.x,n.default.mapManger.currentPos.y);var o=!1;if(u.default.isRoomEqual(n.default.mapManger.getCurrentRoom(),n.default.mapManger.rectDungeon.startRoom)&&n.default.mapManger.rectDungeon.endRoom.state!=d.default.STATE_CLEAR){var a=n.default.mapManger.rectDungeon.getNeighborRoomType(n.default.mapManger.currentPos.x,n.default.mapManger.currentPos.y,i.dir);a&&a.roomType==u.default.END_ROOM&&n.default.level!=u.default.LEVEL_5&&n.default.level!=u.default.LEVEL_3&&(o=!0)}1==n.default.level&&(o=!1),o||this.dungeonStyleManager.setDoor(i.dir,i.isDoor,!0)}},t.prototype.checkPlayerPos=function(e){this.fog.setPosition(this.lerp(this.fog.position,this.player.node.position,3*e));var t=i.getIndexInMap(this.player.node.position),o=this.map[t.x][t.y];o.isBroken&&this.player.fall(),o.isAutoShow&&this.breakTile(t)},t.prototype.lerp=function(e,t,i){var o=cc.v2(0,0),a=e.x,n=e.y;return o.x=a+(t.x-a)*i,o.y=n+(t.y-n)*i,o},t.prototype.checkMonstersPos=function(){for(var e=0,t=this.monsters;e<t.length;e++){var i=t[e];if(i.isDied)return;this.map[i.pos.x][i.pos.y].isBroken&&i.fall()}},t.prototype.isTimeDelay=function(e){return this.timeDelay+=e,this.timeDelay>.016&&(this.timeDelay=0,!0)},t.prototype.isCheckTimeDelay=function(e){return this.checkTimeDelay+=e,this.checkTimeDelay>1&&(this.checkTimeDelay=0,!0)},t.prototype.isSaveTimeDelay=function(e){return this.saveTimeDelay+=e,this.saveTimeDelay>15&&(this.saveTimeDelay=0,!0)},t.prototype.update=function(e){this.isTimeDelay(e)&&this.checkPlayerPos(e),this.isCheckTimeDelay(e)&&this.checkRoomClear(),this.isSaveTimeDelay(e)&&n.default.profile.saveData()},t.WIDTH_SIZE=15,t.HEIGHT_SIZE=9,t.MAPX=32,t.MAPY=32,t.TILE_SIZE=64,__decorate([M(cc.Prefab)],t.prototype,"tile",void 0),__decorate([M(cc.Prefab)],t.prototype,"wall",void 0),__decorate([M(cc.Prefab)],t.prototype,"trap",void 0),__decorate([M(cc.Prefab)],t.prototype,"fallStone",void 0),__decorate([M(cc.Prefab)],t.prototype,"emplacement",void 0),__decorate([M(cc.Prefab)],t.prototype,"footboard",void 0),__decorate([M(cc.Prefab)],t.prototype,"chest",void 0),__decorate([M(cc.Prefab)],t.prototype,"box",void 0),__decorate([M(cc.Prefab)],t.prototype,"heart",void 0),__decorate([M(cc.Prefab)],t.prototype,"ammo",void 0),__decorate([M(cc.Prefab)],t.prototype,"shop",void 0),__decorate([M(cc.Prefab)],t.prototype,"shoptable",void 0),__decorate([M(cc.Prefab)],t.prototype,"floorDecoration",void 0),__decorate([M(o.default)],t.prototype,"player",void 0),__decorate([M(cc.Prefab)],t.prototype,"portalPrefab",void 0),__decorate([M(cc.Prefab)],t.prototype,"bed",void 0),__decorate([M(cc.Prefab)],t.prototype,"campFire",void 0),__decorate([M(cc.Prefab)],t.prototype,"venom",void 0),__decorate([M(cc.Node)],t.prototype,"fog",void 0),__decorate([M(v.default)],t.prototype,"bossHealthBar",void 0),t=i=__decorate([S],t)}(cc.Component);i.default=T,cc._RF.pop()},{"./Boss/SlimeVenom":"SlimeVenom","./Building/Box":"Box","./Building/Chest":"Chest","./Building/Emplacement":"Emplacement","./Building/FallStone":"FallStone","./Building/FootBoard":"FootBoard","./Building/Portal":"Portal","./Building/ShopTable":"ShopTable","./Building/Trap":"Trap","./Building/Wall":"Wall","./EventConstant":"EventConstant","./HealthBar":"HealthBar","./Logic":"Logic","./Manager/CoinManager":"CoinManager","./Manager/DungeonStyleManager":"DungeonStyleManager","./Manager/EquipmentManager":"EquipmentManager","./Manager/MonsterManager":"MonsterManager","./Player":"Player","./Rect/RectDungeon":"RectDungeon","./Rect/RectRoom":"RectRoom","./Tile":"Tile"}],Emplacement:[function(e,t,i){"use strict";cc._RF.push(t,"78b9bpQ7+BAGrpzYzxR/1mq","Emplacement"),Object.defineProperty(i,"__esModule",{value:!0});var o=e("../Dungeon"),a=e("../Shooter"),n=cc._decorator,s=n.ccclass,r=n.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.shooterTop=null,t.shooterBottom=null,t.shooterLeft=null,t.shooterRight=null,t.isOpen=!1,t.pos=cc.v2(0,0),t.timeDelay=0,t}return __extends(t,e),t.prototype.onLoad=function(){this.setShooterHv(this.shooterTop,cc.v2(0,1)),this.setShooterHv(this.shooterBottom,cc.v2(0,-1)),this.setShooterHv(this.shooterLeft,cc.v2(-1,0)),this.setShooterHv(this.shooterRight,cc.v2(1,0))},t.prototype.start=function(){var e=this;this.anim=this.getComponent(cc.Animation),setTimeout(function(){e.fire()},1e3)},t.prototype.setPos=function(e){this.pos=e,this.node.position=o.default.getPosInMap(e),this.node.zIndex=3e3+100*(o.default.HEIGHT_SIZE-e.y)+1},t.prototype.OpenFire=function(){},t.prototype.fire=function(){this.anim&&this.anim.play(),this.dungeon&&(this.fireShooter(this.shooterTop),this.fireShooter(this.shooterBottom),this.fireShooter(this.shooterLeft),this.fireShooter(this.shooterRight))},t.prototype.fireShooter=function(e){e.dungeon||(e.dungeon=this.dungeon,e.data.bulletType="bullet010"),e.fireBullet()},t.prototype.setShooterHv=function(e,t){e.setHv(t)},t.prototype.update=function(e){this.timeDelay+=e,this.timeDelay>5&&(this.timeDelay=0,this.fire())},__decorate([r(a.default)],t.prototype,"shooterTop",void 0),__decorate([r(a.default)],t.prototype,"shooterBottom",void 0),__decorate([r(a.default)],t.prototype,"shooterLeft",void 0),__decorate([r(a.default)],t.prototype,"shooterRight",void 0),t=__decorate([s],t)}(cc.Component);i.default=c,cc._RF.pop()},{"../Dungeon":"Dungeon","../Shooter":"Shooter"}],EquipmentData:[function(e,t,i){"use strict";cc._RF.push(t,"a5970exQi1ISK2QZd4VAwv9","EquipmentData"),Object.defineProperty(i,"__esModule",{value:!0});var o=e("./CommonData"),a=function(){function e(){this.nameCn="",this.nameEn="",this.equipmetType="empty",this.equipmetTypeCn="",this.prefix="",this.desc="",this.color="#ffffff",this.titlecolor="#ffffff",this.img="emptyequipment",this.level=0,this.stab=0,this.far=0,this.isLocked=0,this.trouserslong=0,this.damageRemote=0,this.bulletType="",this.showShooter=0,this.info1="",this.info2="",this.info3="",this.suit1="",this.suit2="",this.suit3="",this.infobase="",this.infocolor1="#ffffff",this.infocolor2="#ffffff",this.infocolor3="#ffffff",this.suitcolor1="#ffffff",this.suitcolor2="#ffffff",this.suitcolor3="#ffffff",this.infobasecolor="#ffffff",this.common=new o.default}return Object.defineProperty(e.prototype,"Common",{get:function(){return this.common},enumerable:!0,configurable:!0}),e.prototype.valueCopy=function(e){this.common.valueCopy(e.common),this.nameCn=e.nameCn?e.nameCn:"",this.nameEn=e.nameEn?e.nameEn:"",this.equipmetType=e.equipmetType?e.equipmetType:"",this.equipmetTypeCn=e.equipmetTypeCn?e.equipmetTypeCn:"",this.prefix=e.prefix?e.prefix:"",this.desc=e.desc?e.desc:"",this.color=e.color?e.color:"#ffffff",this.titlecolor=e.titlecolor?e.titlecolor:"#ffffff",this.img=e.img?e.img:"emptyequipment",this.stab=e.stab?e.stab:0,this.far=e.far?e.far:0,this.isLocked=e.isLocked?e.isLocked:0,this.showShooter=e.showShooter?e.showShooter:0,this.level=e.level?e.level:0,this.trouserslong=e.trouserslong?e.trouserslong:0,this.damageRemote=e.damageRemote?e.damageRemote:0,this.showShooter=e.showShooter?e.showShooter:0,this.bulletType=e.bulletType?e.bulletType:"",this.info1=e.info1?e.info1:"",this.info2=e.info2?e.info2:"",this.info3=e.info3?e.info3:"",this.suit1=e.suit1?e.suit1:"",this.suit2=e.suit2?e.suit2:"",this.suit3=e.suit3?e.suit3:"",this.infobase=e.infobase?e.infobase:"",this.infocolor1=e.infocolor1?e.infocolor1:"#ffffff",this.infocolor2=e.infocolor2?e.infocolor2:"#ffffff",this.infocolor3=e.infocolor3?e.infocolor3:"#ffffff",this.suitcolor1=e.suitcolor1?e.suitcolor1:"#ffffff",this.suitcolor2=e.suitcolor2?e.suitcolor2:"#ffffff",this.suitcolor3=e.suitcolor3?e.suitcolor3:"#ffffff",this.infobasecolor=e.infobasecolor?e.infobasecolor:"#ffffff"},e.prototype.clone=function(){var t=new e;return t.common=this.common.clone(),t.nameCn=this.nameCn,t.nameEn=this.nameEn,t.equipmetType=this.equipmetType,t.equipmetTypeCn=this.equipmetTypeCn,t.prefix=this.prefix,t.desc=this.desc,t.color=this.color,t.titlecolor=this.titlecolor,t.img=this.img,t.stab=this.stab,t.far=this.far,t.isLocked=this.isLocked,t.level=this.level,t.trouserslong=this.trouserslong,t.damageRemote=this.damageRemote,t.showShooter=this.showShooter,t.bulletType=this.bulletType,t.info1=this.info1,t.info2=this.info2,t.info3=this.info3,t.suit1=this.suit1,t.suit2=this.suit2,t.suit3=this.suit3,t.infobase=this.infobase,t.infocolor1=this.infocolor1,t.infocolor2=this.infocolor2,t.infocolor3=this.infocolor3,t.suitcolor1=this.suitcolor1,t.suitcolor2=this.suitcolor2,t.suitcolor3=this.suitcolor3,t.infobasecolor=this.infobasecolor,t},e}();i.default=a,cc._RF.pop()},{"./CommonData":"CommonData"}],EquipmentDescData:[function(e,t,i){"use strict";cc._RF.push(t,"d7742jFusdGiIE+18obcC2k","EquipmentDescData"),Object.defineProperty(i,"__esModule",{value:!0});var o=function(){return function(){this.nameCn="",this.nameEn="",this.damageMin=0,this.damageMax=0,this.criticalStrikeRate=0,this.defence=0,this.lifeDrain=0,this.lifeRecovery=0,this.moveSpeed=0,this.attackSpeed=0,this.dodge=0,this.health=0,this.titlecolor="#ffffff",this.color="#ffffff",this.prefix="",this.level=0,this.damageRemote=0,this.realDamage=0,this.realRate=0,this.iceDamage=0,this.iceDefence=0,this.iceRate=0,this.fireDamage=0,this.fireDefence=0,this.fireRate=0,this.lighteningDamage=0,this.lighteningDefence=0,this.lighteningRate=0,this.toxicDamage=0,this.toxicDefence=0,this.toxicRate=0,this.curseDamage=0,this.curseDefence=0,this.curseRate=0,this.info1="",this.info2="",this.info3="",this.suit1="",this.suit2="",this.suit3="",this.infobase="",this.infocolor1="#ffffff",this.infocolor2="#ffffff",this.infocolor3="#ffffff",this.suitcolor1="#ffffff",this.suitcolor2="#ffffff",this.suitcolor3="#ffffff",this.infobasecolor="#ffffff"}}();i.default=o,cc._RF.pop()},{}],EquipmentDialog:[function(e,t,i){"use strict";cc._RF.push(t,"9bf82hBG9BGv4V/KYPwSFw+","EquipmentDialog"),Object.defineProperty(i,"__esModule",{value:!0});var o=cc._decorator,a=o.ccclass,n=o.property,s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.labelTile=null,t.infoBase=null,t.info1=null,t.info2=null,t.info3=null,t.infoSuit1=null,t.infoSuit2=null,t.infoSuit3=null,t.infoDesc=null,t.alpha=0,t.showSpeed=3,t}return __extends(t,e),t.prototype.onLoad=function(){},t.prototype.start=function(){this.alpha=0,this.node.opacity=0,this.showSpeed=30},t.prototype.refreshDialog=function(e){this.labelTile.string=e.prefix+e.nameCn,this.labelTile.node.color=this.labelTile.node.color.fromHEX(e.titlecolor),this.infoBase.string=e.infobase,this.infoBase.node.color=this.infoBase.node.color.fromHEX(e.infobasecolor),this.info1.string=e.info1,this.info1.node.color=this.info1.node.color.fromHEX(e.infocolor1),this.info2.string=e.info2,this.info2.node.color=this.info2.node.color.fromHEX(e.infocolor2),this.info3.string=e.info3,this.info3.node.color=this.info3.node.color.fromHEX(e.infocolor3),this.infoSuit1.string=e.suit1,this.infoSuit1.node.color=this.infoSuit1.node.color.fromHEX(e.suitcolor1),this.infoSuit2.string=e.suit2,this.infoSuit2.node.color=this.infoSuit2.node.color.fromHEX(e.suitcolor2),this.infoSuit3.string=e.suit3,this.infoSuit3.node.color=this.infoSuit3.node.color.fromHEX(e.suitcolor3),this.infoDesc.string=e.desc,this.infoBase.node.active=this.infoBase.string.length>0,this.info1.node.active=this.info1.string.length>0,this.info2.node.active=this.info2.string.length>0,this.info3.node.active=this.info3.string.length>0,this.infoSuit1.node.active=this.infoSuit1.string.length>0,this.infoSuit2.node.active=this.infoSuit2.string.length>0,this.infoSuit3.node.active=this.infoSuit3.string.length>0},t.prototype.showDialog=function(){this.showSpeed=3,this.node.opacity=255},t.prototype.hideDialog=function(){this.showSpeed=30,this.node.opacity=0},t.prototype.update=function(e){},t.prototype.lerp=function(e,t,i){return e+(t-e)*i},__decorate([n(cc.Label)],t.prototype,"labelTile",void 0),__decorate([n(cc.Label)],t.prototype,"infoBase",void 0),__decorate([n(cc.Label)],t.prototype,"info1",void 0),__decorate([n(cc.Label)],t.prototype,"info2",void 0),__decorate([n(cc.Label)],t.prototype,"info3",void 0),__decorate([n(cc.Label)],t.prototype,"infoSuit1",void 0),__decorate([n(cc.Label)],t.prototype,"infoSuit2",void 0),__decorate([n(cc.Label)],t.prototype,"infoSuit3",void 0),__decorate([n(cc.Label)],t.prototype,"infoDesc",void 0),t=__decorate([a],t)}(cc.Component);i.default=s,cc._RF.pop()},{}],EquipmentManager:[function(e,t,i){"use strict";cc._RF.push(t,"29c053rRnlLqrw1VkMXkISC","EquipmentManager"),Object.defineProperty(i,"__esModule",{value:!0});var o=e("../Dungeon"),a=e("../Logic"),n=e("../Data/EquipmentData"),s=e("../Data/EquipmentDescData"),r=e("../Equipment/Equipment"),c=cc._decorator,l=c.ccclass,h=c.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.equipment=null,t}var i;return __extends(t,e),i=t,t.prototype.onLoad=function(){},t.prototype.getRandomDesc=function(e,t){var o=new s.default;if("remote"==e.equipmetType)return o;var a=0,n=this.getRandomQuality(0,100-e.Common.criticalStrikeRate,t);a=n.y>a?n.y:a,o.prefix+=n.y>2?"\u66b4\u51fb":"",o.color=this.getMixColor("#000000",n.y>2?i.COLOR_CRITICALSTRIKE:"#000000");var r=this.getRandomQuality(0,5,t);a=r.y>a?r.y:a;var c=this.getRandomQuality(r.x,r.x+5,t);a=c.y>a?c.y:a,o.prefix+=c.y>2?"\u5f3a\u529b":"",o.color=this.getMixColor(o.color,c.y>2?i.COLOR_POWERFUL:"#000000");var l=this.getRandomQuality(0,5,t);a=l.y>a?l.y:a,o.prefix+=l.y>2?"\u575a\u56fa":"",o.color=this.getMixColor(o.color,l.y>2?i.COLOR_STABLE:"#000000");var h=this.getRandomQuality(0,100,t);a=h.y>a?h.y:a,o.prefix+=h.y>2?"\u90aa\u6076":"",o.color=this.getMixColor(o.color,h.y>2?i.COLOR_LIFEDRAIN:"#000000");var p=Math.random()<.1?this.getRandomQuality(0,5,t):cc.v2(0,0);a=p.y>a?p.y:a,o.prefix+=p.y>2?"\u6e29\u6696":"",o.color=this.getMixColor(o.color,p.y>2?i.COLOR_RECOVERY:"#000000");var d=this.getRandomQuality(0,300-e.Common.moveSpeed,t);a=d.y>a?d.y:a,o.prefix+=d.y>2?"\u7075\u52a8":"",o.color=this.getMixColor(o.color,d.y>2?i.COLOR_MOVESPEED:"#000000");var u=this.getRandomQuality(0,400-e.Common.attackSpeed,t);a=u.y>a?u.y:a,o.prefix+=u.y>2?"\u8fc5\u6377":"",o.color=this.getMixColor(o.color,u.y>2?i.COLOR_ATTACKSPPED:"#000000");var m=this.getRandomQuality(0,60-e.Common.dodge,t);a=m.y>a?m.y:a,o.prefix+=m.y>2?"\u98d8\u9038":"",o.color=this.getMixColor(o.color,m.y>2?i.COLOR_DODGE:"#000000");var g=this.getRandomQuality(0,5,t);a=g.y>a?g.y:a,o.prefix+=g.y>2?"\u5065\u5eb7":"",o.color=this.getMixColor(o.color,g.y>2?i.COLOR_HEALTHY:"#000000");var f=Math.random()<.1?this.getRandomQuality(0,5,t):cc.v2(0,0);a=f.y>a?f.y:a,o.prefix+=f.y>2?"\u950b\u5229":"";var y=Math.random()<.1?this.getRandomQuality(0,5,t):cc.v2(0,0);a=y.y>a?y.y:a,o.prefix+=y.y>2?"\u5bd2\u51b7":"";var D=Math.random()<.1?this.getRandomQuality(0,5,t):cc.v2(0,0);a=D.y>a?D.y:a,o.prefix+=D.y>2?"\u708e\u70ed":"";var v=Math.random()<.1?this.getRandomQuality(0,5,t):cc.v2(0,0);a=v.y>a?v.y:a,o.prefix+=v.y>2?"\u95ea\u7535":"";var C=Math.random()<.1?this.getRandomQuality(0,5,t):cc.v2(0,0);a=C.y>a?C.y:a,o.prefix+=C.y>2?"\u6bd2\u7d20":"";var R=Math.random()<.1?this.getRandomQuality(0,5,t):cc.v2(0,0);a=R.y>a?R.y:a,o.prefix+=R.y>2?"\u8bc5\u5492":"";var _=Math.random()<.1?this.getRandomQuality(0,30,t):cc.v2(0,0);a=_.y>a?_.y:a;var E=Math.random()<.1?this.getRandomQuality(0,30,t):cc.v2(0,0);a=E.y>a?E.y:a;var S=Math.random()<.1?this.getRandomQuality(0,30,t):cc.v2(0,0);a=S.y>a?S.y:a;var M=Math.random()<.1?this.getRandomQuality(0,30,t):cc.v2(0,0);a=M.y>a?M.y:a;var T=Math.random()<.1?this.getRandomQuality(0,30,t):cc.v2(0,0);a=T.y>a?T.y:a;var P=Math.random()<.1?this.getRandomQuality(0,30,t):cc.v2(0,0);a=P.y>a?P.y:a;var x=Math.random()<.1?this.getRandomQuality(0,30,t):cc.v2(0,0);a=x.y>a?x.y:a;var O=Math.random()<.1?this.getRandomQuality(0,30,t):cc.v2(0,0);a=O.y>a?O.y:a;var b=Math.random()<.1?this.getRandomQuality(0,30,t):cc.v2(0,0);a=b.y>a?b.y:a;var A=Math.random()<.1?this.getRandomQuality(0,30,t):cc.v2(0,0);a=A.y>a?A.y:a;var L=Math.random()<.1?this.getRandomQuality(0,30,t):cc.v2(0,0);return a=L.y>a?L.y:a,o.prefix=["\u7c97\u7cd9\u7684","\u666e\u901a\u7684","\u7cbe\u826f\u7684","\u4f18\u79c0\u7684","\u53f2\u8bd7\u7684","\u4f20\u8bf4\u7684"][a]+o.prefix,o.titlecolor=["#dcdcdc","#ffffff","#00ff00","#0000ff","#800080","#ffa500"][a],o.level=a,o.color="#000000"==o.color?"#ffffff":o.color,o.criticalStrikeRate=n.x,o.damageMin=r.x,o.damageMax=c.x,o.defence=l.x,o.lifeDrain=h.x,o.lifeRecovery=p.x,o.moveSpeed=d.x,o.attackSpeed=u.x,o.dodge=m.x,o.health=g.x,o.realDamage=f.x,o.iceDamage=y.x,o.fireDamage=D.x,o.lighteningDamage=v.x,o.toxicDamage=C.x,o.curseDamage=R.x,o.iceDefence=_.x,o.fireDefence=E.x,o.lighteningDefence=S.x,o.toxicDefence=M.x,o.curseDefence=T.x,o.realRate=P.x,o.iceRate=x.x,o.fireRate=O.x,o.lighteningRate=b.x,o.toxicRate=A.x,o.curseRate=L.x,o},t.prototype.getRandomQuality=function(e,t,i){var o=(t-e)/5,n=Math.random();if(i&&n>.9)switch(i){case 1:n=Math.random()>.8?.5:.004;break;case 2:n=Math.random()>.8?.06:.08;break;case 3:n=Math.random()>.8?.086:.09}var s=cc.v2(0,0);return n<.005?(s.x=a.default.getRandomNum(0,o),s.y=1):n>=.05&&n<.075?(s.x=a.default.getRandomNum(o,2*o),s.y=2):n>=.075&&n<.085?(s.x=a.default.getRandomNum(2*o,3*o),s.y=3):n>=.085&&n<.09?(s.x=a.default.getRandomNum(3*o,4*o),s.y=4):n>=.09&&n<.091&&(s.x=a.default.getRandomNum(4*o,5*o),s.y=5),s.x=parseFloat(s.x.toFixed(0)),s},t.prototype.getEquipment=function(e,t,i,s,c,l){var h=cc.instantiate(this.equipment);h.parent=i,h.position=o.default.getPosInMap(t),h.zIndex=3e3+100*(o.default.HEIGHT_SIZE-t.y)+3;var p=h.getComponent(r.default);if(p.pos=t,s)l&&(p.shopTable=l,l.data.equipdata=s.clone(),l.data.price=15*(s.level+1)),p.refresh(s);else{var d=new n.default;d.valueCopy(a.default.equipments[e]);var u=this.getRandomDesc(d,c);d.infobase=this.getEquipmentInfoBase(u,d),d.info1=this.getEquipmentInfo1(u,d),d.info2=this.getEquipmentInfo2(u,d),d.info3=this.getEquipmentInfo3(u,d),d.infobasecolor="#fffff0",d.infocolor1="#98FB98",d.infocolor2="#87CEFA",d.infocolor3="#9370DB",d.Common.criticalStrikeRate+=u.criticalStrikeRate,d.Common.damageMin+=u.damageMin,d.Common.damageMax+=u.damageMax,d.Common.defence+=u.defence,d.Common.lifeDrain+=u.lifeDrain,d.Common.lifeRecovery+=u.lifeRecovery,d.Common.moveSpeed+=u.moveSpeed,d.Common.attackSpeed+=u.attackSpeed,d.Common.dodge+=u.dodge,d.Common.maxHealth+=u.health,d.Common.realDamage+=u.realDamage,d.Common.iceDamage+=u.iceDamage,d.Common.fireDamage+=u.fireDamage,d.Common.lighteningDamage+=u.lighteningDamage,d.Common.toxicDamage+=u.toxicDamage,d.Common.curseDamage+=u.curseDamage,d.Common.iceDefence+=u.iceDefence,d.Common.fireDefence+=u.fireDefence,d.Common.lighteningDefence+=u.lighteningDefence,d.Common.toxicDefence+=u.toxicDefence,d.Common.curseDefence+=u.curseDefence,d.Common.realRate+=u.realRate,d.Common.iceRate+=u.iceRate,d.Common.fireRate+=u.fireRate,d.Common.lighteningRate+=u.lighteningRate,d.Common.toxicRate+=u.toxicRate,d.Common.curseRate+=u.curseRate,d.prefix=u.prefix,d.titlecolor=u.titlecolor,"#ffffff"!=u.color&&(d.color=u.color),d.level=u.level,l&&(p.shopTable=l,l.data.equipdata=d.clone(),l.data.price=15*(u.level+1)),p.refresh(d)}return p},t.prototype.getEquipmentInfoBase=function(e,t){var i="";return i+=t.damageRemote+e.damageRemote==0?"":"\u8fdc\u8ddd\u79bb\u4f24\u5bb3"+t.damageRemote+(0==e.damageRemote?"":"+"+e.damageRemote)+"\n",i+=t.Common.damageMin+e.damageMin==0?"":"\u653b\u51fb"+t.Common.damageMin+(0==e.damageMin?"":"+"+e.damageMin)+" \u6700\u5927\u653b\u51fb\u529b"+t.Common.damageMax+(0==e.damageMax?"":"+"+e.damageMax)+"\n",i+=t.Common.damageMax+e.damageMax==0&&0!=t.Common.damageMax?"\u6700\u5927\u653b\u51fb\u529b"+t.Common.damageMax+(0==e.damageMax?"":"+"+e.damageMax)+"\n":"",i+=t.Common.defence+e.defence==0?"":"\u9632\u5fa1"+t.Common.defence+(0==e.defence?"":"+"+e.defence)+"\n",(i+=t.Common.maxHealth+e.health==0?"":"\u751f\u547d"+t.Common.maxHealth+(0==e.health?"":"+"+e.health)+"\n").length>0&&-1!=i.lastIndexOf("\n")&&(i=i.substring(0,i.lastIndexOf("\n"))),i=i.replace("+-","-")},t.prototype.getEquipmentInfo1=function(e,t){var i="";return i+=t.Common.criticalStrikeRate+e.criticalStrikeRate==0?"":"\u66b4\u51fb"+t.Common.criticalStrikeRate+(0==e.criticalStrikeRate?"":"+"+e.criticalStrikeRate)+"%\n",i+=t.Common.lifeDrain+e.lifeDrain==0?"":"\u5438\u8840"+t.Common.lifeDrain+(0==e.lifeDrain?"":"+"+e.lifeDrain)+"%\n",i+=t.Common.lifeRecovery+e.lifeRecovery==0?"":"\u56de\u590d"+t.Common.lifeRecovery+(0==e.lifeRecovery?"":"+"+e.lifeRecovery)+"\n",i+=t.Common.moveSpeed+e.moveSpeed==0?"":"\u79fb\u901f"+t.Common.moveSpeed+(0==e.moveSpeed?"":"+"+e.moveSpeed)+"\n",i+=t.Common.attackSpeed+e.attackSpeed==0?"":"\u653b\u901f"+t.Common.attackSpeed+(0==e.attackSpeed?"":"+"+e.attackSpeed)+"\n",(i+=t.Common.dodge+e.dodge==0?"":"\u95ea\u907f"+t.Common.dodge+(0==e.dodge?"":"+"+e.dodge)+"%\n").length>0&&-1!=i.lastIndexOf("\n")&&(i=i.substring(0,i.lastIndexOf("\n"))),i=i.replace("+-","-")},t.prototype.getEquipmentInfo2=function(e,t){var i="";return i+=t.Common.realDamage+e.realDamage==0?"":"\u653b\u51fb\u9644\u52a0"+t.Common.realDamage+(0==e.realDamage?"":"+"+e.realDamage)+"\u70b9\u6d41\u8840\u4f24\u5bb3\n",i+=t.Common.realRate+e.realRate==0?"":"\u653b\u51fb\u6709"+t.Common.realRate+(0==e.realRate?"":"+"+e.realRate)+"%\u51e0\u7387\u91ca\u653e\u6d41\u8840\n",i+=t.Common.iceDamage+e.iceDamage==0?"":"\u653b\u51fb\u9644\u52a0"+t.Common.iceDamage+(0==e.iceDamage?"":"+"+e.iceDamage)+"\u70b9\u51b0\u4f24\u5bb3\n",i+=t.Common.iceRate+e.iceRate==0?"":"\u653b\u51fb\u6709"+t.Common.iceRate+(0==e.iceRate?"":"+"+e.iceRate)+"%\u51e0\u7387\u91ca\u653e\u51b0\u51bb\n",i+=t.Common.fireDamage+e.fireDamage==0?"":"\u653b\u51fb\u9644\u52a0"+t.Common.fireDamage+(0==e.fireDamage?"":"+"+e.fireDamage)+"\u70b9\u706b\u4f24\u5bb3\n",i+=t.Common.fireRate+e.fireRate==0?"":"\u653b\u51fb\u6709"+t.Common.fireRate+(0==e.fireRate?"":"+"+e.fireRate)+"%\u51e0\u7387\u91ca\u653e\u71c3\u70e7\n",i+=t.Common.lighteningDamage+e.lighteningDamage==0?"":"\u653b\u51fb\u9644\u52a0"+t.Common.lighteningDamage+(0==e.lighteningDamage?"":"+"+e.lighteningDamage)+"\u70b9\u96f7\u4f24\u5bb3\n",i+=t.Common.lighteningRate+e.lighteningRate==0?"":"\u653b\u51fb\u6709"+t.Common.lighteningRate+(0==e.lighteningRate?"":"+"+e.lighteningRate)+"%\u51e0\u7387\u91ca\u653e\u95ea\u7535\n",i+=t.Common.toxicDamage+e.toxicDamage==0?"":"\u653b\u51fb\u9644\u52a0"+t.Common.toxicDamage+(0==e.toxicDamage?"":"+"+e.toxicDamage)+"\u70b9\u6bd2\u4f24\u5bb3\n",i+=t.Common.toxicRate+e.toxicRate==0?"":"\u6bd2\u653b\u51fb\u6709"+t.Common.toxicRate+(0==e.toxicRate?"":"+"+e.toxicRate)+"%\u51e0\u7387\u91ca\u653e\u6bd2\u7d20\n",i+=t.Common.curseDamage+e.curseDamage==0?"":"\u653b\u51fb\u9644\u52a0 "+t.Common.curseDamage+(0==e.curseDamage?"":"+"+e.curseDamage)+"\u70b9\u8bc5\u5492\u4f24\u5bb3\n",(i+=t.Common.curseRate+e.curseRate==0?"":"\u653b\u51fb\u6709"+t.Common.curseRate+(0==e.curseRate?"":"+"+e.curseRate)+"%\u51e0\u7387\u91ca\u653e\u8bc5\u5492\n").length>0&&-1!=i.lastIndexOf("\n")&&(i=i.substring(0,i.lastIndexOf("\n"))),i=i.replace("+-","-")},t.prototype.getEquipmentInfo3=function(e,t){var i="";return i+=t.Common.iceDefence+e.iceDefence==0?"":"\u51b0\u6297\u6027"+t.Common.iceDefence+(0==e.iceDefence?"":"+"+e.iceDefence)+"%\n",i+=t.Common.fireDefence+e.fireDefence==0?"":"\u706b\u6297\u6027"+t.Common.fireDefence+(0==e.fireDefence?"":"+"+e.fireDefence)+"%\n",i+=t.Common.lighteningDefence+e.lighteningDefence==0?"":"\u96f7\u6297\u6027"+t.Common.lighteningDefence+(0==e.lighteningDefence?"":"+"+e.lighteningDefence)+"%\n",i+=t.Common.toxicDefence+e.toxicDefence==0?"":"\u6bd2\u6297\u6027"+t.Common.toxicDefence+(0==e.toxicDefence?"":"+"+e.toxicDefence)+"%\n",(i+=t.Common.curseDefence+e.curseDefence==0?"":"\u8bc5\u5492\u6297\u6027"+t.Common.curseDefence+(0==e.curseDefence?"":"+"+e.curseDefence)+"%\n").length>0&&-1!=i.lastIndexOf("\n")&&(i=i.substring(0,i.lastIndexOf("\n"))),i=i.replace("+-","-")},t.prototype.start=function(){},t.prototype.getMixColor=function(e,t){var i=cc.color().fromHEX(e),o=cc.color().fromHEX(t),a=cc.color(),n=i.getR()+o.getR(),s=i.getG()+o.getG(),r=i.getB()+o.getB();return a.setR(n>255?255:n),a.setG(s>255?255:s),a.setB(r>255?255:r),"#"+a.toHEX("#rrggbb")},t.EMPTY="emptyequipment",t.WEAPON_DINNERFORK="weapon000",t.WEAPON_KNIFE="weapon001",t.WEAPON_CHOPPER="weapon002",t.WEAPON_HUGEBLADE="weapon003",t.WEAPON_PITCHFORK="weapon004",t.WEAPON_HUGEAXE="weapon005",t.WEAPON_CROWBAR="weapon006",t.WEAPON_KATANA="weapon007",t.WEAPON_FRUITKNIFE="weapon008",t.WEAPON_HAPPYFIRE="weapon009",t.WEAPON_SADICE="weapon010",t.REMOTE_CROSSBOW="remote001",t.REMOTE_LONGBOW="remote002",t.REMOTE_WAND="remote003",t.REMOTE_ALIENGUN="remote004",t.CLOTHES_VEST="clothes001",t.CLOTHES_SHIRT="clothes002",t.CLOTHES_NAVY="clothes003",t.CLOTHES_PIRATE="clothes004",t.CLOTHES_BUCKET="clothes005",t.CLOTHES_REDROBE="clothes006",t.CLOTHES_WHITEROBE="clothes007",t.HELMET_BUCKETHAT="helmet002",t.HELMET_PIRATEHAT="helmet003",t.HELMET_REDHAT="helmet004",t.HELMET_WHITEHAT="helmet005",t.CLOAK_WARRIOR="cloak001",t.TROUSERS_LONG="trousers001",t.TROUSERS_SHORT="trousers002",t.GLOVES_WARRIOR="gloves001",t.GLOVES_DEMON="gloves002",t.GLOVES_BLOODCRAW="gloves003",t.SHOES_WARRIOR="shoes001",t.SHOES_SKATEBOARD="shoes002",t.SHOES_DEMON="shoes003",t.equipments=[i.WEAPON_DINNERFORK,i.WEAPON_KNIFE,i.WEAPON_CHOPPER,i.WEAPON_HUGEBLADE,i.CLOTHES_SHIRT,i.CLOTHES_VEST,i.CLOTHES_NAVY,i.CLOTHES_PIRATE,i.CLOTHES_BUCKET,i.CLOTHES_REDROBE,i.CLOTHES_WHITEROBE,i.HELMET_BUCKETHAT,i.HELMET_PIRATEHAT,i.HELMET_REDHAT,i.HELMET_WHITEHAT,i.WEAPON_PITCHFORK,i.CLOAK_WARRIOR,i.TROUSERS_LONG,i.TROUSERS_SHORT,i.GLOVES_WARRIOR,i.SHOES_WARRIOR,i.SHOES_DEMON,i.SHOES_SKATEBOARD,i.GLOVES_BLOODCRAW,i.GLOVES_DEMON,i.WEAPON_CROWBAR,i.WEAPON_FRUITKNIFE,i.WEAPON_KATANA,i.WEAPON_HUGEAXE,i.WEAPON_HAPPYFIRE,i.WEAPON_SADICE,i.REMOTE_ALIENGUN,i.REMOTE_WAND],t.COLOR_CRITICALSTRIKE="#DC143C",t.COLOR_ATTACKSPPED="#5F9EA0",t.COLOR_MOVESPEED="#00BFFF",t.COLOR_DODGE="#FFFF00",t.COLOR_STABLE="#DEB887",t.COLOR_POWERFUL="#9370DB",t.COLOR_HEALTHY="#90EE90",t.COLOR_LIFEDRAIN="#FFC0CB",t.COLOR_RECOVERY="#ADFF2F",__decorate([h(cc.Prefab)],t.prototype,"equipment",void 0),t=i=__decorate([l],t)}(cc.Component);i.default=p,cc._RF.pop()},{"../Data/EquipmentData":"EquipmentData","../Data/EquipmentDescData":"EquipmentDescData","../Dungeon":"Dungeon","../Equipment/Equipment":"Equipment","../Logic":"Logic"}],Equipment:[function(e,t,i){"use strict";cc._RF.push(t,"46d3aM6X2VOCJtzuWiGZaWE","Equipment"),Object.defineProperty(i,"__esModule",{value:!0});var o=e("../Logic"),a=e("./EquipmentDialog"),n=e("../Data/EquipmentData"),s=e("../EventConstant"),r=e("../Player"),c=cc._decorator,l=c.ccclass,h=c.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.data=new n.default,t.equipmentDialog=null,t.pos=cc.v2(0,0),t.isTaken=!1,t}return __extends(t,e),t.prototype.onLoad=function(){this.isTaken=!1,this.sprite=this.node.getChildByName("sprite")},t.prototype.refresh=function(e){this.data.valueCopy(e),this.equipmentDialog.refreshDialog(this.data);var t=o.default.spriteFrames[this.data.img];"trousers"==e.equipmetType&&(t=1==e.trouserslong?o.default.spriteFrames.idle002:o.default.spriteFrames.idle001),this.sprite.getComponent(cc.Sprite).spriteFrame=t,this.sprite.width=t.getRect().width,this.sprite.height=t.getRect().height;var i=cc.color(255,255,255).fromHEX(this.data.color);this.sprite.color=i,"remote"==e.equipmetType&&(this.sprite.width=this.sprite.width/2,this.sprite.height=this.sprite.height/2)},t.prototype.start=function(){this.anim=this.getComponent(cc.Animation)},t.prototype.onEnable=function(){},t.prototype.taken=function(){var e=this;this.isTaken=!0,this.anim.play("EquipmentTaken"),cc.director.emit(s.EventConstant.PLAYER_CHANGEEQUIPMENT,{detail:{equipData:this.data}}),this.node.getChildByName("shadow").active=!1,this.equipmentDialog.node.active=!1,setTimeout(function(){e.node&&e.destroy()},1e3)},t.prototype.onBeginContact=function(e,t,i){i.body.node.getComponent(r.default)&&this.equipmentDialog.showDialog()},t.prototype.onEndContact=function(e,t,i){i.body.node.getComponent(r.default)&&this.equipmentDialog.hideDialog()},__decorate([h(a.default)],t.prototype,"equipmentDialog",void 0),t=__decorate([l],t)}(cc.Component);i.default=p,cc._RF.pop()},{"../Data/EquipmentData":"EquipmentData","../EventConstant":"EventConstant","../Logic":"Logic","../Player":"Player","./EquipmentDialog":"EquipmentDialog"}],EventConstant:[function(e,t,i){"use strict";cc._RF.push(t,"4128feS00VLAILEQToHDge5","EventConstant"),Object.defineProperty(i,"__esModule",{value:!0});var o=cc._decorator,a=o.ccclass,n=(o.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.PLAYER_MOVE="PLAYER_MOVE",t.PLAYER_ROTATE="PLAYER_ROTATE",t.PLAYER_USEITEM="PLAYER_USEITEM",t.PLAYER_ATTACK="PLAYER_ATTACK",t.PLAYER_REMOTEATTACK="PLAYER_REMOTEATTACK",t.PLAYER_GETITEM="PLAYER_GETITEM",t.PLAYER_TAKEDAMAGE="PLAYER_TAKEDAMAGE",t.PLAYER_CHANGEWEAPON="PLAYER_CHANGEWEAPON",t.PLAYER_CHANGEEQUIPMENT="PLAYER_CHANGEEQUIPMENT",t.PLAYER_STATUSUPDATE="PLAYER_STATUSUPDATE",t.INVENTORY_CHANGEITEM="INVENTORY_CHANGEITEM",t.LOADINGNEXTLEVEL="LOADINGNEXTLEVEL",t.CHANGE_MINIMAP="CHANGE_MINIMAP",t.LOADINGROOM="LOADINGROOM",t.HUD_ADD_COIN="HUD_ADD_COIN",t.HUD_LIGHT_CONTROLLER="HUD_LIGHT_CONTROLLER",t.HUD_DARK_CONTROLLER="HUD_DARK_CONTROLLER",t.DUNGEON_SETEQUIPMENT="DUNGEON_SETEQUIPMENT",t.DUNGEON_SHAKEONCE="DUNGEON_SHAKEONCE",t.DUNGEON_ADD_COIN="DUNGEON_ADD_COIN",t.DUNGEON_ADD_HEART="DUNGEON_ADD_HEART",t.DUNGEON_ADD_AMMO="DUNGEON_ADD_AMMO",t.DUNGEON_ADD_FALLSTONE="DUNGEON_ADD_FALLSTONE",t.MONSTER_STATUSUPDATE="MONSTER_STATUSUPDATE",t.BOSS_ADDSLIME="BOSS_ADDSLIME",t.eventHandler=new cc.Node,t=__decorate([a],t)}(cc.Component));i.EventConstant=n,cc._RF.pop()},{}],ExitDoor:[function(e,t,i){"use strict";cc._RF.push(t,"479c1KI84hEjY9sMAyTcSmq","ExitDoor"),Object.defineProperty(i,"__esModule",{value:!0});var o=e("../Player"),a=e("../EventConstant"),n=e("../Logic"),s=cc._decorator,r=s.ccclass,c=(s.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.isOpen=!1,t.wall1=null,t.wall2=null,t.isDoor=!0,t.bgSprite=null,t.closeSprite=null,t.openSprite=null,t}return __extends(t,e),t.prototype.onLoad=function(){this.bgSprite=this.node.getChildByName("sprite").getChildByName("exitbg").getComponent(cc.Sprite),this.closeSprite=this.node.getChildByName("sprite").getChildByName("exitopen").getComponent(cc.Sprite),this.openSprite=this.node.getChildByName("sprite").getChildByName("exitclose").getComponent(cc.Sprite),this.openSprite.node.zIndex=2e3,this.closeSprite.node.zIndex=3e3},t.prototype.start=function(){switch(n.default.chapterName){case"chapter00":this.changeRes("exit000");break;case"chapter01":this.changeRes("exit001");break;case"chapter02":this.changeRes("exit002");break;case"chapter03":case"chapter04":this.changeRes("exit000")}},t.prototype.hideWall=function(){this.wall1&&(this.wall1.zIndex=1e3,this.wall1.getComponent(cc.PhysicsBoxCollider).sensor=!0,this.wall1.getComponent(cc.PhysicsBoxCollider).apply()),this.wall2&&(this.wall2.zIndex=1e3,this.wall2.getComponent(cc.PhysicsBoxCollider).sensor=!0,this.wall2.getComponent(cc.PhysicsBoxCollider).apply())},t.prototype.openGate=function(){this.isOpen||(this.isOpen=!0,this.getComponent(cc.PhysicsBoxCollider).enabled=!1,this.closeSprite.node.runAction(cc.fadeOut(1)))},t.prototype.closeGate=function(){this.isOpen&&(this.isOpen=!1,this.getComponent(cc.PhysicsBoxCollider).enabled=!0,this.closeSprite.node.runAction(cc.fadeIn(1)))},t.prototype.onCollisionEnter=function(e,t){e.node.getComponent(o.default)&&this.isOpen&&(this.isOpen=!1,cc.director.emit(a.EventConstant.LOADINGNEXTLEVEL))},t.prototype.changeRes=function(e){this.bgSprite.spriteFrame=n.default.spriteFrames[e+"bg"],this.openSprite.spriteFrame=n.default.spriteFrames[e+"open"],this.closeSprite.spriteFrame=n.default.spriteFrames[e+"close"]},t=__decorate([r],t)}(cc.Component));i.default=c,cc._RF.pop()},{"../EventConstant":"EventConstant","../Logic":"Logic","../Player":"Player"}],FallStone:[function(e,t,i){"use strict";cc._RF.push(t,"606fd8guh5COozFgkmej6tZ","FallStone"),Object.defineProperty(i,"__esModule",{value:!0});var o=e("../Player"),a=e("../EventConstant"),n=e("../Data/DamageData"),s=cc._decorator,r=s.ccclass,c=(s.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.isFall=!1,t.isAuto=!0,t.isFalling=!1,t}return __extends(t,e),t.prototype.onLoad=function(){this.isFall=!1},t.prototype.fall=function(){this.anim=this.getComponent(cc.Animation),this.anim.play(),this.isFalling=!0},t.prototype.FallFinish=function(){var e=this;this.isFall=!0,setTimeout(function(){e.isFall=!1},100),setTimeout(function(){e.node&&e.node.destroy()},2e3)},t.prototype.start=function(){},t.prototype.onCollisionEnter=function(e,t){!e.getComponent(o.default)||this.isAuto||this.isFalling||this.fall()},t.prototype.onCollisionStay=function(e,t){e.getComponent(o.default)&&this.isFall&&this.isValid&&(this.isFall=!1,cc.director.emit(a.EventConstant.PLAYER_TAKEDAMAGE,{detail:{damage:new n.default(2)}}))},t=__decorate([r],t)}(cc.Component));i.default=c,cc._RF.pop()},{"../Data/DamageData":"DamageData","../EventConstant":"EventConstant","../Player":"Player"}],FloatingLabelManager:[function(e,t,i){"use strict";cc._RF.push(t,"70be4qc1pdJGpxF0vSkBTb1","FloatingLabelManager"),Object.defineProperty(i,"__esModule",{value:!0});var o=e("../UI/FloatingLabel"),a=cc._decorator,n=a.ccclass,s=a.property,r=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.label=null,t}return __extends(t,e),t.prototype.onLoad=function(){var e=this;this.labelPool=new cc.NodePool,cc.director.on("destorylabel",function(t){e.destroyLabel(t.detail.labelNode)})},t.prototype.getFloaingLabel=function(e){var t=this.node.position.clone();t=this.node.convertToWorldSpace(t),t=e.convertToNodeSpace(t);var i=null;this.labelPool.size()>0&&(i=this.labelPool.get()),i&&!i.active||(i=cc.instantiate(this.label)),i.parent=e,i.position=t.clone();var a=i.getComponent(o.default);return i.zIndex=5e3,i.opacity=255,i.active=!0,a},t.prototype.destroyLabel=function(e){e.active=!1;e.getComponent(cc.Label);this.labelPool&&this.labelPool.put(e)},t.prototype.start=function(){},__decorate([s(cc.Prefab)],t.prototype,"label",void 0),t=__decorate([n],t)}(cc.Component);i.default=r,cc._RF.pop()},{"../UI/FloatingLabel":"FloatingLabel"}],FloatingLabel:[function(e,t,i){"use strict";cc._RF.push(t,"cae6fbyiQhHL5VOrhWuq2d6","FloatingLabel"),Object.defineProperty(i,"__esModule",{value:!0});var o=cc._decorator,a=o.ccclass,n=(o.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.onLoad=function(){this.anim=this.getComponent(cc.Animation),this.label=this.node.getChildByName("label").getComponent(cc.Label)},t.prototype.start=function(){},t.prototype.showLabel=function(e,t,i){i&&(this.node.scale=i),this.label.node.opacity=255,this.label.node.position=cc.v2(0,0),this.label.string=e,this.label.node.color=t,this.anim.play("FontFloating")},t.prototype.showMiss=function(){this.showLabel("\u4e22\u5931",cc.color(255,255,255),1)},t.prototype.showDoge=function(){this.showLabel("\u95ea\u907f",cc.color(255,255,255),1)},t.prototype.showDamage=function(e){var t=e<0?cc.color(255,0,0):cc.color(0,255,0);this.showLabel((e>0?"+":"")+parseFloat(e.toFixed(1)),t,1+Math.abs(e/10))},t.prototype.hideLabel=function(){this.node.active=!1,cc.director.emit("destorylabel",{detail:{labelNode:this.node}})},t.prototype.FloatingFinish=function(){this.hideLabel()},t=__decorate([a],t)}(cc.Component));i.default=n,cc._RF.pop()},{}],FootBoard:[function(e,t,i){"use strict";cc._RF.push(t,"a20d6iwPAJLg7AtbBgYX0yS","FootBoard"),Object.defineProperty(i,"__esModule",{value:!0});var o=e("../Dungeon"),a=e("../Player"),n=e("./Box"),s=cc._decorator,r=s.ccclass,c=s.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.openSpriteFrame=null,t.closeSpriteFrame=null,t.isOpen=!1,t.pos=cc.v2(0,0),t.timeDelay=0,t}return __extends(t,e),t.prototype.onLoad=function(){this.spriteNode=this.node.getChildByName("sprite"),this.sprite=this.spriteNode.getComponent(cc.Sprite)},t.prototype.start=function(){},t.prototype.setPos=function(e){this.pos=e,this.node.position=o.default.getPosInMap(e),this.node.zIndex=3e3+100*(o.default.HEIGHT_SIZE-e.y)+1},t.prototype.openTrap=function(){this.isOpen||(this.isOpen=!0,this.sprite.spriteFrame=this.isOpen?this.openSpriteFrame:this.closeSpriteFrame)},t.prototype.onCollisionStay=function(e,t){e.node.getComponent(n.default)&&(this.isOpen=!0),e.node.getComponent(a.default)&&(this.isOpen=!0)},t.prototype.onCollisionEnter=function(e,t){e.node.getComponent(n.default)&&(this.isOpen=!0),e.node.getComponent(a.default)&&(this.isOpen=!0)},t.prototype.onCollisionExit=function(e,t){e.node.getComponent(n.default)&&(this.isOpen=!1),e.node.getComponent(a.default)&&(this.isOpen=!1)},t.prototype.update=function(e){this.timeDelay+=e,this.timeDelay>.16&&(this.sprite.spriteFrame=this.isOpen?this.openSpriteFrame:this.closeSpriteFrame)},__decorate([c(cc.SpriteFrame)],t.prototype,"openSpriteFrame",void 0),__decorate([c(cc.SpriteFrame)],t.prototype,"closeSpriteFrame",void 0),t=__decorate([r],t)}(cc.Component);i.default=l,cc._RF.pop()},{"../Dungeon":"Dungeon","../Player":"Player","./Box":"Box"}],GameFinish:[function(e,t,i){"use strict";cc._RF.push(t,"98577N+o/RGi4cE+Wsz8Pp4","GameFinish"),Object.defineProperty(i,"__esModule",{value:!0});var o=e("./Logic"),a=e("./WxHelper"),n=cc._decorator,s=n.ccclass,r=n.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.wxhelper=null,t}return __extends(t,e),t.prototype.start=function(){},t.prototype.retry=function(){o.default.resetData(),cc.director.loadScene("loading")},t.prototype.home=function(){this.wxhelper&&this.wxhelper.CloseDialog(),cc.director.loadScene("start")},__decorate([r(a.default)],t.prototype,"wxhelper",void 0),t=__decorate([s],t)}(cc.Component);i.default=c,cc._RF.pop()},{"./Logic":"Logic","./WxHelper":"WxHelper"}],GameOver:[function(e,t,i){"use strict";cc._RF.push(t,"0e28bkl25dNTqUQmquXpqGi","GameOver"),Object.defineProperty(i,"__esModule",{value:!0});var o=e("./Logic"),a=e("./WxHelper"),n=cc._decorator,s=n.ccclass,r=n.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.wxhelper=null,t}return __extends(t,e),t.prototype.start=function(){},t.prototype.retry=function(){o.default.resetData(),cc.director.loadScene("loading")},t.prototype.home=function(){this.wxhelper&&this.wxhelper.CloseDialog(),cc.director.loadScene("start")},__decorate([r(a.default)],t.prototype,"wxhelper",void 0),t=__decorate([s],t)}(cc.Component);i.default=c,cc._RF.pop()},{"./Logic":"Logic","./WxHelper":"WxHelper"}],Game:[function(e,t,i){"use strict";cc._RF.push(t,"c30ffLX6hVIjoNslRhRCM7w","Game"),Object.defineProperty(i,"__esModule",{value:!0});var o=e("./Logic"),a=cc._decorator,n=a.ccclass,s=a.property,r=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.label=null,t}return __extends(t,e),t.prototype.start=function(){},t.prototype.update=function(e){this.label&&(this.label.string="Level "+o.default.level)},__decorate([s(cc.Label)],t.prototype,"label",void 0),t=__decorate([n],t)}(cc.Component);i.default=r,cc._RF.pop()},{"./Logic":"Logic"}],HealthBar:[function(e,t,i){"use strict";cc._RF.push(t,"4298eVZsIJFhKykTJYXRBP0","HealthBar"),Object.defineProperty(i,"__esModule",{value:!0});var o=cc._decorator,a=o.ccclass,n=o.property,s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.backbar=null,t.label=null,t.timeDelay=0,t}return __extends(t,e),t.prototype.onLoad=function(){this.progressBar=this.getComponent(cc.ProgressBar),this.progressBar.progress=1},t.prototype.start=function(){},t.prototype.refreshHealth=function(e,t){this.progressBar&&(this.progressBar.progress=e/t,this.label&&(this.label.string=parseFloat(e.toFixed(1))+"/"+t))},t.prototype.update=function(e){this.timeDelay+=e,this.timeDelay>.016&&(this.timeDelay=0),this.backbar.width=this.lerp(this.backbar.width,this.progressBar.barSprite.node.width,5*e)},t.prototype.lerp=function(e,t,i){return e+(t-e)*i},__decorate([n(cc.Node)],t.prototype,"backbar",void 0),__decorate([n(cc.Label)],t.prototype,"label",void 0),t=__decorate([a],t)}(cc.Component);i.default=s,cc._RF.pop()},{}],InventoryManager:[function(e,t,i){"use strict";cc._RF.push(t,"1dc08IgWM1D6q2nqBDxwhzD","InventoryManager"),Object.defineProperty(i,"__esModule",{value:!0});var o=e("../Data/EquipmentData"),a=function(){function e(){this.weapon=new o.default,this.remote=new o.default,this.helmet=new o.default,this.clothes=new o.default,this.trousers=new o.default,this.gloves=new o.default,this.shoes=new o.default,this.cloak=new o.default,this.buffer=new o.default,this.list=[],this.list=[this.weapon,this.helmet,this.clothes,this.trousers,this.gloves,this.shoes,this.cloak,this.buffer,this.remote]}return e.prototype.getMoveSpeed=function(){for(var e=0,t=0,i=this.list;t<i.length;t++){e+=i[t].Common.moveSpeed}return e},e.prototype.getAttackSpeed=function(){for(var e=0,t=0,i=this.list;t<i.length;t++){e+=i[t].Common.attackSpeed}return e},e.prototype.getRemoteSpeed=function(){for(var e=0,t=0,i=this.list;t<i.length;t++){e+=i[t].Common.remoteSpeed}return e},e.prototype.getAttackPoint=function(){for(var e=cc.v2(0,0),t=0,i=this.list;t<i.length;t++){var o=i[t];e.x+=o.Common.damageMin,e.y+=o.Common.damageMax}return e},e.prototype.getCriticalStrikeRate=function(){for(var e=1,t=0,i=this.list;t<i.length;t++){e*=1-i[t].Common.criticalStrikeRate/100}return 100*(1-e)},e.prototype.getDodge=function(){for(var e=1,t=0,i=this.list;t<i.length;t++){e*=1-i[t].Common.dodge/100}return 100*(1-e)},e.prototype.getDefence=function(){for(var e=0,t=0,i=this.list;t<i.length;t++){e+=i[t].Common.defence}return e},e.prototype.getIceDefence=function(){for(var e=0,t=0,i=this.list;t<i.length;t++){e+=i[t].Common.iceDefence}return e},e.prototype.getFireDefence=function(){for(var e=0,t=0,i=this.list;t<i.length;t++){e+=i[t].Common.fireDefence}return e},e.prototype.getLighteningDefence=function(){for(var e=0,t=0,i=this.list;t<i.length;t++){e+=i[t].Common.lighteningDefence}return e},e.prototype.getToxicDefence=function(){for(var e=0,t=0,i=this.list;t<i.length;t++){e+=i[t].Common.toxicDefence}return e},e.prototype.getCurseDefence=function(){for(var e=0,t=0,i=this.list;t<i.length;t++){e+=i[t].Common.curseDefence}return e},e.prototype.getRealDamage=function(){for(var e=0,t=0,i=this.list;t<i.length;t++){e+=i[t].Common.realDamage}return e},e.prototype.getIceDamage=function(){for(var e=0,t=0,i=this.list;t<i.length;t++){e+=i[t].Common.iceDamage}return e},e.prototype.getFireDamage=function(){for(var e=0,t=0,i=this.list;t<i.length;t++){e+=i[t].Common.fireDamage}return e},e.prototype.getLighteningDamage=function(){for(var e=0,t=0,i=this.list;t<i.length;t++){e+=i[t].Common.lighteningDamage}return e},e.prototype.getToxicDamage=function(){for(var e=0,t=0,i=this.list;t<i.length;t++){e+=i[t].Common.toxicDamage}return e},e.prototype.getCurseDamage=function(){for(var e=0,t=0,i=this.list;t<i.length;t++){e+=i[t].Common.curseDamage}return e},e.prototype.getRealRate=function(){for(var e=0,t=0,i=this.list;t<i.length;t++){e+=i[t].Common.realRate}return e},e.prototype.getIceRate=function(){for(var e=0,t=0,i=this.list;t<i.length;t++){e+=i[t].Common.iceRate}return e},e.prototype.getFireRate=function(){for(var e=0,t=0,i=this.list;t<i.length;t++){e+=i[t].Common.fireRate}return e},e.prototype.getLighteningRate=function(){for(var e=0,t=0,i=this.list;t<i.length;t++){e+=i[t].Common.lighteningRate}return e},e.prototype.getToxicRate=function(){for(var e=0,t=0,i=this.list;t<i.length;t++){e+=i[t].Common.toxicRate}return e},e.prototype.getCurseRate=function(){for(var e=0,t=0,i=this.list;t<i.length;t++){e+=i[t].Common.curseRate}return e},e.prototype.getLifeRecovery=function(){for(var e=0,t=0,i=this.list;t<i.length;t++){e+=i[t].Common.lifeRecovery}return e},e.prototype.getLifeDrainRate=function(){for(var e=1,t=0,i=this.list;t<i.length;t++){e*=1-i[t].Common.lifeDrain/100}return 100*(1-e)},e.prototype.getHealth=function(){for(var e=0,t=0,i=this.list;t<i.length;t++){e+=i[t].Common.maxHealth}return e},e.prototype.getTotalEquipmentData=function(){var e=new o.default;return e.Common.damageMin=this.getAttackPoint().x,e.Common.damageMax=this.getAttackPoint().y,e.Common.criticalStrikeRate=this.getCriticalStrikeRate(),e.Common.defence=this.getDefence(),e.Common.lifeDrain=this.getLifeDrainRate(),e.Common.lifeRecovery=this.getLifeRecovery(),e.Common.moveSpeed=this.getMoveSpeed(),e.Common.attackSpeed=this.getAttackSpeed(),e.Common.remoteSpeed=this.getRemoteSpeed(),e.Common.dodge=this.getDodge(),e.Common.maxHealth=this.getHealth(),e.Common.realDamage=this.getRealDamage(),e.Common.realRate=this.getRealRate(),e.Common.iceDamage=this.getIceDamage(),e.Common.iceDefence=this.getIceDefence(),e.Common.iceRate=this.getIceRate(),e.Common.fireDamage=this.getFireDamage(),e.Common.fireDefence=this.getFireDefence(),e.Common.fireRate=this.getFireRate(),e.Common.lighteningDamage=this.getLighteningDamage(),e.Common.lighteningDefence=this.getLighteningDefence(),e.Common.lighteningRate=this.getLighteningRate(),e.Common.toxicDamage=this.getToxicDamage(),e.Common.toxicDefence=this.getToxicDefence(),e.Common.toxicRate=this.getToxicRate(),e.Common.curseDamage=this.getCurseDamage(),e.Common.curseDefence=this.getCurseDefence(),e.Common.curseRate=this.getCurseRate(),e},e}();i.default=a,cc._RF.pop()},{"../Data/EquipmentData":"EquipmentData"}],Inventory:[function(e,t,i){"use strict";cc._RF.push(t,"3b411lPIzZAv7ApO4pixeng","Inventory"),Object.defineProperty(i,"__esModule",{value:!0});var o=cc._decorator,a=o.ccclass,n=o.property,s=e("./EventConstant"),r=e("./Logic"),c=e("./Data/EquipmentData"),l=e("./Player"),h=e("./Equipment/EquipmentDialog"),p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tabselect=null,t.player=null,t.selectIndex=0,t.weapon=null,t.remote=null,t.helmet=null,t.clothes=null,t.trousers=null,t.gloves=null,t.shoes=null,t.cloak=null,t.equipmentDialog=null,t}return __extends(t,e),t.prototype.onLoad=function(){var e=this;this.inventoryManager=r.default.inventoryManager,cc.director.on(s.EventConstant.PLAYER_CHANGEEQUIPMENT,function(t){e.refreshEquipment(t.detail.equipData,!0)})},t.prototype.start=function(){this.tabselect.x=0,this.weapon.spriteFrame=null,this.remote.spriteFrame=null,this.helmet.spriteFrame=null,this.clothes.spriteFrame=null,this.trousers.spriteFrame=null,this.gloves.spriteFrame=null,this.shoes.spriteFrame=null,this.cloak.spriteFrame=null,this.addSpriteTouchEvent(this.weapon,"weapon"),this.addSpriteTouchEvent(this.remote,"remote"),this.addSpriteTouchEvent(this.helmet,"helmet"),this.addSpriteTouchEvent(this.clothes,"clothes"),this.addSpriteTouchEvent(this.trousers,"trousers"),this.addSpriteTouchEvent(this.gloves,"gloves"),this.addSpriteTouchEvent(this.shoes,"shoes"),this.addSpriteTouchEvent(this.cloak,"cloak"),this.refreshEquipment(this.inventoryManager.weapon,!1),this.refreshEquipment(this.inventoryManager.remote,!1),this.refreshEquipment(this.inventoryManager.helmet,!1),this.refreshEquipment(this.inventoryManager.clothes,!1),this.refreshEquipment(this.inventoryManager.trousers,!1),this.refreshEquipment(this.inventoryManager.gloves,!1),this.refreshEquipment(this.inventoryManager.shoes,!1),this.refreshEquipment(this.inventoryManager.cloak,!1)},t.prototype.addSpriteTouchEvent=function(e,t){var i=this;e.node.on(cc.Node.EventType.TOUCH_START,function(){if(null!=e.spriteFrame){var o=new c.default;switch(t){case"weapon":o=i.inventoryManager.weapon.clone();break;case"remote":o=i.inventoryManager.remote.clone();break;case"helmet":o=i.inventoryManager.helmet.clone();break;case"clothes":o=i.inventoryManager.clothes.clone();break;case"trousers":o=i.inventoryManager.trousers.clone();break;case"gloves":o=i.inventoryManager.gloves.clone();break;case"shoes":o=i.inventoryManager.shoes.clone();break;case"cloak":o=i.inventoryManager.cloak.clone()}i.equipmentDialog.refreshDialog(o),i.equipmentDialog.showDialog()}}),e.node.on(cc.Node.EventType.TOUCH_END,function(){i.equipmentDialog.hideDialog()}),e.node.on(cc.Node.EventType.TOUCH_CANCEL,function(){i.equipmentDialog.hideDialog()})},t.prototype.select=function(e,t){var i=parseInt(t);this.tabselect.y=64*i;var o=e.currentTarget;cc.director.emit(s.EventConstant.INVENTORY_CHANGEITEM,{detail:{spriteFrame:o.getComponentInChildren(cc.Sprite).spriteFrame}})},t.prototype.setEquipment=function(e,t,i){if(t.equipmetType==e.equipmetType){var o=this.player.getComponent(l.default).pos.clone();o.y<1?o.y+=1:o.y-=1,i&&cc.director.emit(s.EventConstant.DUNGEON_SETEQUIPMENT,{detail:{pos:o,equipmentData:t}})}},t.prototype.refreshEquipment=function(e,t){if(e&&this.weapon){var i=cc.color(255,255,255).fromHEX(e.color),o=r.default.spriteFrames[e.img];switch(e.equipmetType){case"weapon":this.weapon.spriteFrame=o,this.weapon.node.color=i,this.setEquipment(e,this.inventoryManager.weapon,t),this.inventoryManager.weapon.valueCopy(e);break;case"remote":this.remote.spriteFrame=o,this.remote.node.color=i,this.setEquipment(e,this.inventoryManager.remote,t),this.inventoryManager.remote.valueCopy(e);break;case"helmet":this.helmet.spriteFrame=o,this.helmet.node.color=i,this.setEquipment(e,this.inventoryManager.helmet,t),this.inventoryManager.helmet.valueCopy(e);break;case"clothes":this.clothes.spriteFrame=o,this.clothes.node.color=i,this.setEquipment(e,this.inventoryManager.clothes,t),this.inventoryManager.clothes.valueCopy(e);break;case"trousers":this.trousers.spriteFrame=1==e.trouserslong?r.default.spriteFrames.idle002:r.default.spriteFrames.idle001,this.trousers.node.color=i,this.setEquipment(e,this.inventoryManager.trousers,t),this.inventoryManager.trousers.valueCopy(e);break;case"gloves":this.gloves.spriteFrame=o,this.gloves.node.color=i,this.setEquipment(e,this.inventoryManager.gloves,t),this.inventoryManager.gloves.valueCopy(e);break;case"shoes":this.shoes.spriteFrame=o,this.shoes.node.color=i,this.setEquipment(e,this.inventoryManager.shoes,t),this.inventoryManager.shoes.valueCopy(e);break;case"cloak":this.cloak.spriteFrame=o,this.cloak.node.color=i,this.setEquipment(e,this.inventoryManager.cloak,t),this.inventoryManager.cloak.valueCopy(e)}this.player&&(this.player.getComponent(l.default).inventoryManager=this.inventoryManager,this.player.getComponent(l.default).changeEquipment(e,o))}},__decorate([n(cc.Node)],t.prototype,"tabselect",void 0),__decorate([n(cc.Node)],t.prototype,"player",void 0),__decorate([n(cc.Sprite)],t.prototype,"weapon",void 0),__decorate([n(cc.Sprite)],t.prototype,"remote",void 0),__decorate([n(cc.Sprite)],t.prototype,"helmet",void 0),__decorate([n(cc.Sprite)],t.prototype,"clothes",void 0),__decorate([n(cc.Sprite)],t.prototype,"trousers",void 0),__decorate([n(cc.Sprite)],t.prototype,"gloves",void 0),__decorate([n(cc.Sprite)],t.prototype,"shoes",void 0),__decorate([n(cc.Sprite)],t.prototype,"cloak",void 0),__decorate([n(h.default)],t.prototype,"equipmentDialog",void 0),t=__decorate([a],t)}(cc.Component);i.default=p,cc._RF.pop()},{"./Data/EquipmentData":"EquipmentData","./Equipment/EquipmentDialog":"EquipmentDialog","./EventConstant":"EventConstant","./Logic":"Logic","./Player":"Player"}],ItemData:[function(e,t,i){"use strict";cc._RF.push(t,"371e21tzPlAtY0KmtggGqZV","ItemData"),Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function e(){this.statusType=0,this.nameCn="",this.nameEn="",this.duration=0,this.desc="",this.spriteFrameName="",this.physicalDamageDirect=0,this.physicalDamageOvertime=0,this.physicalDamageDecrease=0,this.defence=0,this.missRate=0,this.criticalStrikeRate=0,this.lifeDrain=0,this.lifeRecovery=0,this.moveSpeed=0,this.attackSpeed=0,this.dodge=0,this.maxHealth=0,this.realDamgeDirect=0,this.realDamgeOvertime=0,this.iceDamageDirect=0,this.iceDamageOvertime=0,this.iceDamageDecrease=0,this.iceDefence=0,this.iceRate=0,this.fireDamageDirect=0,this.fireDamageOvertime=0,this.fireDamageDecrease=0,this.fireDefence=0,this.fireRate=0,this.lighteningDamageDirect=0,this.lighteningDamageOvertime=0,this.lighteningDamageDecrease=0,this.lighteningDefence=0,this.lighteningRate=0,this.toxicDamageDirect=0,this.toxicDamageOvertime=0,this.toxicDamageDecrease=0,this.toxicDefence=0,this.toxicRate=0,this.curseDamageDirect=0,this.curseDamageOvertime=0,this.curseDamageDecrease=0,this.curseDefence=0,this.curseRate=0}return e.prototype.valueCopy=function(e){this.nameCn=e.nameCn?e.nameCn:this.nameCn,this.nameEn=e.nameEn,this.statusType=e.statusType,this.duration=e.duration,this.spriteFrameName=e.spriteFrameName,this.desc=e.desc,this.physicalDamageDirect=e.physicalDamageDirect,this.physicalDamageOvertime=e.physicalDamageOvertime,this.physicalDamageDecrease=e.physicalDamageDecrease,this.defence=e.defence,this.missRate=e.missRate,this.criticalStrikeRate=e.criticalStrikeRate,this.lifeDrain=e.lifeDrain,this.lifeRecovery=e.lifeRecovery,this.moveSpeed=e.moveSpeed,this.attackSpeed=e.attackSpeed,this.dodge=e.dodge,this.maxHealth=e.maxHealth,this.realDamgeDirect=e.realDamgeDirect,this.realDamgeOvertime=e.realDamgeOvertime,this.iceDamageDirect=e.iceDamageDirect,this.iceDamageOvertime=e.iceDamageOvertime,this.iceDamageDecrease=e.iceDamageDecrease,this.iceDefence=e.iceDefence,this.iceRate=e.iceRate,this.fireDamageDirect=e.fireDamageDirect,this.fireDamageOvertime=e.fireDamageOvertime,this.fireDamageDecrease=e.fireDamageDecrease,this.fireDefence=e.fireDefence,this.fireRate=e.fireRate,this.lighteningDamageDirect=e.lighteningDamageDirect,this.lighteningDamageOvertime=e.lighteningDamageOvertime,this.lighteningDamageDecrease=e.lighteningDamageDecrease,this.lighteningDefence=e.lighteningDefence,this.lighteningRate=e.lighteningRate,this.toxicDamageDirect=e.toxicDamageDirect,this.toxicDamageOvertime=e.toxicDamageOvertime,this.toxicDamageDecrease=e.toxicDamageDecrease,this.toxicDefence=e.toxicDefence,this.toxicRate=e.toxicRate,this.curseDamageDirect=e.curseDamageDirect,this.curseDamageOvertime=e.curseDamageOvertime,this.curseDamageDecrease=e.curseDamageDecrease,this.curseDefence=e.curseDefence,this.curseRate=e.curseRate},e.prototype.clone=function(){var t=new e;return t.nameCn=this.nameCn,t.nameEn=this.nameEn,t.statusType=this.statusType,t.duration=this.duration,t.desc=this.desc,t.physicalDamageDirect=this.physicalDamageDirect,t.physicalDamageOvertime=this.physicalDamageOvertime,t.physicalDamageDecrease=this.physicalDamageDecrease,t.defence=this.defence,t.missRate=this.missRate,t.criticalStrikeRate=this.criticalStrikeRate,t.lifeDrain=this.lifeDrain,t.lifeRecovery=this.lifeRecovery,t.moveSpeed=this.moveSpeed,t.attackSpeed=this.attackSpeed,t.dodge=this.dodge,t.maxHealth=this.maxHealth,t.realDamgeDirect=this.realDamgeDirect,t.realDamgeOvertime=this.realDamgeDirect,t.iceDamageDirect=this.iceDamageDirect,t.iceDamageOvertime=this.iceDamageOvertime,t.iceDamageDecrease=this.iceDamageDecrease,t.iceDefence=this.iceDefence,t.iceRate=this.iceRate,t.fireDamageDirect=this.fireDamageDirect,t.fireDamageOvertime=this.fireDamageOvertime,t.fireDamageDecrease=this.fireDamageDecrease,t.fireDefence=this.fireDefence,t.fireRate=this.fireRate,t.lighteningDamageDirect=this.lighteningDamageDirect,t.lighteningDamageOvertime=this.lighteningDamageOvertime,t.lighteningDamageDecrease=this.lighteningDamageDecrease,t.lighteningDefence=this.lighteningDefence,t.lighteningRate=this.lighteningRate,t.toxicDamageDirect=this.toxicDamageDirect,t.toxicDamageOvertime=this.toxicDamageOvertime,t.toxicDamageDecrease=this.toxicDamageDecrease,t.toxicDefence=this.toxicDefence,t.toxicRate=this.toxicRate,t.curseDamageDirect=this.curseDamageDirect,t.curseDamageOvertime=this.curseDamageOvertime,t.curseDamageDecrease=this.curseDamageDecrease,t.curseDefence=this.curseDefence,t.curseRate=this.curseRate,t.spriteFrameName=this.spriteFrameName,t},e}();i.default=o,cc._RF.pop()},{}],Item:[function(e,t,i){"use strict";cc._RF.push(t,"ce4de5SY9BKg5Ay5wKpP9r7","Item"),Object.defineProperty(i,"__esModule",{value:!0});var o=e("../EventConstant"),a=e("../Player"),n=e("../Logic"),s=e("../Data/DamageData"),r=cc._decorator,c=r.ccclass,l=r.property,h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.damage=-1,t.ammo=0,t.isTaken=!1,t}return __extends(t,e),t.prototype.start=function(){this.anim=this.getComponent(cc.Animation)},t.prototype.taken=function(){var e=this;this.isTaken||(this.anim.play("ItemTaken"),this.isTaken=!0,0!=this.damage&&cc.director.emit(o.EventConstant.PLAYER_TAKEDAMAGE,{detail:{damage:new s.default(this.damage)}}),0!=this.ammo&&(n.default.ammo+=this.ammo),setTimeout(function(){e.node&&(e.node.active=!1)},3e3))},t.prototype.onCollisionEnter=function(e,t){e.node.getComponent(a.default)&&this.taken()},__decorate([l],t.prototype,"damage",void 0),__decorate([l],t.prototype,"ammo",void 0),t=__decorate([c],t)}(cc.Component);i.default=h,cc._RF.pop()},{"../Data/DamageData":"DamageData","../EventConstant":"EventConstant","../Logic":"Logic","../Player":"Player"}],JoyController:[function(e,t,i){"use strict";cc._RF.push(t,"246e3R5w7RM/68kAxSEZZAX","JoyController"),Object.defineProperty(i,"__esModule",{value:!0});var o=e("./EventConstant"),a=cc._decorator,n=a.ccclass,s=a.property,r=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.anglePreDirQuadrant=23,t.fixedPoint=null,t.movePoint=null,t.movePointMoveRadius=100,t.timeDelay=0,t}return __extends(t,e),t.prototype.onLoad=function(){var e=this.node.getContentSize();this.touchArea=new cc.Vec2(e.width,e.height),this.fixedPointMoveCenterPos=cc.v2(0,0),this.fixedPointMoveRadius=this.touchArea.x/2-this.movePointMoveRadius,this.node.on(cc.Node.EventType.TOUCH_START,function(e){if(-1==this.touchID){var t=e.getLocation(),i=new cc.Vec2(t.x,t.y);i.subSelf(this.node.position);var o=this.clampPos(i,this.fixedPointMoveCenterPos,this.fixedPointMoveRadius);this.movePointMoveCenterPos=o,this.setFixedPointPos(o),this.touchID=e.getID()}},this),this.node.on(cc.Node.EventType.TOUCH_MOVE,function(e){if(this.touchID==e.getID()){var t=e.getLocation(),i=new cc.Vec2(t.x,t.y);i.subSelf(this.node.position);var o=this.clampPos(i,this.movePointMoveCenterPos,this.movePointMoveRadius);console.log(o),this.setMovePointPos(o)}},this),this.node.on(cc.Node.EventType.TOUCH_END,function(e){this.init(),cc.director.emit(o.EventConstant.PLAYER_ATTACK)},this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,function(e){this.init(),cc.director.emit(o.EventConstant.PLAYER_ATTACK)},this),this.init()},t.prototype.init=function(){this.touchID=-1,this.joystickInputDir=new cc.Vec2,this.setFixedPointPos(this.fixedPointMoveCenterPos),this.setMovePointPos(this.fixedPointMoveCenterPos)},t.prototype.setFixedPointPos=function(e){this.fixedPoint.setPosition(cc.v2(0,0))},t.prototype.getFixedPointPos=function(){return this.fixedPoint.getPosition()},t.prototype.setMovePointPos=function(e){this.movePoint.setPosition(e)},t.prototype.getMovePointPos=function(){return this.movePoint.getPosition()},t.prototype.clampPos=function(e,t,i){var o=e.sub(t);return o.mag()>i?o.normalize().mul(i).add(t):e},t.prototype.getInputDir=function(){var e=this.movePoint.getPosition().sub(this.fixedPoint.getPosition());return e.mag()>0&&e.normalizeSelf(),e},t.prototype.getInputQuadrantDir=function(){return this.getVec2ByQuadrant(this.getDirQuadrant(this.getInputDir()))},t.prototype.getDirQuadrant=function(e){var t=null;return e.mag()>0&&(t=Math.floor(this.getAngleByVec2(e)/this.anglePreDirQuadrant)),t},t.prototype.getAngleByVec2=function(e){return 180*-Math.atan2(e.y,e.x)/Math.PI+this.anglePreDirQuadrant/2},t.prototype.getVec2ByAngle=function(e){var t=new cc.Vec2,i=(this.anglePreDirQuadrant/2-e)*(Math.PI/180);return t.x=Math.cos(i),t.y=Math.sin(i),t.normalizeSelf()},t.prototype.getVec2ByQuadrant=function(e){if(null!=e){var t=e*this.anglePreDirQuadrant;return t+=this.anglePreDirQuadrant/2,this.getVec2ByAngle(t)}return cc.Vec2.ZERO},t.prototype.sendMoveMessageToPlayer=function(e){var t=this.getInputQuadrantDir(),i=4;Math.abs(t.x)<Math.abs(t.y)&&(t.y>.3&&(i=0),t.y<-.3&&(i=1)),Math.abs(t.x)>Math.abs(t.y)&&(t.x<-.3&&(i=2),t.x>.3&&(i=3));var a=this.getInputDir();cc.director.emit(o.EventConstant.PLAYER_ROTATE,{detail:{dir:i,pos:a,dt:e}})},t.prototype.isTimeDelay=function(e){return this.timeDelay+=e,this.timeDelay>.016&&(this.timeDelay=0,!0)},t.prototype.update=function(e){this.isTimeDelay(e)&&this.sendMoveMessageToPlayer(e)},__decorate([s(cc.Integer)],t.prototype,"anglePreDirQuadrant",void 0),__decorate([s(cc.Node)],t.prototype,"fixedPoint",void 0),__decorate([s(cc.Node)],t.prototype,"movePoint",void 0),__decorate([s],t.prototype,"movePointMoveRadius",void 0),t=__decorate([n],t)}(cc.Component);i.default=r,cc._RF.pop()},{"./EventConstant":"EventConstant"}],Joystick:[function(e,t,i){"use strict";cc._RF.push(t,"a3868eVgi9Ewpbgxpufia3p","Joystick"),Object.defineProperty(i,"__esModule",{value:!0});var o=e("./EventConstant"),a=cc._decorator,n=a.ccclass,s=a.property,r=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.anglePreDirQuadrant=23,t.fixedPoint=null,t.movePoint=null,t.movePointMoveRadius=100,t.stopCount=0,t.timeDelay=0,t}return __extends(t,e),t.prototype.onLoad=function(){var e=this.node.getContentSize();this.touchArea=new cc.Vec2(e.width,e.height),this.fixedPointMoveCenterPos=this.touchArea.div(0,this.touchArea),this.fixedPointMoveRadius=this.touchArea.x/2-this.movePointMoveRadius,this.node.on(cc.Node.EventType.TOUCH_START,function(e){if(-1==this.touchID){var t=e.getLocation(),i=new cc.Vec2(t.x,t.y);i.subSelf(this.node.position);var o=this.clampPos(i,this.fixedPointMoveCenterPos,this.fixedPointMoveRadius);this.movePointMoveCenterPos=o,this.setFixedPointPos(o),this.setMovePointPos(o),this.touchID=e.getID()}},this),this.node.on(cc.Node.EventType.TOUCH_MOVE,function(e){if(this.touchID==e.getID()){var t=e.getLocation(),i=new cc.Vec2(t.x,t.y);i.subSelf(this.node.position);var o=this.clampPos(i,this.movePointMoveCenterPos,this.movePointMoveRadius);this.setMovePointPos(o)}},this),this.node.on(cc.Node.EventType.TOUCH_END,function(e){this.init()},this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,function(e){this.init()},this),this.init()},t.prototype.init=function(){this.touchID=-1,this.joystickInputDir=new cc.Vec2,this.setFixedPointPos(this.fixedPointMoveCenterPos),this.setMovePointPos(this.fixedPointMoveCenterPos)},t.prototype.setFixedPointPos=function(e){this.fixedPoint.setPosition(e)},t.prototype.getFixedPointPos=function(){return this.fixedPoint.getPosition()},t.prototype.setMovePointPos=function(e){this.movePoint.setPosition(e)},t.prototype.getMovePointPos=function(){return this.movePoint.getPosition()},t.prototype.clampPos=function(e,t,i){var o=e.sub(t);return o.mag()>i?o.normalize().mul(i).add(t):e},t.prototype.getInputDir=function(){var e=this.movePoint.getPosition().sub(this.fixedPoint.getPosition());return(isNaN(e.x)||isNaN(e.y))&&(e=cc.v2(0,0)),e.mag()>0&&e.normalizeSelf(),e},t.prototype.getInputQuadrantDir=function(){return this.getVec2ByQuadrant(this.getDirQuadrant(this.getInputDir()))},t.prototype.getDirQuadrant=function(e){var t=null;return e.mag()>0&&(t=Math.floor(this.getAngleByVec2(e)/this.anglePreDirQuadrant)),t},t.prototype.getAngleByVec2=function(e){return 180*-Math.atan2(e.y,e.x)/Math.PI+this.anglePreDirQuadrant/2},t.prototype.getVec2ByAngle=function(e){var t=new cc.Vec2,i=(this.anglePreDirQuadrant/2-e)*(Math.PI/180);return t.x=Math.cos(i),t.y=Math.sin(i),t.normalizeSelf()},t.prototype.getVec2ByQuadrant=function(e){if(null!=e){var t=e*this.anglePreDirQuadrant;return t+=this.anglePreDirQuadrant/2,this.getVec2ByAngle(t)}return cc.Vec2.ZERO},t.prototype.sendMoveMessageToPlayer=function(e){var t=this.getInputQuadrantDir(),i=4;Math.abs(t.x)<Math.abs(t.y)&&(t.y>.3&&(i=0),t.y<-.3&&(i=1)),Math.abs(t.x)>Math.abs(t.y)&&(t.x<-.3&&(i=2),t.x>.3&&(i=3));var a=this.getInputDir();a.equals(cc.Vec2.ZERO)?this.stopCount++:this.stopCount=0,this.stopCount<2&&cc.director.emit(o.EventConstant.PLAYER_MOVE,{detail:{dir:i,pos:a,dt:e}})},t.prototype.isTimeDelay=function(e){return this.timeDelay+=e,this.timeDelay>.016&&(this.timeDelay=0,!0)},t.prototype.update=function(e){this.isTimeDelay(e)&&this.sendMoveMessageToPlayer(e)},__decorate([s(cc.Integer)],t.prototype,"anglePreDirQuadrant",void 0),__decorate([s(cc.Node)],t.prototype,"fixedPoint",void 0),__decorate([s(cc.Node)],t.prototype,"movePoint",void 0),__decorate([s],t.prototype,"movePointMoveRadius",void 0),t=__decorate([n],t)}(cc.Component);i.default=r,cc._RF.pop()},{"./EventConstant":"EventConstant"}],KeyboardController:[function(e,t,i){"use strict";cc._RF.push(t,"b57f7ePcl9JD6/oAh/+vpUg","KeyboardController"),Object.defineProperty(i,"__esModule",{value:!0});var o=e("./EventConstant"),a=cc._decorator,n=a.ccclass,s=(a.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.stopCount=0,t.isUp=!1,t.isDown=!1,t.isLeft=!1,t.isRight=!1,t.isA=!1,t.isB=!1,t.isC=!1,t.timeDelay=0,t}return __extends(t,e),t.prototype.onLoad=function(){cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this)},t.prototype.start=function(){},t.prototype.onKeyDown=function(e){switch(e.keyCode){case cc.macro.KEY.w:this.isUp=!0;break;case cc.macro.KEY.s:this.isDown=!0;break;case cc.macro.KEY.a:this.isLeft=!0;break;case cc.macro.KEY.d:this.isRight=!0;break;case cc.macro.KEY.j:this.isA=!0;break;case cc.macro.KEY.k:this.isB=!0;break;case cc.macro.KEY.l:this.isC=!0}},t.prototype.onKeyUp=function(e){switch(e.keyCode){case cc.macro.KEY.w:this.isUp=!1;break;case cc.macro.KEY.s:this.isDown=!1;break;case cc.macro.KEY.a:this.isLeft=!1;break;case cc.macro.KEY.d:this.isRight=!1;break;case cc.macro.KEY.j:this.isA=!1;break;case cc.macro.KEY.k:this.isB=!1;break;case cc.macro.KEY.l:this.isC=!1}},t.prototype.update=function(e){this.isTimeDelay(e)&&this.sendMoveMessageToPlayer(e)},t.prototype.sendMoveMessageToPlayer=function(e){var t=cc.v2(0,0);this.isUp&&t.addSelf(cc.v2(0,.9)),this.isDown&&t.addSelf(cc.v2(0,-.9)),this.isLeft&&t.addSelf(cc.v2(-.9,0)),this.isRight&&t.addSelf(cc.v2(.9,0)),t.mag()>0&&t.normalizeSelf();var i=4;Math.abs(t.x)<Math.abs(t.y)&&(t.y>.3&&(i=0),t.y<-.3&&(i=1)),Math.abs(t.x)>Math.abs(t.y)&&(t.x<-.3&&(i=2),t.x>.3&&(i=3)),t.equals(cc.Vec2.ZERO)?this.stopCount++:this.stopCount=0,this.stopCount<2&&cc.director.emit(o.EventConstant.PLAYER_MOVE,{detail:{dir:i,pos:t,dt:e}}),this.isA&&cc.director.emit(o.EventConstant.PLAYER_ATTACK),this.isB&&cc.director.emit(o.EventConstant.PLAYER_REMOTEATTACK),this.isC&&cc.director.emit(o.EventConstant.PLAYER_USEITEM)},t.prototype.isTimeDelay=function(e){return this.timeDelay+=e,this.timeDelay>.016&&(this.timeDelay=0,!0)},t=__decorate([n],t)}(cc.Component));i.default=s,cc._RF.pop()},{"./EventConstant":"EventConstant"}],KrakenSwingHand:[function(e,t,i){"use strict";cc._RF.push(t,"15ea4rtPQxD8pcJLX7yPozV","KrakenSwingHand"),Object.defineProperty(i,"__esModule",{value:!0});var o=e("../EventConstant"),a=e("../Player"),n=e("../Data/DamageData"),s=cc._decorator,r=s.ccclass,c=s.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.damage=2,t.isShow=!1,t}return __extends(t,e),t.prototype.start=function(){this.isShow=!1},t.prototype.onCollisionEnter=function(e,t){if(e.node.getComponent(a.default)&&this.isShow&&this.node.active){this.node.stopAllActions();var i=new n.default;i.physicalDamage=this.damage,cc.director.emit(o.EventConstant.PLAYER_TAKEDAMAGE,{detail:{damage:i}})}},__decorate([c],t.prototype,"damage",void 0),t=__decorate([r],t)}(cc.Component);i.default=l,cc._RF.pop()},{"../Data/DamageData":"DamageData","../EventConstant":"EventConstant","../Player":"Player"}],Kraken:[function(e,t,i){"use strict";cc._RF.push(t,"cbbb1U+Yy5Jtb8PV4hyvH/c","Kraken"),Object.defineProperty(i,"__esModule",{value:!0});var o=e("../Shooter"),a=e("./KrakenSwingHand"),n=e("../Dungeon"),s=e("./Boss"),r=cc._decorator,c=r.ccclass,l=r.property,h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.label=null,t.hand1=null,t.hand2=null,t.timeDelay=0,t.actionTimeDelay=0,t}return __extends(t,e),t.prototype.onLoad=function(){this.isDied=!1,this.isShow=!1,this.anim=this.getComponent(cc.Animation),this.sprite=this.node.getChildByName("sprite"),this.sprite.opacity=0,this.shooter=this.getComponentInChildren(o.default)},t.prototype.updatePlayerPos=function(){this.node.x=64*this.pos.x+32,this.node.y=64*this.pos.y+70},t.prototype.changeZIndex=function(){this.node.zIndex=1e3+100*(n.default.HEIGHT_SIZE-this.pos.y-1)+2,this.isShow&&!this.isDied&&(this.node.zIndex=3e3+100*(n.default.HEIGHT_SIZE-this.pos.y-1)+2)},t.prototype.attack=function(e,t){var i=this;if(!this.isDied){var o=0,a=0;switch(e){case 0:a+=32;break;case 1:a-=32;break;case 2:o-=32;break;case 3:o+=32}var n=cc.sequence(cc.moveBy(.1,o,a),cc.callFunc(function(){t&&t(i.data.Common.damageMin)}),cc.moveTo(.1,0,0));this.sprite.runAction(n)}},t.prototype.start=function(){e.prototype.start.call(this)},t.prototype.takeDamage=function(e){if(this.isDied||!this.isShow)return!1;if(this.data.currentHealth-=this.data.getDamage(e).getTotalDamage(),this.data.currentHealth>this.data.Common.maxHealth&&(this.data.currentHealth=this.data.Common.maxHealth),this.anim.playAdditive("KrakenHit"),this.healthBar.refreshHealth(this.data.currentHealth,this.data.Common.maxHealth),this.dungeon){var t=this.dungeon.player.pos;t.x>this.pos.x&&!this.anim.getAnimationState("KrakenSwingRight").isPlaying?this.anim.playAdditive("KrakenSwingRight"):t.x<this.pos.x&&!this.anim.getAnimationState("KrakenSwingLeft").isPlaying&&this.anim.playAdditive("KrakenSwingLeft")}return!0},t.prototype.killed=function(){if(!this.isDied){this.isDied=!0,this.changeZIndex();for(var e=0,t=this.getComponentsInChildren(a.default);e<t.length;e++){t[e].isShow=!1}this.anim.play("KrakenDie")}},t.prototype.BossShow=function(){this.isShow=!0;for(var e=0,t=this.getComponentsInChildren(a.default);e<t.length;e++){t[e].isShow=!0}this.anim.play("KrakenIdle"),this.changeZIndex()},t.prototype.BossHit=function(){},t.prototype.showBoss=function(){this.anim.play("KrakenShow"),this.healthBar&&(this.healthBar.refreshHealth(this.data.currentHealth,this.data.Common.maxHealth),this.healthBar.node.active=!this.isDied)},t.prototype.isActionTimeDelay=function(e){return this.actionTimeDelay+=e,this.actionTimeDelay>1&&(this.actionTimeDelay=0,!0)},t.prototype.update=function(e){this.timeDelay+=e,this.timeDelay>.016&&(this.timeDelay=0,this.updatePlayerPos()),this.isActionTimeDelay(e)&&this.bossAction(),this.data.currentHealth<1&&(this.killed(),this.hand1.isShow=!1,this.hand2.isShow=!1),this.label&&(this.label.string=""+this.node.zIndex),this.healthBar.node.active=!this.isDied},t.prototype.bossAction=function(){if(!this.isDied&&this.isShow&&(this.changeZIndex(),this.shooter&&this.dungeon)){var e=this.node.position.clone().add(this.shooter.node.position),t=this.dungeon.player.getCenterPosition().sub(e);t.equals(cc.Vec2.ZERO)||(t=t.normalizeSelf(),this.shooter.setHv(t),this.shooter.dungeon=this.dungeon,this.shooter.data.bulletType="bullet004",this.shooter.fireBullet()),this.data.currentHealth<this.data.Common.maxHealth/2&&(this.dungeon.addFallStone(this.dungeon.player.node.position,!0),this.shooter.fireBullet(30),this.shooter.fireBullet(-30))}},__decorate([l(cc.Label)],t.prototype,"label",void 0),__decorate([l(a.default)],t.prototype,"hand1",void 0),__decorate([l(a.default)],t.prototype,"hand2",void 0),t=__decorate([c],t)}(s.default);i.default=h,cc._RF.pop()},{"../Dungeon":"Dungeon","../Shooter":"Shooter","./Boss":"Boss","./KrakenSwingHand":"KrakenSwingHand"}],Loading:[function(e,t,i){"use strict";cc._RF.push(t,"a2246gAT5JKc4YhD10URG7K","Loading"),Object.defineProperty(i,"__esModule",{value:!0});var o=e("./Logic"),a=cc._decorator,n=a.ccclass,s=a.property,r=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.label=null,t.timeDelay=0,t.isEquipmentLoaded=!1,t.isMonsterLoaded=!1,t.isLevelLoaded=!1,t.isSpriteFramesLoaded=!1,t.isDebuffsLoaded=!1,t.isBulletsLoaded=!1,t}return __extends(t,e),t.prototype.start=function(){this.label.string="Level "+o.default.level,this.isLevelLoaded=!1,this.isEquipmentLoaded=!1,this.isMonsterLoaded=!1,this.isDebuffsLoaded=!1,this.loadMap(),this.loadEquipment(),this.loadSpriteFrames(),this.loadMonsters(),this.loadDebuffs(),this.loadBullets()},t.prototype.loadMap=function(){o.default.mapManger.isloaded=!1,o.default.mapManger.loadMap()},t.prototype.loadEquipment=function(){var e=this;o.default.equipments?this.isEquipmentLoaded=!0:cc.loader.loadRes("Data/Equipment/equipment",function(t,i){t?cc.error(t):(o.default.equipments=i.json,e.isEquipmentLoaded=!0)})},t.prototype.loadDebuffs=function(){var e=this;o.default.debuffs?this.isDebuffsLoaded=!0:cc.loader.loadRes("Data/Status/status",function(t,i){t?cc.error(t):(o.default.debuffs=i.json,e.isDebuffsLoaded=!0)})},t.prototype.loadBullets=function(){var e=this;o.default.bullets?this.isBulletsLoaded=!0:cc.loader.loadRes("Data/Bullet/bullet",function(t,i){t?cc.error(t):(o.default.bullets=i.json,e.isBulletsLoaded=!0)})},t.prototype.loadMonsters=function(){var e=this;o.default.monsters?this.isMonsterLoaded=!0:cc.loader.loadRes("Data/Monster/monsters",function(t,i){t?cc.error(t):(o.default.monsters=i.json,e.isMonsterLoaded=!0)})},t.prototype.loadSpriteFrames=function(){var e=this;o.default.spriteFrames?this.isSpriteFramesLoaded=!0:cc.loader.loadResDir("Texture",cc.SpriteFrame,function(t,i){o.default.spriteFrames={};for(var a=0,n=i;a<n.length;a++){var s=n[a];o.default.spriteFrames[s.name]=s}e.isSpriteFramesLoaded=!0})},t.prototype.update=function(e){this.timeDelay+=e,this.isLevelLoaded=o.default.mapManger.isloaded,this.timeDelay>.16&&this.isLevelLoaded&&this.isEquipmentLoaded&&this.isSpriteFramesLoaded&&this.isMonsterLoaded&&this.isDebuffsLoaded&&this.isBulletsLoaded&&(this.timeDelay=0,this.isLevelLoaded=!1,this.isEquipmentLoaded=!1,this.isSpriteFramesLoaded=!1,this.isDebuffsLoaded=!1,this.isBulletsLoaded=!1,cc.director.loadScene("game"))},__decorate([s(cc.Label)],t.prototype,"label",void 0),t=__decorate([n],t)}(cc.Component);i.default=r,cc._RF.pop()},{"./Logic":"Logic"}],Logic:[function(e,t,i){"use strict";cc._RF.push(t,"2225fYJ0sRMTZjuD7WFmbVi","Logic"),Object.defineProperty(i,"__esModule",{value:!0});var o=e("./Data/PlayerData"),a=e("./EventConstant"),n=e("./Manager/MapManager"),s=e("./Dungeon"),r=e("./Manager/InventoryManager"),c=e("./Data/ProfileData"),l=cc._decorator,h=l.ccclass,p=(l.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}var i;return __extends(t,e),i=t,t.prototype.onLoad=function(){var e=this;cc.game.setFrameRate(60),cc.game.addPersistRootNode(this.node),cc.director.getCollisionManager().enabled=!0,cc.director.getPhysicsManager().enabled=!0,cc.director.on(a.EventConstant.LOADINGNEXTLEVEL,function(t){e.loadingNextLevel()}),cc.director.on(a.EventConstant.LOADINGROOM,function(t){e.loadingNextRoom(t.detail.dir)})},t.prototype.start=function(){},t.resetData=function(){i.profile=new c.default,i.level=i.profile.level,i.playerData=i.profile.playerData,i.inventoryManager=i.profile.inventoryManager,i.mapManger.reset(i.level),i.mapManger.loadDataFromSave();var e=cc.sys.localStorage.getItem("coin");i.coins=e?parseInt(e):0,i.ammo=i.profile.ammo},t.changeDungeonSize=function(){var e=i.getCurrentMapData().map;e&&e.length>0&&(s.default.WIDTH_SIZE=e.length,s.default.HEIGHT_SIZE=e[0].length)},t.prototype.loadingNextRoom=function(e){if(i.mapManger.loadingNextRoom(e)){switch(i.changeDungeonSize(),e){case 0:i.playerData.pos=cc.v2(Math.round(s.default.WIDTH_SIZE/2-1),0);break;case 1:i.playerData.pos=cc.v2(Math.round(s.default.WIDTH_SIZE/2-1),s.default.HEIGHT_SIZE-1);break;case 2:i.playerData.pos=cc.v2(s.default.WIDTH_SIZE-1,Math.round(s.default.HEIGHT_SIZE/2-1));break;case 3:i.playerData.pos=cc.v2(0,Math.round(s.default.HEIGHT_SIZE/2-1))}cc.director.loadScene("loading")}},t.prototype.loadingNextLevel=function(){i.level++,i.level>5?cc.director.loadScene("gamefinish"):(i.mapManger.reset(i.level),i.changeDungeonSize(),i.playerData.pos=cc.v2(Math.round(s.default.WIDTH_SIZE/2-1),Math.round(s.default.HEIGHT_SIZE/2-1)),cc.director.loadScene("loading"))},t.getCurrentMapData=function(){return i.mapManger.getCurrentMapData()},t.getCurrentMapBoxes=function(){return i.mapManger.getCurrentMapBoxes()},t.getCurrentMapShopTables=function(){return i.mapManger.getCurrentMapShopTables()},t.isBossLevel=function(e){return e==i.BOSS_LEVEL_1},t.getRandomNum=function(e,t){return e+Math.round(Math.random()*(t-e))},t.getHalfChance=function(){return Math.random()>.5},t.getDistance=function(e,t){var i=e.x-t.x,o=e.y-t.y;return Math.sqrt(i*i+o*o)},t.BOSS_LEVEL_1=10,t.equipments=null,t.monsters=null,t.spriteFrames=null,t.debuffs=null,t.bullets=null,t.profile=new c.default,t.level=1,t.chapterName="chapter00",t.playerData=new o.default,t.inventoryManager=new r.default,t.mapManger=new n.default,t.coins=0,t.ammo=30,t.killCount=0,t=i=__decorate([h],t)}(cc.Component));i.default=p,cc._RF.pop()},{"./Data/PlayerData":"PlayerData","./Data/ProfileData":"ProfileData","./Dungeon":"Dungeon","./EventConstant":"EventConstant","./Manager/InventoryManager":"InventoryManager","./Manager/MapManager":"MapManager"}],MapData:[function(e,t,i){"use strict";cc._RF.push(t,"9d7bcZhUYBIzJR0A6/ryRxj","MapData"),Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function e(e){this.map=new Array,this.init(e)}return e.prototype.init=function(e){if(e){var t=(e=e.substring(2,e.length-2)).split("\r\n");this.map=new Array;for(var i=0;i<t.length;i++)this.map[i]=new Array;for(i=0;i<t.length;i++)for(var o=t[t.length-1-i].split(""),a=0;a<o.length;a++)this.map[i][a]=o[a];var n=new Array;for(i=0;i<this.map[0].length;i++){n[i]=new Array;for(a=0;a<this.map.length;a++)n[i][a]=this.map[a][i]}this.map=n}},e.prototype.clone=function(){var t=new e("");return t.map=t.map.concat(this.map),t},e}();i.default=o,cc._RF.pop()},{}],MapManagerData:[function(e,t,i){"use strict";cc._RF.push(t,"fc23bpSDqZOALYDNPFUGFLx","MapManagerData"),Object.defineProperty(i,"__esModule",{value:!0});var o=function(){return function(){}}();i.default=o,cc._RF.pop()},{}],MapManager:[function(e,t,i){"use strict";cc._RF.push(t,"3b0b2KGAWdGI6jcP8eIcPHE","MapManager"),Object.defineProperty(i,"__esModule",{value:!0});var o=e("../Data/MapData"),a=e("../Rect/RectRoom"),n=e("../Rect/RectDungeon"),s=e("../Logic"),r=function(){function e(){this.allfileRooms={},this.roomStrs=["startroom","endroom","traproom","lootroom","dangerroom","merchantroom","puzzleroom","bossroom"],this.isloaded=!1,this.rectDungeon=new n.default(1),this.currentPos=cc.v2(0,0),this.boxes={},this.shopTables={},this.init()}return e.prototype.init=function(){this.isloaded=!1},e.prototype.loadDataFromSave=function(){s.default.profile.hasSaveData&&(this.rectDungeon=s.default.profile.rectDungeon,this.currentPos=s.default.profile.currentPos.clone(),this.boxes=s.default.profile.boxes,this.shopTables=s.default.profile.shopTables,cc.log("load",this.rectDungeon.getDisPlay()))},e.prototype.reset=function(e){this.rectDungeon=new n.default(e),cc.log(this.rectDungeon.getDisPlay()),this.resetRooms(),this.currentPos=cc.v2(this.rectDungeon.startRoom.x,this.rectDungeon.startRoom.y),this.changeRoomsIsFound(this.currentPos.x,this.currentPos.y),s.default.profile.currentPos=this.currentPos.clone(),this.boxes={},this.shopTables={}},e.prototype.loadingNextRoom=function(e){var t=this.rectDungeon.getNeighborRoomType(this.currentPos.x,this.currentPos.y,e);return t&&0!=t.roomType&&(this.currentPos=cc.v2(t.x,t.y),s.default.profile.currentPos=this.currentPos.clone(),this.changeRoomsIsFound(t.x,t.y)),t},e.prototype.changeRoomsIsFound=function(e,t){this.rectDungeon.changeRoomIsFound(e,t),this.rectDungeon.changeRoomIsFound(e+1,t),this.rectDungeon.changeRoomIsFound(e-1,t),this.rectDungeon.changeRoomIsFound(e,t+1),this.rectDungeon.changeRoomIsFound(e,t-1)},e.prototype.getCurrentMapData=function(){return this.getCurrentRoom().map.clone()},e.prototype.getCurrentRoom=function(){return this.rectDungeon.map[this.currentPos.x][this.currentPos.y]},e.prototype.getCurrentMapBoxes=function(){return this.boxes["x="+this.currentPos.x+"y="+this.currentPos.y]},e.prototype.setCurrentBoxesArr=function(e){this.boxes["x="+this.currentPos.x+"y="+this.currentPos.y]=e},e.prototype.getCurrentMapShopTables=function(){return this.shopTables["x="+this.currentPos.x+"y="+this.currentPos.y]},e.prototype.setCurrentShopTableArr=function(e){this.shopTables["x="+this.currentPos.x+"y="+this.currentPos.y]=e},e.prototype.setRoomClear=function(e,t){this.rectDungeon.map[e][t].state=a.default.STATE_CLEAR},e.prototype.getCurrentRoomState=function(){return this.rectDungeon.map[this.currentPos.x][this.currentPos.y].state},e.prototype.isCurrentRoomStateClear=function(){return this.getCurrentRoomState()==a.default.STATE_CLEAR},e.prototype.getCurrentRoomType=function(){return this.rectDungeon.map[this.currentPos.x][this.currentPos.y].roomType},e.prototype.loadMap=function(){var e=this;this.rectDungeon.startRoom.map?this.isloaded=!0:cc.loader.loadRes("Data/Rooms/rooms",function(t,i){if(t)cc.error(t);else{for(var a=i.text.split("room"),n=0,s=0;s<a.length;s++){var r=a[s],c=null;if(r&&(c=(r=r.substring(r.indexOf("=")+1,r.length-3)).split("$")),c){for(var l=new Array,h=0;h<c.length;h++){var p=c[h];l.push(new o.default(p))}e.allfileRooms[e.roomStrs[n]]=l,n++}}e.resetRooms(),e.isloaded=!0}})},e.prototype.resetRooms=function(){if(this.allfileRooms&&this.allfileRooms[this.roomStrs[0]])for(var e=0;e<this.rectDungeon.map.length;e++)for(var t=0;t<this.rectDungeon.map[0].length;t++){var i=this.rectDungeon.map[e][t],o=i.roomType-1;if(o>=0){var a=this.allfileRooms[this.roomStrs[o]];i.map=a[s.default.getRandomNum(0,a.length-1)]}}},e}();i.default=r,cc._RF.pop()},{"../Data/MapData":"MapData","../Logic":"Logic","../Rect/RectDungeon":"RectDungeon","../Rect/RectRoom":"RectRoom"}],MeleeWeaponChild:[function(e,t,i){"use strict";cc._RF.push(t,"81ac4Ib50VMBoiaBfrNyVFU","MeleeWeaponChild"),Object.defineProperty(i,"__esModule",{value:!0});var o=cc._decorator,a=o.ccclass,n=(o.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.meleeWeapon=null,t}return __extends(t,e),t.prototype.onLoad=function(){this.getComponent(cc.Sprite).spriteFrame},t.prototype.start=function(){},t=__decorate([a],t)}(cc.Component));i.default=n,cc._RF.pop()},{}],MeleeWeapon:[function(e,t,i){"use strict";cc._RF.push(t,"8747dgi/6dFupzO0r46t7Ya","MeleeWeapon"),Object.defineProperty(i,"__esModule",{value:!0});var o=e("./Player"),a=e("./Monster"),n=e("./Building/Box"),s=e("./Logic"),r=e("./MeleeWeaponChild"),c=e("./Data/DamageData"),l=e("./Manager/StatusManager"),h=e("./Boss/Boss"),p=cc._decorator,d=p.ccclass,u=p.property,m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.playerNode=null,t.player=null,t.stabWeapon=null,t.waveWeapon=null,t.iceLight=null,t.fireLight=null,t.lighteningLight=null,t.toxicLight=null,t.curseLight=null,t.isReverse=!1,t.isAttacking=!1,t.hv=cc.v2(1,0),t.isStab=!0,t.isFar=!1,t.isMiss=!1,t}var i;return __extends(t,e),i=t,t.prototype.onLoad=function(){this.anim=this.getComponent(cc.Animation),this.player=this.playerNode.getComponent(o.default),this.weaponFirePoint=this.node.getChildByName("firepoint")},t.prototype.setHv=function(e){var t=this.hasNearEnemy();t.equals(cc.Vec2.ZERO)?this.hv=e:(this.rotateColliderManager(cc.v2(this.node.position.x+t.x,this.node.position.y+t.y)),this.hv=t)},t.prototype.getHv=function(){return this.hv},t.prototype.attack=function(e,t){if(!this.isAttacking){this.isMiss=t,this.isAttacking=!0;var o=1+e.getAttackSpeed()/1e3;o<.2&&(o=.2),o>3&&(o=3),this.anim&&(this.anim.play(this.getAttackAnimName()),this.anim.getAnimationState(this.getAttackAnimName()).speed=o);for(var a=this.weaponFirePoint.position.clone(),n=s.default.getRandomNum(0,100),r=0,c=[e.getIceDamage()>0&&n<e.getIceRate()?i.ELEMENT_TYPE_ICE:0,e.getFireDamage()>0&&n<e.getFireRate()?i.ELEMENT_TYPE_FIRE:0,e.getLighteningDamage()>0&&n<e.getLighteningRate()?i.ELEMENT_TYPE_LIGHTENING:0,e.getToxicDamage()>0&&n<e.getToxicRate()?i.ELEMENT_TYPE_TOXIC:0,e.getCurseDamage()>0&&n<e.getCurseRate()?i.ELEMENT_TYPE_CURSE:0];r<c.length;r++){var l=c[r];this.getWaveLight(this.dungeon.node,a,l,this.isStab,this.isFar,this.isReverse)}}},t.prototype.getAttackAnimName=function(){return!this.isFar&&this.isStab?"MeleeAttackStab":this.isFar&&this.isStab?"MeleeAttackStabFar":this.isFar&&!this.isStab?this.isReverse?"MeleeAttackFarReverse":"MeleeAttackFar":this.isReverse?"MeleeAttackReverse":"MeleeAttack"},t.prototype.getWaveLight=function(e,t,i,o,a,n){var s=[this.iceLight,this.fireLight,this.lighteningLight,this.toxicLight,this.curseLight];if(!(i<1||i>s.length)&&this.dungeon){var r=cc.instantiate(s[i-1]),c=60,l=60;o&&(c=10),a&&(c+=o?20:80,l+=10);var h=[cc.v2(t.x,-t.y-l),cc.v2(t.x+.9*c,-t.y-l/2),cc.v2(t.x+c,t.y),cc.v2(t.x+.9*c,t.y+l/2),cc.v2(t.x,t.y+l)],p=[cc.v2(t.x,t.y+l),cc.v2(t.x+.9*c,t.y+l/2),cc.v2(t.x+c,t.y),cc.v2(t.x+.9*c,-t.y-l/2),cc.v2(t.x,-t.y-l)],d=[cc.v2(t.x-2*c,t.y),cc.v2(t.x-.5*c,t.y),cc.v2(t.x,t.y),cc.v2(t.x+.5*c,t.y),cc.v2(t.x+c,t.y)];o||(d=n?h:p);for(var u=0;u<d.length;u++){var m=d[u];m=this.node.convertToWorldSpace(m),m=e.convertToNodeSpace(m),d[u]=m.clone()}r.parent=e,r.position=d[0],r.zIndex=4e3,r.opacity=255,r.active=!0;var g=cc.sequence(cc.moveTo(.025,d[1]),cc.moveTo(.05,d[2]),cc.moveTo(.075,d[3]),cc.moveTo(.1,d[4]));r.runAction(g)}},t.prototype.MeleeAttackFinish=function(e){this.isAttacking=!1,this.isReverse=!e},t.prototype.start=function(){},t.prototype.getRandomNum=function(e,t){return e+Math.round(Math.random()*(t-e))},t.prototype.update=function(e){var t=this.hasNearEnemy();if(t.equals(cc.Vec2.ZERO)){if((0!=this.hv.x||0!=this.hv.y)&&!this.isAttacking){this.node.position=cc.v2(25,45);var i=cc.v2(this.node.position.x+this.hv.x,this.node.position.y+this.hv.y);this.rotateColliderManager(i)}}else this.rotateColliderManager(cc.v2(this.node.position.x+t.x,this.node.position.y+t.y)),this.hv=t},t.prototype.hasNearEnemy=function(){var e=1e3,t=cc.v2(0,0);if(this.dungeon){for(var i=0,o=this.dungeon.monsters;i<o.length;i++){var a=o[i];if((c=s.default.getDistance(this.node.parent.position,a.node.position))<200&&c<e&&!a.isDied)e=c,(l=this.node.position.clone()).x=this.node.scaleX>0?l.x:-l.x,t=a.getCenterPosition().sub(this.node.parent.position.add(l))}if(t.equals(cc.Vec2.ZERO))for(var n=0,r=this.dungeon.bosses;n<r.length;n++){var c,l,h=r[n];if((c=s.default.getDistance(this.node.parent.position,h.node.position))<200&&c<e&&!h.isDied)e=c,(l=this.node.position.clone()).x=this.node.scaleX>0?l.x:-l.x,t=h.getCenterPosition().sub(this.node.parent.position.add(l))}1e3!=e&&(t=t.normalizeSelf())}return t},t.prototype.rotateColliderManager=function(e){var t=e.sub(this.node.position),i=360/(2*Math.PI),o=360-Math.atan2(t.x,t.y)*i;this.node.scaleX=this.node.parent.scaleX;var a=Math.abs(this.node.scaleY);this.node.scaleY=this.node.scaleX<0?-a:a,(o+=90)>=360&&(o-=360),o<=-360&&(o+=360),this.node.rotation=this.node.scaleX<0?o:-o},t.prototype.onBeginContact=function(e,t,i){},t.prototype.onCollisionEnter=function(e,t){this.attacking(e)},t.prototype.beatBack=function(e){var t=e.getComponent(cc.RigidBody),i=this.getHv().clone();i.equals(cc.Vec2.ZERO)&&(i=cc.v2(1,0));!this.isFar&&this.isStab||(this.isFar&&this.isStab||(this.isFar||this.isStab)),i=i.normalizeSelf().mul(640);cc.moveBy(.1,i.x,i.y);t.applyLinearImpulse(i,t.getLocalCenter(),!0)},t.prototype.attacking=function(e){if(e&&this.isAttacking){var t=new c.default;this.player&&(t=this.player.data.getFinalAttackPoint());var i=!1,o=e.node.getComponent(a.default);!o||o.isDied||this.isMiss||(i=o.takeDamage(t))&&(this.beatBack(o.node),this.addMonsterStatus(this.player.data.getIceRate(),o,l.default.FROZEN),this.addMonsterStatus(this.player.data.getFireRate(),o,l.default.BURNING),this.addMonsterStatus(this.player.data.getLighteningRate(),o,l.default.DIZZ),this.addMonsterStatus(this.player.data.getToxicRate(),o,l.default.TOXICOSIS),this.addMonsterStatus(this.player.data.getCurseRate(),o,l.default.CURSING),this.addMonsterStatus(this.player.data.getRealRate(),o,l.default.BLEEDING));var s=e.node.getComponent(h.default);!s||s.isDied||this.isMiss||(i=s.takeDamage(t))&&(this.addBossStatus(this.player.data.getIceRate(),s,l.default.FROZEN),this.addBossStatus(this.player.data.getFireRate(),s,l.default.BURNING),this.addBossStatus(this.player.data.getLighteningRate(),s,l.default.DIZZ),this.addBossStatus(this.player.data.getToxicRate(),s,l.default.TOXICOSIS),this.addBossStatus(this.player.data.getCurseRate(),s,l.default.CURSING),this.addBossStatus(this.player.data.getRealRate(),s,l.default.BLEEDING));var r=e.node.getComponent(n.default);r&&r.breakBox();var p=this.player.data.getLifeDrain();p>0&&i&&this.player.takeDamage(new c.default(-p)),this.isMiss=!1}},t.prototype.addMonsterStatus=function(e,t,i){s.default.getRandomNum(0,100)<e&&t.addStatus(i)},t.prototype.addBossStatus=function(e,t,i){s.default.getRandomNum(0,100)<e&&t.addStatus(i)},t.ELEMENT_TYPE_ICE=1,t.ELEMENT_TYPE_FIRE=2,t.ELEMENT_TYPE_LIGHTENING=3,t.ELEMENT_TYPE_TOXIC=4,t.ELEMENT_TYPE_CURSE=5,__decorate([u(cc.Node)],t.prototype,"playerNode",void 0),__decorate([u(r.default)],t.prototype,"stabWeapon",void 0),__decorate([u(r.default)],t.prototype,"waveWeapon",void 0),__decorate([u(cc.Prefab)],t.prototype,"iceLight",void 0),__decorate([u(cc.Prefab)],t.prototype,"fireLight",void 0),__decorate([u(cc.Prefab)],t.prototype,"lighteningLight",void 0),__decorate([u(cc.Prefab)],t.prototype,"toxicLight",void 0),__decorate([u(cc.Prefab)],t.prototype,"curseLight",void 0),t=i=__decorate([d],t)}(cc.Component);i.default=m,cc._RF.pop()},{"./Boss/Boss":"Boss","./Building/Box":"Box","./Data/DamageData":"DamageData","./Logic":"Logic","./Manager/StatusManager":"StatusManager","./MeleeWeaponChild":"MeleeWeaponChild","./Monster":"Monster","./Player":"Player"}],MiniMap:[function(e,t,i){"use strict";cc._RF.push(t,"b8f7e0qah9Ot5qnGbL59sxK","MiniMap"),Object.defineProperty(i,"__esModule",{value:!0});var o=e("./Logic"),a=e("./Rect/RectDungeon"),n=e("./Rect/RectRoom"),s=e("./EventConstant"),r=cc._decorator,c=r.ccclass,l=r.property,h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.miniTile=null,t.size=0,t}var i;return __extends(t,e),i=t,t.prototype.onLoad=function(){var e=this;cc.director.on(s.EventConstant.CHANGE_MINIMAP,function(t){e.changeMap(t.detail.x,t.detail.y)}),this.size=o.default.level+2;var t=a.default.LEVEL_5-o.default.level;t=Math.round(t/2),this.map=new Array;for(var i=0;i<this.size;i++){this.map[i]=new Array;for(var n=0;n<this.size;n++){var r=cc.instantiate(this.miniTile);r.group="ui",this.map[i][n]=r,this.map[i][n].parent=this.node,this.map[i][n].position=cc.v2(i*r.width,n*r.height),this.map[i][n].color=cc.Color.BLACK,this.map[i][n].opacity=0}}},t.prototype.start=function(){},t.prototype.changeMap=function(e,t){if(this.map)for(var s=0;s<this.size;s++)for(var r=0;r<this.size;r++){var c=o.default.mapManger.rectDungeon.map[r][s].isFound,l=o.default.mapManger.rectDungeon.map[r][s].state,h=o.default.mapManger.rectDungeon.map[r][s].roomType;o.default.mapManger.rectDungeon.map[r][s].isPrimary;this.map[r][s].color=this.getColor(i.ColorLevel.HIDE),c&&(this.map[r][s].color=this.getColor(i.ColorLevel.NORMAL),this.map[r][s].opacity=255,l!=n.default.STATE_SLEEP&&l!=n.default.STATE_ACTIVE||(this.map[r][s].color=this.getColor(i.ColorLevel.NORMAL),h==a.default.BOSS_ROOM&&(this.map[r][s].color=this.getColor(i.ColorLevel.NORMAL_BOSS)),h==a.default.LOOT_ROOM&&(this.map[r][s].color=this.getColor(i.ColorLevel.NORMAL_LOOT)),h==a.default.END_ROOM&&o.default.level!=a.default.LEVEL_3&&o.default.level!=a.default.LEVEL_5&&(this.map[r][s].color=this.getColor(i.ColorLevel.NORMAL_END))),h==a.default.START_ROOM&&(this.map[r][s].color=this.getColor(i.ColorLevel.NORMAL_START)),h==a.default.PUZZLE_ROOM&&(this.map[r][s].color=this.getColor(i.ColorLevel.CLEAR_PUZZLE)),l==n.default.STATE_CLEAR&&(this.map[r][s].color=this.getColor(i.ColorLevel.CLEAR),h==a.default.BOSS_ROOM&&(this.map[r][s].color=this.getColor(i.ColorLevel.CLEAR_BOSS)),h==a.default.END_ROOM&&o.default.level!=a.default.LEVEL_3&&o.default.level!=a.default.LEVEL_5&&(this.map[r][s].color=this.getColor(i.ColorLevel.CLEAR_END)),h==a.default.LOOT_ROOM&&(this.map[r][s].color=this.getColor(i.ColorLevel.CLEAR_LOOT))),r==e&&s==t&&(this.map[e][t].color=this.getColor(i.ColorLevel.PLAYER)))}},t.prototype.getColor=function(e){var t=new cc.Color(0,0,0);switch(e){case i.ColorLevel.HIDE:t=new cc.Color(0,0,0);break;case i.ColorLevel.NORMAL:t=new cc.Color(128,128,128);break;case i.ColorLevel.CLEAR:t=new cc.Color(255,255,255);break;case i.ColorLevel.PLAYER:t=new cc.Color(0,255,0);break;case i.ColorLevel.NORMAL_START:t=new cc.Color(144,238,144);break;case i.ColorLevel.NORMAL_END:t=new cc.Color(100,149,237);break;case i.ColorLevel.NORMAL_BOSS:t=new cc.Color(128,0,128);break;case i.ColorLevel.NORMAL_LOOT:t=new cc.Color(255,215,0);break;case i.ColorLevel.CLEAR_LOOT:t=new cc.Color(240,230,140);break;case i.ColorLevel.CLEAR_BOSS:t=new cc.Color(75,0,130);break;case i.ColorLevel.CLEAR_END:t=new cc.Color(176,196,222);break;case i.ColorLevel.CLEAR_PUZZLE:t=new cc.Color(139,69,19)}return t},t.prototype.getMixColor=function(e,t){var i=e.clone(),o=t.clone(),a=cc.color(),n=i.getR()+o.getR(),s=i.getG()+o.getG(),r=i.getB()+o.getB();return a.setR(n>255?255:n),a.setG(s>255?255:s),a.setB(r>255?255:r),a},t.ColorLevel={HIDE:0,NORMAL:1,PLAYER:2,CLEAR:3,NORMAL_BOSS:4,CLEAR_PUZZLE:5,CLEAR_END:6,CLEAR_BOSS:7,NORMAL_LOOT:8,CLEAR_LOOT:9,NORMAL_START:10,NORMAL_END:11},__decorate([l(cc.Prefab)],t.prototype,"miniTile",void 0),t=i=__decorate([c],t)}(cc.Component);i.default=h,cc._RF.pop()},{"./EventConstant":"EventConstant","./Logic":"Logic","./Rect/RectDungeon":"RectDungeon","./Rect/RectRoom":"RectRoom"}],MonsterData:[function(e,t,i){"use strict";cc._RF.push(t,"1f11a18691HqqKqLoB//q4B","MonsterData"),Object.defineProperty(i,"__esModule",{value:!0});var o=e("./DamageData"),a=e("./StatusData"),n=e("./CommonData"),s=function(){function e(){this.nameCn="",this.nameEn="",this.resName="",this.chapter=0,this.stageLevel=0,this.invisible=0,this.remote=0,this.melee=0,this.dash=0,this.disguise=0,this.sizeType=0,this.pos=cc.v2(0,0),this.currentHealth=0,this.list=[],this.statusTotalData=new a.default,this.common=new n.default,this.list=[this.common,this.statusTotalData.Common]}return Object.defineProperty(e.prototype,"StatusTotalData",{get:function(){return this.statusTotalData},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Common",{get:function(){return this.common},enumerable:!0,configurable:!0}),e.prototype.updateHA=function(e,t,i){this.currentHealth=e,this.common.maxHealth=t,this.common.damageMin=i},e.prototype.valueCopy=function(e){this.common.valueCopy(e.common),this.nameCn=e.nameCn,this.nameEn=e.nameEn,this.resName=e.resName,this.chapter=e.chapter,this.stageLevel=e.stageLevel,this.currentHealth=e.currentHealth?e.currentHealth:0,this.invisible=e.invisible?e.invisible:0,this.remote=e.remote?e.remote:0,this.melee=e.melee?e.melee:0,this.dash=e.dash?e.dash:0,this.pos=e.pos?cc.v2(e.pos.x,e.pos.y):cc.v2(0,0),this.disguise=e.disguise?e.disguise:0,this.sizeType=e.sizeType?e.sizeType:0},e.prototype.clone=function(){var t=new e;return t.common=this.common.clone(),t.nameCn=this.nameCn,t.nameEn=this.nameEn,t.resName=this.resName,t.chapter=this.chapter,t.stageLevel=this.stageLevel,t.currentHealth=this.currentHealth,t.invisible=this.invisible,t.remote=this.remote,t.melee=this.melee,t.dash=this.dash,t.pos=this.pos,t.disguise=this.disguise,t.sizeType=this.sizeType,t},e.prototype.getAttackPoint=function(){var e=new o.default;return e.realDamage=this.common.realDamage,e.physicalDamage=this.common.damageMin,e.iceDamage=this.common.iceDamage,e.fireDamage=this.common.fireDamage,e.lighteningDamage=this.common.lighteningDamage,e.toxicDamage=this.common.toxicDamage,e.curseDamage=this.common.curseDamage,e},e.prototype.getDamage=function(e){var t=e.clone(),i=this.getDefence(),o=this.getIceDefence(),a=this.getFireDefence(),n=this.getLighteningDefence(),s=this.getToxicDefence(),r=this.getCurseDefence();return t.physicalDamage=i>=0?t.physicalDamage*(1-.06*i/(.06*i+1)):t.physicalDamage*(2-Math.pow(.94,-i)),t.iceDamage=t.iceDamage*(1-o/100),t.fireDamage=t.fireDamage*(1-a/100),t.lighteningDamage=t.lighteningDamage*(1-n/100),t.toxicDamage=t.toxicDamage*(1-s/100),t.curseDamage=t.curseDamage*(1-r/100),t},e.prototype.getLifeDrain=function(){var e=this.getCriticalStrikeRate(),t=this.getLifeDrainRate(),i=0;return Math.random()<t&&(i=1,Math.random()<e&&(i=2)),i},e.prototype.getMoveSpeed=function(){for(var e=0,t=0,i=this.list;t<i.length;t++){e+=i[t].moveSpeed}return e},e.prototype.getAttackSpeed=function(){for(var e=0,t=0,i=this.list;t<i.length;t++){e+=i[t].attackSpeed}return e},e.prototype.getDamageMin=function(){for(var e=0,t=0,i=this.list;t<i.length;t++){e+=i[t].damageMin}return e},e.prototype.getDamageMax=function(){for(var e=0,t=0,i=this.list;t<i.length;t++){e+=i[t].damageMax}return e},e.prototype.getCriticalStrikeRate=function(){for(var e=1,t=0,i=this.list;t<i.length;t++){e*=1-i[t].criticalStrikeRate/100}return 1-e},e.prototype.getDodge=function(){for(var e=1,t=0,i=this.list;t<i.length;t++){e*=1-i[t].dodge/100}return 1-e},e.prototype.getDefence=function(){for(var e=0,t=0,i=this.list;t<i.length;t++){e+=i[t].defence}return e},e.prototype.getHealth=function(){for(var e=1,t=0,i=0,o=this.list;i<o.length;i++){t+=o[i].maxHealth}return t>0?(e=this.currentHealth/t,cc.v2(t*e,t)):cc.v2(1,1)},e.prototype.getIceDefence=function(){for(var e=0,t=0,i=this.list;t<i.length;t++){e+=i[t].iceDefence}return e>100&&(e=100),e},e.prototype.getFireDefence=function(){for(var e=0,t=0,i=this.list;t<i.length;t++){e+=i[t].fireDefence}return e>100&&(e=100),e},e.prototype.getLighteningDefence=function(){for(var e=0,t=0,i=this.list;t<i.length;t++){e+=i[t].lighteningDefence}return e>100&&(e=100),e},e.prototype.getToxicDefence=function(){for(var e=0,t=0,i=this.list;t<i.length;t++){e+=i[t].toxicDefence}return e>100&&(e=100),e},e.prototype.getCurseDefence=function(){for(var e=0,t=0,i=this.list;t<i.length;t++){e+=i[t].curseDefence}return e>100&&(e=100),e},e.prototype.getRealDamage=function(){for(var e=0,t=0,i=this.list;t<i.length;t++){e+=i[t].realDamage}return e<0&&(e=0),e},e.prototype.getIceDamage=function(){for(var e=0,t=0,i=this.list;t<i.length;t++){e+=i[t].iceDamage}return e<0&&(e=0),e},e.prototype.getFireDamage=function(){for(var e=0,t=0,i=this.list;t<i.length;t++){e+=i[t].fireDamage}return e<0&&(e=0),e},e.prototype.getLighteningDamage=function(){for(var e=0,t=0,i=this.list;t<i.length;t++){e+=i[t].lighteningDamage}return e<0&&(e=0),e},e.prototype.getToxicDamage=function(){for(var e=0,t=0,i=this.list;t<i.length;t++){e+=i[t].toxicDamage}return e<0&&(e=0),e},e.prototype.getCurseDamage=function(){for(var e=0,t=0,i=this.list;t<i.length;t++){e+=i[t].curseDamage}return e<0&&(e=0),e},e.prototype.getRealRate=function(){for(var e=0,t=0,i=this.list;t<i.length;t++){e+=i[t].realRate}return e=(e=e<0?0:e)>100?100:e},e.prototype.getIceRate=function(){for(var e=0,t=0,i=this.list;t<i.length;t++){e+=i[t].iceRate}return e=(e=e<0?0:e)>100?100:e},e.prototype.getFireRate=function(){for(var e=0,t=0,i=this.list;t<i.length;t++){e+=i[t].fireRate}return e=(e=e<0?0:e)>100?100:e},e.prototype.getLighteningRate=function(){for(var e=0,t=0,i=this.list;t<i.length;t++){e+=i[t].lighteningRate}return e=(e=e<0?0:e)>100?100:e},e.prototype.getToxicRate=function(){for(var e=0,t=0,i=this.list;t<i.length;t++){e+=i[t].toxicRate}return e=(e=e<0?0:e)>100?100:e},e.prototype.getCurseRate=function(){for(var e=0,t=0,i=this.list;t<i.length;t++){e+=i[t].curseRate}return e=(e=e<0?0:e)>100?100:e},e.prototype.getLifeRecovery=function(){for(var e=0,t=0,i=this.list;t<i.length;t++){e+=i[t].lifeRecovery}return e>0?e:0},e.prototype.getLifeDrainRate=function(){for(var e=1,t=0,i=this.list;t<i.length;t++){e*=1-i[t].lifeDrain/100}return 1-e},e}();i.default=s,cc._RF.pop()},{"./CommonData":"CommonData","./DamageData":"DamageData","./StatusData":"StatusData"}],MonsterManager:[function(e,t,i){"use strict";cc._RF.push(t,"441f6g4iH9M574s+sdv3n8E","MonsterManager"),Object.defineProperty(i,"__esModule",{value:!0});var o=e("../Monster"),a=e("../Data/MonsterData"),n=e("../Boss/Kraken"),s=e("../Boss/Captain"),r=e("../Logic"),c=e("../Boss/Slime"),l=cc._decorator,h=l.ccclass,p=l.property,d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.monster=null,t.kraken=null,t.captain=null,t.slime=null,t}return __extends(t,e),t.prototype.onLoad=function(){},t.prototype.getMonster=function(e,t){var i=null;(i=cc.instantiate(this.monster)).active=!1,i.parent=t.node;var n=i.getComponent(o.default),s=new a.default;n.dungeon=t,s.valueCopy(r.default.monsters[e]),n.isDisguising=s.disguise>0,n.isDisguising?n.changeBodyRes(s.resName,o.default.RES_DISGUISE):n.changeBodyRes(e),n.isVariation=r.default.getRandomNum(0,100)<5,n.isVariation&&(s.Common.maxHealth=2*s.Common.maxHealth,s.Common.damageMin=2*s.Common.damageMin,s.currentHealth=2*s.currentHealth,s.melee=s.melee>0?s.melee+20:0,s.remote=s.remote>0?s.remote+20:0,s.dash=s.dash>0?s.dash+20:0,s.Common.moveSpeed=s.Common.moveSpeed+100);return s.Common.iceDamage=Math.random()<.01?s.Common.iceDamage:r.default.getRandomNum(0,1),s.Common.fireDamage=Math.random()<.01?s.Common.iceDamage:r.default.getRandomNum(0,1),s.Common.lighteningDamage=Math.random()<.01?s.Common.lighteningDamage:r.default.getRandomNum(0,1),s.Common.toxicDamage=Math.random()<.01?s.Common.toxicDamage:r.default.getRandomNum(0,1),s.Common.curseDamage=Math.random()<.01?s.Common.curseDamage:r.default.getRandomNum(0,1),s.Common.iceDefence=Math.random()<.01?s.Common.iceDefence:r.default.getRandomNum(0,100),s.Common.fireDefence=Math.random()<.01?s.Common.fireDefence:r.default.getRandomNum(0,100),s.Common.lighteningDefence=Math.random()<.01?s.Common.lighteningDefence:r.default.getRandomNum(0,100),s.Common.toxicDefence=r.default.getRandomNum(0,100)<.01?s.Common.toxicDefence:r.default.getRandomNum(0,100),s.Common.curseDefence=Math.random()<.01?s.Common.curseDefence:r.default.getRandomNum(0,100),s.Common.iceRate=Math.random()<.01?s.Common.iceRate:r.default.getRandomNum(0,100),s.Common.fireRate=Math.random()<.01?s.Common.fireRate:r.default.getRandomNum(0,100),s.Common.lighteningRate=Math.random()<.01?s.Common.lighteningRate:r.default.getRandomNum(0,100),s.Common.toxicRate=r.default.getRandomNum(0,100)<.01?s.Common.toxicRate:r.default.getRandomNum(0,100),s.Common.curseRate=Math.random()<.01?s.Common.curseRate:r.default.getRandomNum(0,100),n.data=s,n},t.prototype.getKraken=function(e,t){var i=null;(i=cc.instantiate(this.kraken)).active=!1,i.parent=e.node;var o=i.getComponent(n.default);o.dungeon=e;var s=new a.default;return s.updateHA(800,800,2),o.data=s,o.transportBoss(t.x,t.y),o.healthBar=e.bossHealthBar,o.node.active=!0,o},t.prototype.getCaptain=function(e,t){var i=null;(i=cc.instantiate(this.captain)).active=!1,i.parent=e.node;var o=i.getComponent(s.default);o.dungeon=e;var n=new a.default;return n.updateHA(400,400,2),o.data=n,o.transportBoss(t.x,t.y),o.healthBar=e.bossHealthBar,o.node.active=!0,o},t.prototype.getSlime=function(e,t,i){var o=null;(o=cc.instantiate(this.slime)).active=!1,o.parent=e.node;var n=o.getComponent(c.default);n.dungeon=e;var s=new a.default;switch(s.Common.moveSpeed=200,i){case 0:s.updateHA(400,400,2),n.scaleSize=2;break;case 1:s.updateHA(200,200,2),n.scaleSize=1.5;break;case 2:s.updateHA(100,100,2),n.scaleSize=1;break;case 3:s.updateHA(50,50,2),n.scaleSize=.5;break;case 4:s.updateHA(25,25,2),n.scaleSize=.3;break;case 5:s.updateHA(10,10,1),n.scaleSize=.2;break;default:s.updateHA(5,5,1),n.scaleSize=.2}return n.slimeType=i,n.node.scaleY=n.scaleSize,n.node.scaleX=n.scaleSize,n.data=s,n.transportBoss(t.x,t.y),n.healthBar=e.bossHealthBar,n.node.active=!0,n},t.prototype.start=function(){},t.BOSS_KRAKEN="BOSS_KRAKEN",t.MONSTER_SLIME="monster000",t.MONSTER_GOBLIN="monster001",t.MONSTER_MUMMY="monster002",t.MONSTER_ANUBIS="monster003",t.MONSTER_PIRATE="monster004",t.MONSTER_SAILOR="monster005",t.MONSTER_OCTOPUS="monster006",t.MONSTER_KILLER="monster007",t.MONSTER_STRONGSAILOR="monster008",t.MONSTER_CHEST="monster009",t.MONSTER_GARGOYLE="monster010",t.MONSTER_CHICKEN="monster011",t.MONSTER_SCARAB="monster012",__decorate([p(cc.Prefab)],t.prototype,"monster",void 0),__decorate([p(cc.Prefab)],t.prototype,"kraken",void 0),__decorate([p(cc.Prefab)],t.prototype,"captain",void 0),__decorate([p(cc.Prefab)],t.prototype,"slime",void 0),t=__decorate([h],t)}(cc.Component);i.default=d,cc._RF.pop()},{"../Boss/Captain":"Captain","../Boss/Kraken":"Kraken","../Boss/Slime":"Slime","../Data/MonsterData":"MonsterData","../Logic":"Logic","../Monster":"Monster"}],Monster:[function(e,t,i){"use strict";cc._RF.push(t,"b7513vXKLpHGrSf+utaohLs","Monster"),Object.defineProperty(i,"__esModule",{value:!0});var o=cc._decorator,a=o.ccclass,n=o.property,s=e("./EventConstant"),r=e("./HealthBar"),c=e("./Logic"),l=e("./Data/MonsterData"),h=e("./Dungeon"),p=e("./Shooter"),d=e("./Player"),u=e("./Manager/StatusManager"),m=e("./Data/DamageData"),g=e("./Manager/FloatingLabelManager"),f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.pos=cc.v2(0,0),t.healthBar=null,t.statusManager=null,t.floatinglabelManager=null,t.isFaceRight=!0,t.isMoving=!1,t.isAttacking=!1,t.isDied=!1,t.isFall=!1,t.timeDelay=0,t.data=new l.default,t.shooter=null,t.isHurt=!1,t.isDashing=!1,t.isDisguising=!1,t.currentlinearVelocitySpeed=cc.Vec2.ZERO,t.isVariation=!1,t}var i;return __extends(t,e),i=t,t.prototype.onLoad=function(){this.isAttacking=!1,this.isDied=!1,this.anim=this.getComponent(cc.Animation),this.sprite=this.node.getChildByName("sprite"),this.isVariation&&(this.node.scale=i.SCALE_NUM),this.dashlight=this.sprite.getChildByName("dashlight"),this.dashlight.opacity=0,this.shadow=this.sprite.getChildByName("shadow"),this.rigidbody=this.getComponent(cc.RigidBody),this.shooter=this.node.getChildByName("Shooter").getComponent(p.default),this.particleIce=this.node.getChildByName("Effect").getChildByName("ice").getComponent(cc.ParticleSystem),this.particleFire=this.node.getChildByName("Effect").getChildByName("fire").getComponent(cc.ParticleSystem),this.particleLightening=this.node.getChildByName("Effect").getChildByName("lightening").getComponent(cc.ParticleSystem),this.particleToxic=this.node.getChildByName("Effect").getChildByName("toxic").getComponent(cc.ParticleSystem),this.particleCurse=this.node.getChildByName("Effect").getChildByName("curse").getComponent(cc.ParticleSystem),this.updatePlayerPos(),this.actionSpriteFrameIdle()},t.prototype.changeBodyRes=function(e,t){this.sprite||(this.sprite=this.node.getChildByName("sprite"));var i=this.sprite.getChildByName("body"),o=this.getSpriteFrameByName(e,t);i.getComponent(cc.Sprite).spriteFrame=o,i.width=o.getRect().width,i.height=o.getRect().height;var a=1;switch(this.data.sizeType){case 0:a=1;break;case 1:a=.5;break;case 2:a=1.5}i.width=i.width*a,i.height=i.height*a},t.prototype.getSpriteFrameByName=function(e,t){var i=c.default.spriteFrames[e+t];return i||(i=c.default.spriteFrames[e]),i},t.prototype.updatePlayerPos=function(){this.node.x=64*this.pos.x+32,this.node.y=64*this.pos.y+32},t.prototype.transportPlayer=function(e,t){this.sprite.rotation=0,this.sprite.scale=1,this.sprite.opacity=255,this.sprite.x=0,this.sprite.y=0,this.pos.x=e,this.pos.y=t,this.changeZIndex(),this.updatePlayerPos()},t.prototype.changeZIndex=function(){this.node.zIndex=3e3+100*(h.default.HEIGHT_SIZE-this.pos.y)+2},t.prototype.showFloatFont=function(e,t,i,o){if(this.floatinglabelManager){var a=this.floatinglabelManager.getFloaingLabel(e);i?a.showDoge():o?a.showMiss():0!=t?a.showDamage(-t):a.hideLabel()}},t.prototype.meleeAttack=function(e,t){var o=this,a=c.default.getRandomNum(0,100)<this.data.StatusTotalData.missRate;if(a&&this.showFloatFont(this.dungeon.node,0,!1,!0),!this.isAttacking){this.isAttacking=!0,this.anim.pause(),e.equals(cc.Vec2.ZERO)&&(e=cc.v2(1,0)),e=e.normalizeSelf().mul(32),this.sprite.stopAllActions(),this.idleAction=null;var n=cc.sequence(cc.callFunc(function(){o.changeBodyRes(o.data.resName,i.RES_WALK01)}),cc.moveBy(.2,-e.x/2,-e.y/2),cc.callFunc(function(){o.changeBodyRes(o.data.resName,i.RES_ATTACK)}),cc.moveBy(.2,e.x,e.y),cc.callFunc(function(){o.isAttacking=!1,o.changeBodyRes(o.data.resName,i.RES_WALK03),o.anim.resume(),t&&!a&&t(o.data.getAttackPoint())}),cc.moveTo(.2,0,0));this.sprite.runAction(n)}},t.prototype.actionSpriteFrameIdle=function(){var e=this;!this.sprite||this.isAttacking||this.isDied||this.isHurt||this.isDisguising||(this.idleAction||(this.idleAction=cc.repeatForever(cc.sequence(cc.moveBy(.2,0,0),cc.callFunc(function(){e.changeBodyRes(e.data.resName)}),cc.moveBy(.2,0,0),cc.callFunc(function(){e.changeBodyRes(e.data.resName,i.RES_WALK01)}),cc.moveBy(.2,0,0),cc.callFunc(function(){e.changeBodyRes(e.data.resName,i.RES_WALK02)}),cc.moveBy(.2,0,0),cc.callFunc(function(){e.changeBodyRes(e.data.resName,i.RES_WALK03)}))),this.sprite.runAction(this.idleAction)),this.idleAction.isDone()&&this.sprite.runAction(this.idleAction))},t.prototype.getNearPlayerDistance=function(e){return c.default.getDistance(this.node.position,e.position)},t.prototype.move=function(e,t){if(!(this.isDied||this.isFall||this.isHurt||this.isDashing||this.isDisguising||e.equals(cc.Vec2.ZERO))){e=e.normalizeSelf(),this.isAttacking&&!e.equals(cc.Vec2.ZERO)&&(e=e.mul(.5)),e.equals(cc.Vec2.ZERO)||(this.pos=h.default.getIndexInMap(this.node.position));var i=e.x,o=e.y,a=Math.abs(i),n=Math.abs(o),s=a>n?a:n;s=0==s?1:s;var r=cc.v2(i,o);r=r.mul(t),this.rigidbody.linearVelocity=r.clone(),this.currentlinearVelocitySpeed=r.clone(),this.isMoving=0!=i||0!=o,this.isMoving&&(this.isFaceRight=i>0),this.changeZIndex()}},t.prototype.start=function(){this.changeZIndex(),this.healthBar.refreshHealth(this.data.getHealth().x,this.data.getHealth().y)},t.prototype.fall=function(){this.isFall||(this.isFall=!0,this.isDied=!0,this.getComponent("cc.PhysicsCollider").sensor=!0,this.anim.play("PlayerFall"))},t.prototype.takeDamage=function(e){var t=this;if(this.data.invisible&&this.sprite.opacity<200&&c.default.getRandomNum(1,10)>2)return this.showFloatFont(this.dungeon.node,0,!0,!1),!1;var i=this.data.getDamage(e),o=this.data.getDodge(),a=Math.random()<=o&&i.getTotalDamage()>0;if(i=a?new m.default:i,!a)return this.isHurt=!0,this.isDisguising&&this.changeBodyRes(this.data.resName),this.isDisguising=!1,this.isAttacking=!1,this.sprite.stopAllActions(),this.idleAction=null,setTimeout(function(){t.node&&(t.isHurt=!1)},200),this.sprite.opacity=255,this.data.currentHealth-=i.getTotalDamage(),this.data.currentHealth>this.data.getHealth().y&&(this.data.currentHealth=this.data.getHealth().y),this.healthBar.refreshHealth(this.data.currentHealth,this.data.getHealth().y),this.showFloatFont(this.dungeon.node,i.getTotalDamage(),!1,!1),!0;this.showFloatFont(this.dungeon.node,0,!0,!1)},t.prototype.addStatus=function(e){this.statusManager.addStatus(e)},t.prototype.showAttackEffect=function(){this.particleIce&&(this.data.getIceDamage()>0?this.particleIce.resetSystem():this.particleIce.stopSystem(),this.data.getFireDamage()>0?this.particleFire.resetSystem():this.particleFire.stopSystem(),this.data.getLighteningDamage()>0?this.particleLightening.resetSystem():this.particleLightening.stopSystem(),this.data.getToxicDamage()>0?this.particleToxic.resetSystem():this.particleToxic.stopSystem(),this.data.getCurseDamage()>0?this.particleCurse.resetSystem():this.particleCurse.stopSystem())},t.prototype.stopAttackEffect=function(){this.particleIce&&(this.particleIce.stopSystem(),this.particleFire.stopSystem(),this.particleLightening.stopSystem(),this.particleToxic.stopSystem(),this.particleCurse.stopSystem())},t.prototype.addPlayerStatus=function(e){c.default.getRandomNum(0,100)<this.data.getIceRate()&&e.addStatus(u.default.FROZEN),c.default.getRandomNum(0,100)<this.data.getFireRate()&&e.addStatus(u.default.BURNING),c.default.getRandomNum(0,100)<this.data.getLighteningRate()&&e.addStatus(u.default.DIZZ),c.default.getRandomNum(0,100)<this.data.getToxicRate()&&e.addStatus(u.default.TOXICOSIS),c.default.getRandomNum(0,100)<this.data.getCurseRate()&&e.addStatus(u.default.CURSING)},t.prototype.killed=function(){var e=this;if(!this.isDied){this.isDied=!0,this.isDisguising&&this.changeBodyRes(this.data.resName),this.isDisguising=!1,this.isDashing=!1,this.anim.play("MonsterDie"),this.idleAction=null,this.sprite.stopAllActions(),this.getComponent("cc.PhysicsCollider").sensor=!0;var t=Math.random();t<.9?cc.director.emit(s.EventConstant.DUNGEON_ADD_COIN,{detail:{pos:this.node.position,count:c.default.getRandomNum(1,10)}}):t>=.9&&t<.98?cc.director.emit(s.EventConstant.DUNGEON_ADD_HEART,{detail:{pos:this.node.position}}):cc.director.emit(s.EventConstant.DUNGEON_ADD_AMMO,{detail:{pos:this.node.position}}),setTimeout(function(){e.node&&(e.node.active=!1)},2e3)}},t.prototype.getCenterPosition=function(){return this.node.position.clone().addSelf(cc.v2(0,32*this.node.scaleY))},t.prototype.monsterAction=function(){var e=this;if(!this.isDied&&this.dungeon&&!this.isHurt){this.node.position=h.default.fixOuterMap(this.node.position),this.pos=h.default.getIndexInMap(this.node.position),this.changeZIndex();var t=cc.v2(0,0);t.x+=c.default.getRandomNum(0,200)-100,t.y+=c.default.getRandomNum(0,200)-100;var i=this.getNearPlayerDistance(this.dungeon.player.node),o=t.clone();if(i<80&&!this.dungeon.player.isDied&&this.data.melee>0&&c.default.getRandomNum(0,100)<this.data.melee&&!this.isDashing&&!this.isDisguising&&((o=this.dungeon.player.getCenterPosition().sub(this.node.position)).equals(cc.Vec2.ZERO)||(o=o.normalizeSelf()),this.showAttackEffect(),this.meleeAttack(o,function(t){e.stopAttackEffect(),e.getNearPlayerDistance(e.dungeon.player.node)<80&&(e.addPlayerStatus(e.dungeon.player),e.dungeon.player.takeDamage(t))}),this.sprite.opacity=255),this.data.melee>0&&(o=this.dungeon.player.getCenterPosition().sub(this.node.position)),i<600&&this.data.remote>0&&c.default.getRandomNum(0,100)<this.data.remote&&this.shooter&&!this.isDisguising){var a=this.shooter.node.position.clone();a.x=this.shooter.node.scaleX>0?a.x+30:-a.x-30;var n=this.dungeon.player.getCenterPosition().sub(this.node.position.add(a));n.equals(cc.Vec2.ZERO)||(n=n.normalizeSelf(),this.shooter.setHv(n),this.shooter.dungeon=this.dungeon,this.shooter.data.bulletType="bullet001",this.shooter.fireBullet(c.default.getRandomNum(0,5)-5))}var s=this.data.getMoveSpeed();i<600&&i>100&&!this.dungeon.player.isDied&&c.default.getRandomNum(0,100)<this.data.dash&&this.data.dash>0&&!this.isDashing&&!this.isDisguising&&(o=this.dungeon.player.getCenterPosition().sub(this.node.position),this.showAttackEffect(),this.move(o,1.2*s),this.isDashing=!0,setTimeout(function(){e.node&&(e.isDashing=!1,e.stopAttackEffect())},3e3)),this.data.disguise>0&&i<this.data.disguise&&!this.dungeon.player.isDied&&this.isDisguising&&(this.changeBodyRes(this.data.resName),this.isDisguising=!1),c.default.getHalfChance()&&this.move(o,s)}},t.prototype.lerp=function(e,t,i){return e+(t-e)*i},t.prototype.onCollisionEnter=function(e,t){e.getComponent(d.default)&&this.isDashing&&this.dungeon&&!this.isHurt&&!this.isDied&&(this.isDashing=!1,this.rigidbody.linearVelocity=cc.Vec2.ZERO,this.addPlayerStatus(this.dungeon.player),this.stopAttackEffect(),this.dungeon.player.takeDamage(this.data.getAttackPoint()))},t.prototype.update=function(e){this.timeDelay+=e,this.timeDelay>.2&&(this.timeDelay=0,this.monsterAction(),this.actionSpriteFrameIdle()),this.data.invisible>0&&this.sprite.opacity>10&&(this.sprite.opacity=this.lerp(this.sprite.opacity,9,3*e)),this.dashlight.opacity=0,this.dungeon&&this.isDashing&&(this.dashlight.opacity=128,this.rigidbody.linearVelocity=this.currentlinearVelocitySpeed.clone()),this.isDied&&(this.rigidbody.linearVelocity=cc.Vec2.ZERO),this.healthBar.node.opacity=this.isDisguising?0:255,this.shadow&&(this.shadow.opacity=this.isDisguising?0:255),this.isDisguising&&this.anim&&this.anim.pause(),this.data.invisible>0&&(this.healthBar.node.opacity=this.sprite.opacity>20?255:9),this.healthBar.node.active=!this.isDied,this.data.currentHealth<1&&this.killed();var t=this.isVariation?i.SCALE_NUM:1;this.node.scaleX=this.isFaceRight?t:-t,this.node.scaleY=t,this.healthBar.node.scaleX=this.node.scaleX>0?1:-1,this.healthBar.node.x=-30*this.node.scaleX,this.healthBar.progressBar.barSprite.node.color=this.isVariation?cc.color(128,0,128):cc.color(194,0,0),this.dashlight.color=this.isVariation?cc.color(0,0,0):cc.color(255,255,255)},t.RES_DISGUISE="disguise",t.RES_WALK01="anim001",t.RES_WALK02="anim002",t.RES_WALK03="anim003",t.RES_ATTACK="anim004",t.SCALE_NUM=1.5,__decorate([n(cc.Vec2)],t.prototype,"pos",void 0),__decorate([n(r.default)],t.prototype,"healthBar",void 0),__decorate([n(u.default)],t.prototype,"statusManager",void 0),__decorate([n(g.default)],t.prototype,"floatinglabelManager",void 0),t=i=__decorate([a],t)}(cc.Component);i.default=f,cc._RF.pop()},{"./Data/DamageData":"DamageData","./Data/MonsterData":"MonsterData","./Dungeon":"Dungeon","./EventConstant":"EventConstant","./HealthBar":"HealthBar","./Logic":"Logic","./Manager/FloatingLabelManager":"FloatingLabelManager","./Manager/StatusManager":"StatusManager","./Player":"Player","./Shooter":"Shooter"}],OilLake:[function(e,t,i){"use strict";cc._RF.push(t,"8cd153I1qFEbb/uteHyUJpM","OilLake"),Object.defineProperty(i,"__esModule",{value:!0});var o=e("./PerlinNoise2D"),a=cc._decorator,n=a.ccclass,s=(a.property,function(){function e(){this.map=new Array;var e,i,a,n,s=new o.default;s.seed(Math.random()),a=20+this.getRandomNum(20),n=20+this.getRandomNum(20),e=this.getRandomNum(9999),i=this.getRandomNum(9999);var r=t.WIDTH,c=t.HEIGHT;this.map=new Array;for(var l=0;l<r;l++){this.map[l]=new Array;for(var h=0;h<c;h++){this.map[l][h]=".";var p=a*l/r+e,d=n*h/c+i,u=s.simplex2(p,d);u>.14?this.map[l][h]="Y":u<-.14&&(this.map[l][h]="~");var m=Math.random();m>=0&&m<.2&&"~"!=this.map[l][h]&&(this.map[l][h]="o"),m>=.2&&m<.25&&"~"!=this.map[l][h]&&(this.map[l][h]="w")}}}var t;return t=e,e.prototype.getRandomNum=function(e){return Math.round(Math.random()*e)},e.prototype.getDisPlay=function(){for(var e="",i=t.HEIGHT-1;i>=0;i--){for(var o=0;o<t.WIDTH;o++)e+=this.map[o][i];e+="\n"}return e},e.WIDTH=64,e.HEIGHT=64,e=t=__decorate([n],e)}());i.default=s,cc._RF.pop()},{"./PerlinNoise2D":"PerlinNoise2D"}],PerlinNoise2D:[function(e,t,i){"use strict";cc._RF.push(t,"59901zRRqlG9KvoKLDTbxq7","PerlinNoise2D"),Object.defineProperty(i,"__esModule",{value:!0});var o=cc._decorator,a=o.ccclass,n=(o.property,function(){function e(){this.grad3=[new s(1,1,0),new s(-1,1,0),new s(1,-1,0),new s(-1,-1,0),new s(1,0,1),new s(-1,0,1),new s(1,0,-1),new s(-1,0,-1),new s(0,1,1),new s(0,-1,1),new s(0,1,-1),new s(0,-1,-1)],this.p=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],this.perm=new Array(512),this.gradP=new Array(512),this.F2=.5*(Math.sqrt(3)-1),this.G2=(3-Math.sqrt(3))/6,this.F3=1/3,this.G3=1/6}return e.prototype.simplex2=function(e,t){var i,o,a=(e+t)*this.F2,n=Math.floor(e+a),s=Math.floor(t+a),r=(n+s)*this.G2,c=e-n+r,l=t-s+r;c>l?(i=1,o=0):(i=0,o=1);var h=c-i+this.G2,p=l-o+this.G2,d=c-1+2*this.G2,u=l-1+2*this.G2;n&=255,s&=255;var m=this.gradP[n+this.perm[s]],g=this.gradP[n+i+this.perm[s+o]],f=this.gradP[n+1+this.perm[s+1]],y=.5-c*c-l*l,D=.5-h*h-p*p,v=.5-d*d-u*u;return 70*((y<0?0:(y*=y)*y*m.dot2(c,l))+(D<0?0:(D*=D)*D*g.dot2(h,p))+(v<0?0:(v*=v)*v*f.dot2(d,u)))},e.prototype.simplex3=function(e,t,i){var o,a,n,s,r,c,l=(e+t+i)*this.F3,h=Math.floor(e+l),p=Math.floor(t+l),d=Math.floor(i+l),u=(h+p+d)*this.G3,m=e-h+u,g=t-p+u,f=i-d+u;m>=g?g>=f?(o=1,a=0,n=0,s=1,r=1,c=0):m>=f?(o=1,a=0,n=0,s=1,r=0,c=1):(o=0,a=0,n=1,s=1,r=0,c=1):g<f?(o=0,a=0,n=1,s=0,r=1,c=1):m<f?(o=0,a=1,n=0,s=0,r=1,c=1):(o=0,a=1,n=0,s=1,r=1,c=0);var y=m-o+this.G3,D=g-a+this.G3,v=f-n+this.G3,C=m-s+2*this.G3,R=g-r+2*this.G3,_=f-c+2*this.G3,E=m-1+3*this.G3,S=g-1+3*this.G3,M=f-1+3*this.G3;h&=255,p&=255,d&=255;var T=this.gradP[h+this.perm[p+this.perm[d]]],P=this.gradP[h+o+this.perm[p+a+this.perm[d+n]]],x=this.gradP[h+s+this.perm[p+r+this.perm[d+c]]],O=this.gradP[h+1+this.perm[p+1+this.perm[d+1]]],b=.6-m*m-g*g-f*f,A=.6-y*y-D*D-v*v,L=.6-C*C-R*R-_*_,N=.6-E*E-S*S-M*M;return 32*((b<0?0:(b*=b)*b*T.dot3(m,g,f))+(A<0?0:(A*=A)*A*P.dot3(y,D,v))+(L<0?0:(L*=L)*L*x.dot3(C,R,_))+(N<0?0:(N*=N)*N*O.dot3(E,S,M)))},e.prototype.perlin2=function(e,t){var i=Math.floor(e),o=Math.floor(t);e-=i,t-=o,i&=255,o&=255;var a=this.gradP[i+this.perm[o]].dot2(e,t),n=this.gradP[i+this.perm[o+1]].dot2(e,t-1),s=this.gradP[i+1+this.perm[o]].dot2(e-1,t),r=this.gradP[i+1+this.perm[o+1]].dot2(e-1,t-1),c=this.fade(e);return this.lerp(this.lerp(a,s,c),this.lerp(n,r,c),this.fade(t))},e.prototype.perlin3=function(e,t,i){var o=Math.floor(e),a=Math.floor(t),n=Math.floor(i);e-=o,t-=a,i-=n,o&=255,a&=255,n&=255;var s=this.gradP[o+this.perm[a+this.perm[n]]].dot3(e,t,i),r=this.gradP[o+this.perm[a+this.perm[n+1]]].dot3(e,t,i-1),c=this.gradP[o+this.perm[a+1+this.perm[n]]].dot3(e,t-1,i),l=this.gradP[o+this.perm[a+1+this.perm[n+1]]].dot3(e,t-1,i-1),h=this.gradP[o+1+this.perm[a+this.perm[n]]].dot3(e-1,t,i),p=this.gradP[o+1+this.perm[a+this.perm[n+1]]].dot3(e-1,t,i-1),d=this.gradP[o+1+this.perm[a+1+this.perm[n]]].dot3(e-1,t-1,i),u=this.gradP[o+1+this.perm[a+1+this.perm[n+1]]].dot3(e-1,t-1,i-1),m=this.fade(e),g=this.fade(t),f=this.fade(i);return this.lerp(this.lerp(this.lerp(s,h,m),this.lerp(r,p,m),f),this.lerp(this.lerp(c,d,m),this.lerp(l,u,m),f),g)},e.prototype.seed=function(e){e>0&&e<1&&(e*=65536),(e=Math.floor(e))<256&&(e|=e<<8);for(var t=0;t<256;t++){var i=void 0;i=1&t?this.p[t]^255&e:this.p[t]^e>>8&255,this.perm[t]=this.perm[t+256]=i,this.gradP[t]=this.gradP[t+256]=this.grad3[i%12]}},e.prototype.lerp=function(e,t,i){return(1-i)*e+i*t},e.prototype.fade=function(e){return e*e*e*(e*(6*e-15)+10)},e=__decorate([a],e)}());i.default=n;var s=function(){function e(e,t,i){this.x=e,this.y=t,this.z=i}return e.prototype.dot2=function(e,t){return this.x*e+this.y*t},e.prototype.dot3=function(e,t,i){return this.x*e+this.y*t+this.z*i},e}();cc._RF.pop()},{}],PlayerData:[function(e,t,i){"use strict";cc._RF.push(t,"802a53ZqslNorozVvKYFivM","PlayerData"),Object.defineProperty(i,"__esModule",{value:!0});var o=e("./EquipmentData"),a=e("./DamageData"),n=e("./StatusData"),s=e("./CommonData"),r=function(){function e(){this.name="",this.pos=cc.v2(7,4),this.currentHealth=e.DEFAULT_HEALTH,this.list=[],this.equipmentTotalData=new o.default,this.statusTotalData=new n.default,this.common=new s.default,this.common.maxHealth=e.DEFAULT_HEALTH,this.common.moveSpeed=e.DefAULT_SPEED,this.common.damageMin=e.DefAULT_ATTACK,this.list=[this.common,this.equipmentTotalData.Common,this.statusTotalData.Common]}return Object.defineProperty(e.prototype,"EquipmentTotalData",{get:function(){return this.equipmentTotalData},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"StatusTotalData",{get:function(){return this.statusTotalData},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Common",{get:function(){return this.common},enumerable:!0,configurable:!0}),e.prototype.updateHA=function(e,t){return this.currentHealth=e.x,this.common.maxHealth=e.y,this.common.damageMin=this.common.damageMin,this},e.prototype.valueCopy=function(t){this.common.valueCopy(t.common),this.pos=t.pos?cc.v2(t.pos.x,t.pos.y):cc.v2(4,7),this.name=t.name?t.name:"",this.equipmentTotalData.valueCopy(t.equipmentTotalData),this.statusTotalData.valueCopy(t.statusTotalData),this.currentHealth=t.currentHealth?t.currentHealth:e.DEFAULT_HEALTH,this.common.maxHealth=t.common.maxHealth?t.common.maxHealth:e.DEFAULT_HEALTH,this.common.moveSpeed=t.common.moveSpeed?t.common.moveSpeed:300},e.prototype.clone=function(){var t=new e;return t.common=this.common.clone(),t.pos=this.pos,t.name=this.name,t.currentHealth=this.currentHealth,t.equipmentTotalData=this.equipmentTotalData,t.statusTotalData=this.statusTotalData,t},e.prototype.getFinalAttackPoint=function(){var e=new a.default,t=this.getDamageMin(),i=this.getDamageMax(),o=this.getCriticalStrikeRate(),n=Math.random()>o?t:t+i;return n<0&&(n=0),e.physicalDamage=n,e.realDamage=this.getRealDamage(),e.iceDamage=this.getIceDamage(),e.fireDamage=this.getFireDamage(),e.lighteningDamage=this.getLighteningDamage(),e.toxicDamage=this.getToxicDamage(),e.curseDamage=this.getCurseDamage(),e},e.prototype.getDamage=function(e){var t=e.clone(),i=this.getDefence(),o=this.getIceDefence(),a=this.getFireDefence(),n=this.getLighteningDefence(),s=this.getToxicDefence(),r=this.getCurseDefence();return t.physicalDamage=i>=0?t.physicalDamage*(1-.06*i/(.06*i+1)):t.physicalDamage*(2-Math.pow(.94,-i)),t.iceDamage=t.iceDamage*(1-o/100),t.fireDamage=t.fireDamage*(1-a/100),t.lighteningDamage=t.lighteningDamage*(1-n/100),t.toxicDamage=t.toxicDamage*(1-s/100),t.curseDamage=t.curseDamage*(1-r/100),t},e.prototype.getLifeDrain=function(){var e=this.getCriticalStrikeRate(),t=this.getLifeDrainRate(),i=0;return Math.random()<t&&(i=1,Math.random()<e&&(i=2)),i},e.prototype.getMoveSpeed=function(){for(var t=0,i=0,o=this.list;i<o.length;i++){t+=o[i].moveSpeed}return t>2*e.DefAULT_SPEED&&(t=2*e.DefAULT_SPEED),t<2*-e.DefAULT_SPEED&&(t=2*-e.DefAULT_SPEED),t},e.prototype.getAttackSpeed=function(){for(var e=0,t=0,i=this.list;t<i.length;t++){e+=i[t].attackSpeed}return e},e.prototype.getRemoteSpeed=function(){for(var e=0,t=0,i=this.list;t<i.length;t++){e+=i[t].remoteSpeed}return e},e.prototype.getDamageMin=function(){for(var e=0,t=0,i=this.list;t<i.length;t++){e+=i[t].damageMin}return e},e.prototype.getDamageMax=function(){for(var e=0,t=0,i=this.list;t<i.length;t++){e+=i[t].damageMax}return e},e.prototype.getCriticalStrikeRate=function(){for(var e=1,t=0,i=this.list;t<i.length;t++){e*=1-i[t].criticalStrikeRate/100}return 1-e},e.prototype.getDodge=function(){for(var e=1,t=0,i=this.list;t<i.length;t++){e*=1-i[t].dodge/100}return 1-e},e.prototype.getDefence=function(){for(var e=0,t=0,i=this.list;t<i.length;t++){e+=i[t].defence}return e},e.prototype.getHealth=function(){for(var e=1,t=0,i=0,o=this.list;i<o.length;i++){t+=o[i].maxHealth}return t>0?(e=this.currentHealth/t,cc.v2(t*e,t)):cc.v2(1,1)},e.prototype.getIceDefence=function(){for(var e=0,t=0,i=this.list;t<i.length;t++){e+=i[t].iceDefence}return e>100&&(e=100),e},e.prototype.getFireDefence=function(){for(var e=0,t=0,i=this.list;t<i.length;t++){e+=i[t].fireDefence}return e>100&&(e=100),e},e.prototype.getLighteningDefence=function(){for(var e=0,t=0,i=this.list;t<i.length;t++){e+=i[t].lighteningDefence}return e>100&&(e=100),e},e.prototype.getToxicDefence=function(){for(var e=0,t=0,i=this.list;t<i.length;t++){e+=i[t].toxicDefence}return e>100&&(e=100),e},e.prototype.getCurseDefence=function(){for(var e=0,t=0,i=this.list;t<i.length;t++){e+=i[t].curseDefence}return e>100&&(e=100),e},e.prototype.getRealDamage=function(){for(var e=0,t=0,i=this.list;t<i.length;t++){e+=i[t].realDamage}return e<0&&(e=0),e},e.prototype.getIceDamage=function(){for(var e=0,t=0,i=this.list;t<i.length;t++){e+=i[t].iceDamage}return e<0&&(e=0),e},e.prototype.getFireDamage=function(){for(var e=0,t=0,i=this.list;t<i.length;t++){e+=i[t].fireDamage}return e<0&&(e=0),e},e.prototype.getLighteningDamage=function(){for(var e=0,t=0,i=this.list;t<i.length;t++){e+=i[t].lighteningDamage}return e<0&&(e=0),e},e.prototype.getToxicDamage=function(){for(var e=0,t=0,i=this.list;t<i.length;t++){e+=i[t].toxicDamage}return e<0&&(e=0),e},e.prototype.getCurseDamage=function(){for(var e=0,t=0,i=this.list;t<i.length;t++){e+=i[t].curseDamage}return e<0&&(e=0),e},e.prototype.getRealRate=function(){for(var e=0,t=0,i=this.list;t<i.length;t++){e+=i[t].realRate}return e=(e=e<0?0:e)>100?100:e},e.prototype.getIceRate=function(){for(var e=0,t=0,i=this.list;t<i.length;t++){e+=i[t].iceRate}return e=(e=e<0?0:e)>100?100:e},e.prototype.getFireRate=function(){for(var e=0,t=0,i=this.list;t<i.length;t++){e+=i[t].fireRate}return e=(e=e<0?0:e)>100?100:e},e.prototype.getLighteningRate=function(){for(var e=0,t=0,i=this.list;t<i.length;t++){e+=i[t].lighteningRate}return e=(e=e<0?0:e)>100?100:e},e.prototype.getToxicRate=function(){for(var e=0,t=0,i=this.list;t<i.length;t++){e+=i[t].toxicRate}return e=(e=e<0?0:e)>100?100:e},e.prototype.getCurseRate=function(){for(var e=0,t=0,i=this.list;t<i.length;t++){e+=i[t].curseRate}return e=(e=e<0?0:e)>100?100:e},e.prototype.getLifeRecovery=function(){for(var e=0,t=0,i=this.list;t<i.length;t++){e+=i[t].lifeRecovery}return e>0?e:0},e.prototype.getLifeDrainRate=function(){for(var e=1,t=0,i=this.list;t<i.length;t++){e*=1-i[t].lifeDrain/100}return 1-e},e.DEFAULT_HEALTH=5,e.DefAULT_SPEED=300,e.DefAULT_ATTACK=1,e}();i.default=r,cc._RF.pop()},{"./CommonData":"CommonData","./DamageData":"DamageData","./EquipmentData":"EquipmentData","./StatusData":"StatusData"}],PlayerInfoDialog:[function(e,t,i){"use strict";cc._RF.push(t,"15316LuMnlLl6y6PlDqoReo","PlayerInfoDialog"),Object.defineProperty(i,"__esModule",{value:!0});var o=cc._decorator,a=o.ccclass,n=(o.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.attack=null,t.criticalStrikeRate=null,t.defence=null,t.lifeDrain=null,t.lifeRecovery=null,t.moveSpeed=null,t.attackSpeed=null,t.dodge=null,t.health=null,t.realDamage=null,t.realRate=null,t.iceDamage=null,t.iceDefence=null,t.iceRate=null,t.fireDamage=null,t.fireDefence=null,t.fireRate=null,t.lighteningDamage=null,t.lighteningDefence=null,t.lighteningRate=null,t.toxicDamage=null,t.toxicDefence=null,t.toxicRate=null,t.curseDamage=null,t.curseDefence=null,t.curseRate=null,t.isShow=!1,t.layout=null,t}return __extends(t,e),t.prototype.onLoad=function(){this.attack=this.node.getChildByName("layout").getChildByName("attack").getChildByName("label").getComponent(cc.Label),this.criticalStrikeRate=this.node.getChildByName("layout").getChildByName("criticalStrikeRate").getChildByName("label").getComponent(cc.Label),this.defence=this.node.getChildByName("layout").getChildByName("defence").getChildByName("label").getComponent(cc.Label),this.lifeDrain=this.node.getChildByName("layout").getChildByName("lifeDrain").getChildByName("label").getComponent(cc.Label),this.lifeRecovery=this.node.getChildByName("layout").getChildByName("lifeRecovery").getChildByName("label").getComponent(cc.Label),this.moveSpeed=this.node.getChildByName("layout").getChildByName("moveSpeed").getChildByName("label").getComponent(cc.Label),this.attackSpeed=this.node.getChildByName("layout").getChildByName("attackSpeed").getChildByName("label").getComponent(cc.Label),this.dodge=this.node.getChildByName("layout").getChildByName("dodge").getChildByName("label").getComponent(cc.Label),this.health=this.node.getChildByName("layout").getChildByName("health").getChildByName("label").getComponent(cc.Label),this.realDamage=this.node.getChildByName("layout").getChildByName("realDamage").getChildByName("label").getComponent(cc.Label),this.realRate=this.node.getChildByName("layout").getChildByName("realRate").getChildByName("label").getComponent(cc.Label),this.iceDamage=this.node.getChildByName("layout").getChildByName("iceDamage").getChildByName("label").getComponent(cc.Label),this.iceDefence=this.node.getChildByName("layout").getChildByName("iceDefence").getChildByName("label").getComponent(cc.Label),this.iceRate=this.node.getChildByName("layout").getChildByName("iceRate").getChildByName("label").getComponent(cc.Label),this.fireDamage=this.node.getChildByName("layout").getChildByName("fireDamage").getChildByName("label").getComponent(cc.Label),this.fireDefence=this.node.getChildByName("layout").getChildByName("fireDefence").getChildByName("label").getComponent(cc.Label),this.fireRate=this.node.getChildByName("layout").getChildByName("fireRate").getChildByName("label").getComponent(cc.Label),this.lighteningDamage=this.node.getChildByName("layout").getChildByName("lighteningDamage").getChildByName("label").getComponent(cc.Label),this.lighteningDefence=this.node.getChildByName("layout").getChildByName("lighteningDefence").getChildByName("label").getComponent(cc.Label),this.lighteningRate=this.node.getChildByName("layout").getChildByName("lighteningRate").getChildByName("label").getComponent(cc.Label),this.toxicDamage=this.node.getChildByName("layout").getChildByName("toxicDamage").getChildByName("label").getComponent(cc.Label),this.toxicDefence=this.node.getChildByName("layout").getChildByName("toxicDefence").getChildByName("label").getComponent(cc.Label),this.toxicRate=this.node.getChildByName("layout").getChildByName("toxicRate").getChildByName("label").getComponent(cc.Label),this.curseDamage=this.node.getChildByName("layout").getChildByName("curseDamage").getChildByName("label").getComponent(cc.Label),this.curseDefence=this.node.getChildByName("layout").getChildByName("curseDefence").getChildByName("label").getComponent(cc.Label),this.curseRate=this.node.getChildByName("layout").getChildByName("curseRate").getChildByName("label").getComponent(cc.Label),this.layout=this.node.getChildByName("layout"),this.addSpriteTouchEvent()},t.prototype.start=function(){},t.prototype.refreshDialog=function(e,t,i){this.attack&&(this.attack.string=this.getInfo(e.Common.damageMin,t.Common.damageMin,i.Common.damageMin)+"->"+this.getInfo(e.Common.damageMax,t.Common.damageMax,i.Common.damageMax),this.criticalStrikeRate.string=this.getInfo(e.Common.criticalStrikeRate,t.Common.criticalStrikeRate,i.Common.criticalStrikeRate,!0),this.defence.string=this.getInfo(e.Common.defence,t.Common.defence,i.Common.defence),this.lifeDrain.string=this.getInfo(e.Common.lifeDrain,t.Common.lifeDrain,i.Common.lifeDrain,!0),this.lifeRecovery.string=this.getInfo(e.Common.lifeRecovery,t.Common.lifeRecovery,i.Common.lifeRecovery),this.moveSpeed.string=this.getInfo(e.Common.moveSpeed,t.Common.moveSpeed,i.Common.moveSpeed),this.attackSpeed.string=this.getInfo(e.Common.attackSpeed,t.Common.attackSpeed,i.Common.attackSpeed,!0),this.dodge.string=this.getInfo(e.Common.dodge,t.Common.dodge,i.Common.dodge,!0),this.health.string=e.currentHealth.toFixed(1).replace(".0","")+"/"+this.getInfo(e.Common.maxHealth,t.Common.maxHealth,i.Common.maxHealth),this.realDamage.string=this.getInfo(e.Common.realDamage,t.Common.realDamage,i.Common.realDamage),this.realRate.string=this.getInfo(e.Common.realRate,t.Common.realRate,i.Common.realRate,!0),this.iceDamage.string=this.getInfo(e.Common.iceDamage,t.Common.iceDamage,i.Common.iceDamage),this.iceDefence.string=this.getInfo(e.Common.iceDefence,t.Common.iceDefence,i.Common.iceDefence,!0),this.iceRate.string=this.getInfo(e.Common.iceRate,t.Common.iceRate,i.Common.iceRate,!0),this.fireDamage.string=this.getInfo(e.Common.fireDamage,t.Common.fireDamage,i.Common.fireDamage),this.fireDefence.string=this.getInfo(e.Common.fireDefence,t.Common.fireDefence,i.Common.fireDefence,!0),this.fireRate.string=this.getInfo(e.Common.fireRate,t.Common.fireRate,i.Common.fireRate,!0),this.lighteningDamage.string=this.getInfo(e.Common.lighteningDamage,t.Common.lighteningDamage,i.Common.lighteningDamage),this.lighteningDefence.string=this.getInfo(e.Common.lighteningDefence,t.Common.lighteningDefence,i.Common.lighteningDefence,!0),this.lighteningRate.string=this.getInfo(e.Common.lighteningRate,t.Common.lighteningRate,i.Common.lighteningRate,!0),this.toxicDamage.string=this.getInfo(e.Common.toxicDamage,t.Common.toxicDamage,i.Common.toxicDamage),this.toxicDefence.string=this.getInfo(e.Common.toxicDefence,t.Common.toxicDefence,i.Common.toxicDefence,!0),this.toxicRate.string=this.getInfo(e.Common.toxicRate,t.Common.toxicRate,i.Common.toxicRate,!0),this.curseDamage.string=this.getInfo(e.Common.curseDamage,t.Common.curseDamage,i.Common.curseDamage),this.curseDefence.string=this.getInfo(e.Common.curseDefence,t.Common.curseDefence,i.Common.curseDefence,!0),this.curseRate.string=this.getInfo(e.Common.curseRate,t.Common.curseRate,i.Common.curseRate,!0))},t.prototype.getInfo=function(e,t,i,o){var a=""+(e+t+i).toFixed(1).replace(".0","");return o&&(a+="%"),t>0?(a+=" E:+"+t.toFixed(1).replace(".0",""),o&&(a+="%")):t<0&&(a+=" E:"+t.toFixed(1).replace(".0",""),o&&(a+="%")),i>0?(a+=" S:+"+i.toFixed(1).replace(".0",""),o&&(a+="%")):i<0&&(a+=" S:"+i.toFixed(1).replace(".0",""),o&&(a+="%")),a},t.prototype.addSpriteTouchEvent=function(){var e=this;this.node.on(cc.Node.EventType.TOUCH_START,function(){e.isShow=!0}),this.node.on(cc.Node.EventType.TOUCH_END,function(){e.isShow=!1}),this.node.on(cc.Node.EventType.TOUCH_CANCEL,function(){e.isShow=!1})},t.prototype.update=function(e){this.layout.active=this.isShow},t=__decorate([a],t)}(cc.Component));i.default=n,cc._RF.pop()},{}],Player:[function(e,t,i){"use strict";cc._RF.push(t,"03570PUzDdNyIu4Asd1jFZT","Player"),Object.defineProperty(i,"__esModule",{value:!0});var o=cc._decorator,a=o.ccclass,n=o.property,s=e("./EventConstant"),r=e("./Shooter"),c=e("./HealthBar"),l=e("./Logic"),h=e("./Dungeon"),p=e("./Equipment/Equipment"),d=e("./MeleeWeapon"),u=e("./Rect/RectDungeon"),m=e("./Manager/StatusManager"),g=e("./Data/DamageData"),f=e("./Data/PlayerData"),y=e("./UI/PlayerInfoDialog"),D=e("./Manager/FloatingLabelManager"),v=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.pos=cc.v2(4,4),t.floatinglabelManager=null,t.healthBar=null,t.walksmoke=null,t.meleeWeaponNode=null,t.meleeWeapon=null,t.shooterNode=null,t.shooter=null,t.statusManager=null,t.playerInfoDialog=null,t.hairSprite=null,t.weaponSprite=null,t.weaponLightSprite=null,t.weaponStabSprite=null,t.weaponStabLightSprite=null,t.helmetSprite=null,t.clothesSprite=null,t.trousersSprite=null,t.glovesLeftSprite=null,t.glovesRightSprite=null,t.shoesLeftSprite=null,t.shoesRightSprite=null,t.cloakSprite=null,t.isMoving=!1,t.isAttacking=!1,t.isDied=!1,t.isFall=!1,t.baseAttackPoint=1,t.recoveryTimeDelay=0,t.isFaceRight=!0,t.defaultPos=cc.v2(0,0),t.remoteRate=0,t.smokeTimeDelay=0,t}return __extends(t,e),t.prototype.onLoad=function(){var e=this;this.isAttacking=!1,this.inventoryManager=l.default.inventoryManager,this.data=l.default.playerData,this.statusUpdate(),this.pos=cc.v2(4,4),this.isDied=!1,this.anim=this.getComponent(cc.Animation);var t="PlayerWalkShort";1==this.inventoryManager.trousers.trouserslong&&(t="PlayerWalk"),this.anim&&this.anim.play(t),this.rigidbody=this.getComponent(cc.RigidBody),this.sprite=this.node.getChildByName("sprite"),this.playerItemSprite=this.sprite.getChildByName("righthand").getChildByName("item").getComponent(cc.Sprite),this.hairSprite=this.sprite.getChildByName("body").getChildByName("hair").getComponent(cc.Sprite),this.weaponSprite=this.node.getChildByName("MeleeWeapon").getChildByName("sprite").getChildByName("weapon").getComponent(cc.Sprite),this.weaponLightSprite=this.node.getChildByName("MeleeWeapon").getChildByName("sprite").getChildByName("meleelight").getComponent(cc.Sprite),this.weaponStabSprite=this.node.getChildByName("MeleeWeapon").getChildByName("sprite").getChildByName("stabweapon").getComponent(cc.Sprite),this.weaponStabLightSprite=this.node.getChildByName("MeleeWeapon").getChildByName("sprite").getChildByName("stablight").getComponent(cc.Sprite),this.helmetSprite=this.sprite.getChildByName("body").getChildByName("helmet").getComponent(cc.Sprite),this.clothesSprite=this.sprite.getChildByName("body").getChildByName("clothes").getComponent(cc.Sprite),this.trousersSprite=this.sprite.getChildByName("body").getChildByName("trousers").getComponent(cc.Sprite),this.glovesLeftSprite=this.sprite.getChildByName("body").getChildByName("glovesleft").getComponent(cc.Sprite),this.glovesRightSprite=this.sprite.getChildByName("body").getChildByName("glovesright").getComponent(cc.Sprite),this.shoesLeftSprite=this.sprite.getChildByName("body").getChildByName("shoesleft").getComponent(cc.Sprite),this.shoesRightSprite=this.sprite.getChildByName("body").getChildByName("shoesright").getComponent(cc.Sprite),this.cloakSprite=this.sprite.getChildByName("cloak").getComponent(cc.Sprite),cc.director.on(s.EventConstant.INVENTORY_CHANGEITEM,function(t){e.changeItem(t.detail.spriteFrame)}),cc.director.on(s.EventConstant.PLAYER_USEITEM,function(t){e.UseItem()}),cc.director.on(s.EventConstant.PLAYER_ATTACK,function(t){e.meleeAttack()}),cc.director.on(s.EventConstant.PLAYER_REMOTEATTACK,function(t){e.remoteAttack()}),cc.director.on(s.EventConstant.PLAYER_STATUSUPDATE,function(t){e.statusUpdate()}),cc.director.on(s.EventConstant.PLAYER_TAKEDAMAGE,function(t){e.takeDamage(t.detail.damage)}),cc.director.on(s.EventConstant.PLAYER_ROTATE,function(t){e.rotatePlayer(t.detail.dir,t.detail.pos,t.detail.dt)}),l.default.mapManger.getCurrentRoomType()==u.default.BOSS_ROOM&&(l.default.playerData.pos=cc.v2(Math.floor(h.default.WIDTH_SIZE/2),Math.floor(h.default.HEIGHT_SIZE/2))),this.pos=l.default.playerData.pos.clone(),this.defaultPos=l.default.playerData.pos.clone(),this.baseAttackPoint=l.default.playerData.getDamageMin(),this.updatePlayerPos(),this.meleeWeapon=this.meleeWeaponNode.getComponent(d.default),this.shooter=this.shooterNode.getComponent(r.default),this.shooter.player=this,this.smokePool=new cc.NodePool,cc.director.on("destorysmoke",function(t){e.destroySmoke(t.detail.coinNode)})},t.prototype.statusUpdate=function(){this.inventoryManager&&this.playerInfoDialog&&(this.data.EquipmentTotalData.valueCopy(this.inventoryManager.getTotalEquipmentData()),this.playerInfoDialog.refreshDialog(this.data,this.data.EquipmentTotalData,this.data.StatusTotalData))},t.prototype.getWalkSmoke=function(e,t){var i=null;this.smokePool.size()>0&&(i=this.smokePool.get()),i&&!i.active||(i=cc.instantiate(this.walksmoke)),i.parent=e,i.position=t,i.zIndex=4e3,i.opacity=255,i.active=!0},t.prototype.destroySmoke=function(e){e&&(e.active=!1,this.smokePool&&this.smokePool.put(e))},t.prototype.changeItem=function(e){this.playerItemSprite.spriteFrame=e},t.prototype.changeEquipment=function(e,t){switch(e.equipmetType){case"weapon":this.meleeWeapon.isStab=1==e.stab,this.meleeWeapon.isFar=1==e.far,1==e.stab?(this.weaponSprite.spriteFrame=null,this.weaponStabSprite.spriteFrame=t,this.weaponStabLightSprite.spriteFrame=this.meleeWeapon.isFar?l.default.spriteFrames.stablight:l.default.spriteFrames.stablight1):(this.weaponSprite.spriteFrame=t,this.weaponStabSprite.spriteFrame=null);var i=cc.color(255,255,255).fromHEX(this.inventoryManager.weapon.color);this.weaponSprite.node.color=i,this.weaponLightSprite.node.color=i,this.weaponStabSprite.node.color=i,this.weaponStabLightSprite.node.color=i;break;case"remote":this.shooter.data=e.clone(),this.shooter.changeRes(this.shooter.data.img);break;case"helmet":this.helmetSprite.spriteFrame=t,this.hairSprite.node.opacity=t?0:255;var o=cc.color(255,255,255).fromHEX(this.inventoryManager.helmet.color);this.helmetSprite.node.color=o;break;case"clothes":this.clothesSprite.spriteFrame=t;var a=cc.color(255,255,255).fromHEX(this.inventoryManager.clothes.color);this.clothesSprite.node.color=a;break;case"trousers":this.trousersSprite.spriteFrame=1==e.trouserslong?l.default.spriteFrames.idle002:l.default.spriteFrames.idle001;var n=cc.color(255,255,255).fromHEX(this.inventoryManager.trousers.color);this.trousersSprite.node.color=n;break;case"gloves":this.glovesLeftSprite.spriteFrame=t;var s=cc.color(255,255,255).fromHEX(this.inventoryManager.gloves.color);this.glovesLeftSprite.node.color=s,this.glovesRightSprite.spriteFrame=t;var r=cc.color(255,255,255).fromHEX(this.inventoryManager.gloves.color);this.glovesRightSprite.node.color=r;break;case"shoes":this.shoesLeftSprite.spriteFrame=t;var c=cc.color(255,255,255).fromHEX(this.inventoryManager.shoes.color);this.shoesLeftSprite.node.color=c,this.shoesRightSprite.spriteFrame=t;var h=cc.color(255,255,255).fromHEX(this.inventoryManager.shoes.color);this.shoesRightSprite.node.color=h;break;case"cloak":this.cloakSprite.spriteFrame=t;var p=cc.color(255,255,255).fromHEX(this.inventoryManager.cloak.color);this.cloakSprite.node.color=p}this.data.EquipmentTotalData.valueCopy(this.inventoryManager.getTotalEquipmentData()),this.playerInfoDialog.refreshDialog(this.data,this.data.EquipmentTotalData,this.data.StatusTotalData);var d=this.data.getHealth();this.healthBar&&this.healthBar.refreshHealth(d.x,d.y)},t.prototype.getCenterPosition=function(){return this.node.position.clone().addSelf(cc.v2(0,32*this.node.scaleY))},t.prototype.updatePlayerPos=function(){this.node.x=64*this.pos.x+32,this.node.y=64*this.pos.y+32},t.prototype.transportPlayer=function(e){this.sprite&&(this.sprite.rotation=0,this.sprite.scale=1,this.sprite.opacity=255,this.sprite.x=0,this.sprite.y=0,this.pos=e,this.changeZIndex(this.pos),this.updatePlayerPos())},t.prototype.changeZIndex=function(e){this.node.zIndex=3e3+100*(h.default.HEIGHT_SIZE-e.y)+2},t.prototype.addStatus=function(e){this.statusManager.addStatus(e)},t.prototype.meleeAttack=function(){var e=this;if(this.meleeWeapon&&!this.isAttacking){this.isAttacking=!0;var t=this.meleeWeapon.getHv().clone();t.equals(cc.Vec2.ZERO)&&(t=cc.v2(1,0)),(t=t.normalizeSelf().mul(15)).x=this.isFaceRight?t.x:-t.x;var i=f.default.DefAULT_SPEED-this.data.getAttackSpeed();i<1&&(i=1),i>10*f.default.DefAULT_SPEED&&(i=10*f.default.DefAULT_SPEED);var o=this.sprite.position.clone(),a=cc.sequence(cc.moveBy(.1,t.x,t.y),cc.moveBy(.1,-t.x,-t.y),cc.callFunc(function(){setTimeout(function(){e.sprite.position=o.clone(),e.isAttacking=!1},i)},this));this.sprite.runAction(a);var n=l.default.getRandomNum(0,100)<this.data.StatusTotalData.missRate;n&&this.showFloatFont(this.node.parent,0,!1,!0),this.meleeWeapon.attack(this.data,n)}},t.prototype.remoteAttack=function(){var e=!1,t=f.default.DefAULT_SPEED-this.data.getRemoteSpeed();t<10&&(t=10),t>10*r.default.DefAULT_SPEED&&(t=10*r.default.DefAULT_SPEED);var i=Date.now();i-this.remoteRate>t&&(this.remoteRate=i,e=!0),e&&this.shooter&&this.shooter.fireBullet(0)},t.prototype.rotatePlayer=function(e,t,i){!this.node||this.isDied||this.isFall||this.meleeWeapon&&!t.equals(cc.Vec2.ZERO)&&this.meleeWeapon.setHv(cc.v2(t.x,t.y))},t.prototype.move=function(e,t,i){if(!this.isDied&&!this.isFall){this.isAttacking&&!t.equals(cc.Vec2.ZERO)&&(t=t.mul(.5)),this.shooter&&!t.equals(cc.Vec2.ZERO)&&(this.shooter.setHv(cc.v2(t.x,t.y)),this.pos=h.default.getIndexInMap(this.node.position),l.default.playerData.pos=this.pos.clone()),this.meleeWeapon&&!t.equals(cc.Vec2.ZERO)&&this.meleeWeapon.setHv(cc.v2(t.x,t.y));var o=t.x,a=t.y,n=Math.abs(o),s=Math.abs(a),r=n>s?n:s;r=0==r?1:r;var c=cc.v2(o,a),p=this.data.getMoveSpeed();c=c.mul(p),this.rigidbody.linearVelocity=c,this.isMoving=0!=o||0!=a,this.isMoving&&(this.isFaceRight=o>0);var d="PlayerWalkShort",u="idle001";1==this.inventoryManager.trousers.trouserslong&&(d="PlayerWalk",u="idle002"),this.isMoving?this.anim.getAnimationState(d).isPlaying||this.anim.playAdditive(d):this.anim.getAnimationState(d).isPlaying&&(this.anim.play("PlayerIdle"),this.trousersSprite.spriteFrame=l.default.spriteFrames[u]),(1==e||0==e)&&this.changeZIndex(this.pos)}},t.prototype.start=function(){if(this.node){this.changeZIndex(this.pos);var e=this.data.getHealth();this.healthBar&&this.healthBar.refreshHealth(e.x,e.y)}},t.prototype.fall=function(){var e=this;this.isFall||(this.isFall=!0,this.anim.play("PlayerFall"),this.isAttacking=!1,setTimeout(function(){e.transportPlayer(e.defaultPos),e.anim.play("PlayerIdle");var t=new g.default;t.realDamage=1,e.takeDamage(t),e.isFall=!1},2e3))},t.prototype.takeDamage=function(e){if(this.healthBar){var t=this.data.getDamage(e),i=this.data.getDodge(),o=Math.random()<=i&&t.getTotalDamage()>0;t=o?new g.default:t;var a=this.data.getHealth();a.x-=t.getTotalDamage(),a.x>a.y&&(a.x=a.y),this.healthBar.refreshHealth(a.x,a.y),l.default.playerData.currentHealth=a.x,this.showFloatFont(this.node.parent,t.getTotalDamage(),o,!1),l.default.playerData.currentHealth<=0&&this.killed()}},t.prototype.showFloatFont=function(e,t,i,o){if(this.floatinglabelManager){var a=this.floatinglabelManager.getFloaingLabel(e);i?a.showDoge():o?a.showMiss():0!=t?a.showDamage(-t):a.hideLabel()}},t.prototype.killed=function(){this.isDied||(this.isDied=!0,this.anim.play("PlayerDie"),setTimeout(function(){l.default.profile.clearData(),cc.director.loadScene("gameover")},1e3))},t.prototype.playerAction=function(e,t,i,o){this.meleeWeapon&&!this.meleeWeapon.dungeon&&(this.meleeWeapon.dungeon=o),this.shooter&&!this.shooter.dungeon&&(this.shooter.dungeon=o),this.move(e,t,i)},t.prototype.isRecoveryTimeDelay=function(e){return this.recoveryTimeDelay+=e,this.recoveryTimeDelay>30&&(this.recoveryTimeDelay=0,!0)},t.prototype.isSmokeTimeDelay=function(e){return this.smokeTimeDelay+=e,this.smokeTimeDelay>.2&&(this.smokeTimeDelay=0,!0)},t.prototype.update=function(e){if(this.isRecoveryTimeDelay(e)){var t=this.data.getLifeRecovery();if(t>0){var i=new g.default;i.realDamage=-t,this.takeDamage(i)}}this.isSmokeTimeDelay(e)&&this.isMoving&&this.getWalkSmoke(this.node.parent,this.node.position),this.node.scaleX=this.isFaceRight?1:-1},t.prototype.UseItem=function(){this.touchedEquipment&&!this.touchedEquipment.isTaken&&(this.touchedEquipment.shopTable?l.default.coins>=this.touchedEquipment.shopTable.data.price&&(cc.director.emit(s.EventConstant.HUD_ADD_COIN,{detail:{count:-this.touchedEquipment.shopTable.data.price}}),this.touchedEquipment.taken(),this.touchedEquipment.shopTable.data.isSaled=!0,this.touchedEquipment=null):(this.touchedEquipment.taken(),this.touchedEquipment=null))},t.prototype.AttackFinish=function(){this.isAttacking=!1},t.prototype.onCollisionEnter=function(e,t){this.touchedEquipment=null},t.prototype.onCollisionExit=function(e,t){this.touchedEquipment=null},t.prototype.onCollisionStay=function(e,t){var i=e.node.getComponent(p.default);i&&(this.touchedEquipment=i)},__decorate([n(cc.Vec2)],t.prototype,"pos",void 0),__decorate([n(D.default)],t.prototype,"floatinglabelManager",void 0),__decorate([n(c.default)],t.prototype,"healthBar",void 0),__decorate([n(cc.Prefab)],t.prototype,"walksmoke",void 0),__decorate([n(cc.Node)],t.prototype,"meleeWeaponNode",void 0),__decorate([n(cc.Node)],t.prototype,"shooterNode",void 0),__decorate([n(m.default)],t.prototype,"statusManager",void 0),__decorate([n(y.default)],t.prototype,"playerInfoDialog",void 0),t=__decorate([a],t)}(cc.Component);i.default=v,cc._RF.pop()},{"./Data/DamageData":"DamageData","./Data/PlayerData":"PlayerData","./Dungeon":"Dungeon","./Equipment/Equipment":"Equipment","./EventConstant":"EventConstant","./HealthBar":"HealthBar","./Logic":"Logic","./Manager/FloatingLabelManager":"FloatingLabelManager","./Manager/StatusManager":"StatusManager","./MeleeWeapon":"MeleeWeapon","./Rect/RectDungeon":"RectDungeon","./Shooter":"Shooter","./UI/PlayerInfoDialog":"PlayerInfoDialog"}],Portal:[function(e,t,i){"use strict";cc._RF.push(t,"deb90P3hX5AB5svKZmVAO6Q","Portal"),Object.defineProperty(i,"__esModule",{value:!0});var o=e("../Dungeon"),a=e("../EventConstant"),n=e("../Player"),s=cc._decorator,r=s.ccclass,c=(s.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.isOpen=!1,t.pos=cc.v2(4,4),t}return __extends(t,e),t.prototype.start=function(){this.anim=this.getComponent(cc.Animation),this.anim.play("PortalCloseIdle")},t.prototype.setPos=function(e){this.pos=e,this.node.position=o.default.getPosInMap(e),this.node.zIndex=1e3+100*(o.default.HEIGHT_SIZE-e.y)+1},t.prototype.AnimGateClose=function(){this.anim.play("PortalCloseIdle")},t.prototype.AnimGateOpen=function(){this.anim.play("PortalOpenIdle")},t.prototype.openGate=function(){this.isOpen||(this.isOpen=!0,this.anim.play("PortalOpen"))},t.prototype.closeGate=function(){this.isOpen&&(this.isOpen=!1,this.anim.play("PortalClose"))},t.prototype.transportPlayer=function(e){e.x==this.pos.x&&e.y==this.pos.y&&this.isOpen},t.prototype.onBeginContact=function(e,t,i){i.body.node.getComponent(n.default)&&this.isOpen&&(this.closeGate(),cc.director.emit(a.EventConstant.LOADINGNEXTLEVEL))},t=__decorate([r],t)}(cc.Component));i.default=c,cc._RF.pop()},{"../Dungeon":"Dungeon","../EventConstant":"EventConstant","../Player":"Player"}],ProfileData:[function(e,t,i){"use strict";cc._RF.push(t,"6ba48LTPitPa5dUl/wXJcJ0","ProfileData"),Object.defineProperty(i,"__esModule",{value:!0});var o=e("./PlayerData"),a=e("../Manager/InventoryManager"),n=e("../Rect/RectDungeon"),s=e("./BoxData"),r=e("./ShopTableData"),c=function(){function e(){this.rectDungeon=new n.default(1),this.currentPos=cc.v2(0,0),this.boxes={},this.shopTables={},this.chapterName="chapter00",this.hasSaveData=!1,this.playerData=new o.default,this.inventoryManager=new a.default,this.ammo=30,this.level=1}return e.prototype.saveData=function(){console.log("save data")},e.prototype.clearData=function(){cc.sys.localStorage.setItem("profileData",""),this.playerData=new o.default,this.inventoryManager=new a.default,this.rectDungeon=new n.default(1),this.currentPos=cc.v2(0,0),this.boxes={},this.shopTables={},this.hasSaveData=!1,this.chapterName="chapter00",this.ammo=30,this.level=1,console.log("clear data")},e.prototype.getSaveData=function(){var e=cc.sys.localStorage.getItem("profileData");return e?JSON.parse(e):null},e.prototype.loadProfile=function(){var e=this.getSaveData();if(e)if(e.playerData&&e.inventoryManager&&e.rectDungeon&&e.currentPos&&e.shopTables&&e.boxes){this.hasSaveData=!0,this.playerData.valueCopy(e.playerData),this.chapterName=e.chapterName;for(var t=0;t<e.inventoryManager.list.length;t++)this.inventoryManager.list[t].valueCopy(e.inventoryManager.list[t]);for(var i in this.rectDungeon=this.rectDungeon.buildMapFromSave(e.rectDungeon),this.currentPos=e.currentPos?cc.v2(e.currentPos.x,e.currentPos.y):cc.v2(0,0),e.boxes){var o=e.boxes[i];this.boxes[i]=new Array;for(t=0;t<o.length;t++){var a=new s.default;a.valueCopy(o[t]),this.boxes[i][t]=a}}for(var i in e.shopTables){o=e.shopTables[i];this.shopTables[i]=new Array;for(t=0;t<o.length;t++){var n=new r.default;n.valueCopy(o[t]),this.shopTables[i][t]=n}}console.log("profileData",this)}else this.hasSaveData=!1;else this.hasSaveData=!1},e}();i.default=c,cc._RF.pop()},{"../Manager/InventoryManager":"InventoryManager","../Rect/RectDungeon":"RectDungeon","./BoxData":"BoxData","./PlayerData":"PlayerData","./ShopTableData":"ShopTableData"}],RectDoor:[function(e,t,i){"use strict";cc._RF.push(t,"d41e5HipSBBVLDWw2G1WR/C","RectDoor"),Object.defineProperty(i,"__esModule",{value:!0});var o=function(){return function(e,t,i){this.isLocked=!1,this.isDoor=!1,this.dir=e,this.isLocked=t,this.isDoor=i}}();i.default=o,cc._RF.pop()},{}],RectDungeon:[function(e,t,i){"use strict";cc._RF.push(t,"3b710jO571KQpPd9DCAmaJb","RectDungeon"),Object.defineProperty(i,"__esModule",{value:!0});var o=e("./RectRoom"),a=function(){function e(e){this.level=1,this.level=e,this.size=e+2,this.primaryRooms=new Array,this.secondaryRooms=new Array,this.buildMap()}return e.prototype.buildMapFromSave=function(t){this.level=t.level,this.size=t.size,this.map=new Array;for(var i=0;i<this.size;i++){this.map[i]=new Array;for(var a=0;a<this.size;a++)this.map[i][a]=new o.default(!0,0,i,a,e.EMPTY_ROOM).initFromSave(t.map[i][a])}for(i=0;i<t.primaryRooms.length;i++)this.primaryRooms[i]=t.primaryRooms[i];for(i=0;i<t.secondaryRooms.length;i++)this.secondaryRooms[i]=t.secondaryRooms[i];return this.startRoom=new o.default(!1,0,0,0,e.EMPTY_ROOM).initFromSave(t.startRoom),this.endRoom=new o.default(!1,0,0,0,e.EMPTY_ROOM).initFromSave(t.endRoom),this.merChantRoom=new o.default(!1,0,0,0,e.EMPTY_ROOM).initFromSave(t.merChantRoom),this.puzzleRoom=new o.default(!1,0,0,0,e.EMPTY_ROOM).initFromSave(t.puzzleRoom),this},e.prototype.buildMap=function(){this.map=new Array;for(var t=0;t<this.size;t++){this.map[t]=new Array;for(var i=0;i<this.size;i++)this.map[t][i]=null,(1==t||t==this.level)&&i>=1&&i<=this.level||(1==i||i==this.level)&&t>=1&&t<=this.level?this.map[t][i]=new o.default(!0,0,t,i,e.EMPTY_ROOM):this.map[t][i]=new o.default(!1,0,t,i,e.EMPTY_ROOM)}this.addPrimaryRooms(),this.addSecondaryRooms(),this.buildPrimaryRoomsType(),this.buildSecondaryRoomsType(),this.addLootKeys(),this.addDoors()},e.prototype.addPrimaryRooms=function(){for(var e=1,t=1;t<=this.level;t++){var i=1;this.map[t][i].isPrimary&&(this.map[t][i].index=e,this.primaryRooms.push(this.map[t][i]),e++)}for(i=2;i<=this.level;i++){t=this.level;this.map[t][i].isPrimary&&(this.map[t][i].index=e,this.primaryRooms.push(this.map[t][i]),e++)}for(t=this.level-1;t>0;t--){i=this.level;this.map[t][i].isPrimary&&(this.map[t][i].index=e,this.primaryRooms.push(this.map[t][i]),e++)}for(i=this.level-1;i>1;i--){t=1;this.map[t][i].isPrimary&&(this.map[t][i].index=e,this.primaryRooms.push(this.map[t][i]),e++)}},e.prototype.addSecondaryRooms=function(){for(var e=1,t=0;t<this.size;t++)for(var i=0;i<this.size;i++)this.isSecondaryRoom(t,i)&&(this.map[t][i].index=e++,this.secondaryRooms.push(this.map[t][i]))},e.prototype.isSecondaryRoom=function(e,t){return!this.isPrimaryRoom(e,t)&&!!(this.isPrimaryRoom(e+1,t)||this.isPrimaryRoom(e,t+1)||this.isPrimaryRoom(e-1,t)||this.isPrimaryRoom(e,t-1))},e.prototype.isPrimaryRoom=function(e,t){return!!(e<this.size-1&&e>0&&t<this.size-1&&t>0&&this.map[e][t].isPrimary)},e.prototype.buildPrimaryRoomsType=function(){for(var t=[e.TRAP_ROOM,e.DANGER_ROOM],i=0,o=this.primaryRooms;i<o.length;i++){var a=o[i],n=t[this.getRandomNum(0,t.length-1)];a.roomType=n}var s=this.getRandomNum(0,this.primaryRooms.length-1),r=s-1;r<0&&(r=this.primaryRooms.length-1),this.primaryRooms[r].roomType=e.END_ROOM,this.endRoom=this.primaryRooms[r],this.endRoom.lockAllDoors(!0),this.primaryRooms[s].roomType=e.START_ROOM,this.startRoom=this.primaryRooms[s],this.startRoom.lockAllDoors(!1),this.startRoom.isFound=!0},e.prototype.buildSecondaryRoomsType=function(){for(var t=[e.TRAP_ROOM,e.DANGER_ROOM],i=0,o=this.secondaryRooms;i<o.length;i++){var a=o[i],n=t[this.getRandomNum(0,t.length-1)];this.level==e.LEVEL_1?a.roomType=n:this.getHalfChance()&&(a.roomType=n)}var s=this.getRandomNum(0,this.secondaryRooms.length-1);this.level==e.LEVEL_1&&(this.secondaryRooms[s].roomType=e.END_ROOM,this.endRoom=this.secondaryRooms[s],this.endRoom.lockAllDoors(!1)),this.level==e.LEVEL_3&&(this.map[2][2].roomType=e.PUZZLE_ROOM),this.level==e.LEVEL_5&&(this.map[3][3].roomType=e.BOSS_ROOM,this.map[3][4].roomType==e.EMPTY_ROOM&&this.map[3][2].roomType==e.EMPTY_ROOM&&this.map[2][3].roomType==e.EMPTY_ROOM&&this.map[4][3].roomType==e.EMPTY_ROOM&&(this.map[3][4].roomType=this.getHalfChance()?e.DANGER_ROOM:e.TRAP_ROOM),this.addLootRoom()),this.addMerchantRoom(),this.addLootRoom(),this.addLootRoom()},e.prototype.addMerchantRoom=function(){var t=this.getRandomNum(0,this.secondaryRooms.length-1);this.secondaryRooms[t].roomType==e.TRAP_ROOM||this.secondaryRooms[t].roomType==e.DANGER_ROOM||this.secondaryRooms[t].roomType==e.EMPTY_ROOM?this.secondaryRooms[t].roomType=e.MERCHANT_ROOM:this.addMerchantRoom()},e.prototype.addLootRoom=function(){for(var t=0,i=new Array,o=0,a=this.secondaryRooms;o<a.length;o++){var n=a[o];n.roomType!=e.DANGER_ROOM&&n.roomType!=e.TRAP_ROOM&&n.roomType!=e.EMPTY_ROOM||i.push(n),n.roomType==e.LOOT_ROOM&&t++}if(i.length>1&&t<i.length+1){var s=this.getRandomNum(0,i.length-1);i[s].roomType=e.LOOT_ROOM,i[s].lockAllDoors(!0)}},e.prototype.addLootKeys=function(){for(var t=0,i=new Array,o=0,a=this.secondaryRooms;o<a.length;o++){var n=a[o];n.enemyCount!=e.DANGER_ROOM&&n.roomType!=e.TRAP_ROOM||i.push(n),n.roomType==e.LOOT_ROOM&&t++,n.roomType==e.MERCHANT_ROOM&&(n.hasKey=!0)}for(var s=0;s<t;s++)if(i.length>0){var r=this.getRandomNum(0,i.length-1);i[r].hasKey=!0,i.splice(r,1)}},e.prototype.addDoors=function(){for(var t=0;t<this.size;t++)for(var i=0;i<this.size;i++)this.map[t][i].roomType!=e.EMPTY_ROOM&&(this.changeDoor(t,i,o.default.TOPDOOR,!0),this.changeDoor(t,i,o.default.BOTTOMDOOR,!0),this.changeDoor(t,i,o.default.LEFTDOOR,!0),this.changeDoor(t,i,o.default.RIGHTDOOR,!0));for(t=0;t<this.size;t++)for(i=0;i<this.size;i++)this.map[t][i].roomType==e.EMPTY_ROOM&&(this.changeDoor(t,i,o.default.TOPDOOR,!1),this.changeDoor(t,i,o.default.BOTTOMDOOR,!1),this.changeDoor(t,i,o.default.LEFTDOOR,!1),this.changeDoor(t,i,o.default.RIGHTDOOR,!1))},e.prototype.changeDoor=function(e,t,i,a){switch(i){case o.default.TOPDOOR:this.map[e][t].doors[0].isDoor=a,t+1<this.size?this.map[e][t+1].doors[1].isDoor=a:this.map[e][t].doors[0].isDoor=!1;break;case o.default.BOTTOMDOOR:this.map[e][t].doors[1].isDoor=a,t-1>=0?this.map[e][t-1].doors[0].isDoor=a:this.map[e][t].doors[1].isDoor=!1;break;case o.default.LEFTDOOR:this.map[e][t].doors[2].isDoor=a,e-1>=0?this.map[e-1][t].doors[3].isDoor=a:this.map[e][t].doors[2].isDoor=!1;break;case o.default.RIGHTDOOR:this.map[e][t].doors[3].isDoor=a,e+1<this.size?this.map[e+1][t].doors[2].isDoor=a:this.map[e][t].doors[3].isDoor=!1}},e.prototype.getDisPlay=function(){for(var e="",t=this.size-1;t>=0;t--){for(var i=0;i<this.size;i++)e+=this.getTypeStringLog(this.map[i][t].roomType);e+="\n"}return e},e.prototype.getNeighborRoomType=function(e,t,i){var o=e,a=t;return-1==i?this.map[o][a]:(0==i&&(a+=1),1==i&&(a-=1),2==i&&(o-=1),3==i&&(o+=1),o>=this.size||o<0||a>=this.size||a<0||i<0||i>4?null:this.map[o][a])},e.prototype.changeRoomIsFound=function(t,i){t>=this.size||t<0||i>=this.size||i<0||this.map[t][i].roomType!=e.EMPTY_ROOM&&(this.map[t][i].isFound=!0)},e.isRoomEqual=function(e,t){return e.x==t.x&&e.y==t.y},e.getTypeString=function(t){return t!=e.EMPTY_ROOM?"Room":"RoomEmpty"},e.prototype.getTypeStringLog=function(t){switch(t){case e.EMPTY_ROOM:return"\u3000";case e.START_ROOM:return"\uff33";case e.END_ROOM:return"\uff25";case e.TRAP_ROOM:return"\uff34";case e.LOOT_ROOM:return"\uff2c";case e.DANGER_ROOM:return"\uff24";case e.PUZZLE_ROOM:return"\uff30";case e.MERCHANT_ROOM:return"\uff2d";case e.BOSS_ROOM:return"\uff22"}return"\u3000"},e.prototype.getRandomNum=function(e,t){return e+Math.round(Math.random()*(t-e))},e.prototype.getHalfChance=function(){return Math.random()>.5},e.LEVEL_1=1,e.LEVEL_2=2,e.LEVEL_3=3,e.LEVEL_4=4,e.LEVEL_5=5,e.PRIMARY=1e3,e.SECONDARY=2e3,e.EMPTY_ROOM=0,e.START_ROOM=1,e.END_ROOM=2,e.TRAP_ROOM=3,e.LOOT_ROOM=4,e.DANGER_ROOM=5,e.MERCHANT_ROOM=6,e.PUZZLE_ROOM=7,e.BOSS_ROOM=8,e}();i.default=a,cc._RF.pop()},{"./RectRoom":"RectRoom"}],RectRoom:[function(e,t,i){"use strict";cc._RF.push(t,"d55edjfV4pLuKPki2DqAONx","RectRoom"),Object.defineProperty(i,"__esModule",{value:!0});var o=e("./RectDoor"),a=e("../Logic"),n=e("../Dungeon"),s=function(){function e(t,i,o,a,n){this.isPrimary=!1,this.enemyCount=0,this.state=e.STATE_SLEEP,this.isFound=!1,this.isInit=!0,this.x=o,this.y=a,this.isPrimary=t,this.index=i,this.roomType=n,this.init()}return e.prototype.initFromSave=function(e){if(e)return this.x=e.x,this.y=e.y,this.isPrimary=e.isPrimary,this.index=e.index,this.roomType=e.roomType,this.isFound=e.isFound,this.isInit=e.isInit,this.doors=e.doors,this.state=e.state,this.hasKey=e.hasKey,this.enemyCount=e.enemyCount,this.map=e.map,this.hasKey=e.hasKey,this.randomTiles=e.randomTiles,this},e.prototype.init=function(){if(this.state=e.STATE_SLEEP,null==this.doors){this.doors=new Array(4);for(var t=0;t<4;t++)this.doors[t]=new o.default(t,!1,!1)}this.randomTiles=new Array;for(t=0;t<e.ROOM_WIDTH;t++){this.randomTiles=new Array(t);for(var i=0;i<e.ROOM_HEIGHT;i++)this.randomTiles.push(cc.v2(t,i))}},e.prototype.lockAllDoors=function(e){for(var t=0;t<4;t++)this.doors[t].isLocked=e},Object.defineProperty(e.prototype,"positionStr",{get:function(){return""+this.x+this.y},enumerable:!0,configurable:!0}),e.prototype.randomTile=function(){if(this.randomTiles.length>0){var e=a.default.getRandomNum(0,this.randomTiles.length-1),t=this.randomTiles[e];return this.randomTiles.splice(e,1),t}return null},e.STATE_SLEEP=0,e.STATE_ACTIVE=1,e.STATE_CLEAR=2,e.ROOM_WIDTH=n.default.WIDTH_SIZE,e.ROOM_HEIGHT=n.default.HEIGHT_SIZE,e.TOPDOOR=0,e.BOTTOMDOOR=1,e.LEFTDOOR=2,e.RIGHTDOOR=3,e}();i.default=s,cc._RF.pop()},{"../Dungeon":"Dungeon","../Logic":"Logic","./RectDoor":"RectDoor"}],Shooter:[function(e,t,i){"use strict";cc._RF.push(t,"f9805u1Wn9OeouYmQSWcHcq","Shooter"),Object.defineProperty(i,"__esModule",{value:!0});var o=e("./Item/Bullet"),a=e("./Logic"),n=e("./Data/EquipmentData"),s=e("./Data/BulletData"),r=cc._decorator,c=r.ccclass,l=r.property,h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.bullet=null,t.isAI=!1,t.dungeon=null,t.player=null,t.timeDelay=0,t.isAutoAim=!0,t.bulletName="",t.data=new n.default,t.hv=cc.v2(1,0),t.remoteRate=0,t}return __extends(t,e),t.prototype.onLoad=function(){var e=this;this.bulletPool=new cc.NodePool,this.sprite=this.node.getChildByName("sprite"),cc.director.on("destorybullet",function(t){e.destroyBullet(t.detail.bulletNode)})},t.prototype.changeRes=function(e,t){if(this.sprite||(this.sprite=this.node.getChildByName("sprite")),this.sprite){var i=this.getSpriteFrameByName(e,t);this.sprite.getComponent(cc.Sprite).spriteFrame=i,this.sprite.width=1.5*i.getRect().width,this.sprite.height=1.5*i.getRect().height,this.sprite.anchorX=.2,1==this.data.far&&(this.sprite.width=2*this.sprite.width,this.sprite.height=2*this.sprite.height,this.sprite.anchorX=.5)}},t.prototype.getSpriteFrameByName=function(e,t){var i=a.default.spriteFrames[e+t];return i||(i=a.default.spriteFrames[e]),i},t.prototype.setHv=function(e){var t=this.hasNearEnemy();t.equals(cc.Vec2.ZERO)?this.hv=e:(this.rotateColliderManager(cc.v2(this.node.position.x+t.x,this.node.position.y+t.y)),this.hv=t)},t.prototype.fireBullet=function(e,t){var i=this;if(this.sprite){this.sprite.stopAllActions(),this.sprite.position=cc.Vec2.ZERO,this.changeRes(this.data.img);var o=cc.sequence(cc.moveBy(.1,10,0),cc.callFunc(function(){i.changeRes(i.data.img,"anim")},this),cc.moveBy(.05,-5,0),cc.moveBy(.05,0,0),cc.callFunc(function(){i.changeRes(i.data.img)},this));this.sprite.runAction(o)}e||(e=0),this.fire(this.bullet,this.bulletPool,e)},t.prototype.fire=function(e,t,i){if(this.dungeon&&(this.isAI||!this.player||!(a.default.ammo<=0||"remote"!=this.player.inventoryManager.remote.equipmetType))){!this.isAI&&a.default.ammo>0&&a.default.ammo--;var n=null;t.size()>0&&(n=t.get()),n&&!n.active||(n=cc.instantiate(e)),n.parent=this.node;var r=this.node.convertToWorldSpace(cc.v2(30,0));r=this.dungeon.node.convertToNodeSpace(r),n.parent=this.dungeon.node,n.position=r,n.scale=1,n.active=!0;var c=n.getComponent(o.default);c.node.rotation=this.node.scaleX<0?-this.node.rotation:this.node.rotation,c.node.scaleY=this.node.scaleX>0?1:-1,c.node.zIndex=4e3,c.isFromPlayer=!this.isAI,c.isFromPlayer&&this.player&&(c.data.damage.physicalDamage=this.data.damageRemote);var l=new s.default;l.valueCopy(a.default.bullets[this.data.bulletType]),c.changeBullet(l),this.bulletName=c.name+l.resName,c.showBullet(this.hv.clone().rotateSelf(i*Math.PI/180))}},t.prototype.destroyBullet=function(e){e.active=!1;var t=e.getComponent(o.default);this.bulletPool&&t.name==this.bulletName&&this.bulletPool.put(e)},t.prototype.start=function(){},t.prototype.getRandomNum=function(e,t){return e+Math.round(Math.random()*(t-e))},t.prototype.update=function(e){var t=this.hasNearEnemy();if(t.equals(cc.Vec2.ZERO)){if(0!=this.hv.x||0!=this.hv.y){var i=cc.v2(this.node.position.x+this.hv.x,this.node.position.y+this.hv.y);this.rotateColliderManager(i)}}else this.rotateColliderManager(cc.v2(this.node.position.x+t.x,this.node.position.y+t.y)),this.hv=t},t.prototype.hasNearEnemy=function(){if(!this.isAutoAim)return cc.Vec2.ZERO;var e=1e3,t=cc.v2(0,0);if(this.isAI);else if(this.dungeon){for(var i=0,o=this.dungeon.monsters;i<o.length;i++){var n=o[i];if((c=a.default.getDistance(this.node.parent.position,n.node.position))<500&&c<e&&!n.isDied&&!n.isDisguising)e=c,(l=this.node.position.clone()).x=this.node.scaleX>0?l.x:-l.x,t=n.node.position.sub(this.node.parent.position.add(l))}if(t.equals(cc.Vec2.ZERO))for(var s=0,r=this.dungeon.bosses;s<r.length;s++){var c,l,h=r[s];if((c=a.default.getDistance(this.node.parent.position,h.node.position))<500&&c<e&&!h.isDied)e=c,(l=this.node.position.clone()).x=this.node.scaleX>0?l.x:-l.x,t=h.node.position.sub(this.node.parent.position.add(l))}1e3!=e&&(t=t.normalizeSelf())}return t},t.prototype.rotateColliderManager=function(e){var t=e.sub(this.node.position),i=360/(2*Math.PI),o=360-Math.atan2(t.x,t.y)*i;this.node.scaleX=this.node.parent.scaleX>0?1:-1,this.node.scaleY=this.node.parent.scaleX>0?1:-1,o+=90,this.node.rotation=-1==this.node.scaleX?o:-o},t.DefAULT_SPEED=300,__decorate([l(cc.Prefab)],t.prototype,"bullet",void 0),__decorate([l],t.prototype,"isAI",void 0),t=__decorate([c],t)}(cc.Component);i.default=h,cc._RF.pop()},{"./Data/BulletData":"BulletData","./Data/EquipmentData":"EquipmentData","./Item/Bullet":"Bullet","./Logic":"Logic"}],ShopTableData:[function(e,t,i){"use strict";cc._RF.push(t,"1f67aUHn09Nvaj7spLXjq++","ShopTableData"),Object.defineProperty(i,"__esModule",{value:!0});var o=e("./EquipmentData"),a=function(){function e(){this.price=60,this.isSaled=!1}return e.prototype.valueCopy=function(e){this.pos=e.pos?cc.v2(e.pos.x,e.pos.y):cc.v2(0,0),this.equipdata||(this.equipdata=new o.default),this.equipdata.valueCopy(e.equipdata),this.price=this.price,this.isSaled=e.isSaled},e}();i.default=a,cc._RF.pop()},{"./EquipmentData":"EquipmentData"}],ShopTable:[function(e,t,i){"use strict";cc._RF.push(t,"feb404aValPAJxRKh4uvHLm","ShopTable"),Object.defineProperty(i,"__esModule",{value:!0});var o=e("../Player"),a=e("../Dungeon"),n=e("../Manager/EquipmentManager"),s=e("../Logic"),r=e("../Data/ShopTableData"),c=cc._decorator,l=c.ccclass,h=(c.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.data=new r.default,t.timeDelay=0,t}return __extends(t,e),t.prototype.onLoad=function(){this.info=this.node.getChildByName("info"),this.label=this.info.getComponentInChildren(cc.Label)},t.prototype.start=function(){},t.prototype.showItem=function(){if(this.node.parent&&!this.data.isSaled){var e=this.node.parent.getComponent(a.default);e&&e.addEquipment(n.default.equipments[s.default.getRandomNum(0,n.default.equipments.length-1)],this.data.pos,this.data.equipdata,3,this)}},t.prototype.setPos=function(e){this.data.pos=e,this.node.position=a.default.getPosInMap(e),this.node.zIndex=3e3+100*(a.default.HEIGHT_SIZE-e.y)+1},t.prototype.update=function(e){if(this.timeDelay+=e,this.timeDelay>.2){this.label.string=""+this.data.price,this.info.opacity=this.data.isSaled?0:255;var t=s.default.getCurrentMapShopTables();if(t)for(var i=0,o=t;i<o.length;i++){var a=o[i];a.pos.equals(this.data.pos)&&(a.isSaled=this.data.isSaled,a.price=this.data.price)}}},t.prototype.onCollisionStay=function(e,t){e.node.getComponent(o.default)},t.prototype.onCollisionEnter=function(e,t){e.node.getComponent(o.default)},t.prototype.onCollisionExit=function(e,t){e.node.getComponent(o.default)},t=__decorate([l],t)}(cc.Component));i.default=h,cc._RF.pop()},{"../Data/ShopTableData":"ShopTableData","../Dungeon":"Dungeon","../Logic":"Logic","../Manager/EquipmentManager":"EquipmentManager","../Player":"Player"}],SlimeVenom:[function(e,t,i){"use strict";cc._RF.push(t,"a7fa4vRR+xDO6TrjB6jQViO","SlimeVenom"),Object.defineProperty(i,"__esModule",{value:!0});var o=e("../Logic"),a=e("../Data/DamageData"),n=e("../EventConstant"),s=cc._decorator,r=s.ccclass,c=(s.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.isHide=!1,t.isForever=!1,t.checkTimeDelay=0,t}return __extends(t,e),t.prototype.onLoad=function(){this.venom1=this.node.getChildByName("sprite").getChildByName("venom1"),this.venom2=this.node.getChildByName("sprite").getChildByName("venom2"),this.venom3=this.node.getChildByName("sprite").getChildByName("venom2"),this.anim=this.getComponent(cc.Animation),this.sprite=this.node.getChildByName("sprite")},t.prototype.onEnable=function(){var e=this;this.isHide=!1,this.sprite.opacity=255,this.venom1.rotation=o.default.getRandomNum(0,180),this.venom2.rotation=o.default.getRandomNum(0,180),this.venom2.rotation=o.default.getRandomNum(0,180),this.anim.play(),this.isForever||setTimeout(function(){e.anim&&(e.isHide=!0,e.anim.play("VenomHide"),setTimeout(function(){cc.director.emit("destoryvenom",{detail:{coinNode:e.node}})},1500))},3e3),this.damagePlayer()},t.prototype.start=function(){},t.prototype.getNearPlayerDistance=function(e){return o.default.getDistance(this.node.position,e.position)},t.prototype.isCheckTimeDelay=function(e){return this.checkTimeDelay+=e,this.checkTimeDelay>1&&(this.checkTimeDelay=0,!0)},t.prototype.update=function(e){this.isCheckTimeDelay(e)&&this.damagePlayer()},t.prototype.damagePlayer=function(){if(this.player&&this.getNearPlayerDistance(this.player.node)<60*this.node.scale&&this.node.active&&!this.isHide){var e=new a.default;e.toxicDamage=1,cc.director.emit(n.EventConstant.PLAYER_TAKEDAMAGE,{detail:{damage:e}})}},t=__decorate([r],t)}(cc.Component));i.default=c,cc._RF.pop()},{"../Data/DamageData":"DamageData","../EventConstant":"EventConstant","../Logic":"Logic"}],Slime:[function(e,t,i){"use strict";cc._RF.push(t,"263b6VIDCJP+LELMRjXCL3M","Slime"),Object.defineProperty(i,"__esModule",{value:!0});var o=e("./Boss"),a=e("../Player"),n=e("../EventConstant"),s=e("../Manager/EquipmentManager"),r=e("../Logic"),c=e("../Dungeon"),l=e("./SlimeVenom"),h=e("../Manager/MonsterManager"),p=cc._decorator,d=p.ccclass,u=p.property,m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.venom=null,t.healthBar=null,t.isJumping=!1,t.isFaceRight=!0,t.isMoving=!1,t.isAttacking=!1,t.timeDelay=0,t.isHurt=!1,t.isCrownFall=!1,t.isDashing=!1,t.currentlinearVelocitySpeed=cc.Vec2.ZERO,t.scaleSize=1,t.slimeType=0,t.venomTimeDelay=0,t.childSlimeTimeDelay=0,t}var i;return __extends(t,e),i=t,t.prototype.onLoad=function(){var e=this;this.isAttacking=!1,this.isDied=!1,this.anim=this.getComponent(cc.Animation),this.rigidbody=this.getComponent(cc.RigidBody),this.updatePlayerPos(),this.venomPool=new cc.NodePool,this.sprite=this.node.getChildByName("sprite"),this.crown=this.sprite.getChildByName("crown"),this.decorate=this.node.getChildByName("sprite").getChildByName("body").getChildByName("decorate"),this.dashlight=this.sprite.getChildByName("dashlight"),this.dashlight.opacity=0,cc.director.on("destoryvenom",function(t){e.destroyVenom(t.detail.coinNode)}),setTimeout(function(){e.isShow=!0},1e3)},t.prototype.start=function(){e.prototype.start.call(this),this.crown&&0!=this.slimeType&&(this.crown.opacity=0),this.decorate&&this.slimeType>2&&(this.decorate.opacity=0)},t.prototype.getVenom=function(e,t){if(!(this.scaleSize<1||this.isDied)){var i=null;this.venomPool.size()>0&&(i=this.venomPool.get()),i&&!i.active||(i=cc.instantiate(this.venom)),i.parent=e,i.position=t,i.scale=0==this.slimeType?1.5:1,i.getComponent(l.default).player=this.dungeon.player,i.zIndex=3e3,i.opacity=255,i.active=!0}},t.prototype.destroyVenom=function(e){e&&(e.active=!1,this.venomPool&&this.venomPool.put(e))},t.prototype.AnimAttacking=function(){this.isAttacking=!1;var e=64+50*this.scaleSize;this.getNearPlayerDistance(this.dungeon.player.node)<e&&this.dungeon.player.takeDamage(this.data.getAttackPoint())},t.prototype.onCollisionEnter=function(e,t){e.getComponent(a.default)&&this.isDashing&&this.dungeon&&!this.isHurt&&!this.isDied&&(this.isDashing=!1,this.rigidbody.linearVelocity=cc.Vec2.ZERO,this.dungeon.player.takeDamage(this.data.getAttackPoint()))},t.prototype.isVenomTimeDelay=function(e){return this.venomTimeDelay+=e,this.venomTimeDelay>.2&&(this.venomTimeDelay=0,!0)},t.prototype.isChildSlimeTimeDelay=function(e){return this.childSlimeTimeDelay+=e,this.childSlimeTimeDelay>5&&(this.childSlimeTimeDelay=0,!0)},t.prototype.update=function(e){(this.healthBar.node.active=!this.isDied,this.timeDelay+=e,this.timeDelay>.016&&(this.timeDelay=0,this.bossAction()),this.dashlight.opacity=0,this.dungeon&&this.isDashing&&(this.dashlight.opacity=128,this.rigidbody.linearVelocity=this.currentlinearVelocitySpeed.clone()),this.dungeon)&&(this.getNearPlayerDistance(this.dungeon.player.node)<64&&!this.isHurt&&(this.rigidbody.linearVelocity=cc.v2(0,0)));if(this.isDied&&(this.rigidbody.linearVelocity=cc.Vec2.ZERO),this.healthBar.node.active=!this.isDied,this.data.currentHealth<1&&this.killed(),this.node.scaleY=this.scaleSize,this.node.scaleX=this.isFaceRight?this.scaleSize:-this.scaleSize,this.isVenomTimeDelay(e)&&this.isMoving&&!this.isAttacking&&this.getVenom(this.node.parent,this.node.position),this.isChildSlimeTimeDelay(e)&&!this.isDied&&0==this.slimeType&&this.dungeon){for(var t=0,i=0,o=this.dungeon.monsters;i<o.length;i++){o[i].isDied||t++}if(t<10&&this.dungeon.monsters.length<50){var a=c.default.getIndexInMap(this.node.position.clone());this.dungeon.addMonsterFromData(h.default.MONSTER_SLIME,a.x,a.y)}}},t.prototype.takeDamage=function(e){var t=this;return!(this.isDied||!this.isShow)&&(this.data.currentHealth-=this.data.getDamage(e).getTotalDamage(),this.data.currentHealth>this.data.Common.maxHealth&&(this.data.currentHealth=this.data.Common.maxHealth),this.isHurt=!0,this.isDashing=!1,setTimeout(function(){t.node&&(t.isHurt=!1)},100),this.anim.play("SlimeHit"),this.isAttacking=!1,this.data.currentHealth<this.data.Common.maxHealth/2&&!this.isCrownFall&&0==this.slimeType&&(this.isCrownFall=!0,this.isShow=!1,setTimeout(function(){t.isShow=!0,t.crown.opacity=0},1e3),this.anim.play("SlimeCrownFall")),this.healthBar.refreshHealth(this.data.currentHealth,this.data.Common.maxHealth),!0)},t.prototype.killed=function(){var e=this;this.isDied||(this.isDied=!0,this.isDashing=!1,this.anim.play("SlimeDie"),this.getComponent(cc.PhysicsBoxCollider).sensor=!0,setTimeout(function(){e.node&&(e.node.active=!1)},5e3),this.dungeon&&(0==this.slimeType&&(cc.director.emit(n.EventConstant.DUNGEON_ADD_HEART,{detail:{pos:this.node.position}}),cc.director.emit(n.EventConstant.DUNGEON_ADD_AMMO,{detail:{pos:this.node.position}}),this.dungeon.addEquipment(s.default.equipments[r.default.getRandomNum(0,s.default.equipments.length-1)],this.pos,null,3)),this.slimeType<i.DIVIDE_COUNT&&(cc.director.emit(n.EventConstant.DUNGEON_ADD_COIN,{detail:{pos:this.node.position,count:5}}),cc.director.emit(n.EventConstant.BOSS_ADDSLIME,{detail:{posIndex:this.pos.clone(),slimeType:this.slimeType+1}}),cc.director.emit(n.EventConstant.BOSS_ADDSLIME,{detail:{posIndex:this.pos.clone(),slimeType:this.slimeType+1}}))))},t.prototype.bossAction=function(){var e=this;if(!this.isDied&&this.dungeon&&!this.isHurt){var t=cc.v2(0,0);t.x+=r.default.getRandomNum(0,2e3)-1e3,t.y+=r.default.getRandomNum(0,2e3)-1e3;var i=this.getNearPlayerDistance(this.dungeon.player.node);this.node.position=c.default.fixOuterMap(this.node.position),this.pos=c.default.getIndexInMap(this.node.position),this.changeZIndex();var o=t.clone();if(i<64+50*this.scaleSize&&!this.dungeon.player.isDied&&!this.isDashing&&this.isShow&&this.scaleSize>=1)(o=this.dungeon.player.getCenterPosition().sub(this.node.position)).equals(cc.Vec2.ZERO)||(o=o.normalizeSelf()),this.anim.getAnimationState("SlimeAttack").isPlaying||(this.isAttacking=!0,this.anim.play("SlimeAttack"));var a=300-50*this.scaleSize;i>128+35*this.scaleSize&&!this.dungeon.player.isDied&&!this.isDashing&&this.isShow&&r.default.getHalfChance()&&(r.default.getHalfChance()&&(o=this.dungeon.player.getCenterPosition().sub(this.node.position)),this.move(o,1.5*a),this.isDashing=!0,setTimeout(function(){e.node&&(e.isDashing=!1)},2e3)),r.default.getRandomNum(1,10)<3&&this.move(o,a)}},t.prototype.move=function(e,t){if(!(this.isDied||this.isHurt||this.isDashing||!this.isShow||this.isAttacking||e.equals(cc.Vec2.ZERO))){e=e.normalizeSelf(),this.isAttacking&&!e.equals(cc.Vec2.ZERO)&&(e=e.mul(.5)),e.equals(cc.Vec2.ZERO)||(this.pos=c.default.getIndexInMap(this.node.position));var i=e.x,o=e.y,a=(Math.abs(i),Math.abs(o),cc.v2(i,o));a=a.mul(t),this.rigidbody.linearVelocity=a.clone(),this.currentlinearVelocitySpeed=a.clone(),this.isMoving=0!=i||0!=o,this.isMoving&&(this.isFaceRight=i>0);var n=this.anim.getAnimationState("SlimeAttack").isPlaying;this.anim.getAnimationState("SlimeIdle").isPlaying||n||this.anim.play("SlimeIdle"),this.changeZIndex()}},t.DIVIDE_COUNT=4,__decorate([u(cc.Prefab)],t.prototype,"venom",void 0),t=i=__decorate([d],t)}(o.default);i.default=m,cc._RF.pop()},{"../Dungeon":"Dungeon","../EventConstant":"EventConstant","../Logic":"Logic","../Manager/EquipmentManager":"EquipmentManager","../Manager/MonsterManager":"MonsterManager","../Player":"Player","./Boss":"Boss","./SlimeVenom":"SlimeVenom"}],Start:[function(e,t,i){"use strict";cc._RF.push(t,"e1b90/rohdEk4SdmmEZANaD","Start"),Object.defineProperty(i,"__esModule",{value:!0});var o=e("./Logic"),a=e("./WxHelper"),n=cc._decorator,s=n.ccclass,r=n.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.continueButton=null,t.wxhelper=null,t}return __extends(t,e),t.prototype.start=function(){cc.view.enableAntiAlias(!1),this.continueButton&&(this.continueButton.active=o.default.profile.hasSaveData)},t.prototype.startGame=function(){this.wxhelper&&this.wxhelper.CloseDialog(),o.default.profile.clearData(),cc.director.loadScene("chapter")},t.prototype.continueGame=function(){this.wxhelper&&this.wxhelper.CloseDialog(),cc.director.loadScene("chapter")},__decorate([r(cc.Node)],t.prototype,"continueButton",void 0),__decorate([r(a.default)],t.prototype,"wxhelper",void 0),t=__decorate([s],t)}(cc.Component);i.default=c,cc._RF.pop()},{"./Logic":"Logic","./WxHelper":"WxHelper"}],StatusData:[function(e,t,i){"use strict";cc._RF.push(t,"e6cc1ffzwVEGqcTbp1oM4Mh","StatusData"),Object.defineProperty(i,"__esModule",{value:!0});var o=e("./CommonData"),a=function(){function e(){this.statusType=0,this.nameCn="",this.nameEn="",this.duration=0,this.desc="",this.spriteFrameName="",this.physicalDamageDirect=0,this.physicalDamageOvertime=0,this.missRate=0,this.realDamageDirect=0,this.realDamageOvertime=0,this.iceDamageDirect=0,this.iceDamageOvertime=0,this.fireDamageDirect=0,this.fireDamageOvertime=0,this.lighteningDamageDirect=0,this.lighteningDamageOvertime=0,this.toxicDamageDirect=0,this.toxicDamageOvertime=0,this.curseDamageDirect=0,this.curseDamageOvertime=0,this.common=new o.default}return Object.defineProperty(e.prototype,"Common",{get:function(){return this.common},enumerable:!0,configurable:!0}),e.prototype.valueCopy=function(e){this.common.valueCopy(e.common),this.nameCn=e.nameCn?e.nameCn:this.nameCn,this.nameEn=e.nameEn,this.statusType=e.statusType,this.duration=e.duration,this.spriteFrameName=e.spriteFrameName,this.desc=e.desc,this.physicalDamageDirect=e.physicalDamageDirect,this.physicalDamageOvertime=e.physicalDamageOvertime,this.missRate=e.missRate,this.realDamageDirect=e.realDamageDirect,this.realDamageOvertime=e.realDamageOvertime,this.iceDamageDirect=e.iceDamageDirect,this.iceDamageOvertime=e.iceDamageOvertime,this.fireDamageDirect=e.fireDamageDirect,this.fireDamageOvertime=e.fireDamageOvertime,this.lighteningDamageDirect=e.lighteningDamageDirect,this.lighteningDamageOvertime=e.lighteningDamageOvertime,this.toxicDamageDirect=e.toxicDamageDirect,this.toxicDamageOvertime=e.toxicDamageOvertime,this.curseDamageDirect=e.curseDamageDirect,this.curseDamageOvertime=e.curseDamageOvertime},e.prototype.clone=function(){var t=new e;return t.common=this.common.clone(),t.nameCn=this.nameCn,t.nameEn=this.nameEn,t.statusType=this.statusType,t.duration=this.duration,t.desc=this.desc,t.physicalDamageDirect=this.physicalDamageDirect,t.physicalDamageOvertime=this.physicalDamageOvertime,t.missRate=this.missRate,t.realDamageDirect=this.realDamageDirect,t.realDamageOvertime=this.realDamageDirect,t.iceDamageDirect=this.iceDamageDirect,t.iceDamageOvertime=this.iceDamageOvertime,t.fireDamageDirect=this.fireDamageDirect,t.fireDamageOvertime=this.fireDamageOvertime,t.lighteningDamageDirect=this.lighteningDamageDirect,t.lighteningDamageOvertime=this.lighteningDamageOvertime,t.toxicDamageDirect=this.toxicDamageDirect,t.toxicDamageOvertime=this.toxicDamageOvertime,t.curseDamageDirect=this.curseDamageDirect,t.curseDamageOvertime=this.curseDamageOvertime,t.spriteFrameName=this.spriteFrameName,t},e}();i.default=a,cc._RF.pop()},{"./CommonData":"CommonData"}],StatusManager:[function(e,t,i){"use strict";cc._RF.push(t,"70cfczADURLkqYmvLLsshT9","StatusManager"),Object.defineProperty(i,"__esModule",{value:!0});var o=e("../Status"),a=e("../Data/StatusData"),n=e("../Logic"),s=e("../EventConstant"),r=e("../Player"),c=e("../Monster"),l=cc._decorator,h=l.ccclass,p=l.property,d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.statusPrefab=null,t.timeDelay=0,t}return __extends(t,e),t.prototype.onLoad=function(){this.statusList=new Array},t.prototype.start=function(){},t.prototype.addStatus=function(e){var t=new a.default;t.valueCopy(n.default.debuffs[e]),this.showStatus(t)},t.prototype.showStatus=function(e){for(var t=this.statusList.length-1;t>=0;t--){(a=this.statusList[t])&&a.node&&a.isValid&&a.isStatusRunning()||this.statusList.splice(t,1)}var i=!1;for(t=this.statusList.length-1;t>=0;t--){var a;if((a=this.statusList[t])&&a.node&&a.isValid&&a.isStatusRunning()&&a.data.statusType==e.statusType){a.data.duration+=e.duration,i=!0;break}}if(!i){var n=cc.instantiate(this.statusPrefab);n.parent=this.node,n.active=!0;var s=n.getComponent(o.default);s.showStatus(this.node.parent,e),this.statusList.push(s)}},t.prototype.update=function(e){if(this.node.parent&&(this.node.scaleX=this.node.parent.scaleX>0?1:-1),this.isTimeDelay(e)){var t=this.node.parent.getComponent(c.default);this.node.parent&&this.node.parent.getComponent(r.default)?(n.default.playerData.StatusTotalData.valueCopy(this.updateStatus()),cc.director.emit(s.EventConstant.PLAYER_STATUSUPDATE)):this.node.parent&&t&&t.data.StatusTotalData.valueCopy(this.updateStatus())}},t.prototype.isTimeDelay=function(e){return this.timeDelay+=e,this.timeDelay>.2&&(this.timeDelay=0,!0)},t.prototype.updateStatus=function(){for(var e=new a.default,t=this.statusList.length-1;t>=0;t--){var i=this.statusList[t];i&&i.node&&i.isValid&&i.isStatusRunning()&&(e.missRate+=i.data.missRate?i.data.missRate:0,e.Common.damageMin+=i.data.Common.damageMin?i.data.Common.damageMin:0,e.Common.damageMax+=i.data.Common.damageMax?i.data.Common.damageMax:0,e.Common.defence+=i.data.Common.defence?i.data.Common.defence:0,e.Common.criticalStrikeRate*=i.data.Common.criticalStrikeRate?1-i.data.Common.criticalStrikeRate/100:1,e.Common.lifeDrain*=i.data.Common.lifeDrain?1-i.data.Common.lifeDrain/100:1,e.Common.lifeRecovery+=i.data.Common.lifeRecovery?i.data.Common.lifeRecovery:0,e.Common.moveSpeed+=i.data.Common.moveSpeed?i.data.Common.moveSpeed:0,e.Common.attackSpeed+=i.data.Common.attackSpeed?i.data.Common.attackSpeed:0,e.Common.dodge*=i.data.Common.dodge?1-i.data.Common.dodge/100:1,e.Common.maxHealth+=i.data.Common.maxHealth?i.data.Common.maxHealth:0,e.Common.realDamage+=i.data.Common.realDamage?i.data.Common.realDamage:0,e.Common.realRate+=i.data.Common.realRate?i.data.Common.realRate:0,e.Common.iceDamage+=i.data.Common.iceDamage?i.data.Common.iceDamage:0,e.Common.iceDefence+=i.data.Common.iceDefence?i.data.Common.iceDefence:0,e.Common.iceRate+=i.data.Common.iceRate?i.data.Common.iceRate:0,e.Common.fireDamage+=i.data.Common.fireDamage?i.data.Common.fireDamage:0,e.Common.fireDefence+=i.data.Common.fireDefence?i.data.Common.fireDefence:0,e.Common.fireRate+=i.data.Common.fireRate?i.data.Common.fireRate:0,e.Common.lighteningDamage+=i.data.Common.lighteningDamage?i.data.Common.lighteningDamage:0,e.Common.lighteningDefence+=i.data.Common.lighteningDefence?i.data.Common.lighteningDefence:0,e.Common.lighteningRate+=i.data.Common.lighteningRate?i.data.Common.lighteningRate:0,e.Common.toxicDamage+=i.data.Common.toxicDamage?i.data.Common.toxicDamage:0,e.Common.toxicDefence+=i.data.Common.toxicDefence?i.data.Common.toxicDefence:0,e.Common.toxicRate+=i.data.Common.toxicRate?i.data.Common.toxicRate:0,e.Common.curseDamage+=i.data.Common.curseDamage?i.data.Common.curseDamage:0,e.Common.curseDefence+=i.data.Common.curseDefence?i.data.Common.curseDefence:0,e.Common.curseRate+=i.data.Common.curseRate?i.data.Common.curseRate:0)}return e.Common.criticalStrikeRate*=100,e.Common.lifeDrain*=100,e.Common.dodge*=100,e},t.FROZEN="status001",t.BURNING="status002",t.DIZZ="status003",t.TOXICOSIS="status004",t.CURSING="status005",t.BLEEDING="status006",__decorate([p(cc.Prefab)],t.prototype,"statusPrefab",void 0),t=__decorate([h],t)}(cc.Component);i.default=d,cc._RF.pop()},{"../Data/StatusData":"StatusData","../EventConstant":"EventConstant","../Logic":"Logic","../Monster":"Monster","../Player":"Player","../Status":"Status"}],Status:[function(e,t,i){"use strict";cc._RF.push(t,"71809qjadJJZIMwM9M2G6cL","Status"),Object.defineProperty(i,"__esModule",{value:!0});var o=e("./Data/StatusData"),a=e("./Logic"),n=e("./Player"),s=e("./Data/DamageData"),r=e("./Monster"),c=e("./Boss/Boss"),l=cc._decorator,h=l.ccclass,p=(l.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.stateRunning=!1,t.sprite=null,t.data=new o.default,t.delayTime=0,t}return __extends(t,e),t.prototype.onLoad=function(){this.sprite=this.node.getChildByName("sprite").getComponent(cc.Sprite),this.label=this.node.getChildByName("sprite").getChildByName("label").getComponent(cc.Label),this.anim=this.getComponent(cc.Animation)},t.prototype.start=function(){},t.prototype.showStatus=function(e,t){this.anim&&(this.target=e,this.data=t,this.sprite.spriteFrame=a.default.spriteFrames[t.spriteFrameName],this.anim.playAdditive("StatusShow"),this.doStatusDamge(!0),this.stateRunning=!0)},t.prototype.stopStatus=function(){this.data.duration=0,this.stateRunning&&this.node.destroy()},t.prototype.isStatusRunning=function(){return this.data.duration>0||-1==this.data.duration},t.prototype.isTimeDelay=function(e){return this.delayTime+=e,this.delayTime>1&&(this.delayTime=0,!0)},t.prototype.doStatusDamge=function(e){if(this.target&&this.data){var t=e?this.getDamgeDirect():this.getDamgeOverTime(),i=this.target.getComponent(n.default);if(0!=t.getTotalDamage())if(i)i.takeDamage(t);else{var o=this.target.getComponent(r.default);if(o)o.takeDamage(t);else{var a=this.target.getComponent(c.default);a&&a.takeDamage(t)}}}},t.prototype.update=function(e){var t=this;this.label.string=""+this.data.duration,this.label.node.opacity=-1==this.data.duration?0:255,this.isTimeDelay(e)&&(this.data.duration>0&&(-1!=this.data.duration&&this.data.duration--,this.doStatusDamge(!1)),0==this.data.duration&&this.stateRunning&&(this.stateRunning=!1,this.anim.play("StatusHide"),setTimeout(function(){t.node&&t.node.destroy()},500)))},t.prototype.getDamgeDirect=function(){var e=new s.default;return e.realDamage=this.data.realDamageDirect?this.data.realDamageDirect:0,e.physicalDamage=this.data.physicalDamageDirect?this.data.physicalDamageDirect:0,e.iceDamage=this.data.iceDamageDirect?this.data.iceDamageDirect:0,e.fireDamage=this.data.fireDamageDirect?this.data.fireDamageDirect:0,e.lighteningDamage=this.data.lighteningDamageDirect?this.data.lighteningDamageDirect:0,e.toxicDamage=this.data.toxicDamageDirect?this.data.toxicDamageDirect:0,e.curseDamage=this.data.curseDamageDirect?this.data.curseDamageDirect:0,e},t.prototype.getDamgeOverTime=function(){var e=new s.default;return e.realDamage=this.data.realDamageOvertime?this.data.realDamageOvertime:0,e.physicalDamage=this.data.physicalDamageOvertime?this.data.physicalDamageOvertime:0,e.iceDamage=this.data.iceDamageOvertime?this.data.iceDamageOvertime:0,e.fireDamage=this.data.fireDamageOvertime?this.data.fireDamageOvertime:0,e.lighteningDamage=this.data.lighteningDamageOvertime?this.data.lighteningDamageOvertime:0,e.toxicDamage=this.data.toxicDamageOvertime?this.data.toxicDamageOvertime:0,e.curseDamage=this.data.curseDamageOvertime?this.data.curseDamageOvertime:0,e},t=__decorate([h],t)}(cc.Component));i.default=p,cc._RF.pop()},{"./Boss/Boss":"Boss","./Data/DamageData":"DamageData","./Data/StatusData":"StatusData","./Logic":"Logic","./Monster":"Monster","./Player":"Player"}],Tile:[function(e,t,i){"use strict";cc._RF.push(t,"f8047r9sJ5IqqTgIdjYi6dc","Tile"),Object.defineProperty(i,"__esModule",{value:!0});var o=e("./Logic"),a=cc._decorator,n=a.ccclass,s=a.property,r=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.label=null,t.isBroken=!1,t.isAutoShow=!0,t.timeDelay=0,t.isAnimPlaying=!1,t.isBreakingNow=!1,t}return __extends(t,e),t.prototype.onLoad=function(){this.isAutoShow=!0,this.anim=this.getComponent(cc.Animation),this.floor=this.node.getChildByName("sprite").getChildByName("floor").getComponent(cc.Sprite)},t.prototype.start=function(){switch(o.default.chapterName){case"chapter00":this.changeRes("tile000");break;case"chapter01":this.changeRes(this.getDeckRes());break;case"chapter02":this.changeRes(this.getDirtRes());break;case"chapter03":this.changeRes("tile003");break;case"chapter04":this.changeRes("tile004")}},t.prototype.getGrassRes=function(){var e="tile_grass001";switch(o.default.getRandomNum(0,2)){case 0:e="tile_grass001";break;case 1:e="tile_grass002";break;case 2:e="tile_grass003"}return e},t.prototype.getDirtRes=function(){var e="tile_dirt001";switch(o.default.getRandomNum(0,3)){case 0:e="tile_dirt001";break;case 1:e="tile_dirt002";break;case 2:e="tile_dirt003";break;case 3:e="tile_dirt004"}return e},t.prototype.getDeckRes=function(){var e="tile_deck001";switch(o.default.getRandomNum(0,3)){case 0:e="tile_deck001";break;case 1:e="tile_deck002";break;case 2:e="tile_deck003";break;case 3:e="tile_deck004"}return e},t.prototype.TileBreak=function(){},t.prototype.TileBreakFinish=function(){var e=this;this.isBroken=!0,this.isAnimPlaying=!1,this.isAutoShow&&setTimeout(function(){e.showTile()},2e3)},t.prototype.TileShow=function(){this.isAnimPlaying=!1},t.prototype.breakTile=function(){this.isAnimPlaying||(this.anim.play("TileBreak"),this.isBreakingNow=!0,this.isAnimPlaying=!0)},t.prototype.showTile=function(){!this.isAnimPlaying&&this.anim&&(this.anim.play("TileShow"),this.isBroken=!1,this.isBreakingNow=!1,this.isAnimPlaying=!0)},t.prototype.update=function(e){this.timeDelay+=e,this.timeDelay>1&&(this.timeDelay=0),this.label&&(this.label.string=""+this.node.zIndex)},t.prototype.changeRes=function(e){this.floor.spriteFrame=o.default.spriteFrames[e]},__decorate([s(cc.Label)],t.prototype,"label",void 0),t=__decorate([n],t)}(cc.Component);i.default=r,cc._RF.pop()},{"./Logic":"Logic"}],Trap:[function(e,t,i){"use strict";cc._RF.push(t,"67e3dv84GNOwbSynhs23bOv","Trap"),Object.defineProperty(i,"__esModule",{value:!0});var o=e("../Dungeon"),a=e("../EventConstant"),n=e("../Player"),s=e("../Data/DamageData"),r=cc._decorator,c=r.ccclass,l=r.property,h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.openSpriteFrame=null,t.closeSpriteFrame=null,t.isOpen=!1,t.pos=cc.v2(0,0),t.timeDelay=0,t.isPlayerIn=!1,t}return __extends(t,e),t.prototype.onLoad=function(){this.sprite=this.node.getChildByName("sprite")},t.prototype.start=function(){},t.prototype.setPos=function(e){this.pos=e,this.node.position=o.default.getPosInMap(e),this.node.zIndex=3e3+100*(o.default.HEIGHT_SIZE-e.y)+1},t.prototype.openTrap=function(){var e=this;this.isOpen||(this.isOpen=!0,this.sprite.getComponent(cc.Sprite).spriteFrame=this.openSpriteFrame,setTimeout(function(){e.closeSpriteFrame&&(e.sprite.getComponent(cc.Sprite).spriteFrame=e.closeSpriteFrame,e.isOpen=!1)},500))},t.prototype.onCollisionStay=function(e,t){3==e.tag&&this.isOpen&&this.isPlayerIn&&(this.isOpen=!1,cc.director.emit(a.EventConstant.PLAYER_TAKEDAMAGE,{detail:{damage:new s.default(1)}}))},t.prototype.onBeginContact=function(e,t,i){i.body.node.getComponent(n.default)&&(this.isPlayerIn=!0)},t.prototype.onEndContact=function(e,t,i){i.body.node.getComponent(n.default)&&(this.isPlayerIn=!1)},t.prototype.update=function(e){this.timeDelay+=e,this.timeDelay>2&&(this.openTrap(),this.timeDelay=0)},__decorate([l(cc.SpriteFrame)],t.prototype,"openSpriteFrame",void 0),__decorate([l(cc.SpriteFrame)],t.prototype,"closeSpriteFrame",void 0),t=__decorate([c],t)}(cc.Component);i.default=h,cc._RF.pop()},{"../Data/DamageData":"DamageData","../Dungeon":"Dungeon","../EventConstant":"EventConstant","../Player":"Player"}],WalkSmoke:[function(e,t,i){"use strict";cc._RF.push(t,"d3d56K96jBFs6t/GiwCmf8x","WalkSmoke"),Object.defineProperty(i,"__esModule",{value:!0});var o=cc._decorator,a=o.ccclass,n=(o.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.start=function(){var e=this;setTimeout(function(){cc.director.emit("destorysmoke",{detail:{coinNode:e.node}})},300)},t=__decorate([a],t)}(cc.Component));i.default=n,cc._RF.pop()},{}],Wall:[function(e,t,i){"use strict";cc._RF.push(t,"e7c06zRjp9J+piF+ZsFdjSH","Wall"),Object.defineProperty(i,"__esModule",{value:!0});var o=e("../Dungeon"),a=e("../Logic"),n=cc._decorator,s=n.ccclass,r=(n.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.half=!1,t}return __extends(t,e),t.prototype.onLoad=function(){this.wallsprite=this.node.getChildByName("sprite").getChildByName("wallsprite").getComponent(cc.Sprite)},t.prototype.changeRes=function(e){this.wallsprite.spriteFrame=a.default.spriteFrames[e]},t.prototype.setPos=function(e){this.pos=e,this.node.position=o.default.getPosInMap(e)},t.prototype.start=function(){switch(this.node.opacity=255,a.default.chapterName){case"chapter00":this.changeRes("wall000");break;case"chapter01":case"chapter02":case"chapter03":case"chapter04":this.changeRes("wall005")}},t.prototype.onCollisionEnter=function(e,t){this.node.opacity=255},t.prototype.onCollisionStay=function(e,t){3!=e.tag&&4!=e.tag||(this.node.opacity=128)},t.prototype.onCollisionExit=function(e,t){this.node.opacity=255},t=__decorate([s],t)}(cc.Component));i.default=r,cc._RF.pop()},{"../Dungeon":"Dungeon","../Logic":"Logic"}],WxHelper:[function(e,t,i){"use strict";cc._RF.push(t,"4e113prls5Op7r/tgtPErZz","WxHelper"),Object.defineProperty(i,"__esModule",{value:!0});var o=e("./Logic"),a=cc._decorator,n=a.ccclass,s=a.property,r=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.wx=window.wx,t.user=null,t.startButtonNode=null,t.rankList=null,t.rankListOpen=!1,t}return __extends(t,e),t.prototype.start=function(){if(this.rankList&&(this.CloseDialog(),this.rankList.node.active=this.rankListOpen),this.wx)if(this.startButtonNode){var e=cc.size(this.startButtonNode.width+10,this.startButtonNode.height+10),t=cc.view.getFrameSize(),i=cc.director.getWinSize(),o=(.5*i.width+this.startButtonNode.x-.5*e.width)/i.width*t.width,a=(.5*i.height-this.startButtonNode.y-.5*e.height)/i.height*t.height,n=e.width/i.width*t.width,s=e.height/i.height*t.height,r=this.wx.createUserInfoButton({type:"text",text:"getUserInfo",style:{left:o,top:a,width:n,height:s,lineHeight:0,backgroundColor:"",color:"#000000",textAlign:"center",fontSize:10,borderRadius:3}}),c=this,l=null;r.onTap(function(e){if(l)r.hide();else switch(e.errMsg){case"getUserInfo:ok":r.hide(),cc.sys.localStorage.setItem("hasUserInfo","1");var t=(l=e.userInfo).nickName,i=l.avatarUrl;c.setUserConfig(t,i),c.wx.getOpenDataContext().postMessage({message:"User info get success."});default:console.error(e.errMsg)}}),"1"==cc.sys.localStorage.getItem("hasUserInfo")&&r.hide()}else this.saveRankData()},t.prototype.setUserConfig=function(e,t){if(this.user){var i=this.user.getChildByName("mask").getComponentInChildren(cc.Sprite);this.user.getChildByName("userName").getComponent(cc.Label).string=e,cc.loader.load({url:t,type:"png"},function(e,t){e&&console.error(e),i.spriteFrame=new cc.SpriteFrame(t)})}},t.prototype.CloseDialog=function(){this.wx&&this.node&&this.rankList&&this.rankList.node&&(this.rankList.node.active=!1,this.wx.getOpenDataContext().postMessage({message:"close"}))},t.prototype.OpenDialog=function(){this.wx&&this.rankList&&(this.rankList.node.active=!0,this.saveRankData())},t.prototype.saveRankData=function(){if(this.wx){var e=this;e.wx.setUserCloudStorage({KVDataList:[{key:"score",value:o.default.coins+""}],success:function(t){console.log("score"+o.default.coins),console.log(t),e.wx.getOpenDataContext().postMessage({message:"updateMaxScore"})},fail:function(e){console.log("failed"+o.default.coins),console.log(e)}})}else console.log("wx is empty")},__decorate([s(cc.Node)],t.prototype,"user",void 0),__decorate([s(cc.Node)],t.prototype,"startButtonNode",void 0),__decorate([s(cc.WXSubContextView)],t.prototype,"rankList",void 0),__decorate([s],t.prototype,"rankListOpen",void 0),t=__decorate([n],t)}(cc.Component);i.default=r,cc._RF.pop()},{"./Logic":"Logic"}]},{},["AmmoCount","Boss","Captain","CaptainSword","Kraken","KrakenSwingHand","Slime","SlimeVenom","Box","Chest","DecorateRoom","Door","Emplacement","ExitDoor","FallStone","FootBoard","Portal","ShopTable","Trap","Wall","CameraControl","Chapter","CoinCount","Controller","BoxData","BulletData","CommonData","DamageData","DungeonStyleData","EquipmentData","EquipmentDescData","ItemData","MapData","MapManagerData","MonsterData","PlayerData","ProfileData","ShopTableData","StatusData","Dungeon","Equipment","EquipmentDialog","EventConstant","Game","GameFinish","GameOver","HealthBar","Inventory","Bullet","Coin","Item","JoyController","Joystick","KeyboardController","Loading","Logic","CoinManager","DungeonStyleManager","EquipmentManager","FloatingLabelManager","InventoryManager","MapManager","MonsterManager","StatusManager","MeleeWeapon","MeleeWeaponChild","MiniMap","Monster","OilLake","PerlinNoise2D","Player","RectDoor","RectDungeon","RectRoom","Shooter","Start","Status","Tile","FloatingLabel","PlayerInfoDialog","WalkSmoke","WxHelper"]);
window.__require=function t(e,i,o){function a(n,c){if(!i[n]){if(!e[n]){var r=n.split("/");if(r=r[r.length-1],!e[r]){var l="function"==typeof __require&&__require;if(!c&&l)return l(r,!0);if(s)return s(r,!0);throw new Error("Cannot find module '"+n+"'")}}var h=i[n]={exports:{}};e[n][0].call(h.exports,function(t){return a(e[n][1][t]||t)},h,h.exports,t,e,i,o)}return i[n].exports}for(var s="function"==typeof __require&&__require,n=0;n<o.length;n++)a(o[n]);return a}({AudioPlayer:[function(t,e,i){"use strict";cc._RF.push(e,"e5bd2TM901Exod7A4hZNEcf","AudioPlayer");var o=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),a=this&&this.__decorate||function(t,e,i,o){var a,s=arguments.length,n=s<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(n=(s<3?a(n):s>3?a(e,i,n):a(e,i))||n);return s>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(i,"__esModule",{value:!0});var s=t("../EventConstant"),n=t("./Random"),c=cc._decorator,r=c.ccclass,l=c.property,h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.boom=null,e.fall=null,e.falldown=null,e.skill001=null,e.over=null,e.bg01=null,e.bg02=null,e.bg03=null,e}var i;return o(e,t),i=e,e.prototype.onLoad=function(){var t=this;cc.director.on(s.EventConstant.PLAY_AUDIO,function(e){t.play(e.detail.name)})},e.prototype.playbg=function(){var t=n.default.getHalfChance()?this.bg01:this.bg03;cc.audioEngine.playMusic(t,!0)},e.prototype.play=function(t){switch(t){case i.FALL_TILE:cc.audioEngine.playEffect(this.fall,!1);break;case i.GAME_OVER:cc.audioEngine.playEffect(this.over,!1);break;case i.BOOM_TILE:cc.audioEngine.playEffect(this.boom,!1);break;case i.FALL_DOWN:cc.audioEngine.playEffect(this.falldown,!1);break;case i.SKILL_001:cc.audioEngine.playEffect(this.skill001,!1);break;case i.STOP_BG:cc.audioEngine.stopMusic();break;case i.PLAY_BG:this.playbg()}},e.prototype.start=function(){},e.PLAYER_UPGRADE="PLAYER_UPGRADE",e.GAME_OVER="GAME_OVER",e.FALL_TILE="FALL_TILE",e.FALL_DOWN="FALL_DOWN",e.BOOM_TILE="BOOM_TILE",e.STOP_BG="STOP_BG",e.PLAY_BG="PLAY_BG",e.SKILL_001="SKILL_001",a([l({type:cc.AudioClip})],e.prototype,"boom",void 0),a([l({type:cc.AudioClip})],e.prototype,"fall",void 0),a([l({type:cc.AudioClip})],e.prototype,"falldown",void 0),a([l({type:cc.AudioClip})],e.prototype,"skill001",void 0),a([l({type:cc.AudioClip})],e.prototype,"over",void 0),a([l({type:cc.AudioClip})],e.prototype,"bg01",void 0),a([l({type:cc.AudioClip})],e.prototype,"bg02",void 0),a([l({type:cc.AudioClip})],e.prototype,"bg03",void 0),e=i=a([r],e)}(cc.Component);i.default=h,cc._RF.pop()},{"../EventConstant":"EventConstant","./Random":"Random"}],BoomData:[function(t,e,i){"use strict";cc._RF.push(e,"811bds9q7RFeLHbGhrdC6X1","BoomData"),Object.defineProperty(i,"__esModule",{value:!0});var o=function(){return function(t,e,i,o,a,s){this.x=0,this.y=0,this.isCenter=!1,this.tileSpecial=0,this.isExtraBoom=!1,this.exElementMulti=0,this.x=t,this.y=e,this.isCenter=i,this.tileSpecial=o,this.isExtraBoom=a,this.exElementMulti=s}}();i.default=o,cc._RF.pop()},{}],BossData:[function(t,e,i){"use strict";cc._RF.push(e,"338f6FiDAdBJLkhE7CdENo3","BossData"),Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function t(t,e,i,o,a,s){this.id=0,this.resName="boss000",this.posIndex=cc.v2(0,0),this.width=1,this.height=1,this.health=cc.v2(10,10),this.id=t,this.posIndex=i,this.resName=e,this.width=o,this.height=a,this.health=s}return t.prototype.valueCopy=function(t){this.id=t.id,this.resName=t.resName,this.width=t.width,this.height=t.height,this.posIndex=cc.v2(t.posIndex.x,t.posIndex.y),this.health=cc.v2(t.health.x,t.health.y)},t.prototype.clone=function(){return new t(this.id,this.resName,this.posIndex.clone(),this.width,this.height,this.health.clone())},t}();i.default=o,cc._RF.pop()},{}],Boss:[function(t,e,i){"use strict";cc._RF.push(e,"fcba3bm9ctH4KosxR86+8lB","Boss");var o=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),a=this&&this.__decorate||function(t,e,i,o){var a,s=arguments.length,n=s<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(n=(s<3?a(n):s>3?a(e,i,n):a(e,i))||n);return s>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(i,"__esModule",{value:!0});var s=t("./data/BossData"),n=t("./Logic"),c=t("./GameWorld"),r=t("./EventConstant"),l=t("./utils/AudioPlayer"),h=t("./utils/Random"),p=t("./data/TileData"),u=cc._decorator,d=u.ccclass,f=(u.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isDied=!1,e.isHurt=!1,e}var i;return o(e,t),i=e,e.prototype.onLoad=function(){var t=this;cc.director.on(r.EventConstant.BOSS_HURT,function(e){t.takeDamge(e.detail.damage)})},e.prototype.start=function(){},e.prototype.onEnable=function(){var t=Math.floor(10*n.default.currentLevel);t<1&&(t=5),this.isHurt=!1,this.isDied=!1,this.data=new s.default(0,"boss000",cc.v2(4,1),3,3,cc.v2(t,t)),this.showBoss()},e.prototype.takeDamge=function(t){this.isDied||(this.isHurt=!0,this.anim||(this.anim=this.getComponent(cc.Animation)),this.anim.play("BossHurt"),this.data.health.x-=t,this.data.health.x<=0&&(this.isDied=!0,this.hideBoss(),this.clearBossTile(),this.enabled=!1),cc.director.emit(r.EventConstant.HUD_UPDATE_HEATH_BAR,{detail:{health:this.data.health}}))},e.prototype.hideBoss=function(){this.node.position=c.default.getPosInMap(cc.v2(this.data.posIndex.x,this.data.posIndex.y-8))},e.prototype.showAttackAnim=function(){this.anim||(this.anim=this.getComponent(cc.Animation)),this.anim.play("BossAttack")},e.prototype.showBoss=function(){var t=this;this.node.position=c.default.getPosInMap(this.data.posIndex),this.node.zIndex=3e3,this.changeRes(),this.scheduleOnce(function(){cc.director.emit(r.EventConstant.HUD_UPDATE_HEATH_BAR,{detail:{health:t.data.health}})},.1)},e.prototype.changeRes=function(){if(this.data){this.sprite||(this.sprite=this.node.getChildByName("sprite").getComponent(cc.Sprite));this.sprite.node.width=c.default.TILE_SIZE*this.data.width,this.sprite.node.height=c.default.TILE_SIZE*this.data.height,this.sprite.spriteFrame=n.default.spriteFrames[this.data.resName+""],this.sprite.node.opacity=200}},e.prototype.bossAction=function(){switch(this.data.resName){case i.BOSS000:case i.BOSS001:this.addObstacle()}},e.prototype.addObstacle=function(){if(!this.isDied&&this.enabled&&this.gameWorld){var t=0;if(n.default.currentLevel>2&&(t=1),n.default.currentLevel>4&&(t=2),cc.director.emit(r.EventConstant.PLAY_AUDIO,{detail:{name:l.default.FALL_TILE}}),this.isHurt)this.isHurt=!1;else{this.showAttackAnim();for(var e=new Array,i=0;i<this.gameWorld.map.length;i++)for(var o=0;o<this.gameWorld.map[0].length;o++)this.gameWorld.map[i][o].data.isBoss||this.gameWorld.map[i][o].data.isObstacle||this.gameWorld.map[i][o].data.isEmpty||e.push(cc.v2(i,o));if(e.length>0){var a=1+n.default.currentLevel;a>4&&(a=4);for(i=0;i<a;i++){var s=h.default.getRandomNum(0,e.length),c=e[s];e.length>1&&e.splice(s,1),this.gameWorld.map[c.x][c.y].initTile(p.default.getObstacleTileData(c.x,c.y,h.default.getRandomNum(0,t)))}}}}},e.prototype.clearBossTile=function(){for(var t=0;t<this.gameWorld.map.length;t++)for(var e=0;e<this.gameWorld.map[0].length;e++)this.gameWorld.map[t][e].data.isBoss&&(this.gameWorld.map[t][e].node.opacity=0,this.gameWorld.map[t][e].initTile(p.default.getEmptyTileData(t,e)))},e.BOSS000="boss000",e.BOSS001="boss001",e=i=a([d],e)}(cc.Component));i.default=f,cc._RF.pop()},{"./EventConstant":"EventConstant","./GameWorld":"GameWorld","./Logic":"Logic","./data/BossData":"BossData","./data/TileData":"TileData","./utils/AudioPlayer":"AudioPlayer","./utils/Random":"Random"}],CameraControl:[function(t,e,i){"use strict";cc._RF.push(e,"58a49NAKelDNoXaL6hYhEEU","CameraControl");var o=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),a=this&&this.__decorate||function(t,e,i,o){var a,s=arguments.length,n=s<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(n=(s<3?a(n):s>3?a(e,i,n):a(e,i))||n);return s>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(i,"__esModule",{value:!0});var s=t("./GameWorld"),n=t("./EventConstant"),c=t("./utils/Utils"),r=cc._decorator,l=r.ccclass,h=r.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.world=null,e.isZoomUp=!1,e}return o(e,t),e.prototype.onLoad=function(){var t=this;this.camera=this.getComponent(cc.Camera),cc.director.on(n.EventConstant.ZOOM_UP,function(e){t.isZoomUp=e.detail.isUp})},e.prototype.onEnable=function(){},e.prototype.onDisable=function(){},e.prototype.start=function(){},e.prototype.lateUpdate=function(){},e.prototype.zoomUp=function(){this.camera.zoomRatio=c.default.lerpnum(this.camera.zoomRatio,.5,.05)},e.prototype.zoomDown=function(){this.camera.zoomRatio=c.default.lerpnum(this.camera.zoomRatio,1,.05)},a([h(s.default)],e.prototype,"world",void 0),e=a([l],e)}(cc.Component);i.default=p,cc._RF.pop()},{"./EventConstant":"EventConstant","./GameWorld":"GameWorld","./utils/Utils":"Utils"}],Elements:[function(t,e,i){"use strict";cc._RF.push(e,"88f21MMYdlAkIksdZxrHJ/6","Elements"),Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function t(){this.redmax=20,this.bluemax=20,this.purplemax=20,this.greenmax=20,this.oilmax=50,this.red=0,this.blue=0,this.purple=0,this.green=0,this.oil=0,this.coin=0}return t.prototype.valueCopy=function(t){this.redmax=t.redmax?t.redmax:0,this.bluemax=t.bluemax?t.bluemax:0,this.purplemax=t.purplemax?t.purplemax:0,this.greenmax=t.greenmax?t.greenmax:0,this.oilmax=t.oilmax?t.oilmax:0,this.red=t.red?t.red:0,this.blue=t.blue?t.blue:0,this.purple=t.purple?t.purple:0,this.green=t.green?t.green:0,this.oil=t.oil?t.oil:0,this.coin=t.coin?t.coin:0},t.prototype.clone=function(){var e=new t;return e.redmax=this.redmax,e.bluemax=this.bluemax,e.purplemax=this.purplemax,e.greenmax=this.greenmax,e.oilmax=this.oilmax,e.red=this.red,e.blue=this.blue,e.purple=this.purple,e.green=this.green,e.oil=this.oil,e.coin=this.coin,e},t.prototype.getElementArr=function(){return[this.red,this.blue,this.purple,this.green,this.oil,this.coin]},t.prototype.getElementNumber=function(t,e,i){return t-i<0?cc.v2(t,0):(-1!=e&&t-i>e&&(t=e),cc.v2(t-i,1))},t.prototype.updateElements=function(t,e){var i=this.getElementNumber(this.red,this.redmax,t[0]),o=this.getElementNumber(this.blue,this.bluemax,t[1]),a=this.getElementNumber(this.purple,this.purplemax,t[2]),s=this.getElementNumber(this.green,this.greenmax,t[3]),n=this.getElementNumber(this.oil,this.oilmax,t[4]),c=this.getElementNumber(this.coin,-1,t[5]);return!(i.y<1||o.y<1||a.y<1||s.y<1||n.y<1||c.y<1)&&(e&&(this.red=i.x,this.blue=o.x,this.green=s.x,this.purple=a.x,this.oil=n.x,this.coin=c.x),!0)},t}();i.default=o,cc._RF.pop()},{}],EventConstant:[function(t,e,i){"use strict";cc._RF.push(e,"a5d82jAzBRME7BOwO7evcoZ","EventConstant");var o=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),a=this&&this.__decorate||function(t,e,i,o){var a,s=arguments.length,n=s<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(n=(s<3?a(n):s>3?a(e,i,n):a(e,i))||n);return s>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(i,"__esModule",{value:!0});var s=cc._decorator,n=s.ccclass,c=(s.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.PLAYER_MOVE="PLAYER_MOVE",e.TIME_CHANGE="TIME_CHANGE",e.ZOOM_UP="ZOOM_UP",e.PLAYER_LEVEL_UPDATE="PLAYER_LEVEL_UPDATE",e.GAME_FINISHED="GAME_FINISHED",e.GAME_OVER="GAME_OVER",e.GAME_START="GAME_START",e.PLAY_AUDIO="PLAY_AUDIO",e.INIT_MAP="INIT_MAP",e.TILE_SWITCH="TILE_SWITCH",e.USE_SKILL="USE_SKILL",e.BOSS_HURT="BOSS_HURT",e.HUD_UPDATE_HEATH_BAR="HUD_UPDATE_HEATH_BAR",e.eventHandler=new cc.Node,e=a([n],e)}(cc.Component));i.EventConstant=c,cc._RF.pop()},{}],FallRowData:[function(t,e,i){"use strict";cc._RF.push(e,"17253us4dtGPJEuEiquQxNH","FallRowData"),Object.defineProperty(i,"__esModule",{value:!0});var o=function(){return function(t,e){this.boomPos=t,this.boomRowLength=e}}();i.default=o,cc._RF.pop()},{}],GameHud:[function(t,e,i){"use strict";cc._RF.push(e,"45cdfJdh35JBrvRikv80DXP","GameHud");var o=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),a=this&&this.__decorate||function(t,e,i,o){var a,s=arguments.length,n=s<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(n=(s<3?a(n):s>3?a(e,i,n):a(e,i))||n);return s>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(i,"__esModule",{value:!0});var s=t("./Logic"),n=t("./EventConstant"),c=t("./utils/Utils"),r=t("./manager/SkillManager"),l=t("./SkillIcon"),h=t("./GameWorld"),p=cc._decorator,u=p.ccclass,d=p.property,f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.steplabel=null,e.levellabel=null,e.coinlabel=null,e.againDialog=null,e.homeDialog=null,e.dialogPlayer=null,e.skillPrefab=null,e.gameWorld=null,e.healthBar=null,e.healthLabel=null,e.redbar=null,e.bluebar=null,e.purplebar=null,e.greenbar=null,e.oilbar=null,e.redlabel=null,e.bluelabel=null,e.purplelabel=null,e.greenlabel=null,e.oillabel=null,e.skillNode=null,e.skillList=[],e.skillManager=new r.default,e.skillTipsNode=null,e.bossHealth=cc.v2(0,0),e.checkTimeDelay=0,e}return o(e,t),e.prototype.onLoad=function(){var t=this;for(var e in cc.director.on(n.EventConstant.GAME_OVER,function(e){t.gameOver(e.detail.over)}),cc.director.on(n.EventConstant.HUD_UPDATE_HEATH_BAR,function(e){t.bossHealth=cc.v2(e.detail.health.x,e.detail.health.y)}),this.healthBar=this.node.getChildByName("healthBar").getComponent(cc.ProgressBar),this.healthLabel=this.node.getChildByName("healthBar").getChildByName("label").getComponent(cc.Label),this.redbar=this.node.getChildByName("bar").getChildByName("redbar").getComponent(cc.ProgressBar),this.bluebar=this.node.getChildByName("bar").getChildByName("bluebar").getComponent(cc.ProgressBar),this.purplebar=this.node.getChildByName("bar").getChildByName("purplebar").getComponent(cc.ProgressBar),this.greenbar=this.node.getChildByName("bar").getChildByName("greenbar").getComponent(cc.ProgressBar),this.oilbar=this.node.getChildByName("bar").getChildByName("oilbar").getComponent(cc.ProgressBar),this.redlabel=this.node.getChildByName("bar").getChildByName("redbar").getChildByName("label").getComponent(cc.Label),this.bluelabel=this.node.getChildByName("bar").getChildByName("bluebar").getChildByName("label").getComponent(cc.Label),this.purplelabel=this.node.getChildByName("bar").getChildByName("purplebar").getChildByName("label").getComponent(cc.Label),this.greenlabel=this.node.getChildByName("bar").getChildByName("greenbar").getChildByName("label").getComponent(cc.Label),this.oillabel=this.node.getChildByName("bar").getChildByName("oilbar").getChildByName("label").getComponent(cc.Label),this.skillTipsNode=this.node.getChildByName("skillTips"),this.skillNode=this.node.getChildByName("skill"),this.skillNode.removeAllChildren(),this.skillManager.gameWorld=this.gameWorld,s.default.skills){var i=cc.instantiate(this.skillPrefab),o=i.getComponent(l.default);this.skillList.push(o),this.skillNode.addChild(i),o.data.valueCopy(s.default.skills[e]),o.init(this.skillManager,this.skillTipsNode)}},e.prototype.playAgain=function(){this.againDialog.active=!1,s.default.isPaused=!1,s.default.reset(),cc.director.emit(n.EventConstant.INIT_MAP)},e.prototype.goHome=function(){s.default.reset(),cc.director.loadScene("main")},e.prototype.cheat=function(){this.gameOver(!1)},e.prototype.gameOver=function(t){if(!t)return s.default.saveData(),s.default.reset(),void cc.director.loadScene("mine");this.dialogPlayer.spriteFrame=s.default.spriteFrames.player4,this.againDialog.active=!0,s.default.isPaused=!0},e.prototype.showHomeDialog=function(){this.homeDialog.active=!this.homeDialog.active},e.prototype.start=function(){},e.prototype.isCheckTimeDelay=function(t){return this.checkTimeDelay+=t,this.checkTimeDelay>.5&&(this.checkTimeDelay=0,!0)},e.prototype.update=function(t){this.steplabel.string=""+s.default.step,this.levellabel.string="\u6df1\u5ea6\uff1a"+(s.default.currentLevel*s.default.METRE_LENGTH+s.default.currentMeter)+"\u7c73",this.coinlabel.string="\uff1a"+s.default.coin,this.redlabel.string=s.default.elements.red+"/"+s.default.elements.redmax,this.bluelabel.string=s.default.elements.blue+"/"+s.default.elements.bluemax,this.purplelabel.string=s.default.elements.purple+"/"+s.default.elements.purplemax,this.greenlabel.string=s.default.elements.green+"/"+s.default.elements.greenmax,this.oillabel.string=s.default.elements.oil+"/"+s.default.elements.oilmax,this.redbar.progress=c.default.lerpnum(this.redbar.progress,s.default.elements.red/s.default.elements.redmax,5*t),this.bluebar.progress=c.default.lerpnum(this.bluebar.progress,s.default.elements.blue/s.default.elements.bluemax,5*t),this.purplebar.progress=c.default.lerpnum(this.purplebar.progress,s.default.elements.purple/s.default.elements.purplemax,5*t),this.greenbar.progress=c.default.lerpnum(this.greenbar.progress,s.default.elements.green/s.default.elements.greenmax,5*t),this.oilbar.progress=c.default.lerpnum(this.oilbar.progress,s.default.elements.oil/s.default.elements.oilmax,5*t),0!=this.bossHealth.y&&(this.healthBar.progress=c.default.lerpnum(this.healthBar.progress,this.bossHealth.x/this.bossHealth.y,5*t)),this.healthLabel.string=this.bossHealth.x+"/"+this.bossHealth.y,this.healthBar.node.opacity=this.bossHealth.x<=0?0:255},a([d(cc.Label)],e.prototype,"steplabel",void 0),a([d(cc.Label)],e.prototype,"levellabel",void 0),a([d(cc.Label)],e.prototype,"coinlabel",void 0),a([d(cc.Node)],e.prototype,"againDialog",void 0),a([d(cc.Node)],e.prototype,"homeDialog",void 0),a([d(cc.Sprite)],e.prototype,"dialogPlayer",void 0),a([d(cc.Prefab)],e.prototype,"skillPrefab",void 0),a([d(h.default)],e.prototype,"gameWorld",void 0),e=a([u],e)}(cc.Component);i.default=f,cc._RF.pop()},{"./EventConstant":"EventConstant","./GameWorld":"GameWorld","./Logic":"Logic","./SkillIcon":"SkillIcon","./manager/SkillManager":"SkillManager","./utils/Utils":"Utils"}],GameStart:[function(t,e,i){"use strict";cc._RF.push(e,"88009wMttRCU4cxCCZ3+ApL","GameStart");var o=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),a=this&&this.__decorate||function(t,e,i,o){var a,s=arguments.length,n=s<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(n=(s<3?a(n):s>3?a(e,i,n):a(e,i))||n);return s>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(i,"__esModule",{value:!0});var s=cc._decorator,n=s.ccclass,c=(s.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype.startGame=function(){cc.director.loadScene("main")},e=a([n],e)}(cc.Component));i.default=c,cc._RF.pop()},{}],GameWorld:[function(t,e,i){"use strict";cc._RF.push(e,"2d559jfMsxI8alkcM6ZnD10","GameWorld");var o=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),a=this&&this.__decorate||function(t,e,i,o){var a,s=arguments.length,n=s<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(n=(s<3?a(n):s>3?a(e,i,n):a(e,i))||n);return s>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(i,"__esModule",{value:!0});var s=t("./EventConstant"),n=t("./Logic"),c=t("./data/TileData"),r=t("./Tile"),l=t("./utils/AudioPlayer"),h=t("./data/BoomData"),p=t("./Boss"),u=t("./data/BossData"),d=t("./utils/Random"),f=t("./utils/MapHelper"),m=cc._decorator,y=m.ccclass,_=m.property,v=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.playerPrefab=null,e.tilePrefab=null,e.bossPrefab=null,e.timeDelay=0,e.checkTimeDelay=0,e.map=[],e.obstacleMap=[],e.canFall=!1,e.canFill=!1,e.isRandoming=!1,e.isTopDown=!1,e.isSkilling=!1,e.boomList=[],e.speed=.1,e}var i;return o(e,t),i=e,e.prototype.onLoad=function(){var t=this;cc.log(i.MAPX),cc.director.on(s.EventConstant.TILE_SWITCH,function(e){t.tileSwitched(e.detail.tapPos,e.detail.targetPos,!1)}),cc.director.on(s.EventConstant.INIT_MAP,function(e){t.initMap()}),this.actorLayer=this.node.getChildByName("actorlayer"),this.actorLayer.zIndex=2e3,this.initMap()},e.prototype.initMap=function(){this.boomList=[],this.actorLayer.removeAllChildren(),this.map=new Array;for(var t=0;t<i.WIDTH_SIZE;t++){this.map[t]=new Array;for(var e=0;e<i.HEIGHT_SIZE;e++){(o=cc.instantiate(this.tilePrefab).getComponent(r.default)).initTile(c.default.getRandomTileData(t,e)),e<i.OBSTACLE_HEIGHT&&(o.initTile(c.default.getObstacleTileData(t,e,d.default.getRandomNum(0,1))),t>2&&t<6&&n.default.needBoss()&&e<i.OBSTACLE_HEIGHT-1&&o.initTile(c.default.getBossTileData(t,e,1))),this.actorLayer.addChild(o.node),this.map[t][e]=o}}this.obstacleMap=new Array;for(t=0;t<i.WIDTH_SIZE;t++){this.obstacleMap[t]=new Array;for(e=0;e<i.OBSTACLE_HEIGHT;e++){var o;(o=cc.instantiate(this.tilePrefab).getComponent(r.default)).initTile(c.default.getObstacleTileData(t,e-i.OBSTACLE_HEIGHT,d.default.getRandomNum(0,1))),o.node.opacity=0,this.actorLayer.addChild(o.node),this.obstacleMap[t][e]=o}}this.initBoss(),this.updateBoss(),this.checkMapValid(),cc.log(this.showMap())},e.prototype.initBoss=function(){var t=cc.instantiate(this.bossPrefab);this.actorLayer.addChild(t),this.boss=t.getComponent(p.default),this.boss.gameWorld=this,this.boss.data=new u.default(0,"boss000",cc.v2(4,1),3,3,cc.v2(0,0)),this.boss.hideBoss(),this.boss.enabled=!1},e.prototype.updateBoss=function(){var t=this;if(!n.default.needBoss())return this.boss.hideBoss(),void(this.boss.enabled=!1);this.scheduleOnce(function(){t.boss.enabled=!0},.1)},e.prototype.checkMapValid=function(){for(var t=this.getBoomList([],[]),e=0;e<t.length;e++){var i=t[e];this.isPosObstacle(cc.v2(i.x,i.y))||this.map[i.x][i.y].initTile(c.default.getRandomTileData(i.x,i.y))}t.length>0?this.checkMapValid():this.checkMapCanBoom()||this.randomSortMap()},e.prototype.randomSortMap=function(t,e){var i=this;cc.log("randomSortMap"),this.isRandoming=!0;for(var o=new Array,a=new Array,s=0;s<this.map.length;s++)for(var n=0;n<this.map[0].length;n++)this.isObstacleOrEmptyType(this.map[s][n].data.tileType)||(o.push(cc.v2(s,n)),a.push(cc.v2(s,n)));a.sort(function(){return Math.random()-.5});for(s=0;s<o.length;s++){var c=o[s].clone(),r=a[s].clone();this.map[c.x][c.y].data.posIndex=r,this.map[r.x][r.y].data.posIndex=c;var l=this.map[c.x][c.y];this.map[c.x][c.y]=this.map[r.x][r.y],this.map[r.x][r.y]=l}if(this.getBoomList([],[]).length>0||!this.checkMapCanBoom())return e||(e=0),e++,cc.log(e),void(e<200&&this.randomSortMap(t,e));var h=0;for(s=0;s<o.length;s++){var p=o[s].clone();this.map[p.x][p.y].updateTilePosition(t,function(){++h==o.length&&(i.isRandoming=!1)})}},e.prototype.downMap=function(){var t=this;n.default.currentMeter+=4,n.default.step+=3;cc.director.emit(s.EventConstant.PLAY_AUDIO,{detail:{name:l.default.FALL_DOWN}}),this.isTopDown=!0;for(var e=0;e<this.map.length;e++)for(var o=0;o<this.map[0].length;o++)this.map[e][o].data.posIndex=cc.v2(e,o+i.OBSTACLE_HEIGHT),o>=i.HEIGHT_SIZE-i.OBSTACLE_HEIGHT?this.map[e][o].node.runAction(cc.fadeOut(.2)):this.map[e][o].node.runAction(cc.moveTo(.4,i.getPosInMap(this.map[e][o].data.posIndex)));for(e=0;e<this.obstacleMap.length;e++)for(o=0;o<this.obstacleMap[0].length;o++)this.obstacleMap[e][o].data.posIndex=cc.v2(e,o),this.obstacleMap[e][o].node.opacity=255,this.obstacleMap[e][o].node.runAction(cc.moveTo(.4,i.getPosInMap(this.obstacleMap[e][o].data.posIndex)));this.scheduleOnce(function(){for(var e=0;e<t.map.length;e++)for(var o=t.map[0].length-1;o-i.OBSTACLE_HEIGHT>-1;o--){var a=t.map[e][o];t.map[e][o]=t.map[e][o-i.OBSTACLE_HEIGHT],t.map[e][o-i.OBSTACLE_HEIGHT]=a}for(e=0;e<t.obstacleMap.length;e++)for(o=0;o<t.obstacleMap[0].length;o++){a=t.obstacleMap[e][o];t.obstacleMap[e][o]=t.map[e][o],t.map[e][o]=a,t.obstacleMap[e][o].initTile(c.default.getObstacleTileData(e,o-i.OBSTACLE_HEIGHT,d.default.getRandomNum(0,1))),e>2&&e<6&&n.default.needBoss()&&o<t.obstacleMap[0].length-1&&t.map[e][o].initTile(c.default.getBossTileData(e,o,1)),t.obstacleMap[e][o].node.opacity=0}t.updateBoss(),t.isTopDown=!1},.4*1.5)},e.prototype.checkMapCanBoom=function(){var t=this.getMapDataClone();return f.default.checkMapCanBoom(t)},e.prototype.checkPosHasThree=function(t,e){var i=t.x,o=t.y;return!!(this.isDataTypeEqual(cc.v2(i,o),cc.v2(i,o+1),e)&&this.isDataTypeEqual(cc.v2(i,o),cc.v2(i,o+2),e)||this.isDataTypeEqual(cc.v2(i,o),cc.v2(i,o-1),e)&&this.isDataTypeEqual(cc.v2(i,o),cc.v2(i,o-2),e)||this.isDataTypeEqual(cc.v2(i,o),cc.v2(i,o-1),e)&&this.isDataTypeEqual(cc.v2(i,o),cc.v2(i,o+1),e)||this.isDataTypeEqual(cc.v2(i,o),cc.v2(i+1,o),e)&&this.isDataTypeEqual(cc.v2(i,o),cc.v2(i+2,o),e)||this.isDataTypeEqual(cc.v2(i,o),cc.v2(i-1,o),e)&&this.isDataTypeEqual(cc.v2(i,o),cc.v2(i-2,o),e)||this.isDataTypeEqual(cc.v2(i,o),cc.v2(i+1,o),e)&&this.isDataTypeEqual(cc.v2(i,o),cc.v2(i-1,o),e))},e.prototype.checkMapHasTopObstacle=function(){for(var t=0;t<this.map.length;t++)for(var e=2;e<this.map[0].length;e++)if(c.default.isTypeObstacleOrBoss(this.map[t][e].data.tileType)||this.map[t][e].data.isBoss)return!0;return!1},e.prototype.getMapDataClone=function(){for(var t=new Array,e=0;e<this.map.length;e++){t[e]=new Array;for(var i=0;i<this.map[0].length;i++){var o=this.map[e][i].data.clone();t[e][i]=o}}return t},e.prototype.showMap=function(){for(var t="",e=0;e<this.map[0].length;e++){for(var i="",o=0;o<this.map.length;o++)i+=this.getTileTypeString(this.map[o][e].data.tileType)+",";t=i+"\n"+t}return t},e.prototype.getTileTypeString=function(t){switch(t){case c.default.RED:return"1";case c.default.BLUE:return"2";case c.default.PURPLE:return"3";case c.default.GREEN:return"4";case c.default.OIL:return"5";case c.default.COIN:return"6";case c.default.OBSTACLE:return"#";case c.default.BOSS:return"b";default:return"0"}},e.prototype.tileSwitched=function(t,e,o){if(this.map&&!(e.x>this.map.length-1||e.x<0||e.y>this.map[0].length-1||e.y<0||this.map[e.x][e.y].data.isObstacle||this.canFall||this.canFill||(n.default.isProcessing=!0,this.map[t.x][t.y].data.isEmpty||this.map[e.x][e.y].data.isEmpty))){this.switchTileData(t,e);var a=this.getBoomList([],[t,e]);this.boomList=a,a.length>0?(n.default.step--,this.map[t.x][t.y].node.runAction(cc.moveTo(this.speed,i.getPosInMap(cc.v2(t.x,t.y)))),this.map[e.x][e.y].node.runAction(cc.moveTo(this.speed,i.getPosInMap(cc.v2(e.x,e.y)))),this.boomTiles(a)):(this.switchTileData(t,e),this.map[t.x][t.y].node.runAction(cc.sequence(cc.moveTo(this.speed,i.getPosInMap(cc.v2(e.x,e.y))),cc.moveTo(this.speed,i.getPosInMap(cc.v2(t.x,t.y))))),this.map[e.x][e.y].node.runAction(cc.sequence(cc.moveTo(this.speed,i.getPosInMap(cc.v2(t.x,t.y))),cc.moveTo(this.speed,i.getPosInMap(cc.v2(e.x,e.y))))))}},e.prototype.boomTiles=function(t){var e=this,i=0;t.length>0&&cc.director.emit(s.EventConstant.PLAY_AUDIO,{detail:{name:l.default.BOOM_TILE}});for(var o=function(o){var s=t[o],l=1;switch(a.map[s.x][s.y].data.tileSpecial){case r.default.SPECIAL_NORMAL:break;case r.default.SPECIAL_VERTICAL:case r.default.SPECIAL_HORIZONTAL:l=4;break;case r.default.SPECIAL_CROSS:l=6;break;case r.default.SPECIAL_FIVE:l=10}s.exElementMulti>0&&(l+=s.exElementMulti*l),a.map[s.x][s.y].data.tileType==c.default.OIL?(n.default.elements.oil+=l,n.default.elements.oil>n.default.elements.oilmax&&(n.default.elements.oil=n.default.elements.oilmax)):a.map[s.x][s.y].data.tileType==c.default.COIN?n.default.coin+=l:a.map[s.x][s.y].data.tileType==c.default.RED?(n.default.elements.red+=l,n.default.elements.red>n.default.elements.redmax&&(n.default.elements.red=n.default.elements.redmax)):a.map[s.x][s.y].data.tileType==c.default.BLUE?(n.default.elements.blue+=l,n.default.elements.blue>n.default.elements.bluemax&&(n.default.elements.blue=n.default.elements.blue)):a.map[s.x][s.y].data.tileType==c.default.PURPLE?(n.default.elements.purple+=l,n.default.elements.purple>n.default.elements.purplemax&&(n.default.elements.purple=n.default.elements.purplemax)):a.map[s.x][s.y].data.tileType==c.default.GREEN&&(n.default.elements.green+=l,n.default.elements.green>n.default.elements.greenmax&&(n.default.elements.green=n.default.elements.greenmax)),a.map[s.x][s.y].node.runAction(cc.sequence(cc.callFunc(function(){s.isExtraBoom&&!e.isPosObstacle(cc.v2(s.x,s.y))&&e.map[s.x][s.y].showBoomEffect(),e.isPosObstacle(cc.v2(s.x,s.y))&&e.map[s.x][s.y].showBoomObstcleEffect()}),cc.delayTime(s.isExtraBoom?5*a.speed:0),cc.moveBy(.05,0,10),cc.moveBy(.05,0,-10),cc.moveBy(.05,0,10),cc.moveBy(.05,0,-10),cc.moveBy(.025,10,0),cc.moveBy(.025,-10,0),cc.moveBy(.025,10,0),cc.moveBy(.025,-10,0),cc.fadeOut(.05),cc.callFunc(function(){s.tileSpecial>0&&s.isCenter?(e.map[s.x][s.y].data.tileSpecial=s.tileSpecial,e.map[s.x][s.y].node.opacity=255,e.map[s.x][s.y].updateTile(),cc.log(s)):e.map[s.x][s.y].data.isBoss&&e.boss.enabled?e.boss.takeDamge(1):e.isPosObstacle(cc.v2(s.x,s.y))&&e.map[s.x][s.y].data.obstacleLevel>0?(e.map[s.x][s.y].node.opacity=255,e.map[s.x][s.y].data.obstacleLevel<999&&e.map[s.x][s.y].data.obstacleLevel--,e.map[s.x][s.y].updateTile()):(e.map[s.x][s.y].node.opacity=0,e.map[s.x][s.y].data=c.default.getEmptyTileData(s.x,s.y)),++i==t.length&&(e.canFall=!0)})))},a=this,h=0;h<t.length;h++)o(h)},e.prototype.fallTiles=function(){this.canFall=!1;var t=this.getFallList();t.length>0&&cc.director.emit(s.EventConstant.PLAY_AUDIO,{detail:{name:l.default.FALL_TILE}});for(var e=0;e<t.length;e++){var o=t[e];this.switchTileData(cc.v2(o.x,o.y),cc.v2(o.x,o.y-o.z)),e==t.length-1&&(this.canFill=!0),this.map[o.x][o.y-o.z].node.runAction(cc.sequence(cc.moveTo(this.speed*o.z,i.getPosInMap(cc.v2(o.x,o.y-o.z))).easing(cc.easeBackIn()),cc.callFunc(function(){})))}t.length<1&&(this.canFill=!0)},e.prototype.fillTiles=function(){var t=this;this.canFill=!1;for(var e=this.getEmptyList(),o=0,a=0;a<e.length;a++){var r=e[a];this.map[r.x][r.y].node.runAction(cc.sequence(cc.delayTime(this.speed*r.y/10),cc.moveTo(this.speed,i.getPosInMap(cc.v2(r.x,2*i.HEIGHT_SIZE))),cc.fadeIn(this.speed),cc.moveTo(this.speed*(1+r.y/2),i.getPosInMap(cc.v2(r.x,r.y))).easing(cc.easeBackIn()),cc.callFunc(function(){if(++o==e.length){var i=t.getBoomList([],[]);t.boomList=i,t.boomTiles(i),i.length<1&&(n.default.step<1?cc.director.emit(s.EventConstant.GAME_OVER,{detail:{over:!0}}):t.checkMapCanBoom()?t.checkMapHasTopObstacle()?(t.boss.bossAction(),t.checkMapCanBoom()||t.scheduleOnce(function(){t.randomSortMap(!0)},1)):n.default.currentMeter>n.default.METRE_LENGTH?cc.director.emit(s.EventConstant.GAME_OVER,{detail:{over:!1}}):t.downMap():t.scheduleOnce(function(){t.randomSortMap(!0)},1))}}))),this.map[r.x][r.y].initTile(c.default.getRandomTileData(r.x,r.y))}},e.prototype.switchTileData=function(t,e){var i=this.map[t.x][t.y],o=this.map[e.x][e.y],a=i.data.posIndex;i.data.posIndex=o.data.posIndex.clone(),o.data.posIndex=a.clone(),this.map[t.x][t.y]=o,this.map[e.x][e.y]=i},e.prototype.getBoomList=function(t,e){for(var i=new Array,o=new Array,a=new Array,s={},n=0;n<this.map.length;n++)for(var c=new Array,l=0,p=0;p<this.map[0].length;p++)this.isTypeEqual(cc.v2(n,p),cc.v2(n,l))||(o=this.getTempBoomList(o,c,!0,e),c=new Array,l=p),c.push(cc.v2(n,p)),p==this.map[0].length-1&&(o=this.getTempBoomList(o,c,!0,e));for(p=0;p<this.map[0].length;p++)for(c=new Array,l=0,n=0;n<this.map.length;n++)this.isTypeEqual(cc.v2(n,p),cc.v2(l,p))||(a=this.getTempBoomList(a,c,!1,e),c=new Array,l=n),c.push(cc.v2(n,p)),n==this.map.length-1&&(a=this.getTempBoomList(a,c,!1,e));for(var u=o.concat(a),d=0,f=u=u.concat(t);d<f.length;d++){var m=s["x="+(C=f[d]).x+"y="+C.y];m?m.tileSpecial!=r.default.SPECIAL_FIVE&&m.tileSpecial!=r.default.SPECIAL_CROSS&&(s["x="+C.x+"y="+C.y].tileSpecial=r.default.SPECIAL_CROSS,s["x="+C.x+"y="+C.y].isCenter=!0):s["x="+C.x+"y="+C.y]=C}for(var y in s){var _=s[y];i.push(_)}i=this.getExBoomList(i);var v=new Array;for(n=0;n<i.length;n++){var g=cc.v2(i[n].x,i[n].y),b=cc.v2(i[n].x+1,i[n].y),T=cc.v2(i[n].x-1,i[n].y),E=cc.v2(i[n].x,i[n].y+1),I=cc.v2(i[n].x,i[n].y-1);this.isPosObstacle(b)&&!this.isPosObstacle(g)&&v.push(new h.default(b.x,b.y,!1,0,i[n].isExtraBoom,0)),this.isPosObstacle(T)&&!this.isPosObstacle(g)&&v.push(new h.default(T.x,T.y,!1,0,i[n].isExtraBoom,0)),this.isPosObstacle(E)&&!this.isPosObstacle(g)&&v.push(new h.default(E.x,E.y,!1,0,i[n].isExtraBoom,0)),this.isPosObstacle(I)&&!this.isPosObstacle(g)&&v.push(new h.default(E.x,I.y,!1,0,i[n].isExtraBoom,0))}for(var L={},O=0,S=v;O<S.length;O++){var C;L["x="+(C=S[O]).x+"y="+C.y]=C}for(var y in L){_=L[y];i.push(_)}return i},e.prototype.getExBoomList=function(t){for(var e={},o=0,a=t;o<a.length;o++){e["x="+(c=a[o]).x+"y="+c.y]=c}var s=!1;for(var n in e){var c=e[n];if(this.map[c.x][c.y].data.tileSpecial==r.default.SPECIAL_VERTICAL)for(var l=0;l<this.map.length;l++)e["x="+l+"y="+c.y]||this.isPosObstacle(cc.v2(l,c.y))?e["x="+l+"y="+c.y]&&(e["x="+l+"y="+c.y].isExtraBoom=!0):(s=!0,e["x="+l+"y="+c.y]=new h.default(l,c.y,!1,this.map[l][c.y].data.tileSpecial,!0,0));if(this.map[c.x][c.y].data.tileSpecial==r.default.SPECIAL_HORIZONTAL)for(var p=0;p<this.map[0].length;p++)e["x="+c.x+"y="+p]||this.isPosObstacle(cc.v2(c.x,p))?e["x="+c.x+"y="+p]&&(e["x="+c.x+"y="+p].isExtraBoom=!0):(s=!0,e["x="+c.x+"y="+p]=new h.default(c.x,p,!1,this.map[c.x][p].data.tileSpecial,!0,0));if(this.map[c.x][c.y].data.tileSpecial==r.default.SPECIAL_CROSS){var u=[cc.v2(c.x-2,c.y),cc.v2(c.x-1,c.y),cc.v2(c.x+1,c.y),cc.v2(c.x+2,c.y),cc.v2(c.x,c.y-2),cc.v2(c.x,c.y-1),cc.v2(c.x,c.y+1),cc.v2(c.x,c.y+2),cc.v2(c.x+1,c.y+1),cc.v2(c.x+1,c.y-1),cc.v2(c.x-1,c.y+1),cc.v2(c.x-1,c.y+1)];for(l=0;l<u.length;l++)e["x="+u[l].x+"y="+u[l].y]||!i.isPosIndexValid(u[l])||this.isPosObstacle(u[l])?e["x="+u[l].x+"y="+u[l].y]&&(e["x="+u[l].x+"y="+u[l].y].isExtraBoom=!0):(s=!0,e["x="+u[l].x+"y="+u[l].y]=new h.default(u[l].x,u[l].y,!1,this.map[u[l].x][u[l].y].data.tileSpecial,!0,0))}if(this.map[c.x][c.y].data.tileSpecial==r.default.SPECIAL_FIVE)for(l=0;l<this.map.length;l++)for(p=0;p<this.map[0].length;p++)e["x="+l+"y="+p]||this.isPosObstacle(cc.v2(l,p))||!this.isTypeEqual(cc.v2(c.x,c.y),cc.v2(l,p))?e["x="+l+"y="+p]&&(e["x="+l+"y="+p].isExtraBoom=!0):(s=!0,e["x="+l+"y="+p]=new h.default(l,p,!1,this.map[l][p].data.tileSpecial,!0,0))}for(var n in t=[],e){var d=e[n];t.push(d)}return cc.log(t),s&&(t=this.getExBoomList(t)),t},e.prototype.getTempBoomList=function(t,e,i,o){var a=r.default.SPECIAL_NORMAL,s=!1;if(e.length>3&&(a=i?r.default.SPECIAL_VERTICAL:r.default.SPECIAL_HORIZONTAL),e.length>4&&(a=r.default.SPECIAL_FIVE),e.length>2)for(var n=0;n<e.length;n++){var c=!1,l=cc.v2(e[n].x,e[n].y);if(o)for(var p=0,u=o;p<u.length;p++){if(u[p].equals(l)){c=!0;break}}c||(c=n==Math.floor(e.length/2)),t.push(new h.default(e[n].x,e[n].y,c&&!s&&e.length>3,a,!1,0)),c&&(s=!0)}return t},e.prototype.setBoomMapData=function(t,e){return t["x="+e.x+"y="+e.y]?t["x="+e.x+"y="+e.y].z<=e.z&&(t["x="+e.x+"y="+e.x]=e.clone()):t["x="+e.x+"y="+e.y]=e.clone(),t},e.prototype.getFallList=function(){for(var t=new Array,e=0;e<this.map.length;e++)for(var i=0,o=0,a=!1,s=0;s<this.map[0].length;s++)this.map[e][s].data.isEmpty?(a&&(a=!1,o=0),o++):o>0&&(a||(i+=o),a=!0,t.push(cc.v3(e,s,i)));return t},e.prototype.getEmptyList=function(){for(var t=new Array,e=0;e<this.map.length;e++)for(var i=0;i<this.map[0].length;i++)this.map[e][i].data.isEmpty&&t.push(cc.v2(e,i));return t},e.prototype.findBoomTile=function(t,e,i,o){var a=e,s=i;switch(o){case 0:s=i+1;break;case 1:s=i-1;break;case 2:a=e-1;break;case 3:a=e+1}return this.isTypeEqual(cc.v2(e,i),cc.v2(a,s))?(t.push(cc.v3(a,s,0)),this.findBoomTile(t,a,s,o)):t},e.prototype.isTypeEqual=function(t,e){return!!i.isPosIndexValid(t)&&(!!i.isPosIndexValid(e)&&(!this.isObstacleOrEmptyType(this.map[t.x][t.y].data.tileType)&&!this.isObstacleOrEmptyType(this.map[e.x][e.y].data.tileType)&&this.map[t.x][t.y].data.tileType==this.map[e.x][e.y].data.tileType))},e.prototype.isDataTypeEqual=function(t,e,o){return!!i.isPosIndexValid(t)&&(!!i.isPosIndexValid(e)&&(!this.isObstacleOrEmptyType(o[t.x][t.y].tileType)&&!this.isObstacleOrEmptyType(o[e.x][e.y].tileType)&&o[t.x][t.y].tileType==o[e.x][e.y].tileType))},e.prototype.isObstacleOrEmptyType=function(t){return!(t!=c.default.EMPTY&&!c.default.isTypeObstacleOrBoss(t))},e.prototype.isPosObstacle=function(t){return!(!i.isPosIndexValid(t)||!c.default.isTypeObstacleOrBoss(this.map[t.x][t.y].data.tileType))},e.prototype.isTimeDelay=function(t){return this.timeDelay+=t,this.timeDelay>.016&&(this.timeDelay=0,!0)},e.prototype.isCheckTimeDelay=function(t){return this.checkTimeDelay+=t,this.checkTimeDelay>1&&(this.checkTimeDelay=0,!0)},e.prototype.update=function(t){this.isTimeDelay(t)&&(this.canFall&&this.fallTiles(),this.canFill&&this.fillTiles(),n.default.isProcessing=this.boomList.length>0||this.isRandoming||this.isTopDown)},e.isPosIndexValid=function(t){return t.x<i.WIDTH_SIZE&&t.x>-1&&t.y<i.HEIGHT_SIZE&&t.y>-1},e.getPosInMap=function(t){var e=i.MAPX+t.x*i.TILE_SIZE+i.TILE_SIZE/2,o=i.MAPY+t.y*i.TILE_SIZE-i.TILE_SIZE;return cc.v2(e,o)},e.getIndexInMap=function(t,e){var o=(t.x-i.MAPX)/i.TILE_SIZE,a=(t.y-i.MAPY)/i.TILE_SIZE;return o=Math.round(o),a=Math.round(a),e||(o<0&&(o=0),o>=i.WIDTH_SIZE&&(o=i.WIDTH_SIZE-1),a<0&&(a=0),a>=i.HEIGHT_SIZE&&(a=i.HEIGHT_SIZE-1)),cc.v2(o,a)},e.fixOuterMap=function(t){var e=(t.x-i.MAPX)/i.TILE_SIZE,o=(t.y-i.MAPY)/i.TILE_SIZE;e=Math.round(e),o=Math.round(o);var a=!1;return e<0&&(e=0,a=!0),e>=i.WIDTH_SIZE&&(e=i.WIDTH_SIZE-1,a=!0),o<0&&(o=0,a=!0),o>=i.HEIGHT_SIZE&&(o=i.HEIGHT_SIZE-1,a=!0),a?i.getPosInMap(cc.v2(e,o)):t},e.BOTTOM_LINE_INDEX=3,e.TILE_SIZE=64,e.WIDTH_SIZE=9,e.HEIGHT_SIZE=9,e.MAPX=-i.WIDTH_SIZE*i.TILE_SIZE/2,e.MAPY=128,e.OBSTACLE_HEIGHT=4,a([_(cc.Prefab)],e.prototype,"playerPrefab",void 0),a([_(cc.Prefab)],e.prototype,"tilePrefab",void 0),a([_(cc.Prefab)],e.prototype,"bossPrefab",void 0),e=i=a([y],e)}(cc.Component);i.default=v,cc._RF.pop()},{"./Boss":"Boss","./EventConstant":"EventConstant","./Logic":"Logic","./Tile":"Tile","./data/BoomData":"BoomData","./data/BossData":"BossData","./data/TileData":"TileData","./utils/AudioPlayer":"AudioPlayer","./utils/MapHelper":"MapHelper","./utils/Random":"Random"}],KeyboardController:[function(t,e,i){"use strict";cc._RF.push(e,"890117p2tpMNYXd5PtS5Hgr","KeyboardController");var o=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),a=this&&this.__decorate||function(t,e,i,o){var a,s=arguments.length,n=s<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(n=(s<3?a(n):s>3?a(e,i,n):a(e,i))||n);return s>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(i,"__esModule",{value:!0});var s=t("./EventConstant"),n=t("./Logic"),c=cc._decorator,r=c.ccclass,l=(c.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.stopCount=0,e.isUp=!1,e.isDown=!1,e.isLeft=!1,e.isRight=!1,e.isA=!1,e.isB=!1,e.isC=!1,e.isD=!1,e.timeDelay=0,e}return o(e,t),e.prototype.onLoad=function(){cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this)},e.prototype.start=function(){},e.prototype.onKeyDown=function(t){switch(t.keyCode){case cc.macro.KEY.w:this.isUp=!0;break;case cc.macro.KEY.s:this.isDown=!0;break;case cc.macro.KEY.a:this.isLeft=!0;break;case cc.macro.KEY.d:this.isRight=!0;break;case cc.macro.KEY.j:this.isA=!0;break;case cc.macro.KEY.k:this.isB=!0;break;case cc.macro.KEY.i:this.isC=!0;break;case cc.macro.KEY.l:this.isD=!0}},e.prototype.onKeyUp=function(t){switch(t.keyCode){case cc.macro.KEY.w:this.isUp=!1;break;case cc.macro.KEY.s:this.isDown=!1;break;case cc.macro.KEY.a:this.isLeft=!1;break;case cc.macro.KEY.d:this.isRight=!1;break;case cc.macro.KEY.j:this.isA=!1;break;case cc.macro.KEY.k:this.isB=!1;break;case cc.macro.KEY.i:this.isC=!1;break;case cc.macro.KEY.l:this.isD=!1}},e.prototype.update=function(t){this.isTimeDelay(t)&&this.sendMoveMessageToPlayer(t)},e.prototype.sendMoveMessageToPlayer=function(t){var e=cc.v2(0,0);this.isUp&&e.addSelf(cc.v2(0,.9)),this.isDown&&e.addSelf(cc.v2(0,-.9)),this.isLeft&&e.addSelf(cc.v2(-.9,0)),this.isRight&&e.addSelf(cc.v2(.9,0)),e.mag()>0&&e.normalizeSelf();var i=4;Math.abs(e.x)<Math.abs(e.y)&&(e.y>.3&&(i=0),e.y<-.3&&(i=1)),Math.abs(e.x)>Math.abs(e.y)&&(e.x<-.3&&(i=2),e.x>.3&&(i=3)),e.equals(cc.Vec2.ZERO)?this.stopCount++:this.stopCount=0,this.stopCount<2&&cc.director.emit(s.EventConstant.PLAYER_MOVE,{detail:{dir:i,pos:e,dt:t}}),this.isA&&n.default.isPaused&&cc.director.emit(s.EventConstant.GAME_START),this.isB,this.isC,this.isD},e.prototype.isTimeDelay=function(t){return this.timeDelay+=t,this.timeDelay>.016&&(this.timeDelay=0,!0)},e=a([r],e)}(cc.Component));i.default=l,cc._RF.pop()},{"./EventConstant":"EventConstant","./Logic":"Logic"}],ListItem:[function(t,e,i){"use strict";cc._RF.push(e,"69b00937upLzJHgYDLVFet1","ListItem");var o=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),a=this&&this.__decorate||function(t,e,i,o){var a,s=arguments.length,n=s<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(n=(s<3?a(n):s>3?a(e,i,n):a(e,i))||n);return s>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(i,"__esModule",{value:!0});var s,n=cc._decorator,c=n.ccclass,r=n.property,l=n.disallowMultiple,h=n.menu,p=n.executionOrder;(function(t){t[t.NONE=0]="NONE",t[t.TOGGLE=1]="TOGGLE",t[t.SWITCH=2]="SWITCH"})(s||(s={}));var u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.icon=null,e.title=null,e.selectedMode=s.NONE,e.selectedFlag=null,e.selectedSpriteFrame=null,e._unselectedSpriteFrame=null,e._selected=!1,e._eventReg=!1,e}return o(e,t),Object.defineProperty(e.prototype,"selected",{get:function(){return this._selected},set:function(t){if(this._selected=t,this.selectedFlag)switch(this.selectedMode){case s.TOGGLE:this.selectedFlag.active=t;break;case s.SWITCH:var e=this.selectedFlag.getComponent(cc.Sprite);e&&(e.spriteFrame=t?this.selectedSpriteFrame:this._unselectedSpriteFrame)}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"btnCom",{get:function(){return this._btnCom||(this._btnCom=this.node.getComponent(cc.Button)),this._btnCom},enumerable:!0,configurable:!0}),e.prototype.onLoad=function(){if(this.btnCom||(this.selectedMode,s.NONE),this.selectedMode==s.SWITCH){var t=this.selectedFlag.getComponent(cc.Sprite);this._unselectedSpriteFrame=t.spriteFrame}},e.prototype._registerEvent=function(){if(this._btnCom&&this.list.selectedMode>0&&!this._eventReg){var t=new cc.Component.EventHandler;t.target=this.node,t.component="ListItem",t.handler="onClickThis",this._btnCom.clickEvents.unshift(t),this._eventReg=!0}},e.prototype.showAni=function(t,e,i){var o,a=this;switch(t){case 0:o=[cc.scaleTo(.2,.7),cc.moveBy(.3,0,2*this.node.height)];break;case 1:o=[cc.scaleTo(.2,.7),cc.moveBy(.3,2*this.node.width,0)];break;case 2:o=[cc.scaleTo(.2,.7),cc.moveBy(.3,0,-2*this.node.height)];break;case 3:o=[cc.scaleTo(.2,.7),cc.moveBy(.3,-2*this.node.width,0)];break;default:o=[cc.scaleTo(.3,.1)]}(e||i)&&o.push(cc.callFunc(function(){if(i){a.list._delSingleItem(a.node);for(var t=a.list.displayData.length-1;t>=0;t--)if(a.list.displayData[t].id==a.listId){a.list.displayData.splice(t,1);break}}e()})),this.node.runAction(cc.sequence(o))},e.prototype.onClickThis=function(){this.list.selectedId=this.listId},a([r({type:cc.Sprite,tooltip:!1})],e.prototype,"icon",void 0),a([r({type:cc.Node,tooltip:!1})],e.prototype,"title",void 0),a([r({type:cc.Enum(s),tooltip:!1})],e.prototype,"selectedMode",void 0),a([r({type:cc.Node,tooltip:!1,visible:function(){return this.selectedMode>s.NONE}})],e.prototype,"selectedFlag",void 0),a([r({type:cc.SpriteFrame,tooltip:!1,visible:function(){return this.selectedMode==s.SWITCH}})],e.prototype,"selectedSpriteFrame",void 0),e=a([c,l(),h("\u81ea\u5b9a\u4e49\u7ec4\u4ef6/List Item"),p(-5001)],e)}(cc.Component);i.default=u,cc._RF.pop()},{}],List:[function(t,e,i){"use strict";cc._RF.push(e,"6d61fUK+klDt5YvD3x+UYcP","List");var o=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),a=this&&this.__decorate||function(t,e,i,o){var a,s=arguments.length,n=s<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(n=(s<3?a(n):s>3?a(e,i,n):a(e,i))||n);return s>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(i,"__esModule",{value:!0});var s,n,c,r=t("./ListItem"),l=cc._decorator,h=l.ccclass,p=l.property,u=l.disallowMultiple,d=l.menu,f=l.executionOrder,m=l.requireComponent;(function(t){t[t.NODE=1]="NODE",t[t.PREFAB=2]="PREFAB"})(s||(s={})),function(t){t[t.NORMAL=1]="NORMAL",t[t.ADHERING=2]="ADHERING",t[t.PAGE=3]="PAGE"}(n||(n={})),function(t){t[t.NONE=0]="NONE",t[t.SINGLE=1]="SINGLE",t[t.MULT=2]="MULT"}(c||(c={}));var y=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.templateType=s.NODE,e.tmpNode=null,e.tmpPrefab=null,e._slideMode=n.NORMAL,e.pageDistance=.3,e.pageChangeEvent=new cc.Component.EventHandler,e._virtual=!0,e.lackCenter=!1,e._updateRate=2,e.frameByFrameRenderNum=0,e.renderEvent=new cc.Component.EventHandler,e.selectedMode=c.NONE,e.repeatEventSingle=!1,e.selectedEvent=null,e._selectedId=-1,e._forceUpdate=!1,e._updateDone=!0,e._numItems=0,e._inited=!1,e._aniDelRuning=!1,e._doneAfterUpdate=!1,e.adhering=!1,e._adheringBarrier=!1,e.curPageNum=0,e}return o(e,t),Object.defineProperty(e.prototype,"slideModel",{get:function(){return this._slideMode},set:function(t){this._slideMode=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"virtual",{get:function(){return this._virtual},set:function(t){null!=t&&(this._virtual=t),0!=this._numItems&&this._onScrolling(null)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"updateRate",{get:function(){return this._updateRate},set:function(t){t>=0&&t<=6&&(this._updateRate=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectedId",{get:function(){return this._selectedId},set:function(t){var e,i=this;switch(i.selectedMode){case c.SINGLE:if(!i.repeatEventSingle&&t==i._selectedId)return;e=i.getItemByListId(t);var o=void 0;if(i._selectedId>=0?i._lastSelectedId=i._selectedId:i._lastSelectedId=null,i._selectedId=t,e&&((o=e.getComponent(r.default)).selected=!0),i._lastSelectedId>=0&&i._lastSelectedId!=i._selectedId){var a=i.getItemByListId(i._lastSelectedId);a&&(a.getComponent(r.default).selected=!1)}i.selectedEvent&&cc.Component.EventHandler.emitEvents([i.selectedEvent],e,t,i._lastSelectedId);break;case c.MULT:if(!(e=i.getItemByListId(t)))return;o=e.getComponent(r.default);i._selectedId>=0&&(i._lastSelectedId=i._selectedId),i._selectedId=t;var s=!o.selected;o.selected=s;var n=i.multSelected.indexOf(t);s&&n<0?i.multSelected.push(t):!s&&n>=0&&i.multSelected.splice(n,1),i.selectedEvent&&cc.Component.EventHandler.emitEvents([i.selectedEvent],e,t,i._lastSelectedId,s)}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numItems",{get:function(){return this._numItems},set:function(t){var e=this;if(e.checkInited(!1))if(null==t||t<0)cc.error("numItems set the wrong::",t);else if(e._numItems=t,e._forceUpdate=!0,e._virtual)e._resizeContent(),e._onScrolling(null);else{var i=e.content.getComponent(cc.Layout);if(i&&(i.enabled=!0),e._delRedundantItem(),e.firstListId=0,e.frameByFrameRenderNum>0){for(var o=e.frameByFrameRenderNum>e._numItems?e._numItems:e.frameByFrameRenderNum,a=0;a<o;a++)e._createOrUpdateItem2(a);e.frameByFrameRenderNum<e._numItems&&(e._updateCounter=e.frameByFrameRenderNum,e._updateDone=!1)}else{for(a=0;a<t;a++)e._createOrUpdateItem2(a);e.actualNumItems=t}}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scrollView",{get:function(){return this._scrollView},enumerable:!0,configurable:!0}),e.prototype.onLoad=function(){this._init()},e.prototype.start=function(){this._init()},e.prototype.onEnable=function(){this._registerEvent(),this._init()},e.prototype.onDisable=function(){this._unregisterEvent()},e.prototype._registerEvent=function(){var t=this;t.node.on(cc.Node.EventType.TOUCH_START,this._onTouchStart,this,!0),t.node.on("touch-up",t._onTouchUp,t),t.node.on(cc.Node.EventType.TOUCH_CANCEL,t._onTouchCancelled,t,!0),t.node.on("scroll-began",t._onScrollBegan,t,!0),t.node.on("scroll-ended",t._onScrollEnded,t,!0),t.node.on("scrolling",t._onScrolling,t,!0)},e.prototype._unregisterEvent=function(){var t=this;t.node.off(cc.Node.EventType.TOUCH_START,this._onTouchStart,this,!0),t.node.off("touch-up",t._onTouchUp,t),t.node.off(cc.Node.EventType.TOUCH_CANCEL,t._onTouchCancelled,t,!0),t.node.off("scroll-began",t._onScrollBegan,t,!0),t.node.off("scroll-ended",t._onScrollEnded,t,!0),t.node.off("scrolling",t._onScrolling,t,!0)},e.prototype._init=function(){var t=this;if(!t._inited)if(t._scrollView=t.node.getComponent(cc.ScrollView),t._scrollView)if(t.content=t._scrollView.content,t.content){switch(t._layout=t.content.getComponent(cc.Layout),t._align=t._layout.type,t._resizeMode=t._layout.resizeMode,t._startAxis=t._layout.startAxis,t._topGap=t._layout.paddingTop,t._rightGap=t._layout.paddingRight,t._bottomGap=t._layout.paddingBottom,t._leftGap=t._layout.paddingLeft,t._columnGap=t._layout.spacingX,t._lineGap=t._layout.spacingY,t._colLineNum,t._verticalDir=t._layout.verticalDirection,t._horizontalDir=t._layout.horizontalDirection,t.setTemplateItem(t.templateType==s.PREFAB?t.tmpPrefab.data:t.tmpNode),t._slideMode!=n.ADHERING&&t._slideMode!=n.PAGE||(t._scrollView.inertia=!1),t.virtual||(t.lackCenter=!1),t._lastDisplayData=[],t.displayData=[],t._pool=new cc.NodePool,t._forceUpdate=!1,t._updateCounter=0,t._updateDone=!0,t._align){case cc.Layout.Type.HORIZONTAL:switch(t._horizontalDir){case cc.Layout.HorizontalDirection.LEFT_TO_RIGHT:t._alignCalcType=1;break;case cc.Layout.HorizontalDirection.RIGHT_TO_LEFT:t._alignCalcType=2}break;case cc.Layout.Type.VERTICAL:switch(t._verticalDir){case cc.Layout.VerticalDirection.TOP_TO_BOTTOM:t._alignCalcType=3;break;case cc.Layout.VerticalDirection.BOTTOM_TO_TOP:t._alignCalcType=4}break;case cc.Layout.Type.GRID:switch(t._startAxis){case cc.Layout.AxisDirection.HORIZONTAL:switch(t._verticalDir){case cc.Layout.VerticalDirection.TOP_TO_BOTTOM:t._alignCalcType=3;break;case cc.Layout.VerticalDirection.BOTTOM_TO_TOP:t._alignCalcType=4}break;case cc.Layout.AxisDirection.VERTICAL:switch(t._horizontalDir){case cc.Layout.HorizontalDirection.LEFT_TO_RIGHT:t._alignCalcType=1;break;case cc.Layout.HorizontalDirection.RIGHT_TO_LEFT:t._alignCalcType=2}}}t.content.removeAllChildren(),t._inited=!0}else cc.error(t.node.name+"'s cc.ScrollView unset content!");else cc.error(t.node.name+" no assembly cc.ScrollView!")},e.prototype.setTemplateItem=function(t){if(t){var e=this;e._itemTmp=t,e._resizeMode==cc.Layout.ResizeMode.CHILDREN?e._itemSize=e._layout.cellSize:e._itemSize=cc.size(e._itemTmp.width,e._itemTmp.height);var i=e._itemTmp.getComponent(r.default),o=!1;switch(i||(o=!0),i&&(i._btnCom||e._itemTmp.getComponent(cc.Button)||(o=!0)),o&&(e.selectedMode=c.NONE),e.selectedMode==c.MULT&&(e.multSelected=[]),e._align){case cc.Layout.Type.HORIZONTAL:e._colLineNum=1,e._sizeType=!1;break;case cc.Layout.Type.VERTICAL:e._colLineNum=1,e._sizeType=!0;break;case cc.Layout.Type.GRID:switch(e._startAxis){case cc.Layout.AxisDirection.HORIZONTAL:var a=e.content.width-e._leftGap-e._rightGap;e._colLineNum=Math.floor((a+e._columnGap)/(e._itemSize.width+e._columnGap)),e._sizeType=!0;break;case cc.Layout.AxisDirection.VERTICAL:var s=e.content.height-e._topGap-e._bottomGap;e._colLineNum=Math.floor((s+e._lineGap)/(e._itemSize.height+e._lineGap)),e._sizeType=!1}}}},e.prototype.checkInited=function(t){var e=t||!0;return!!this._inited||(e&&cc.error("List initialization not completed!"),!1)},e.prototype._resizeContent=function(){var t,e=this;switch(e._align){case cc.Layout.Type.HORIZONTAL:if(e.customSize){var i=e._getFixedSize(null);t=e._leftGap+i.val+e._itemSize.width*(e._numItems-i.count)+e._columnGap*(e._numItems-1)+e._rightGap}else t=e._leftGap+e._itemSize.width*e._numItems+e._columnGap*(e._numItems-1)+e._rightGap;break;case cc.Layout.Type.VERTICAL:if(e.customSize){i=e._getFixedSize(null);t=e._topGap+i.val+e._itemSize.height*(e._numItems-i.count)+e._lineGap*(e._numItems-1)+e._bottomGap}else t=e._topGap+e._itemSize.height*e._numItems+e._lineGap*(e._numItems-1)+e._bottomGap;break;case cc.Layout.Type.GRID:switch(e.lackCenter&&(e.lackCenter=!1),e._startAxis){case cc.Layout.AxisDirection.HORIZONTAL:var o=Math.ceil(e._numItems/e._colLineNum);t=e._topGap+e._itemSize.height*o+e._lineGap*(o-1)+e._bottomGap;break;case cc.Layout.AxisDirection.VERTICAL:var a=Math.ceil(e._numItems/e._colLineNum);t=e._leftGap+e._itemSize.width*a+e._columnGap*(a-1)+e._rightGap}}var s,n=e.content.getComponent(cc.Layout);n&&(n.enabled=!1),e._allItemSize=t,e._sizeType?((s=t<e.node.height?e.node.height-.1:t)<0&&(s=0),e._lackSize=e.lackCenter?s:null,e._allItemSizeNoBorder=e._allItemSize-e._topGap-e._bottomGap,e.content.height=s):((s=t<e.node.width?e.node.width-.1:t)<0&&(s=0),e._lackSize=e.lackCenter?s:null,e._allItemSizeNoBorder=e._allItemSize-e._leftGap-e._rightGap,e.content.width=s)},e.prototype._onScrolling=function(t){var e,i,o,a;if(null==this.frameCount&&(this.frameCount=this._updateRate),!this._forceUpdate&&t&&"scroll-ended"!=t.type&&this.frameCount>0)this.frameCount--;else if(this.frameCount=this._updateRate,!this._aniDelRuning&&(this._calcViewPos(),this._sizeType?(e=this.viewTop,o=this.viewBottom):(i=this.viewRight,a=this.viewLeft),this._virtual)){this.displayData=[];var s=void 0,n=0,c=this._numItems-1;if(this.customSize)for(var r=!1;n<=c&&!r;n++)switch(s=this._calcItemPos(n),this._align){case cc.Layout.Type.HORIZONTAL:s.right>=a&&s.left<=i?this.displayData.push(s):0!=n&&this.displayData.length>0&&(r=!0);break;case cc.Layout.Type.VERTICAL:s.bottom<=e&&s.top>=o?this.displayData.push(s):0!=n&&this.displayData.length>0&&(r=!0);break;case cc.Layout.Type.GRID:switch(this._startAxis){case cc.Layout.AxisDirection.HORIZONTAL:s.bottom<=e&&s.top>=o?this.displayData.push(s):0!=n&&this.displayData.length>0&&(r=!0);break;case cc.Layout.AxisDirection.VERTICAL:s.right>=a&&s.left<=i?this.displayData.push(s):0!=n&&this.displayData.length>0&&(r=!0)}}else{var l=this._itemSize.width+this._columnGap,h=this._itemSize.height+this._lineGap;switch(this._alignCalcType){case 1:n=(a+this._leftGap)/l,c=(i+this._rightGap)/l;break;case 2:n=(-i-this._rightGap)/l,c=(-a-this._leftGap)/l;break;case 3:n=(-e-this._topGap)/h,c=(-o-this._bottomGap)/h;break;case 4:n=(o+this._bottomGap)/h,c=(e+this._topGap)/h}for(n=Math.floor(n)*this._colLineNum,c=Math.ceil(c)*this._colLineNum,c--,n<0&&(n=0),c>=this._numItems&&(c=this._numItems-1);n<=c;n++)this.displayData.push(this._calcItemPos(n))}if(this.displayData.length<=0||!this._numItems)return void this._delRedundantItem();this.firstListId=this.displayData[0].id,this.actualNumItems=this.displayData.length;var p=this._lastDisplayData.length;if(this._forceUpdate||this.actualNumItems!=p||this.firstListId!=this._lastDisplayData[0]||this.displayData[this.actualNumItems-1].id!=this._lastDisplayData[p-1])if(this._lastDisplayData=[],this.frameByFrameRenderNum>0)this._numItems>0?(this._updateDone?this._updateCounter=0:this._doneAfterUpdate=!0,this._updateDone=!1):(this._delRedundantItem(),this._updateCounter=0,this._updateDone=!0);else{for(var u=0;u<this.actualNumItems;u++)this._createOrUpdateItem(this.displayData[u]);this._delRedundantItem(),this._forceUpdate=!1}this._calcNearestItem()}},e.prototype._calcViewPos=function(){var t=this.content.getPosition();switch(this._alignCalcType){case 1:this.elasticLeft=t.x>0?t.x:0,this.viewLeft=(t.x<0?-t.x:0)-this.elasticLeft,this.viewRight=this.viewLeft+this.node.width,this.elasticRight=this.viewRight>this.content.width?Math.abs(this.viewRight-this.content.width):0,this.viewRight+=this.elasticRight;break;case 2:this.elasticRight=t.x<0?-t.x:0,this.viewRight=(t.x>0?-t.x:0)+this.elasticRight,this.viewLeft=this.viewRight-this.node.width,this.elasticLeft=this.viewLeft<-this.content.width?Math.abs(this.viewLeft+this.content.width):0,this.viewLeft-=this.elasticLeft;break;case 3:this.elasticTop=t.y<0?Math.abs(t.y):0,this.viewTop=(t.y>0?-t.y:0)+this.elasticTop,this.viewBottom=this.viewTop-this.node.height,this.elasticBottom=this.viewBottom<-this.content.height?Math.abs(this.viewBottom+this.content.height):0,this.viewBottom+=this.elasticBottom;break;case 4:this.elasticBottom=t.y>0?Math.abs(t.y):0,this.viewBottom=(t.y<0?-t.y:0)-this.elasticBottom,this.viewTop=this.viewBottom+this.node.height,this.elasticTop=this.viewTop>this.content.height?Math.abs(this.viewTop-this.content.height):0,this.viewTop-=this.elasticTop}},e.prototype._calcItemPos=function(t){var e,i,o,a,s,n,c,r;switch(this._align){case cc.Layout.Type.HORIZONTAL:switch(this._horizontalDir){case cc.Layout.HorizontalDirection.LEFT_TO_RIGHT:if(this.customSize){var l=this._getFixedSize(t);s=this._leftGap+(this._itemSize.width+this._columnGap)*(t-l.count)+(l.val+this._columnGap*l.count),e=(h=this.customSize[t])>0?h:this._itemSize.width}else s=this._leftGap+(this._itemSize.width+this._columnGap)*t,e=this._itemSize.width;if(n=s+e,this.lackCenter&&this._lackSize>=0)s+=p=this.content.width/2-this._allItemSizeNoBorder/2,n+=p;return{id:t,left:s,right:n,x:s+this._itemTmp.anchorX*e,y:this._itemTmp.y};case cc.Layout.HorizontalDirection.RIGHT_TO_LEFT:if(this.customSize){l=this._getFixedSize(t);n=-this._rightGap-(this._itemSize.width+this._columnGap)*(t-l.count)-(l.val+this._columnGap*l.count),e=(h=this.customSize[t])>0?h:this._itemSize.width}else n=-this._rightGap-(this._itemSize.width+this._columnGap)*t,e=this._itemSize.width;if(s=n-e,this.lackCenter&&this._lackSize>=0)s-=p=this.content.width/2-this._allItemSizeNoBorder/2,n-=p;return{id:t,right:n,left:s,x:s+this._itemTmp.anchorX*e,y:this._itemTmp.y}}break;case cc.Layout.Type.VERTICAL:switch(this._verticalDir){case cc.Layout.VerticalDirection.TOP_TO_BOTTOM:if(this.customSize){l=this._getFixedSize(t);o=-this._topGap-(this._itemSize.height+this._lineGap)*(t-l.count)-(l.val+this._lineGap*l.count),i=(h=this.customSize[t])>0?h:this._itemSize.height}else o=-this._topGap-(this._itemSize.height+this._lineGap)*t,i=this._itemSize.height;if(a=o-i,this.lackCenter&&this._lackSize>=0)o-=p=this.content.height/2-this._allItemSizeNoBorder/2,a-=p;return{id:t,top:o,bottom:a,x:this._itemTmp.x,y:a+this._itemTmp.anchorY*i};case cc.Layout.VerticalDirection.BOTTOM_TO_TOP:if(this.customSize){var h;l=this._getFixedSize(t);a=this._bottomGap+(this._itemSize.height+this._lineGap)*(t-l.count)+(l.val+this._lineGap*l.count),i=(h=this.customSize[t])>0?h:this._itemSize.height}else a=this._bottomGap+(this._itemSize.height+this._lineGap)*t,i=this._itemSize.height;var p;if(o=a+i,this.lackCenter&&this._lackSize>=0)o+=p=this.content.height/2-this._allItemSizeNoBorder/2,a+=p;return{id:t,top:o,bottom:a,x:this._itemTmp.x,y:a+this._itemTmp.anchorY*i}}case cc.Layout.Type.GRID:var u=Math.floor(t/this._colLineNum);switch(this._startAxis){case cc.Layout.AxisDirection.HORIZONTAL:switch(this._verticalDir){case cc.Layout.VerticalDirection.TOP_TO_BOTTOM:r=(a=(o=-this._topGap-(this._itemSize.height+this._lineGap)*u)-this._itemSize.height)+this._itemTmp.anchorY*this._itemSize.height;break;case cc.Layout.VerticalDirection.BOTTOM_TO_TOP:o=(a=this._bottomGap+(this._itemSize.height+this._lineGap)*u)+this._itemSize.height,r=a+this._itemTmp.anchorY*this._itemSize.height}switch(c=this._leftGap+t%this._colLineNum*(this._itemSize.width+this._columnGap),this._horizontalDir){case cc.Layout.HorizontalDirection.LEFT_TO_RIGHT:c+=this._itemTmp.anchorX*this._itemSize.width,c-=this.content.anchorX*this.content.width;break;case cc.Layout.HorizontalDirection.RIGHT_TO_LEFT:c+=(1-this._itemTmp.anchorX)*this._itemSize.width,c-=(1-this.content.anchorX)*this.content.width,c*=-1}return{id:t,top:o,bottom:a,x:c,y:r};case cc.Layout.AxisDirection.VERTICAL:switch(this._horizontalDir){case cc.Layout.HorizontalDirection.LEFT_TO_RIGHT:n=(s=this._leftGap+(this._itemSize.width+this._columnGap)*u)+this._itemSize.width,c=s+this._itemTmp.anchorX*this._itemSize.width,c-=this.content.anchorX*this.content.width;break;case cc.Layout.HorizontalDirection.RIGHT_TO_LEFT:c=(s=(n=-this._rightGap-(this._itemSize.width+this._columnGap)*u)-this._itemSize.width)+this._itemTmp.anchorX*this._itemSize.width,c+=(1-this.content.anchorX)*this.content.width}switch(r=-this._topGap-t%this._colLineNum*(this._itemSize.height+this._lineGap),this._verticalDir){case cc.Layout.VerticalDirection.TOP_TO_BOTTOM:r-=(1-this._itemTmp.anchorY)*this._itemSize.height,r+=(1-this.content.anchorY)*this.content.height;break;case cc.Layout.VerticalDirection.BOTTOM_TO_TOP:r-=this._itemTmp.anchorY*this._itemSize.height,r+=this.content.anchorY*this.content.height,r*=-1}return{id:t,left:s,right:n,x:c,y:r}}}},e.prototype._getFixedSize=function(t){if(!this.customSize)return null;null==t&&(t=this._numItems);var e=0,i=0;for(var o in this.customSize)parseInt(o)<t&&(e+=this.customSize[o],i++);return{val:e,count:i}},e.prototype._onScrollBegan=function(){this._beganPos=this._sizeType?this.viewTop:this.viewLeft},e.prototype._onScrollEnded=function(){var t=this;if(null!=t.scrollToListId){var e=t.getItemByListId(t.scrollToListId);t.scrollToListId=null,e&&e.runAction(cc.sequence(cc.scaleTo(.1,1.06),cc.scaleTo(.1,1)))}t._onScrolling(null),t._slideMode!=n.ADHERING||t.adhering?t._slideMode==n.PAGE&&(null!=t._beganPos?this._pageAdhere():t.adhere()):t.adhere()},e.prototype._onTouchStart=function(t,e){if(!this._scrollView._hasNestedViewGroup(t,e)&&!(t.eventPhase===cc.Event.AT_TARGET&&t.target===this.node)){for(var i=t.target;null==i._listId||!i.parent;)i=i.parent;this._scrollItem=null!=i._listId?i:t.target}},e.prototype._onTouchUp=function(){var t=this;t._scrollPos=null,t._slideMode==n.ADHERING?(this.adhering&&(this._adheringBarrier=!0),t.adhere()):t._slideMode==n.PAGE&&(null!=t._beganPos?this._pageAdhere():t.adhere()),this._scrollItem=null},e.prototype._onTouchCancelled=function(t,e){var i=this;i._scrollView._hasNestedViewGroup(t,e)||t.simulate||(i._scrollPos=null,i._slideMode==n.ADHERING?(i.adhering&&(i._adheringBarrier=!0),i.adhere()):i._slideMode==n.PAGE&&(null!=i._beganPos?i._pageAdhere():i.adhere()),this._scrollItem=null)},e.prototype._pageAdhere=function(){var t=this;if(!(t.elasticTop>0||t.elasticRight>0||t.elasticBottom>0||t.elasticLeft>0)){var e=t._sizeType?t.viewTop:t.viewLeft,i=(t._sizeType?t.node.height:t.node.width)*t.pageDistance;if(Math.abs(t._beganPos-e)>i){switch(t._alignCalcType){case 1:case 4:t._beganPos>e?t.prePage(.5):t.nextPage(.5);break;case 2:case 3:t._beganPos<e?t.prePage(.5):t.nextPage(.5)}}else t.elasticTop<=0&&t.elasticRight<=0&&t.elasticBottom<=0&&t.elasticLeft<=0&&t.adhere();t._beganPos=null}},e.prototype.adhere=function(){var t=this;if(!(t.elasticTop>0||t.elasticRight>0||t.elasticBottom>0||t.elasticLeft>0)){t.adhering=!0,t._calcNearestItem();var e=(t._sizeType?t._topGap:t._leftGap)/(t._sizeType?t.node.height:t.node.width);t.scrollTo(t.nearestListId,.7,e)}},e.prototype.update=function(t){if(!(this.frameByFrameRenderNum<=0||this._updateDone))if(this._virtual){for(var e=this._updateCounter+this.frameByFrameRenderNum>this.actualNumItems?this.actualNumItems:this._updateCounter+this.frameByFrameRenderNum,i=this._updateCounter;i<e;i++){var o=this.displayData[i];o&&this._createOrUpdateItem(o)}this._updateCounter>=this.actualNumItems-1?this._doneAfterUpdate?(this._updateCounter=0,this._updateDone=!1,this._scrollView.isScrolling()||(this._doneAfterUpdate=!1)):(this._updateDone=!0,this._delRedundantItem(),this._forceUpdate=!1,this._calcNearestItem()):this._updateCounter+=this.frameByFrameRenderNum}else if(this._updateCounter<this._numItems){for(e=this._updateCounter+this.frameByFrameRenderNum>this._numItems?this._numItems:this._updateCounter+this.frameByFrameRenderNum,i=this._updateCounter;i<e;i++)this._createOrUpdateItem2(i);this._updateCounter+=this.frameByFrameRenderNum}else this._updateDone=!0,this._calcNearestItem()},e.prototype._createOrUpdateItem=function(t){var e=this.getItemByListId(t.id);if(e)this._forceUpdate&&this.renderEvent&&(e.setPosition(cc.v2(t.x,t.y)),this._resetItemSize(e),this.renderEvent&&cc.Component.EventHandler.emitEvents([this.renderEvent],e,t.id));else{(e=this._pool.size()?this._pool.get():cc.instantiate(this._itemTmp))._listId=t.id,e.setPosition(cc.v2(t.x,t.y)),this._resetItemSize(e),this.content.addChild(e),e.setSiblingIndex(this.content.childrenCount-1);var i=e.getComponent(r.default);e.listItem=i,i&&(i.listId=t.id,i.list=this,i._registerEvent()),this.renderEvent&&cc.Component.EventHandler.emitEvents([this.renderEvent],e,t.id)}this._resetItemSize(e),this._updateListItem(e.listItem),this._lastDisplayData.indexOf(t.id)<0&&this._lastDisplayData.push(t.id)},e.prototype._createOrUpdateItem2=function(t){var e,i=this.content.children[t];i?this._forceUpdate&&this.renderEvent&&(i._listId=t,e&&(e.listId=t),this.renderEvent&&cc.Component.EventHandler.emitEvents([this.renderEvent],i,t)):((i=cc.instantiate(this._itemTmp))._listId=t,this.content.addChild(i),e=i.getComponent(r.default),i.listItem=e,e&&(e.listId=t,e.list=this,e._registerEvent()),this.renderEvent&&cc.Component.EventHandler.emitEvents([this.renderEvent],i,t)),this._updateListItem(e),this._lastDisplayData.indexOf(t)<0&&this._lastDisplayData.push(t)},e.prototype._updateListItem=function(t){if(t&&this.selectedMode>c.NONE)switch(this.selectedMode){case c.SINGLE:t.selected=this.selectedId==t.node._listId;break;case c.MULT:t.selected=this.multSelected.indexOf(t.node._listId)>=0}},e.prototype._resetItemSize=function(t){var e=t.getComponent(r.default);if(this.customSize&&this.customSize[e.node._listId]){var i=this.customSize[e.node._listId];this._align==cc.Layout.Type.HORIZONTAL?t.width=i:this._align==cc.Layout.Type.VERTICAL&&(t.height=i)}else t.setContentSize(this._itemSize)},e.prototype.setMultSelected=function(t,e){var i=this;if(Array.isArray(t)||(t=[t]),null==e)i.multSelected=t;else{var o=void 0,a=void 0;if(e)for(var s=t.length-1;s>=0;s--)o=t[s],(a=i.multSelected.indexOf(o))<0&&i.multSelected.push(o);else for(s=t.length-1;s>=0;s--)o=t[s],(a=i.multSelected.indexOf(o))>=0&&i.multSelected.splice(a,1)}i._forceUpdate=!0,i._onScrolling(null)},e.prototype.updateItem=function(t){Array.isArray(t)||(t=[t]);for(var e=0,i=t.length;e<i;e++){var o=t[e],a=this.getItemByListId(o);a&&cc.Component.EventHandler.emitEvents([this.renderEvent],a,o)}},e.prototype.updateAll=function(){this.numItems=this.numItems},e.prototype.getItemByListId=function(t){for(var e=this.content.childrenCount-1;e>=0;e--)if(this.content.children[e]._listId==t)return this.content.children[e]},e.prototype._getOutsideItem=function(){for(var t,e,i=[],o=this.content.childrenCount-1;o>=0;o--){if(t=this.content.children[o],e=!0)for(var a=this.actualNumItems-1;a>=0;a--)if(this.displayData[a]){var s=this.displayData[a].id;if(t._listId==s){e=!1;break}}e&&i.push(t)}return i},e.prototype._delRedundantItem=function(){if(this._virtual)for(var t=this._getOutsideItem(),e=t.length-1;e>=0;e--){var i=t[e];this._scrollItem&&i._listId==this._scrollItem._listId||this._pool.put(i)}else for(;this.content.childrenCount>this._numItems;)this._delSingleItem(this.content.children[this.content.childrenCount-1])},e.prototype._delSingleItem=function(t){t.removeFromParent(),t.destroy&&t.destroy(),t=null},e.prototype.aniDelItem=function(t,e,i){var o,a=this,s=a.getItemByListId(t);if(!a._aniDelRuning&&a._virtual)if(s){o=s.getComponent(r.default),a._aniDelRuning=!0;var n=a.displayData[a.displayData.length-1].id,l=o.selected;o.showAni(i,function(){var i;if(n<a._numItems-2&&(i=n+1),null!=i){var o=a._calcItemPos(i);a.displayData.push(o),a._virtual?a._createOrUpdateItem(o):a._createOrUpdateItem2(i)}else a._numItems--;if(a.selectedMode==c.SINGLE)l?a._selectedId=-1:a._selectedId-1>=0&&a._selectedId--;else if(a.selectedMode==c.MULT&&a.multSelected.length){var r=a.multSelected.indexOf(t);r>=0&&a.multSelected.splice(r,1);for(var h=a.multSelected.length-1;h>=0;h--){(d=a.multSelected[h])>=t&&a.multSelected[h]--}}if(a.customSize){a.customSize[t]&&delete a.customSize[t];var p={},u=void 0;for(var d in a.customSize){u=a.customSize[d];var f=parseInt(d);p[f-(f>=t?1:0)]=u}a.customSize=p}var m,y;for(h=null!=i?i:n;h>=t+1;h--)if(s=a.getItemByListId(h)){var _=a._calcItemPos(h-1);m=[cc.moveTo(.2333,cc.v2(_.x,_.y))],h<=t+1&&(y=!0,m.push(cc.callFunc(function(){a._aniDelRuning=!1,e(t)}))),m.length>1?s.runAction(cc.sequence(m)):s.runAction(m[0])}y||(a._aniDelRuning=!1,e(t))},!0)}else e(t)},e.prototype.scrollTo=function(t,e,i,o){void 0===e&&(e=.5),void 0===i&&(i=null),void 0===o&&(o=!1);var a=this;if(a.checkInited(!1)){a._scrollView.stopAutoScroll(),null==e?e=.5:e<0&&(e=0),t<0?t=0:t>=a._numItems&&(t=a._numItems-1);var s,n,c=a._virtual?a._calcItemPos(t):a._calcExistItemPos(t);switch(a._alignCalcType){case 1:s=c.left,s-=null!=i?a.node.width*i:a._leftGap,c=cc.v2(s,0);break;case 2:s=c.right-a.node.width,s+=null!=i?a.node.width*i:a._rightGap,c=cc.v2(s+a.content.width,0);break;case 3:n=c.top,n+=null!=i?a.node.height*i:a._topGap,c=cc.v2(0,-n);break;case 4:n=c.bottom+a.node.height,n-=null!=i?a.node.height*i:a._bottomGap,c=cc.v2(0,-n+a.content.height)}var r=a.content.getPosition();r=Math.abs(a._sizeType?r.y:r.x);var l=a._sizeType?c.y:c.x,h=Math.abs((null!=a._scrollPos?a._scrollPos:r)-l)>.5;a._scrollView.stopAutoScroll(),h&&(a._scrollView.scrollToOffset(c,e),a.scheduleOnce(function(){if(a._adheringBarrier||(a.adhering=a._adheringBarrier=!1),o){var e=a.getItemByListId(t);e&&e.runAction(cc.sequence(cc.scaleTo(.1,1.05),cc.scaleTo(.1,1)))}},e+.1),e<=0&&a._onScrolling(null))}},e.prototype._calcNearestItem=function(){var t,e,i,o,a,s;this.nearestListId=null,this._virtual&&this._calcViewPos(),i=this.viewTop,o=this.viewRight,a=this.viewBottom,s=this.viewLeft;for(var n=!1,c=0;c<this.content.childrenCount&&!n;c+=this._colLineNum)switch(t=this._virtual?this.displayData[c]:this._calcExistItemPos(c),e=this._sizeType?(t.top+t.bottom)/2:e=(t.left+t.right)/2,this._alignCalcType){case 1:t.right>=s&&(this.nearestListId=t.id,s>e&&(this.nearestListId+=this._colLineNum),n=!0);break;case 2:t.left<=o&&(this.nearestListId=t.id,o<e&&(this.nearestListId+=this._colLineNum),n=!0);break;case 3:t.bottom<=i&&(this.nearestListId=t.id,i<e&&(this.nearestListId+=this._colLineNum),n=!0);break;case 4:t.top>=a&&(this.nearestListId=t.id,a>e&&(this.nearestListId+=this._colLineNum),n=!0)}if((t=this._virtual?this.displayData[this.actualNumItems-1]:this._calcExistItemPos(this._numItems-1))&&t.id==this._numItems-1)switch(e=this._sizeType?(t.top+t.bottom)/2:e=(t.left+t.right)/2,this._alignCalcType){case 1:o>e&&(this.nearestListId=t.id);break;case 2:s<e&&(this.nearestListId=t.id);break;case 3:a<e&&(this.nearestListId=t.id);break;case 4:i>e&&(this.nearestListId=t.id)}},e.prototype._calcExistItemPos=function(t){var e=this.getItemByListId(t);if(!e)return null;var i={id:t,x:e.x,y:e.y};return this._sizeType?(i.top=e.y+e.height*(1-e.anchorY),i.bottom=e.y-e.height*e.anchorY):(i.left=e.x-e.width*e.anchorX,i.right=e.x+e.width*(1-e.anchorX)),i},e.prototype.prePage=function(t){void 0===t&&(t=.5),this.skipPage(this.curPageNum-1,t)},e.prototype.nextPage=function(t){void 0===t&&(t=.5),this.skipPage(this.curPageNum+1,t)},e.prototype.skipPage=function(t,e){var i=this;if(i._slideMode!=n.PAGE)return cc.error("This function is not allowed to be called, Must SlideMode = PAGE!");t<0||t>=i._numItems||i.curPageNum!=t&&(i.curPageNum=t,i.pageChangeEvent&&cc.Component.EventHandler.emitEvents([i.pageChangeEvent],t),i.scrollTo(t,e))},e.prototype.calcCustomSize=function(t){var e=this;if(!e._itemTmp)return cc.error("Unset template item!");if(!e.renderEvent)return cc.error("Unset Render-Event!");e.customSize={};var i=cc.instantiate(e._itemTmp);e.content.addChild(i);for(var o=0;o<t;o++)cc.Component.EventHandler.emitEvents([e.renderEvent],i,o),i.height==e._itemSize.height&&i.width==e._itemSize.width||(e.customSize[o]=e._sizeType?i.height:i.width);return Object.keys(e.customSize).length||(e.customSize=null),i.removeFromParent(),i.destroy&&i.destroy(),e.customSize},a([p({type:cc.Enum(s),tooltip:!1})],e.prototype,"templateType",void 0),a([p({type:cc.Node,tooltip:!1,visible:function(){return this.templateType==s.NODE}})],e.prototype,"tmpNode",void 0),a([p({type:cc.Prefab,tooltip:!1,visible:function(){return this.templateType==s.PREFAB}})],e.prototype,"tmpPrefab",void 0),a([p()],e.prototype,"_slideMode",void 0),a([p({type:cc.Enum(n),tooltip:!1})],e.prototype,"slideModel",null),a([p({type:cc.Float,range:[0,1,.1],tooltip:!1,slide:!0,visible:function(){return this._slideMode==n.PAGE}})],e.prototype,"pageDistance",void 0),a([p({type:cc.Component.EventHandler,tooltip:!1,visible:function(){return this._slideMode==n.PAGE}})],e.prototype,"pageChangeEvent",void 0),a([p()],e.prototype,"_virtual",void 0),a([p({type:cc.Boolean,tooltip:!1})],e.prototype,"virtual",null),a([p({tooltip:!1,visible:function(){return this.virtual}})],e.prototype,"lackCenter",void 0),a([p({type:cc.Integer})],e.prototype,"_updateRate",void 0),a([p({type:cc.Integer,range:[0,6,1],tooltip:!1,slide:!0})],e.prototype,"updateRate",null),a([p({type:cc.Integer,range:[0,12,1],tooltip:!1,slide:!0})],e.prototype,"frameByFrameRenderNum",void 0),a([p({type:cc.Component.EventHandler,tooltip:!1})],e.prototype,"renderEvent",void 0),a([p({type:cc.Enum(c),tooltip:!1})],e.prototype,"selectedMode",void 0),a([p({tooltip:!1,visible:function(){return this.selectedMode==c.SINGLE}})],e.prototype,"repeatEventSingle",void 0),a([p({type:cc.Component.EventHandler,tooltip:!1,visible:function(){return this.selectedMode>c.NONE}})],e.prototype,"selectedEvent",void 0),a([p({serializable:!1})],e.prototype,"_numItems",void 0),e=a([h,u(),d("\u81ea\u5b9a\u4e49\u7ec4\u4ef6/List"),m(cc.ScrollView),f(-5e3)],e)}(cc.Component);i.default=y,cc._RF.pop()},{"./ListItem":"ListItem"}],Loading:[function(t,e,i){"use strict";cc._RF.push(e,"d89e3RWyLhN2ZFfaJfQzqAs","Loading");var o=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),a=this&&this.__decorate||function(t,e,i,o){var a,s=arguments.length,n=s<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(n=(s<3?a(n):s>3?a(e,i,n):a(e,i))||n);return s>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(i,"__esModule",{value:!0});var s=t("./Logic"),n=t("./data/SkillData"),c=t("./utils/Random"),r=cc._decorator,l=r.ccclass,h=r.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.ui=null,e.label=null,e.timeDelay=0,e.isSpriteFramesLoaded=!1,e.isSkillsLoaded=!1,e.TIPS=["\u77ff\u5de5\u7948\u7977\u4e2d...","\u957f\u6309\u6280\u80fd\u53ef\u4ee5\u67e5\u770b\u8bf4\u660e","\u53ca\u65f6\u8865\u5145\u80fd\u91cf","boss\u4f1a\u88ab\u5468\u56f4\u65b9\u5757\u70b8\u4f24"],e}return o(e,t),e.prototype.start=function(){this.loadSpriteFrames(),this.loadSkills(),this.label.string=this.TIPS[c.default.getRandomNum(0,this.TIPS.length-1)]},e.prototype.loadSpriteFrames=function(){var t=this;s.default.spriteFrames?this.isSpriteFramesLoaded=!0:cc.loader.loadResDir("Texture",cc.SpriteFrame,function(e,i){s.default.spriteFrames={};for(var o=0,a=i;o<a.length;o++){var n=a[o];s.default.spriteFrames[n.name]=n}t.isSpriteFramesLoaded=!0,cc.log("texture loaded")})},e.prototype.loadSkills=function(){var t=this;s.default.skills?this.isSkillsLoaded=!0:cc.loader.loadRes("Data/skills",function(e,i){if(e)cc.error(e);else{for(var o in t.isSkillsLoaded=!0,s.default.skills={},i.json){var a=new n.default;a.valueCopy(i.json[o]),s.default.skills[a.resName]=a}cc.log(JSON.stringify(s.default.skills)),cc.log("skills loaded")}})},e.prototype.update=function(t){var e=this;this.timeDelay+=t,this.timeDelay>.16&&this.isSpriteFramesLoaded&&this.isSkillsLoaded&&(this.timeDelay=0,this.isSpriteFramesLoaded=!1,cc.director.preloadScene("game",function(){},function(){e.ui.runAction(cc.fadeOut(1)),e.scheduleOnce(function(){cc.director.loadScene("game")},1)}))},a([h(cc.Node)],e.prototype,"ui",void 0),a([h(cc.Label)],e.prototype,"label",void 0),e=a([l],e)}(cc.Component);i.default=p,cc._RF.pop()},{"./Logic":"Logic","./data/SkillData":"SkillData","./utils/Random":"Random"}],Logic:[function(t,e,i){"use strict";cc._RF.push(e,"e235fPmQT1Nh7nMh+UJ5Y2h","Logic");var o=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),a=this&&this.__decorate||function(t,e,i,o){var a,s=arguments.length,n=s<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(n=(s<3?a(n):s>3?a(e,i,n):a(e,i))||n);return s>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(i,"__esModule",{value:!0});var s=t("./manager/ProfileManager"),n=t("./manager/Elements"),c=cc._decorator,r=c.ccclass,l=(c.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}var i;return o(e,t),i=e,e.prototype.onLoad=function(){cc.game.setFrameRate(60),cc.game.addPersistRootNode(this.node),cc.view.enableAntiAlias(!1),i.reset()},e.updateElements=function(t,e){return i.elements.updateElements(t,e)},e.reset=function(){i.isProcessing=!1,i.isUseSkillSwipe=!1,i.isUseSkillChoose=!1,i.level=i.profile.data.level,i.coin=i.profile.data.coins,i.currentLevel=0,i.elements=new n.default,i.elements.coin=i.coin,i.step=i.MAX_STEP,i.currentMeter=0},e.needBoss=function(){return i.currentMeter>=i.METRE_LENGTH},e.saveData=function(){i.currentLevel+1>i.level&&(i.level=i.currentLevel+1),i.profile.data.level=i.level,i.profile.data.coins=i.coin,i.profile.saveData()},e.loadGame=function(t){i.reset(),i.currentLevel=t,cc.director.loadScene("loading")},e.prototype.start=function(){},e.METRE_LENGTH=10,e.MAX_STEP=99,e.isPaused=!1,e.isProcessing=!1,e.level=0,e.currentMeter=0,e.currentLevel=0,e.step=0,e.coin=0,e.spriteFrames=null,e.skills=null,e.elements=new n.default,e.profile=new s.default,e.isUseSkillSwipe=!1,e.isUseSkillChoose=!1,e=i=a([r],e)}(cc.Component));i.default=l,cc._RF.pop()},{"./manager/Elements":"Elements","./manager/ProfileManager":"ProfileManager"}],MainStage:[function(t,e,i){"use strict";cc._RF.push(e,"1e5f9/nDSpJ5rCvPp/1/3R8","MainStage");var o=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),a=this&&this.__decorate||function(t,e,i,o){var a,s=arguments.length,n=s<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(n=(s<3?a(n):s>3?a(e,i,n):a(e,i))||n);return s>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(i,"__esModule",{value:!0});var s=cc._decorator,n=s.ccclass,c=(s.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype.start=function(){},e.prototype.gotoTheMine=function(){cc.director.loadScene("mine")},e=a([n],e)}(cc.Component));i.default=c,cc._RF.pop()},{}],MapHelper:[function(t,e,i){"use strict";cc._RF.push(e,"ff784cre3VAp6FsBAtmwAdJ","MapHelper"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("../GameWorld"),a=cc._decorator,s=(a.ccclass,a.property,function(){function t(){}return t.checkMapCanBoom=function(e){for(var i=0;i<e.length;i++)for(var o=0;o<e[0].length;o++)if(!e[i][o].isObstacle){var a=e[i][o];if(o<e[0].length-1&&!e[i][o+1].isObstacle){if(e[i][o]=e[i][o+1],e[i][o+1]=a,t.checkPosHasThree(cc.v2(i,o),e)||t.checkPosHasThree(cc.v2(i,o+1),e))return cc.log("CanBoom"),!0;a=e[i][o],e[i][o]=e[i][o+1],e[i][o+1]=a}if(i<e.length-1&&!e[i+1][o].isObstacle){if(a=e[i][o],e[i][o]=e[i+1][o],e[i+1][o]=a,t.checkPosHasThree(cc.v2(i,o),e)||t.checkPosHasThree(cc.v2(i+1,o),e))return cc.log("CanBoom"),!0;a=e[i][o],e[i][o]=e[i+1][o],e[i+1][o]=a}}return cc.log("NoTileCanBoom"),!1},t.checkPosHasThree=function(e,i){var o=e.x,a=e.y;return!!(t.isDataTypeEqual(cc.v2(o,a),cc.v2(o,a+1),i)&&t.isDataTypeEqual(cc.v2(o,a),cc.v2(o,a+2),i)||t.isDataTypeEqual(cc.v2(o,a),cc.v2(o,a-1),i)&&t.isDataTypeEqual(cc.v2(o,a),cc.v2(o,a-2),i)||t.isDataTypeEqual(cc.v2(o,a),cc.v2(o,a-1),i)&&t.isDataTypeEqual(cc.v2(o,a),cc.v2(o,a+1),i)||t.isDataTypeEqual(cc.v2(o,a),cc.v2(o+1,a),i)&&t.isDataTypeEqual(cc.v2(o,a),cc.v2(o+2,a),i)||t.isDataTypeEqual(cc.v2(o,a),cc.v2(o-1,a),i)&&t.isDataTypeEqual(cc.v2(o,a),cc.v2(o-2,a),i)||t.isDataTypeEqual(cc.v2(o,a),cc.v2(o+1,a),i)&&t.isDataTypeEqual(cc.v2(o,a),cc.v2(o-1,a),i))},t.isDataTypeEqual=function(e,i,a){return!!o.default.isPosIndexValid(e)&&(!!o.default.isPosIndexValid(i)&&(!t.isPosIndexValid(e,a)&&!t.isPosIndexValid(i,a)&&a[e.x][e.y].tileType==a[i.x][i.y].tileType))},t.isPosIndexValid=function(t,e){return!!(e[t.x][t.y].isObstacle||e[t.x][t.y].isEmpty||e[t.x][t.y].isBoss)},t}());i.default=s,cc._RF.pop()},{"../GameWorld":"GameWorld"}],MineStage:[function(t,e,i){"use strict";cc._RF.push(e,"c3df3aCCopLt7qWlAhyIkV2","MineStage");var o=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),a=this&&this.__decorate||function(t,e,i,o){var a,s=arguments.length,n=s<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(n=(s<3?a(n):s>3?a(e,i,n):a(e,i))||n);return s>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(i,"__esModule",{value:!0});var s=t("./Logic"),n=t("./ui/List"),c=t("./ui/ListItem"),r=cc._decorator,l=r.ccclass,h=r.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.levellabel=null,e.list=null,e.data=[],e.level=0,e}return o(e,t),e.prototype.onLoad=function(){var t=this;this.level=s.default.level,this.data=[];for(var e=0;e<100;e++)this.data.push(e*s.default.METRE_LENGTH);this.list.numItems=this.data.length,this.scheduleOnce(function(){t.list.scrollTo(t.level,2,.25,!1)},.5),this.levellabel.node.on(cc.Node.EventType.TOUCH_END,function(e){t.scheduleOnce(function(){t.list.scrollTo(t.level,2,.25,!1)},.5)},this)},e.prototype.start=function(){this.levellabel.string="\u5f53\u524d\u6df1\u5ea6\uff1a"+s.default.level*s.default.METRE_LENGTH+" \n\n\u4e0b\u4e00\u76ee\u6807\uff1a"+(s.default.level+1)*s.default.METRE_LENGTH},e.prototype.goHome=function(){cc.director.loadScene("main")},e.prototype.onListRender=function(t,e){t.getComponent(c.default).title.getComponent(cc.Label).string=this.data[e]+"",t.getComponent(c.default).icon.node.color=e>this.level?cc.Color.BLACK:cc.Color.WHITE;var i=t.getComponent(c.default).node.getChildByName("finish"),o=t.getComponent(c.default).node.getChildByName("cover");o.opacity=e>this.level?200:128,i.opacity=e>=this.level?0:200,e==this.level&&(o.opacity=0)},e.prototype.onItemClick=function(t){var e=t.target.getComponent(c.default);cc.log(e.listId),e.listId<=this.level&&s.default.loadGame(e.listId)},a([h(cc.Label)],e.prototype,"levellabel",void 0),a([h(n.default)],e.prototype,"list",void 0),e=a([l],e)}(cc.Component);i.default=p,cc._RF.pop()},{"./Logic":"Logic","./ui/List":"List","./ui/ListItem":"ListItem"}],Player:[function(t,e,i){"use strict";cc._RF.push(e,"7cda7BZOz1Dq7ikRhlO7P3X","Player");var o=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),a=this&&this.__decorate||function(t,e,i,o){var a,s=arguments.length,n=s<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(n=(s<3?a(n):s>3?a(e,i,n):a(e,i))||n);return s>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(i,"__esModule",{value:!0});var s=cc._decorator,n=s.ccclass,c=(s.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype.onLoad=function(){},e.prototype.update=function(t){},e=a([n],e)}(cc.Component));i.default=c,cc._RF.pop()},{}],ProfileData:[function(t,e,i){"use strict";cc._RF.push(e,"3a305mak+BBDYH9u8VjgWj6","ProfileData"),Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function t(){this.coins=0,this.level=0}return t.prototype.clearData=function(){cc.sys.localStorage.setItem("profileData",""),this.coins=0,this.level=0,this.skillList=[],console.log("clear data")},t}();i.default=o,cc._RF.pop()},{}],ProfileManager:[function(t,e,i){"use strict";cc._RF.push(e,"3b79fzUc29MC48RxhKZWFtj","ProfileManager");var o=this&&this.__decorate||function(t,e,i,o){var a,s=arguments.length,n=s<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(n=(s<3?a(n):s>3?a(e,i,n):a(e,i))||n);return s>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(i,"__esModule",{value:!0});var a=t("../data/ProfileData"),s=t("../data/SkillData"),n=cc._decorator,c=n.ccclass,r=(n.property,function(){function t(){this.data=new a.default,this.loadData()}return t.prototype.loadData=function(){this.data=new a.default,this.loadProfile()},t.prototype.getSaveData=function(){var t=cc.sys.localStorage.getItem("goblindata");return t?JSON.parse(t):null},t.prototype.saveData=function(){cc.sys.localStorage.setItem("goblindata",JSON.stringify(this.data)),console.log("save data")},t.prototype.clearData=function(){cc.sys.localStorage.setItem("goblindata",""),this.data.clearData(),console.log("clear data")},t.prototype.loadProfile=function(){var t=this.getSaveData();if(t&&(this.data.coins=t.coins,this.data.level=t.level,t.skillList)){for(var e=0;e<t.skillList.length;e++){var i=new s.default;i.valueCopy(t.skillList[e]),this.data.skillList.push(i)}console.log("data",this)}},t=o([c],t)}());i.default=r,cc._RF.pop()},{"../data/ProfileData":"ProfileData","../data/SkillData":"SkillData"}],Random:[function(t,e,i){"use strict";cc._RF.push(e,"6884aZwgtJKhYfD6AFDvIcl","Random"),Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function t(){}return t.prototype.setSeed=function(e){t.seed=e},t.rand=function(){return t.seed=(9301*t.seed+49297)%233280,t.seed/233280},t.getRandomNum=function(e,i){return e+Math.round(t.rand()*(i-e))},t.getHalfChance=function(){return t.rand()>.5},t.seed=(new Date).getTime(),t}();i.default=o,cc._RF.pop()},{}],SkillData:[function(t,e,i){"use strict";cc._RF.push(e,"37ed8O9yWpPf5V3BJDUJi/G","SkillData"),Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function t(){this.name="",this.desc="",this.resName="",this.red=0,this.blue=0,this.purple=0,this.green=0,this.oil=0,this.coin=0,this.operator=0}return t.prototype.init=function(t,e,i,o,a,s,n,c,r,l){this.name=t,this.desc=e,this.resName=i,this.red=o,this.blue=a,this.purple=s,this.green=n,this.oil=c,this.coin=r,this.operator=l},t.prototype.valueCopy=function(t){this.name=t.name?t.name:"",this.desc=t.desc?t.desc:"",this.resName=t.resName?t.resName:"",this.red=t.red?t.red:0,this.blue=t.blue?t.blue:0,this.purple=t.purple?t.purple:0,this.green=t.green?t.green:0,this.oil=t.oil?t.oil:0,this.coin=t.coin?t.coin:0,this.operator=t.operator?t.operator:0},t.prototype.clone=function(){var e=new t;return e.name=this.name,e.desc=this.desc,e.resName=this.resName,e.red=this.red,e.blue=this.blue,e.purple=this.purple,e.green=this.green,e.oil=this.oil,e.coin=this.coin,e.operator=this.operator,e},t.prototype.getElementArr=function(){return[this.red,this.blue,this.purple,this.green,this.oil,this.coin]},t}();i.default=o,cc._RF.pop()},{}],SkillIcon:[function(t,e,i){"use strict";cc._RF.push(e,"142d8pUH7hBCJM7QgfosCjc","SkillIcon");var o=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),a=this&&this.__decorate||function(t,e,i,o){var a,s=arguments.length,n=s<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(n=(s<3?a(n):s>3?a(e,i,n):a(e,i))||n);return s>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(i,"__esModule",{value:!0});var s=t("./data/SkillData"),n=t("./Logic"),c=t("./EventConstant"),r=cc._decorator,l=r.ccclass,h=(r.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.data=new s.default,e.isActive=!1,e.skillTipsNode=null,e.isLongPress=!1,e.touchStart=!1,e.checkTimeDelay=0,e}var i;return o(e,t),i=e,e.prototype.onLoad=function(){var t=this;this.effectChoose=this.node.getChildByName("effectChoose"),this.sprite=this.node.getChildByName("sprite").getComponent(cc.Sprite),this.effectChoose.active=!1,cc.director.on(c.EventConstant.USE_SKILL,function(e){t.isActive&&t.doOperator(e.detail.tapPos,e.detail.targetPos)}),this.node.on(cc.Node.EventType.TOUCH_START,function(e){t.touchStart=!0,t.isLongPress=!1,t.scheduleOnce(function(){if(t.touchStart&&t.skillTipsNode){t.isLongPress=!0;var e=t.data.name+"\n\n"+t.data.desc+"\n\n\n\u9700\u8981 \u7ea2\u65b9\uff1a"+t.data.red+" \u84dd\u661f\uff1a"+t.data.blue+" \u7d2b\u5706\uff1a"+t.data.purple+" \u7eff\u89d2\uff1a"+t.data.green+" \u71c3\u6599\uff1a"+t.data.oil;t.skillTipsNode.getChildByName("label").getComponent(cc.Label).string=e,t.skillTipsNode.opacity=255}},.3),255==t.node.opacity&&t.node.runAction(cc.scaleTo(.2,1.2))},this),this.node.on(cc.Node.EventType.TOUCH_END,function(e){if(t.skillTipsNode&&(t.skillTipsNode.opacity=0),t.node.runAction(cc.scaleTo(.2,1)),t.touchStart=!1,t.isLongPress)t.isLongPress=!1;else if(255==t.node.opacity)switch(t.data.operator){case i.OPERATOR_TAP:t.doOperator();break;case i.OPERATOR_CHOOSE:t.isActive=!t.isActive,n.default.isUseSkillChoose=t.isActive;break;case i.OPERATOR_SWIPE:t.isActive=!t.isActive,n.default.isUseSkillSwipe=t.isActive}},this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,function(e){t.touchStart=!1,t.skillTipsNode&&(t.skillTipsNode.opacity=0),t.node.runAction(cc.scaleTo(.2,1)),t.isLongPress&&(t.isLongPress=!1)},this)},e.prototype.init=function(t,e){this.skillManager=t,this.skillTipsNode=e,this.changeRes()},e.prototype.changeRes=function(){this.sprite.spriteFrame=n.default.spriteFrames[this.data.resName]},e.prototype.doOperator=function(t,e){this.isActive=!1,n.default.isUseSkillChoose=!1,n.default.isUseSkillSwipe=!1,this.skillManager&&this.skillManager.doOperator(this.data,t,e)},e.prototype.start=function(){},e.prototype.isCheckTimeDelay=function(t){return this.checkTimeDelay+=t,this.checkTimeDelay>.2&&(this.checkTimeDelay=0,!0)},e.prototype.update=function(t){this.isCheckTimeDelay(t)&&(this.effectChoose.active=this.isActive,this.node.opacity=n.default.updateElements(this.data.getElementArr(),!1)&&!n.default.isProcessing?255:128)},e.OPERATOR_TAP=0,e.OPERATOR_CHOOSE=1,e.OPERATOR_SWIPE=2,e=i=a([l],e)}(cc.Component));i.default=h,cc._RF.pop()},{"./EventConstant":"EventConstant","./Logic":"Logic","./data/SkillData":"SkillData"}],SkillManager:[function(t,e,i){"use strict";cc._RF.push(e,"48854JhQr5Ccph5vweim5Ji","SkillManager"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("../GameWorld"),a=t("../Logic"),s=t("../EventConstant"),n=t("../utils/AudioPlayer"),c=t("../data/BoomData"),r=t("../data/TileData"),l=cc._decorator,h=(l.ccclass,l.property,function(){function t(){}return t.prototype.doOperator=function(e,i,o){if(this.gameWorld&&a.default.updateElements(e.getElementArr(),!0))switch(e.resName){case t.SKILL001:a.default.step+=1,cc.director.emit(s.EventConstant.PLAY_AUDIO,{detail:{name:n.default.SKILL_001}}),this.changeOil();break;case t.SKILL002:this.tntBoom(i);break;case t.SKILL003:this.collectOil();break;case t.SKILL004:this.pickTile(i)}},t.prototype.tntBoom=function(t){for(var e=[],i=0,a=[cc.v2(t.x+1,t.y),cc.v2(t.x+1,t.y+1),cc.v2(t.x+1,t.y-1),cc.v2(t.x-1,t.y),cc.v2(t.x-1,t.y+1),cc.v2(t.x-1,t.y-1),cc.v2(t.x,t.y+1),cc.v2(t.x,t.y-1),t];i<a.length;i++){var s=a[i];o.default.isPosIndexValid(s)&&e.push(new c.default(s.x,s.y,!1,this.gameWorld.map[s.x][s.y].data.tileSpecial,!0,0))}e.length>0&&(this.gameWorld.boomList=this.gameWorld.getBoomList(e,[]),this.gameWorld.boomTiles(this.gameWorld.boomList))},t.prototype.pickTile=function(t){var e=[];o.default.isPosIndexValid(t)&&e.push(new c.default(t.x,t.y,!1,this.gameWorld.map[t.x][t.y].data.tileSpecial,!0,1)),e.length>0&&(this.gameWorld.boomList=this.gameWorld.getBoomList(e,[]),this.gameWorld.boomTiles(this.gameWorld.boomList))},t.prototype.changeOil=function(){a.default.elements.oil>=3&&(a.default.elements.oil-=3,a.default.step+=1,cc.director.emit(s.EventConstant.PLAY_AUDIO,{detail:{name:n.default.SKILL_001}}),this.changeOil())},t.prototype.collectOil=function(){for(var t=[],e=0;e<this.gameWorld.map.length;e++)for(var i=0;i<this.gameWorld.map[0].length;i++)this.gameWorld.map[e][i].data.tileType==r.default.OIL&&t.push(new c.default(e,i,!1,this.gameWorld.map[e][i].data.tileSpecial,!0,0));t.length>0&&(this.gameWorld.boomList=this.gameWorld.getBoomList(t,[]),this.gameWorld.boomTiles(this.gameWorld.boomList))},t.SKILL001="skill001",t.SKILL002="skill002",t.SKILL003="skill003",t.SKILL004="skill004",t}());i.default=h,cc._RF.pop()},{"../EventConstant":"EventConstant","../GameWorld":"GameWorld","../Logic":"Logic","../data/BoomData":"BoomData","../data/TileData":"TileData","../utils/AudioPlayer":"AudioPlayer"}],TileData:[function(t,e,i){"use strict";cc._RF.push(e,"660b86IF55MpZYbQRZo4A/l","TileData"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("../utils/Random"),a=function(){function t(e,i,o,a,s,n,c){this.tileType=t.EMPTY,this.resName="tile000",this.posIndex=cc.v2(0,0),this.tileSpecial=0,this.isEmpty=!1,this.isObstacle=!1,this.obstacleLevel=0,this.isBoss=!1,this.tileType=e,this.posIndex=i,this.resName=o,this.isEmpty=a,this.isObstacle=s,this.obstacleLevel=n,this.isBoss=c}return t.prototype.valueCopy=function(t){this.posIndex=cc.v2(t.posIndex.x,t.posIndex.y),this.statusCopy(t)},t.prototype.statusCopy=function(t){this.tileType=t.tileType,this.resName=t.resName,this.isEmpty=t.isEmpty,this.isObstacle=t.isObstacle,this.obstacleLevel=t.obstacleLevel?t.obstacleLevel:0,this.isBoss=t.isBoss},t.prototype.clone=function(){return new t(this.tileType,this.posIndex.clone(),this.resName,this.isEmpty,this.isObstacle,this.obstacleLevel,this.isBoss)},t.getEmptyTileData=function(e,i){return new t(t.EMPTY,cc.v2(e,i),t.EMPTY,!0,!1,0,!1)},t.getRandomTileData=function(e,i){var a="tile00"+o.default.getRandomNum(1,6);return new t(a,cc.v2(e,i),a,!1,!1,0,!1)},t.getObstacleTileData=function(e,i,o){var a="obstacle000";return new t(a,cc.v2(e,i),a,!1,!0,o,!1)},t.getBossTileData=function(e,i,o){var a="boss000";return new t(a,cc.v2(e,i),a,!1,!0,0,!0)},t.isTypeObstacleOrBoss=function(t){return t.indexOf("obstacle")>-1||t.indexOf("boss")>-1},t.EMPTY="tile000",t.RED="tile001",t.BLUE="tile002",t.PURPLE="tile003",t.GREEN="tile004",t.OIL="tile005",t.COIN="tile006",t.OBSTACLE="obstacle000",t.BOSS="boss000",t}();i.default=a,cc._RF.pop()},{"../utils/Random":"Random"}],Tile:[function(t,e,i){"use strict";cc._RF.push(e,"ffe19gYutBE3LyIrRIF5dD0","Tile");var o=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),a=this&&this.__decorate||function(t,e,i,o){var a,s=arguments.length,n=s<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(n=(s<3?a(n):s>3?a(e,i,n):a(e,i))||n);return s>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(i,"__esModule",{value:!0});var s=t("./Logic"),n=t("./GameWorld"),c=t("./EventConstant"),r=t("./utils/Utils"),l=cc._decorator,h=l.ccclass,p=(l.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype.onLoad=function(){var t=this;this.sprite=this.node.getChildByName("sprite").getComponent(cc.Sprite),this.glow=this.node.getChildByName("glow"),this.effectboom=this.node.getChildByName("effectboom"),this.effectobstcleboom=this.node.getChildByName("effectobstacleboom"),this.glow.opacity=0,this.effectboom.opacity=0,this.effectobstcleboom.opacity=0,this.node.on(cc.Node.EventType.TOUCH_START,function(){s.default.isPaused||(t.glow.opacity=80)},this),this.node.on(cc.Node.EventType.TOUCH_END,function(e){t.glow.opacity=0,s.default.isUseSkillChoose&&cc.director.emit(c.EventConstant.USE_SKILL,{detail:{tapPos:t.data.posIndex}})},this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,function(e){if(s.default.isProcessing||s.default.isPaused||s.default.isUseSkillChoose)t.glow.opacity=0;else{var i=t.node.convertToNodeSpaceAR(e.getLocation()),o=t.data.posIndex.clone();r.default.getDistance(cc.v2(0,0),i)<32||(Math.abs(i.x)>Math.abs(i.y)?o.x=i.x>0?o.x+1:o.x-1:o.y=i.y>0?o.y+1:o.y-1,s.default.isUseSkillSwipe?cc.director.emit(c.EventConstant.USE_SKILL,{detail:{tapPos:t.data.posIndex,targetPos:o}}):cc.director.emit(c.EventConstant.TILE_SWITCH,{detail:{tapPos:t.data.posIndex,targetPos:o}}),t.glow.opacity=0)}},this)},e.prototype.initTile=function(t){this.data=t,this.changeRes(),this.node.position=n.default.getPosInMap(t.posIndex)},e.prototype.showBoomEffect=function(){var t=this;this.effectboom.active=!0,this.effectboom.runAction(cc.sequence(cc.fadeIn(.1),cc.fadeOut(.5),cc.callFunc(function(){t.effectboom.active=!1})))},e.prototype.showBoomObstcleEffect=function(){var t=this;this.effectobstcleboom.active=!0,this.effectobstcleboom.runAction(cc.sequence(cc.fadeIn(.1),cc.fadeOut(.5),cc.callFunc(function(){t.effectobstcleboom.active=!1})))},e.prototype.updateTile=function(){this.changeRes(),this.node.position=n.default.getPosInMap(this.data.posIndex)},e.prototype.updateTilePosition=function(t,e){t?this.node.runAction(cc.sequence(cc.moveTo(.2,n.default.getPosInMap(this.data.posIndex)),cc.callFunc(e))):(this.node.position=n.default.getPosInMap(this.data.posIndex),e())},e.prototype.changeRes=function(){this.sprite||(this.sprite=this.node.getChildByName("sprite").getComponent(cc.Sprite));var t="";switch(this.data.tileSpecial){case 0:t="";break;case 1:t="four1";break;case 2:t="four2";break;case 3:t="cross";break;case 4:t="five"}this.data.isObstacle&&this.data.obstacleLevel>0&&(t="level"+this.data.obstacleLevel),this.sprite.spriteFrame=s.default.spriteFrames[this.data.resName+t],this.sprite.node.color=this.data.isBoss?cc.Color.BLACK:cc.Color.WHITE},e.prototype.start=function(){},e.prototype.changeTile=function(){},e.SPECIAL_NORMAL=0,e.SPECIAL_VERTICAL=1,e.SPECIAL_HORIZONTAL=2,e.SPECIAL_CROSS=3,e.SPECIAL_FIVE=4,e=a([h],e)}(cc.Component));i.default=p,cc._RF.pop()},{"./EventConstant":"EventConstant","./GameWorld":"GameWorld","./Logic":"Logic","./utils/Utils":"Utils"}],Utils:[function(t,e,i){"use strict";cc._RF.push(e,"b6c395Cn/hBcaIzEjpdihLD","Utils"),Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function t(){}return t.lerpnum=function(t,e,i){return t+(e-t)*i},t.lerp=function(t,e,i){var o=cc.v2(0,0),a=t.x,s=t.y;return o.x=a+(e.x-a)*i,o.y=s+(e.y-s)*i,o},t.getDistance=function(t,e){var i=t.x-e.x,o=t.y-e.y;return Math.sqrt(i*i+o*o)},t}();i.default=o,cc._RF.pop()},{}]},{},["Boss","CameraControl","EventConstant","GameHud","GameStart","GameWorld","KeyboardController","Loading","Logic","MainStage","MineStage","Player","SkillIcon","Tile","BoomData","BossData","FallRowData","ProfileData","SkillData","TileData","Elements","ProfileManager","SkillManager","List","ListItem","AudioPlayer","MapHelper","Random","Utils"]);
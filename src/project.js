require=function n(r,s,c){function l(e,t){if(!s[e]){if(!r[e]){var o="function"==typeof require&&require;if(!t&&o)return o(e,!0);if(p)return p(e,!0);var i=new Error("Cannot find module '"+e+"'");throw i.code="MODULE_NOT_FOUND",i}var a=s[e]={exports:{}};r[e][0].call(a.exports,function(t){return l(r[e][1][t]||t)},a,a.exports,n,r,s,c)}return s[e].exports}for(var p="function"==typeof require&&require,t=0;t<c.length;t++)l(c[t]);return l}({Bullet:[function(t,e,o){"use strict";cc._RF.push(e,"d243aeNu+tEJJbz1ng6i61f","Bullet"),Object.defineProperty(o,"__esModule",{value:!0});var s=t("../Monster"),c=t("../Player"),l=t("../Boss/Kraken"),p=t("../MeleeWeapon"),i=cc._decorator,a=i.ccclass,n=i.property,r=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.label=null,t.damage=1,t.speed=500,t.isMelee=!1,t.dir=0,t.tagetPos=cc.v2(0,0),t.hv=cc.v2(0,0),t.isFromPlayer=!1,t}return __extends(t,e),t.prototype.onLoad=function(){this.anim=this.getComponent(cc.Animation),this.rigidBody=this.getComponent(cc.RigidBody)},t.prototype.onEnable=function(){this.tagetPos=cc.v2(0,0),this.rigidBody.linearVelocity=cc.v2(0,0),this.sprite=this.node.getChildByName("sprite"),this.sprite.opacity=255,this.light=this.node.getChildByName("light"),this.light.opacity=0},t.prototype.MeleeFinish=function(){cc.director.emit("destorybullet",{bulletNode:this.node})},t.prototype.showBullet=function(t){this.hv=t,this.isMelee&&this.anim.play(this.node.name+"Show"),this.fire(this.hv)},t.prototype.BulletDestory=function(){cc.director.emit("destorybullet",{bulletNode:this.node})},t.prototype.fire=function(t){this.rigidBody||(this.rigidBody=this.getComponent(cc.RigidBody)),this.rigidBody.linearVelocity=cc.v2(this.speed*t.x,this.speed*t.y)},t.prototype.start=function(){},t.prototype.onBeginContact=function(t,e,o){var i=!0;e.body.node.name==o.body.node.name&&(i=!1),"Player"==o.body.node.name&&(i=!1),"Monster"==o.body.node.name&&(i=!1),o.sensor&&(i=!1),2==o.tag&&(i=!1),i&&this.anim&&(this.rigidBody.linearVelocity=cc.v2(0,0),this.anim.play("Bullet001Hit"))},t.prototype.onCollisionEnter=function(t,e){var o=!0;this.isFromPlayer&&"Player"==t.node.name&&(o=!1),this.isFromPlayer||"Monster"!=t.node.name||(o=!1),o&&this.attacking(t.node)},t.prototype.attacking=function(t){if(t){var e=this.damage,o=!1,i=t.getComponent(s.default);i&&!i.isDied&&(i.takeDamage(e),o=!0);var a=t.getComponent(c.default);a&&!a.isDied&&(a.takeDamage(e),o=!0);var n=t.getComponent(l.default);n&&!n.isDied&&(n.takeDamage(e,cc.v2(0,0)),o=!0);var r=t.getComponent(p.default);r&&r.isAttacking&&(o=!0),o&&this.anim&&(this.rigidBody.linearVelocity=cc.v2(0,0),this.anim.play("Bullet001Hit"))}},t.prototype.update=function(t){},__decorate([n(cc.Label)],t.prototype,"label",void 0),__decorate([n],t.prototype,"damage",void 0),__decorate([n],t.prototype,"speed",void 0),__decorate([n],t.prototype,"isMelee",void 0),t=__decorate([a],t)}(cc.Component);o.default=r,cc._RF.pop()},{"../Boss/Kraken":"Kraken","../MeleeWeapon":"MeleeWeapon","../Monster":"Monster","../Player":"Player"}],CameraControl:[function(t,e,o){"use strict";cc._RF.push(e,"aaca098lw9M94SueX+ajVM7","CameraControl"),Object.defineProperty(o,"__esModule",{value:!0});var i=cc._decorator,a=i.ccclass,n=i.property,r=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.target=null,t}return __extends(t,e),t.prototype.onLoad=function(){this.camera=this.getComponent(cc.Camera)},t.prototype.onEnable=function(){cc.director.getPhysicsManager().attachDebugDrawToCamera(this.camera)},t.prototype.onDisable=function(){cc.director.getPhysicsManager().detachDebugDrawFromCamera(this.camera)},t.prototype.start=function(){},t.prototype.lateUpdate=function(){var t=this.target.convertToWorldSpaceAR(cc.Vec2.ZERO);this.node.position=this.node.parent.convertToNodeSpaceAR(t);var e=t.y/cc.winSize.height;this.camera.zoomRatio=1+.5*(.5-e)},__decorate([n(cc.Node)],t.prototype,"target",void 0),t=__decorate([a],t)}(cc.Component);o.default=r,cc._RF.pop()},{}],Chapter:[function(t,e,o){"use strict";cc._RF.push(e,"e966c6tQ3FASbN1WCJi24PI","Chapter"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("./Logic"),a=cc._decorator,n=a.ccclass,r=a.property,s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.chapter00=null,t.chapter01=null,t.chapter02=null,t.chapter03=null,t.chapter04=null,t.timeDelay=0,t}return __extends(t,e),t.prototype.start=function(){i.default.setAlias(this.chapter00.node),i.default.setAlias(this.chapter01.node),i.default.setAlias(this.chapter02.node),i.default.setAlias(this.chapter03.node),i.default.setAlias(this.chapter04.node)},t.prototype.clickChapter=function(t,e){e&&(i.default.chapterName=e,i.default.resetData()),"chapter00"==e&&i.default.playerData.updateHA(cc.v2(100,100),1),cc.director.loadScene("loading")},t.prototype.isTimeDelay=function(t){return this.timeDelay+=t,.016<this.timeDelay&&!(this.timeDelay=0)},t.prototype.update=function(t){this.isTimeDelay(t)},__decorate([r(cc.Button)],t.prototype,"chapter00",void 0),__decorate([r(cc.Button)],t.prototype,"chapter01",void 0),__decorate([r(cc.Button)],t.prototype,"chapter02",void 0),__decorate([r(cc.Button)],t.prototype,"chapter03",void 0),__decorate([r(cc.Button)],t.prototype,"chapter04",void 0),t=__decorate([n],t)}(cc.Component);o.default=s,cc._RF.pop()},{"./Logic":"Logic"}],Chest:[function(t,e,o){"use strict";cc._RF.push(e,"a259fOC11hFpJCy2hycs7kH","Chest"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("../Dungeon"),a=t("../Manager/EquipmentManager"),r=t("../Logic"),n=cc._decorator,s=n.ccclass,c=n.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.rewards=[a.default.WEAPON_KNIFE,a.default.CLOTHES_SHIRT,a.default.CLOTHES_VEST,a.default.HELMET_BUCKETHAT,a.default.WEAPON_PITCHFORK],t.openSpriteFrame=null,t.closeSpriteFrame=null,t.isOpen=!1,t.pos=cc.v2(0,0),t.timeDelay=0,t.quality=1,t}return __extends(t,e),t.prototype.onLoad=function(){this.sprite=this.node.getChildByName("sprite")},t.prototype.start=function(){},t.prototype.setQuality=function(t,e){this.quality=t,this.isOpen=e,this.sprite||(this.sprite=this.node.getChildByName("sprite"));var o="chest001",i="chestopen001";switch(t){case 1:o="chest001",i="chestopen001";break;case 2:o="chest003",i="chestopen003";break;case 3:o="chest002",i="chestopen002"}var a=r.default.spriteFrames[o],n=r.default.spriteFrames[i];this.openSpriteFrame=a,this.closeSpriteFrame=n,this.sprite.getComponent(cc.Sprite).spriteFrame=this.openSpriteFrame,e&&(this.sprite.getComponent(cc.Sprite).spriteFrame=this.closeSpriteFrame)},t.prototype.setPos=function(t){this.pos=t,this.node.position=i.default.getPosInMap(t),this.node.zIndex=3e3+100*(i.default.HEIGHT_SIZE-t.y)+1},t.prototype.openChest=function(){var e=this;if(!this.isOpen){this.isOpen=!0;var t=cc.sequence(cc.moveTo(.1,5,16),cc.moveTo(.1,-5,0),cc.moveTo(.1,5,0),cc.moveTo(.1,-5,0),cc.moveTo(.1,0,0),cc.callFunc(function(){if(e.sprite.getComponent(cc.Sprite).spriteFrame=e.closeSpriteFrame,e.node.parent){var t=e.node.parent.getComponent(i.default);t&&t.addEquipment(e.rewards[r.default.getRandomNum(0,e.rewards.length-1)],e.pos,null,e.quality)}}));this.sprite.runAction(t)}},t.prototype.onCollisionStay=function(t,e){3==t.tag&&(this.isOpen||this.openChest())},t.prototype.update=function(t){},__decorate([c(cc.SpriteFrame)],t.prototype,"openSpriteFrame",void 0),__decorate([c(cc.SpriteFrame)],t.prototype,"closeSpriteFrame",void 0),t=__decorate([s],t)}(cc.Component);o.default=l,cc._RF.pop()},{"../Dungeon":"Dungeon","../Logic":"Logic","../Manager/EquipmentManager":"EquipmentManager"}],Controller:[function(t,e,o){"use strict";cc._RF.push(e,"12f66EVamVPmoXVKYdoGHk5","Controller"),Object.defineProperty(o,"__esModule",{value:!0});var i=cc._decorator,a=i.ccclass,n=i.property,r=t("./EventConstant"),s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.player=null,t.mainAction=null,t.mainActionTouched=!1,t.secondAction=null,t.secondActionTouched=!1,t.timeDelay=0,t}return __extends(t,e),t.prototype.onLoad=function(){for(var t=this.node.getComponentsInChildren(cc.Sprite),e=0;e<t.length;e++)t[e].spriteFrame.getTexture().setAliasTexParameters();this.mainAction.on(cc.Node.EventType.TOUCH_START,function(t){this.mainActionTouched=!0},this),this.mainAction.on(cc.Node.EventType.TOUCH_END,function(t){this.mainActionTouched=!1},this),this.mainAction.on(cc.Node.EventType.TOUCH_CANCEL,function(t){this.mainActionTouched=!1},this),this.secondAction.on(cc.Node.EventType.TOUCH_START,function(t){this.secondActionTouched=!0},this),this.secondAction.on(cc.Node.EventType.TOUCH_END,function(t){this.secondActionTouched=!1},this),this.secondAction.on(cc.Node.EventType.TOUCH_CANCEL,function(t){this.secondActionTouched=!1},this)},t.prototype.thirdAction=function(){cc.director.emit(r.EventConstant.PLAYER_USEITEM)},t.prototype.move=function(t,e){e=parseInt(e),cc.director.emit(r.EventConstant.PLAYER_MOVE,{dir:e})},t.prototype.isTimeDelay=function(t){return this.timeDelay+=t,.016<this.timeDelay&&!(this.timeDelay=0)},t.prototype.update=function(t){this.isTimeDelay(t)&&(this.mainActionTouched&&cc.director.emit(r.EventConstant.PLAYER_ATTACK),this.secondActionTouched&&cc.director.emit(r.EventConstant.PLAYER_REMOTEATTACK))},__decorate([n(cc.Node)],t.prototype,"player",void 0),__decorate([n(cc.Node)],t.prototype,"mainAction",void 0),__decorate([n(cc.Node)],t.prototype,"secondAction",void 0),t=__decorate([a],t)}(cc.Component);o.default=s,cc._RF.pop()},{"./EventConstant":"EventConstant"}],Door:[function(t,e,o){"use strict";cc._RF.push(e,"f14f52tIg1Ivb0Rnl80O8tL","Door"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("../Player"),a=t("../EventConstant"),n=cc._decorator,r=n.ccclass,s=n.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.isOpen=!1,t.isDoor=!0,t.dir=0,t.wall=null,t}return __extends(t,e),t.prototype.onLoad=function(){this.anim=this.getComponent(cc.Animation)},t.prototype.start=function(){},t.prototype.setOpen=function(t){this.isDoor?(this.wall.active=!1,t?this.openGate():this.closeGate()):this.wall.active=!0},t.prototype.openGate=function(){this.isOpen||(this.isOpen=!0,this.anim.play("DoorOpen"))},t.prototype.closeGate=function(){this.isOpen&&(this.isOpen=!1,this.anim.play("DoorClose"))},t.prototype.onCollisionEnter=function(t,e){t.node.getComponent(i.default)&&this.isOpen&&cc.director.emit(a.EventConstant.LOADINGROOM,{dir:this.dir})},__decorate([s],t.prototype,"dir",void 0),__decorate([s(cc.Node)],t.prototype,"wall",void 0),t=__decorate([r],t)}(cc.Component);o.default=c,cc._RF.pop()},{"../EventConstant":"EventConstant","../Player":"Player"}],DungeonStyleManager:[function(t,e,o){"use strict";cc._RF.push(e,"96118QtbixO743MdRQKBctE","DungeonStyleManager"),Object.defineProperty(o,"__esModule",{value:!0});var r=t("../Logic"),s=t("../Building/Door"),i=cc._decorator,a=i.ccclass,n=i.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.background01=null,t.background02=null,t.wallTop=null,t.wallLeft=null,t.wallRight=null,t.wallBottom=null,t.wallDecoration01=null,t.wallDecoration02=null,t.doorRes=null,t}return __extends(t,e),t.prototype.onLoad=function(){switch(r.default.chapterName){case"chapter00":this.setStyle(null,"restwall","restsides","restdoor","restdecoration01",null);break;case"chapter01":this.setStyle("sea","shipwall","handrail","shipdoor","swimring","swimring");break;case"chapter02":this.setStyle("sea","junglewall","junglesides","dungeondoor",null,null);break;case"chapter03":this.setStyle("sandsea","pyramidwall","pyramidsides","dungeondoor",null,null);break;case"chapter04":this.setStyle("magmasea","dungeonwall","dungeonsides","dungeondoor",null,null)}},t.prototype.start=function(){},t.prototype.setStyle=function(t,e,o,i,a,n){this.doorRes=i,this.background01.getComponent(cc.Sprite).spriteFrame=t?r.default.spriteFrames[t]:null,this.background02.getComponent(cc.Sprite).spriteFrame=t?r.default.spriteFrames[t]:null,this.setWall(this.wallTop,e,i),this.setWall(this.wallBottom,e,i),this.setWall(this.wallLeft,o,i),this.setWall(this.wallRight,o,i),this.wallDecoration01.getComponent(cc.Sprite).spriteFrame=a?r.default.spriteFrames[a]:null,this.wallDecoration02.getComponent(cc.Sprite).spriteFrame=n?r.default.spriteFrames[n]:null},t.prototype.setWall=function(t,e,o){t.getChildByName("wallleft").getComponent(cc.Sprite).spriteFrame=e?r.default.spriteFrames[e]:null,t.getChildByName("wallright").getComponent(cc.Sprite).spriteFrame=e?r.default.spriteFrames[e]:null,t.getChildByName("wallcenter").getComponent(cc.Sprite).spriteFrame=e?r.default.spriteFrames[e]:null,t.getChildByName("door").getChildByName("sprite").getComponent(cc.Sprite).spriteFrame=o?r.default.spriteFrames[o]:null},t.prototype.setDoor=function(t,e,o){var i=null;switch(t){case 0:i=this.wallTop;break;case 1:i=this.wallBottom;break;case 2:i=this.wallLeft;break;case 3:i=this.wallRight}if(i){var a=this.doorRes;i.getChildByName("door").getChildByName("sprite").getComponent(cc.Sprite).spriteFrame=a?r.default.spriteFrames[a]:null;var n=i.getChildByName("door").getComponent(s.default);n&&(n.isDoor=e,n.setOpen(o))}},__decorate([n(cc.Node)],t.prototype,"background01",void 0),__decorate([n(cc.Node)],t.prototype,"background02",void 0),__decorate([n(cc.Node)],t.prototype,"wallTop",void 0),__decorate([n(cc.Node)],t.prototype,"wallLeft",void 0),__decorate([n(cc.Node)],t.prototype,"wallRight",void 0),__decorate([n(cc.Node)],t.prototype,"wallBottom",void 0),__decorate([n(cc.Node)],t.prototype,"wallDecoration01",void 0),__decorate([n(cc.Node)],t.prototype,"wallDecoration02",void 0),t=__decorate([a],t)}(cc.Component);o.default=c,cc._RF.pop()},{"../Building/Door":"Door","../Logic":"Logic"}],Dungeon:[function(t,e,o){"use strict";cc._RF.push(e,"6dd52klzMJJgafrk2kw2YVi","Dungeon"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("./Player"),d=t("./Tile"),u=t("./Logic"),m=t("./EventConstant"),y=t("./Manager/MonsterManager"),f=t("./Building/Portal"),g=t("./Building/Wall"),v=t("./Building/Trap"),_=t("./Item/Item"),E=t("./Manager/EquipmentManager"),R=t("./Manager/DungeonStyleManager"),D=t("./Rect/RectRoom"),c=t("./Rect/RectDungeon"),M=t("./Building/Chest"),a=cc._decorator,n=a.ccclass,r=a.property,s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tile=null,t.wall=null,t.trap=null,t.chest=null,t.heart=null,t.player=null,t.portalPrefab=null,t.portal=null,t.fog=null,t.map=new Array,t.wallmap=new Array,t.trapmap=new Array,t.itemmap=new Array,t.timeDelay=0,t.npcTimeDelay=0,t.monsterReswpanPoints={},t.monsterManager=null,t.equipmentManager=null,t.dungeonStyleManager=null,t}return __extends(t,e),(h=t).prototype.onLoad=function(){var e=this;this.anim=this.getComponent(cc.Animation),cc.director.on(m.EventConstant.PLAYER_MOVE,function(t){e.playerAction(t.detail.dir,t.detail.pos,t.detail.dt)}),cc.director.on(m.EventConstant.DUNGEON_SETEQUIPMENT,function(t){e.addEquipment(t.detail.equipmentData.img,t.detail.pos,t.detail.equipmentData)}),cc.director.on(m.EventConstant.DUNGEON_SHAKEONCE,function(t){e.anim&&e.anim.play("DungeonShakeOnce")}),this.fog.zIndex=9e3,this.monsterManager=this.getComponent(y.default),this.equipmentManager=this.getComponent(E.default),this.dungeonStyleManager=this.getComponent(R.default),this.player.node.parent=this.node;var t=u.default.getCurrentMapData().map;this.monsters=new Array,this.map=new Array,this.wallmap=new Array,this.trapmap=new Array,this.itemmap=new Array;for(var o=0;o<h.WIDTH_SIZE;o++){this.map[o]=new Array(o),this.wallmap[o]=new Array(o),this.trapmap[o]=new Array(o),this.itemmap[o]=new Array(o);for(var i=0;i<h.HEIGHT_SIZE;i++){var a=cc.instantiate(this.tile);if(a.parent=this.node,a.position=h.getPosInMap(cc.v2(o,i)),a.zIndex=1e3+100*(h.HEIGHT_SIZE-i),this.map[o][i]=a.getComponent(d.default),this.map[o][i].isAutoShow=!1,"#"==t[o][i]&&(this.map[o][i].isAutoShow=!0),"W"==t[o][i]){var n=cc.instantiate(this.wall);n.parent=this.node,n.position=h.getPosInMap(cc.v2(o,i)),n.zIndex=3e3+100*(h.HEIGHT_SIZE-i),n.opacity=255,this.wallmap[o][i]=n.getComponent(g.default)}if("T"==t[o][i]){var r=cc.instantiate(this.trap);r.parent=this.node,r.position=h.getPosInMap(cc.v2(o,i)),r.zIndex=3e3+100*(h.HEIGHT_SIZE-i),this.trapmap[o][i]=r.getComponent(v.default)}if("C"==t[o][i]){var s=cc.instantiate(this.chest);s.parent=this.node;var c=s.getComponent(M.default);c.setPos(cc.v2(o,i)),c.setQuality(u.default.getRandomNum(1,3),u.default.mapManger.currentRectRoom.state==D.default.STATE_CLEAR)}if("H"==t[o][i]){var l=cc.instantiate(this.heart);l.parent=this.node,l.position=h.getPosInMap(cc.v2(o,i)),l.zIndex=3e3+100*(h.HEIGHT_SIZE-i)+3,this.itemmap[o][i]=l.getComponent(_.default)}if(u.default.mapManger.currentRectRoom.state!=D.default.STATE_CLEAR&&("s"==t[o][i]&&this.addMonsterFromData(y.default.MONSTER_SAILOR,o,i),"p"==t[o][i]&&this.addMonsterFromData(y.default.MONSTER_PIRATE,o,i),"o"==t[o][i]&&this.addMonsterFromData(y.default.MONSTER_OCTOPUS,o,i),"a"==t[o][i]&&this.addMonsterFromData(y.default.MONSTER_SLIME,o,i)),"P"==t[o][i]){var p=cc.instantiate(this.portalPrefab);p.parent=this.node,this.portal=p.getComponent(f.default),this.portal&&this.portal.setPos(cc.v2(o,i))}}}this.addkraken()},t.prototype.addEquipment=function(t,e,o,i){this.equipmentManager&&this.equipmentManager.getEquipment(t,e,this.node,o,i)},t.prototype.addMonsterFromData=function(t,e,o){this.addMonster(this.monsterManager.getMonster(t,this.node),cc.v2(e,o))},t.prototype.breakHalfTiles=function(){for(var t=0;t<h.WIDTH_SIZE;t++)for(var e=6;e<h.HEIGHT_SIZE;e++)this.map[t][e].isAutoShow=!1,this.breakTile(cc.v2(t,e))},t.prototype.addkraken=function(){var t=this;u.default.isBossLevel(u.default.level)&&(this.anim.playAdditive("DungeonShake"),this.breakHalfTiles(),setTimeout(function(){t.bossKraken=t.monsterManager.getKraken(t.node),t.bossKraken.showBoss(),t.anim.play("DungeonWave")},4e3))},t.prototype.addMonster=function(t,e){t.node.active=!0,t.pos=e,t.node.position=h.getPosInMap(e),this.monsters.push(t)},t.getPosInMap=function(t){var e=h.MAPX+t.x*h.TILE_SIZE,o=h.MAPY+t.y*h.TILE_SIZE;return cc.v2(e,o)},t.getIndexInMap=function(t){var e=(t.x-h.MAPX)/h.TILE_SIZE,o=(t.y-h.MAPY)/h.TILE_SIZE;return e=Math.round(e),o=Math.round(o),e<0&&(e=0),e>=h.WIDTH_SIZE&&(e=h.WIDTH_SIZE-1),o<0&&(o=0),o>=h.HEIGHT_SIZE&&(o=h.HEIGHT_SIZE-1),cc.v2(e,o)},t.fixOuterMap=function(t){var e=(t.x-h.MAPX)/h.TILE_SIZE,o=(t.y-h.MAPY)/h.TILE_SIZE;e=Math.round(e),o=Math.round(o);var i=!1;return e<0&&(i=!(e=0)),e>=h.WIDTH_SIZE&&(e=h.WIDTH_SIZE-1,i=!0),o<0&&(i=!(o=0)),o>=h.HEIGHT_SIZE&&(o=h.HEIGHT_SIZE-1,i=!0),i?h.getPosInMap(cc.v2(e,o)):t},t.prototype.start=function(){for(var t=this.node.getComponentsInChildren(cc.Sprite),e=0;e<t.length;e++)t[e].spriteFrame&&t[e].spriteFrame.getTexture().setAliasTexParameters();cc.director.emit(m.EventConstant.CHANGE_MIMIMAP,{x:u.default.mapManger.currentRectRoom.x,y:u.default.mapManger.currentRectRoom.y});for(var o=0,i=u.default.mapManger.currentRectRoom.doors;o<i.length;o++){var a=i[o];this.dungeonStyleManager.setDoor(a.dir,a.isDoor,!1)}},t.prototype.breakTile=function(t){var e=this.map[t.x][t.y];e.isBroken||e.breakTile()},t.prototype.playerAction=function(t,e,o){this.player&&this.player.playerAction(t,e,o,this)},t.prototype.monstersAction=function(){for(var t=0,e=0,o=this.monsters;e<o.length;e++){var i=o[e];i.isDied&&t++,i.monsterAction(this)}if(!u.default.isBossLevel(u.default.level)&&t>=this.monsters.length){this.portal&&this.portal.openGate();for(var a=0,n=u.default.mapManger.currentRectRoom.doors;a<n.length;a++){var r=n[a];u.default.mapManger.currentRectRoom.state=D.default.STATE_CLEAR;var s=!1;if(c.default.isRoomEqual(u.default.mapManger.currentRectRoom,u.default.mapManger.rectDungeon.startRoom))if(u.default.mapManger.rectDungeon.endRoom.state!=D.default.STATE_CLEAR)u.default.mapManger.rectDungeon.getNeighborRoomType(u.default.mapManger.currentRectRoom.x,u.default.mapManger.currentRectRoom.y,r.dir).roomType==c.default.END_ROOM&&(s=!0);1==u.default.level&&(s=!1),s||this.dungeonStyleManager.setDoor(r.dir,r.isDoor,!0)}}u.default.isBossLevel(u.default.level)&&this.bossKraken&&this.bossKraken.isDied&&this.portal&&this.portal.openGate()},t.prototype.checkPlayerPos=function(t){this.fog.setPosition(cc.pLerp(this.fog.position,this.player.node.position,3*t));var e=h.getIndexInMap(this.player.node.position),o=this.map[e.x][e.y];o.isBroken&&(this.player.isMoving||this.player.fall()),o.isAutoShow&&this.breakTile(e)},t.prototype.checkMonstersPos=function(){for(var t=0,e=this.monsters;t<e.length;t++){var o=e[t];if(o.isDied)return;this.map[o.pos.x][o.pos.y].isBroken&&o.fall()}},t.prototype.isTimeDelay=function(t){return this.timeDelay+=t,.016<this.timeDelay&&!(this.timeDelay=0)},t.prototype.isNpcTimeDelay=function(t){return this.npcTimeDelay+=t,1<this.npcTimeDelay&&!(this.npcTimeDelay=0)},t.prototype.update=function(t){this.isTimeDelay(t)&&(this.checkPlayerPos(t),this.checkMonstersPos()),this.isNpcTimeDelay(t)&&this.monstersAction()},t.WIDTH_SIZE=15,t.HEIGHT_SIZE=9,t.MAPX=32,t.MAPY=32,t.TILE_SIZE=64,__decorate([r(cc.Prefab)],t.prototype,"tile",void 0),__decorate([r(cc.Prefab)],t.prototype,"wall",void 0),__decorate([r(cc.Prefab)],t.prototype,"trap",void 0),__decorate([r(cc.Prefab)],t.prototype,"chest",void 0),__decorate([r(cc.Prefab)],t.prototype,"heart",void 0),__decorate([r(i.default)],t.prototype,"player",void 0),__decorate([r(cc.Prefab)],t.prototype,"portalPrefab",void 0),__decorate([r(cc.Node)],t.prototype,"fog",void 0),t=h=__decorate([n],t);var h}(cc.Component);o.default=s,cc._RF.pop()},{"./Building/Chest":"Chest","./Building/Portal":"Portal","./Building/Trap":"Trap","./Building/Wall":"Wall","./EventConstant":"EventConstant","./Item/Item":"Item","./Logic":"Logic","./Manager/DungeonStyleManager":"DungeonStyleManager","./Manager/EquipmentManager":"EquipmentManager","./Manager/MonsterManager":"MonsterManager","./Player":"Player","./Rect/RectDungeon":"RectDungeon","./Rect/RectRoom":"RectRoom","./Tile":"Tile"}],EquipmentData:[function(t,e,o){"use strict";cc._RF.push(e,"a5970exQi1ISK2QZd4VAwv9","EquipmentData"),Object.defineProperty(o,"__esModule",{value:!0});var i=cc._decorator,a=i.ccclass,n=(i.property,function(){function t(){this.nameCn="",this.nameEn="",this.equipmetType="empty",this.equipmetTypeCn="",this.prefix="",this.desc="",this.damageMin=0,this.damageMax=0,this.criticalStrikeRate=0,this.defence=0,this.lifeDrain=0,this.lifeRecovery=0,this.moveSpeed=0,this.attackSpeed=0,this.dodge=0,this.health=0,this.color="#ffffff",this.titlecolor="#ffffff",this.img="emptyequipment",this.stab=0}return(o=t).prototype.valueCopy=function(t){var e=new o;return this.nameCn=t.nameCn,this.nameEn=t.nameEn,this.equipmetType=t.equipmetType,this.equipmetTypeCn=t.equipmetTypeCn,this.prefix=t.prefix,this.desc=t.desc,this.damageMin=t.damageMin,this.damageMax=t.damageMax,this.criticalStrikeRate=t.criticalStrikeRate,this.defence=t.defence,this.lifeDrain=t.lifeDrain,this.lifeRecovery=t.lifeRecovery,this.moveSpeed=t.moveSpeed,this.attackSpeed=t.attackSpeed,this.dodge=t.dodge,this.health=t.health,this.color=t.color,this.titlecolor=t.titlecolor,this.img=t.img,this.stab=t.stab,e},t.prototype.clone=function(){var t=new o;return t.nameCn=this.nameCn,t.nameEn=this.nameEn,t.equipmetType=this.equipmetType,t.equipmetTypeCn=this.equipmetTypeCn,t.prefix=this.prefix,t.desc=this.desc,t.damageMin=this.damageMin,t.damageMax=this.damageMax,t.criticalStrikeRate=this.criticalStrikeRate,t.defence=this.defence,t.lifeDrain=this.lifeDrain,t.lifeRecovery=this.lifeRecovery,t.moveSpeed=this.moveSpeed,t.attackSpeed=this.attackSpeed,t.dodge=this.dodge,t.health=this.health,t.color=this.color,t.titlecolor=this.titlecolor,t.img=this.img,t.stab=this.stab,t},t=o=__decorate([a],t);var o}());o.default=n,cc._RF.pop()},{}],EquipmentDescData:[function(t,e,o){"use strict";cc._RF.push(e,"d7742jFusdGiIE+18obcC2k","EquipmentDescData"),Object.defineProperty(o,"__esModule",{value:!0});var i=cc._decorator,a=i.ccclass,n=(i.property,function(){function t(){this.nameCn="",this.nameEn="",this.damageMin=0,this.damageMax=0,this.criticalStrikeRate=0,this.defence=0,this.lifeDrain=0,this.lifeRecovery=0,this.moveSpeed=0,this.attackSpeed=0,this.dodge=0,this.health=0,this.titlecolor="#ffffff",this.color="#ffffff",this.prefix=""}return t=__decorate([a],t)}());o.default=n,cc._RF.pop()},{}],EquipmentDialog:[function(t,e,o){"use strict";cc._RF.push(e,"9bf82hBG9BGv4V/KYPwSFw+","EquipmentDialog"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("../Logic"),a=cc._decorator,n=a.ccclass,r=a.property,s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.nametag=null,t.desc=null,t.damage=null,t.criticalStrikeRate=null,t.defence=null,t.lifeDrain=null,t.moveSpeed=null,t.attackSpeed=null,t.dodge=null,t.health=null,t.lifeRecovery=null,t.alpha=0,t.showSpeed=3,t}return __extends(t,e),t.prototype.start=function(){i.default.setAlias(this.node),this.alpha=0,this.node.opacity=0,this.showSpeed=30},t.prototype.refreshDialog=function(t){this.nametag.string=t.prefix+" "+t.nameEn,this.nametag.node.color=this.nametag.node.color.fromHEX(t.titlecolor),this.desc.string=t.desc,this.damage.string=t.damageMin+"-"+t.damageMax,this.attackSpeed.string=t.attackSpeed+"%",this.moveSpeed.string=t.moveSpeed+"%",this.dodge.string=t.dodge+"%",this.lifeDrain.string=t.lifeDrain+"%",this.lifeRecovery.string=t.lifeRecovery+"",this.health.string=t.health+"",this.defence.string=t.defence+"",this.criticalStrikeRate.string=t.criticalStrikeRate+"%"},t.prototype.showDialog=function(){this.showSpeed=3,this.node.opacity=255},t.prototype.hideDialog=function(){this.showSpeed=30,this.node.opacity=0},t.prototype.update=function(t){},t.prototype.lerp=function(t,e,o){return t+(e-t)*o},__decorate([r(cc.Label)],t.prototype,"nametag",void 0),__decorate([r(cc.Label)],t.prototype,"desc",void 0),__decorate([r(cc.Label)],t.prototype,"damage",void 0),__decorate([r(cc.Label)],t.prototype,"criticalStrikeRate",void 0),__decorate([r(cc.Label)],t.prototype,"defence",void 0),__decorate([r(cc.Label)],t.prototype,"lifeDrain",void 0),__decorate([r(cc.Label)],t.prototype,"moveSpeed",void 0),__decorate([r(cc.Label)],t.prototype,"attackSpeed",void 0),__decorate([r(cc.Label)],t.prototype,"dodge",void 0),__decorate([r(cc.Label)],t.prototype,"health",void 0),__decorate([r(cc.Label)],t.prototype,"lifeRecovery",void 0),t=__decorate([n],t)}(cc.Component);o.default=s,cc._RF.pop()},{"../Logic":"Logic"}],EquipmentManager:[function(t,e,o){"use strict";cc._RF.push(e,"29c053rRnlLqrw1VkMXkISC","EquipmentManager"),Object.defineProperty(o,"__esModule",{value:!0});var l=t("../Dungeon"),p=t("../Logic"),h=t("../Data/EquipmentData"),y=t("../Data/EquipmentDescData"),d=t("../Equipment/Equipment"),i=cc._decorator,a=i.ccclass,n=i.property,r=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.equipment=null,t}return __extends(t,e),(m=t).prototype.onLoad=function(){},t.prototype.getRandomDesc=function(t,e){var o=new y.default,i=0,a=this.getRandomQuality(0,100-t.criticalStrikeRate,e);i=a.y>i?a.y:i,o.prefix+=2<a.y?"criticalstrike ":"",o.color=this.getMixColor("#000000",2<a.y?m.COLOR_CRITICALSTRIKE:"#000000");var n=this.getRandomQuality(0,10,e);i=n.y>i?n.y:i;var r=this.getRandomQuality(n.x,n.x+10,e);i=r.y>i?r.y:i,o.prefix+=2<r.y?"strong ":"",o.color=this.getMixColor(o.color,2<r.y?m.COLOR_POWERFUL:"#000000");var s=this.getRandomQuality(0,10,e);i=s.y>i?s.y:i,o.prefix+=2<s.y?"stable ":"",o.color=this.getMixColor(o.color,2<s.y?m.COLOR_STABLE:"#000000");var c=this.getRandomQuality(0,100,e);i=c.y>i?c.y:i,o.prefix+=2<c.y?"drain ":"",o.color=this.getMixColor(o.color,2<c.y?m.COLOR_LIFEDRAIN:"#000000");var l=Math.random()<.1?this.getRandomQuality(0,5,e):cc.v2(0,0);i=l.y>i?l.y:i,o.prefix+=2<l.y?"recovery ":"",o.color=this.getMixColor(o.color,2<l.y?m.COLOR_RECOVERY:"#000000");var p=this.getRandomQuality(0,300-t.moveSpeed,e);i=p.y>i?p.y:i,o.prefix+=2<p.y?"fast ":"",o.color=this.getMixColor(o.color,2<p.y?m.COLOR_MOVESPEED:"#000000");var h=this.getRandomQuality(0,400-t.attackSpeed,e);i=h.y>i?h.y:i,o.prefix+=2<h.y?"quick ":"",o.color=this.getMixColor(o.color,2<h.y?m.COLOR_ATTACKSPPED:"#000000");var d=this.getRandomQuality(0,60-t.dodge,e);i=d.y>i?d.y:i,o.prefix+=2<d.y?"agile ":"",o.color=this.getMixColor(o.color,2<d.y?m.COLOR_DODGE:"#000000");var u=this.getRandomQuality(0,50,e);return i=u.y>i?u.y:i,o.prefix+=2<u.y?"healthy ":"",o.color=this.getMixColor(o.color,2<u.y?m.COLOR_HEALTHY:"#000000"),o.prefix=["rough","normal","good","excellent","epic","legend"][i]+" "+o.prefix,o.titlecolor=["#dcdcdc","#ffffff","#00ff00","#0000ff","#800080","#ffa500"][i],o.color="#000000"==o.color?"#ffffff":o.color,o.criticalStrikeRate=a.x,o.damageMin=n.x,o.damageMax=r.x,o.defence=s.x,o.lifeDrain=c.x,o.lifeRecovery=l.x,o.moveSpeed=p.x,o.attackSpeed=h.x,o.dodge=d.x,o.health=u.x,o},t.prototype.getRandomQuality=function(t,e,o){var i=(e-t)/5,a=Math.random();if(o&&.9<a)switch(o){case 1:a=.7<Math.random()?.5:.004;break;case 2:a=.7<Math.random()?.06:.08;break;case 3:a=.7<Math.random()?.086:.09}var n=cc.v2(0,0);return a<.005?(n.x=p.default.getRandomNum(0,i),n.y=1):.05<=a&&a<.075?(n.x=p.default.getRandomNum(i,2*i),n.y=2):.075<=a&&a<.085?(n.x=p.default.getRandomNum(2*i,3*i),n.y=3):.085<=a&&a<.09?(n.x=p.default.getRandomNum(3*i,4*i),n.y=4):.09<=a&&a<.091&&(n.x=p.default.getRandomNum(4*i,5*i),n.y=5),n.x=parseFloat(n.x.toFixed(0)),n},t.prototype.getEquipment=function(t,e,o,i,a){var n=cc.instantiate(this.equipment);n.parent=o,n.position=l.default.getPosInMap(e),n.zIndex=3e3+100*(l.default.HEIGHT_SIZE-e.y)+3;var r=n.getComponent(d.default);if(r.pos=e,i)r.refresh(i);else{var s=new h.default;s.valueCopy(p.default.equipments[t]);var c=this.getRandomDesc(s,a);s.criticalStrikeRate=c.criticalStrikeRate,s.damageMin+=c.damageMin,s.damageMax+=c.damageMax,s.defence+=c.defence,s.lifeDrain+=c.lifeDrain,s.lifeRecovery+=c.lifeRecovery,s.moveSpeed+=c.moveSpeed,s.attackSpeed+=c.attackSpeed,s.dodge+=c.dodge,s.health+=c.health,s.prefix=c.prefix,s.titlecolor=c.titlecolor,s.color=c.color,r.refresh(s)}return r},t.prototype.start=function(){},t.prototype.getMixColor=function(t,e){var o=cc.color().fromHEX(t),i=cc.color().fromHEX(e),a=cc.color(),n=o.getR()+i.getR(),r=o.getG()+i.getG(),s=o.getB()+i.getB();return a.setR(255<n?255:n),a.setG(255<r?255:r),a.setB(255<s?255:s),"#"+a.toHEX("#rrggbb")},t.EMPTY="emptyequipment",t.WEAPON_KNIFE="weapon001",t.WEAPON_PITCHFORK="weapon004",t.CLOTHES_VEST="clothes001",t.CLOTHES_SHIRT="clothes002",t.HELMET_BUCKETHAT="helmet002",t.COLOR_CRITICALSTRIKE="#DC143C",t.COLOR_ATTACKSPPED="#5F9EA0",t.COLOR_MOVESPEED="#00BFFF",t.COLOR_DODGE="#FFFF00",t.COLOR_STABLE="#DEB887",t.COLOR_POWERFUL="#9370DB",t.COLOR_HEALTHY="#90EE90",t.COLOR_LIFEDRAIN="#FFC0CB",t.COLOR_RECOVERY="#ADFF2F",__decorate([n(cc.Prefab)],t.prototype,"equipment",void 0),t=m=__decorate([a],t);var m}(cc.Component);o.default=r,cc._RF.pop()},{"../Data/EquipmentData":"EquipmentData","../Data/EquipmentDescData":"EquipmentDescData","../Dungeon":"Dungeon","../Equipment/Equipment":"Equipment","../Logic":"Logic"}],Equipment:[function(t,e,o){"use strict";cc._RF.push(e,"46d3aM6X2VOCJtzuWiGZaWE","Equipment"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("../Logic"),a=t("./EquipmentDialog"),n=t("../Data/EquipmentData"),r=t("../EventConstant"),s=t("../Player"),c=cc._decorator,l=c.ccclass,p=c.property,h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.data=new n.default,t.equipmentDialog=null,t.pos=cc.v2(0,0),t.isTaken=!1,t}return __extends(t,e),t.prototype.onLoad=function(){this.isTaken=!1,this.sprite=this.node.getChildByName("sprite")},t.prototype.refresh=function(t){this.data.valueCopy(t),this.equipmentDialog.refreshDialog(this.data);var e=i.default.spriteFrames[this.data.img];this.sprite.getComponent(cc.Sprite).spriteFrame=e,this.sprite.width=e.getRect().width,this.sprite.height=e.getRect().height;var o=cc.color(255,255,255).fromHEX(this.data.color);this.sprite.color=o},t.prototype.start=function(){i.default.setAlias(this.node),this.anim=this.getComponent(cc.Animation)},t.prototype.onEnable=function(){},t.prototype.taken=function(){var t=this;this.isTaken=!0,this.anim.play("EquipmentTaken"),cc.director.emit(r.EventConstant.PLAYER_CHANGEEQUIPMENT,{equipData:this.data}),this.node.getChildByName("shadow").active=!1,this.equipmentDialog.node.active=!1,setTimeout(function(){t.node&&t.destroy()},1e3)},t.prototype.onBeginContact=function(t,e,o){o.body.node.getComponent(s.default)&&this.equipmentDialog.showDialog()},t.prototype.onEndContact=function(t,e,o){o.body.node.getComponent(s.default)&&this.equipmentDialog.hideDialog()},__decorate([p(a.default)],t.prototype,"equipmentDialog",void 0),t=__decorate([l],t)}(cc.Component);o.default=h,cc._RF.pop()},{"../Data/EquipmentData":"EquipmentData","../EventConstant":"EventConstant","../Logic":"Logic","../Player":"Player","./EquipmentDialog":"EquipmentDialog"}],EventConstant:[function(t,e,o){"use strict";cc._RF.push(e,"4128feS00VLAILEQToHDge5","EventConstant"),Object.defineProperty(o,"__esModule",{value:!0});var i=cc._decorator,a=i.ccclass,n=(i.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.PLAYER_MOVE="PLAYER_MOVE",e.PLAYER_USEITEM="PLAYER_USEITEM",e.PLAYER_ATTACK="PLAYER_ATTACK",e.PLAYER_REMOTEATTACK="PLAYER_REMOTEATTACK",e.PLAYER_GETITEM="PLAYER_GETITEM",e.PLAYER_TAKEDAMAGE="PLAYER_TAKEDAMAGE",e.INVENTORY_CHANGEITEM="INVENTORY_CHANGEITEM",e.PLAYER_CHANGEWEAPON="PLAYER_CHANGEWEAPON",e.PLAYER_CHANGEEQUIPMENT="PLAYER_CHANGEEQUIPMENT",e.LOADINGNEXTLEVEL="LOADINGNEXTLEVEL",e.CHANGE_MIMIMAP="CHANGE_MIMIMAP",e.LOADINGROOM="LOADINGROOM",e.DUNGEON_SETEQUIPMENT="DUNGEON_SETEQUIPMENT",e.DUNGEON_SHAKEONCE="DUNGEON_SHAKEONCE",e.eventHandler=new cc.Node,e=__decorate([a],e)}(cc.Component));o.EventConstant=n,cc._RF.pop()},{}],GameFinish:[function(t,e,o){"use strict";cc._RF.push(e,"98577N+o/RGi4cE+Wsz8Pp4","GameFinish"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("./Logic"),a=cc._decorator,n=a.ccclass,r=(a.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.start=function(){},e.prototype.retry=function(){i.default.resetData(),cc.director.loadScene("loading")},e.prototype.home=function(){cc.director.loadScene("start")},e=__decorate([n],e)}(cc.Component));o.default=r,cc._RF.pop()},{"./Logic":"Logic"}],GameOver:[function(t,e,o){"use strict";cc._RF.push(e,"0e28bkl25dNTqUQmquXpqGi","GameOver"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("./Logic"),a=cc._decorator,n=a.ccclass,r=a.property,s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.label=null,t}return __extends(t,e),t.prototype.start=function(){},t.prototype.retry=function(){i.default.resetData(),cc.director.loadScene("loading")},t.prototype.home=function(){cc.director.loadScene("start")},__decorate([r(cc.Label)],t.prototype,"label",void 0),t=__decorate([n],t)}(cc.Component);o.default=s,cc._RF.pop()},{"./Logic":"Logic"}],Game:[function(t,e,o){"use strict";cc._RF.push(e,"c30ffLX6hVIjoNslRhRCM7w","Game"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("./Logic"),a=cc._decorator,n=a.ccclass,r=a.property,s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.label=null,t}return __extends(t,e),t.prototype.start=function(){},t.prototype.update=function(t){this.label&&(this.label.string="Level "+i.default.level)},__decorate([r(cc.Label)],t.prototype,"label",void 0),t=__decorate([n],t)}(cc.Component);o.default=s,cc._RF.pop()},{"./Logic":"Logic"}],HealthBar:[function(t,e,o){"use strict";cc._RF.push(e,"4298eVZsIJFhKykTJYXRBP0","HealthBar"),Object.defineProperty(o,"__esModule",{value:!0});var i=cc._decorator,a=i.ccclass,n=i.property,r=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.backbar=null,t.label=null,t.timeDelay=0,t}return __extends(t,e),t.prototype.onLoad=function(){this.progressBar=this.getComponent(cc.ProgressBar),this.progressBar.progress=.3},t.prototype.start=function(){},t.prototype.refreshHealth=function(t,e){this.progressBar.progress=t/e,this.label&&(this.label.string=parseFloat(t.toFixed(1))+"/"+e)},t.prototype.update=function(t){this.timeDelay+=t,.016<this.timeDelay&&(this.timeDelay=0),this.backbar.width=this.lerp(this.backbar.width,this.progressBar.barSprite.node.width,3*t)},t.prototype.lerp=function(t,e,o){return t+(e-t)*o},__decorate([n(cc.Node)],t.prototype,"backbar",void 0),__decorate([n(cc.Label)],t.prototype,"label",void 0),t=__decorate([a],t)}(cc.Component);o.default=r,cc._RF.pop()},{}],InventoryData:[function(t,e,o){"use strict";cc._RF.push(e,"1dc08IgWM1D6q2nqBDxwhzD","InventoryData"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("./EquipmentData"),a=cc._decorator,n=a.ccclass,r=(a.property,function(){function t(){this.weapon=new i.default,this.helmet=new i.default,this.clothes=new i.default,this.trousers=new i.default,this.gloves=new i.default,this.shoes=new i.default}return t.prototype.getMoveSpeed=function(t){var e=0;return 300<(e=this.weapon.moveSpeed+this.helmet.moveSpeed+this.clothes.moveSpeed+this.trousers.moveSpeed+this.gloves.moveSpeed+this.shoes.moveSpeed)&&(e=300),t+e},t.prototype.getAttackSpeed=function(){var t=0;return 400<(t=this.weapon.attackSpeed+this.helmet.attackSpeed+this.clothes.attackSpeed+this.trousers.attackSpeed+this.gloves.attackSpeed+this.shoes.attackSpeed)&&(t=400),500-t},t.prototype.getAttackPoint=function(t){var e=cc.v2(t,t);return e.x+=this.weapon.damageMin+this.helmet.damageMin+this.clothes.damageMin+this.trousers.damageMin+this.gloves.damageMin+this.shoes.damageMin,e.y+=this.weapon.damageMax+this.helmet.damageMax+this.clothes.damageMax+this.trousers.damageMax+this.gloves.damageMax+this.shoes.damageMax,e},t.prototype.getFinalAttackPoint=function(t){var e=this.getAttackPoint(t),o=this.getCriticalStrikeRate();return Math.random()>o?e.x:e.y},t.prototype.getCriticalStrikeRate=function(){return 1-(1-this.weapon.criticalStrikeRate/100)*(1-this.helmet.criticalStrikeRate/100)*(1-this.clothes.criticalStrikeRate/100)*(1-this.trousers.criticalStrikeRate/100)*(1-this.gloves.criticalStrikeRate/100)*(1-this.shoes.criticalStrikeRate/100)},t.prototype.getDamage=function(t){var e=t,o=this.getDefence();return 0<o&&(e*=1-.06*o/(.06*o+1)),e},t.prototype.getDodge=function(){return 1-(1-this.weapon.dodge/100)*(1-this.helmet.dodge/100)*(1-this.clothes.dodge/100)*(1-this.trousers.dodge/100)*(1-this.gloves.dodge/100)*(1-this.shoes.dodge/100)},t.prototype.getDefence=function(){return this.weapon.defence+this.helmet.defence+this.clothes.defence+this.trousers.defence+this.gloves.defence+this.shoes.defence},t.prototype.getRecovery=function(){return this.weapon.lifeRecovery+this.helmet.lifeRecovery+this.clothes.lifeRecovery+this.trousers.lifeRecovery+this.gloves.lifeRecovery+this.shoes.lifeRecovery},t.prototype.getLifeDrain=function(t){var e=this.getAttackPoint(t),o=this.getCriticalStrikeRate(),i=1-(1-this.weapon.lifeDrain/100)*(1-this.helmet.lifeDrain/100)*(1-this.clothes.lifeDrain/100)*(1-this.trousers.lifeDrain/100)*(1-this.gloves.lifeDrain/100)*(1-this.shoes.lifeDrain/100);return Math.random()>o?e.x*i:e.y*i},t.prototype.getHealth=function(t,e){var o=1;0<t.y&&(o=t.x/t.y);var i=e+this.weapon.health+this.helmet.health+this.clothes.health+this.trousers.health+this.gloves.health+this.shoes.health;return cc.v2(i*o,i)},t=__decorate([n],t)}());o.default=r,cc._RF.pop()},{"./EquipmentData":"EquipmentData"}],Inventory:[function(t,e,o){"use strict";cc._RF.push(e,"3b411lPIzZAv7ApO4pixeng","Inventory"),Object.defineProperty(o,"__esModule",{value:!0});var i=cc._decorator,a=i.ccclass,n=i.property,r=t("./EventConstant"),s=t("./Logic"),c=t("./Data/EquipmentData"),l=t("./Player"),p=t("./Equipment/EquipmentDialog"),h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tabselect=null,t.player=null,t.selectIndex=0,t.weapon=null,t.helmet=null,t.clothes=null,t.trousers=null,t.gloves=null,t.shoes=null,t.equipmentDialog=null,t}return __extends(t,e),t.prototype.onLoad=function(){var e=this;this.inventoryData=s.default.inventoryData,cc.director.on(r.EventConstant.PLAYER_CHANGEEQUIPMENT,function(t){e.refreshEquipment(t.detail.equipData,!0)})},t.prototype.start=function(){s.default.setAlias(this.node),this.tabselect.x=0,this.weapon.spriteFrame=null,this.helmet.spriteFrame=null,this.clothes.spriteFrame=null,this.trousers.spriteFrame=null,this.gloves.spriteFrame=null,this.shoes.spriteFrame=null,this.addSpriteTouchEvent(this.weapon,"weapon"),this.addSpriteTouchEvent(this.helmet,"helmet"),this.addSpriteTouchEvent(this.clothes,"clothes"),this.addSpriteTouchEvent(this.trousers,"trousers"),this.addSpriteTouchEvent(this.gloves,"gloves"),this.addSpriteTouchEvent(this.shoes,"shoes"),this.refreshEquipment(this.inventoryData.weapon,!1),this.refreshEquipment(this.inventoryData.helmet,!1),this.refreshEquipment(this.inventoryData.clothes,!1),this.refreshEquipment(this.inventoryData.trousers,!1),this.refreshEquipment(this.inventoryData.gloves,!1),this.refreshEquipment(this.inventoryData.shoes,!1)},t.prototype.addSpriteTouchEvent=function(e,o){var i=this;e.node.on(cc.Node.EventType.TOUCH_START,function(){if(null!=e.spriteFrame){var t=new c.default;switch(o){case"weapon":t=i.inventoryData.weapon;break;case"helmet":t=i.inventoryData.helmet;break;case"clothes":t=i.inventoryData.clothes;break;case"trousers":t=i.inventoryData.trousers;break;case"gloves":t=i.inventoryData.gloves;break;case"shoes":t=i.inventoryData.shoes}i.equipmentDialog.refreshDialog(t),i.equipmentDialog.showDialog()}}),e.node.on(cc.Node.EventType.TOUCH_END,function(){i.equipmentDialog.hideDialog()}),e.node.on(cc.Node.EventType.TOUCH_CANCEL,function(){i.equipmentDialog.hideDialog()})},t.prototype.select=function(t,e){var o=parseInt(e);this.tabselect.y=64*o;var i=t.currentTarget;cc.director.emit(r.EventConstant.INVENTORY_CHANGEITEM,{spriteFrame:i.getComponentInChildren(cc.Sprite).spriteFrame})},t.prototype.setEquipment=function(t,e,o){if(e.equipmetType==t.equipmetType){var i=this.player.getComponent(l.default).pos,a=cc.v2(i.x,i.y);a.y<0?a.y+=1:a.y-=1,o&&cc.director.emit(r.EventConstant.DUNGEON_SETEQUIPMENT,{pos:a,equipmentData:e})}},t.prototype.refreshEquipment=function(t,e){if(t&&this.weapon){var o=cc.color(255,255,255).fromHEX(t.color),i=s.default.spriteFrames[t.img];switch(t.equipmetType){case"weapon":this.weapon.spriteFrame=i,this.weapon.node.color=o,this.setEquipment(t,this.inventoryData.weapon,e),this.inventoryData.weapon.valueCopy(t);break;case"helmet":this.helmet.spriteFrame=i,this.helmet.node.color=o,this.setEquipment(t,this.inventoryData.helmet,e),this.inventoryData.helmet.valueCopy(t);break;case"clothes":this.clothes.spriteFrame=i,this.clothes.node.color=o,this.setEquipment(t,this.inventoryData.clothes,e),this.inventoryData.clothes.valueCopy(t);break;case"trousers":this.trousers.spriteFrame=i,this.trousers.node.color=o,this.setEquipment(t,this.inventoryData.trousers,e),this.inventoryData.trousers.valueCopy(t);break;case"gloves":this.gloves.spriteFrame=i,this.gloves.node.color=o,this.setEquipment(t,this.inventoryData.gloves,e),this.inventoryData.gloves.valueCopy(t);break;case"shoes":this.shoes.spriteFrame=i,this.shoes.node.color=o,this.setEquipment(t,this.inventoryData.shoes,e),this.inventoryData.shoes.valueCopy(t)}this.player&&(this.player.getComponent(l.default).inventoryData=this.inventoryData,this.player.getComponent(l.default).changeEquipment(t,i))}},__decorate([n(cc.Node)],t.prototype,"tabselect",void 0),__decorate([n(cc.Node)],t.prototype,"player",void 0),__decorate([n(cc.Sprite)],t.prototype,"weapon",void 0),__decorate([n(cc.Sprite)],t.prototype,"helmet",void 0),__decorate([n(cc.Sprite)],t.prototype,"clothes",void 0),__decorate([n(cc.Sprite)],t.prototype,"trousers",void 0),__decorate([n(cc.Sprite)],t.prototype,"gloves",void 0),__decorate([n(cc.Sprite)],t.prototype,"shoes",void 0),__decorate([n(p.default)],t.prototype,"equipmentDialog",void 0),t=__decorate([a],t)}(cc.Component);o.default=h,cc._RF.pop()},{"./Data/EquipmentData":"EquipmentData","./Equipment/EquipmentDialog":"EquipmentDialog","./EventConstant":"EventConstant","./Logic":"Logic","./Player":"Player"}],Item:[function(t,e,o){"use strict";cc._RF.push(e,"ce4de5SY9BKg5Ay5wKpP9r7","Item"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("../EventConstant"),a=cc._decorator,n=a.ccclass,r=a.property,s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.label=null,t.damage=-1,t}return __extends(t,e),t.prototype.start=function(){this.anim=this.getComponent(cc.Animation)},t.prototype.taken=function(){0!=this.damage&&cc.director.emit(i.EventConstant.PLAYER_TAKEDAMAGE,{damage:this.damage})},t.prototype.onCollisionEnter=function(t,e){3==t.tag&&(this.anim.play("ItemTaken"),this.taken())},__decorate([r],t.prototype,"damage",void 0),t=__decorate([n],t)}(cc.Component);o.default=s,cc._RF.pop()},{"../EventConstant":"EventConstant"}],Joystick:[function(t,e,o){"use strict";cc._RF.push(e,"a3868eVgi9Ewpbgxpufia3p","Joystick"),Object.defineProperty(o,"__esModule",{value:!0});var a=t("./EventConstant"),i=cc._decorator,n=i.ccclass,r=i.property,s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.anglePreDirQuadrant=23,t.fixedPoint=null,t.movePoint=null,t.movePointMoveRadius=100,t.timeDelay=0,t}return __extends(t,e),t.prototype.onLoad=function(){var t=this.node.getContentSize();this.touchArea=new cc.Vec2(t.width,t.height),this.fixedPointMoveCenterPos=this.touchArea.div(this.touchArea),this.fixedPointMoveRadius=this.touchArea.x/2-this.movePointMoveRadius,this.node.on(cc.Node.EventType.TOUCH_START,function(t){if(-1==this.touchID){var e=t.getLocation(),o=new cc.Vec2(e.x,e.y);o.subSelf(this.node.position);var i=this.clampPos(o,this.fixedPointMoveCenterPos,this.fixedPointMoveRadius);this.movePointMoveCenterPos=i,this.setFixedPointPos(i),this.setMovePointPos(i),this.touchID=t.getID()}},this),this.node.on(cc.Node.EventType.TOUCH_MOVE,function(t){if(this.touchID==t.getID()){var e=t.getLocation(),o=new cc.Vec2(e.x,e.y);o.subSelf(this.node.position);var i=this.clampPos(o,this.movePointMoveCenterPos,this.movePointMoveRadius);this.setMovePointPos(i)}},this),this.node.on(cc.Node.EventType.TOUCH_END,function(t){this.init()},this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,function(t){this.init()},this),this.init()},t.prototype.init=function(){this.touchID=-1,this.joystickInputDir=new cc.Vec2,this.setFixedPointPos(this.fixedPointMoveCenterPos),this.setMovePointPos(this.fixedPointMoveCenterPos)},t.prototype.setFixedPointPos=function(t){this.fixedPoint.setPosition(t)},t.prototype.getFixedPointPos=function(){return this.fixedPoint.getPosition()},t.prototype.setMovePointPos=function(t){this.movePoint.setPosition(t)},t.prototype.getMovePointPos=function(){return this.movePoint.getPosition()},t.prototype.clampPos=function(t,e,o){var i=t.sub(e);return i.mag()>o?i.normalize().mul(o).add(e):t},t.prototype.getInputDir=function(){var t=this.movePoint.getPosition().sub(this.fixedPoint.getPosition());return 0<t.mag()&&t.normalizeSelf(),t},t.prototype.getInputQuadrantDir=function(){return this.getVec2ByQuadrant(this.getDirQuadrant(this.getInputDir()))},t.prototype.getDirQuadrant=function(t){var e=null;return 0<t.mag()&&(e=Math.floor(this.getAngleByVec2(t)/this.anglePreDirQuadrant)),e},t.prototype.getAngleByVec2=function(t){return 180*-Math.atan2(t.y,t.x)/Math.PI+this.anglePreDirQuadrant/2},t.prototype.getVec2ByAngle=function(t){var e=new cc.Vec2,o=(this.anglePreDirQuadrant/2-t)*(Math.PI/180);return e.x=Math.cos(o),e.y=Math.sin(o),e.normalizeSelf()},t.prototype.getVec2ByQuadrant=function(t){if(null!=t){var e=t*this.anglePreDirQuadrant;return e+=this.anglePreDirQuadrant/2,this.getVec2ByAngle(e)}return cc.Vec2.ZERO},t.prototype.sendMoveMessageToPlayer=function(t){var e=this.getInputQuadrantDir(),o=4;Math.abs(e.x)<Math.abs(e.y)&&(.3<e.y&&(o=0),e.y<-.3&&(o=1)),Math.abs(e.x)>Math.abs(e.y)&&(e.x<-.3&&(o=2),.3<e.x&&(o=3));var i=this.getInputDir();cc.director.emit(a.EventConstant.PLAYER_MOVE,{dir:o,pos:i,dt:t})},t.prototype.isTimeDelay=function(t){return this.timeDelay+=t,.016<this.timeDelay&&!(this.timeDelay=0)},t.prototype.update=function(t){this.isTimeDelay(t)&&this.sendMoveMessageToPlayer(t)},__decorate([r(cc.Integer)],t.prototype,"anglePreDirQuadrant",void 0),__decorate([r(cc.Node)],t.prototype,"fixedPoint",void 0),__decorate([r(cc.Node)],t.prototype,"movePoint",void 0),__decorate([r],t.prototype,"movePointMoveRadius",void 0),t=__decorate([n],t)}(cc.Component);o.default=s,cc._RF.pop()},{"./EventConstant":"EventConstant"}],KrakenSwingHand:[function(t,e,o){"use strict";cc._RF.push(e,"15ea4rtPQxD8pcJLX7yPozV","KrakenSwingHand"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("../EventConstant"),a=cc._decorator,n=a.ccclass,r=a.property,s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.damage=2,t.isShow=!1,t}return __extends(t,e),t.prototype.start=function(){this.isShow=!1},t.prototype.onCollisionEnter=function(t,e){3==t.tag&&this.isShow&&this.node.active&&(this.node.stopAllActions(),cc.director.emit(i.EventConstant.PLAYER_TAKEDAMAGE,{damage:this.damage}))},__decorate([r],t.prototype,"damage",void 0),t=__decorate([n],t)}(cc.Component);o.default=s,cc._RF.pop()},{"../EventConstant":"EventConstant"}],Kraken:[function(t,e,o){"use strict";cc._RF.push(e,"cbbb1U+Yy5Jtb8PV4hyvH/c","Kraken"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("../HealthBar"),a=t("../Data/MonsterData"),n=t("../Shooter"),r=t("./KrakenSwingHand"),s=cc._decorator,c=s.ccclass,l=s.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.pos=cc.v2(0,0),t.label=null,t.healthBar=null,t.isDied=!1,t.isShow=!1,t.timeDelay=0,t.data=new a.default,t}return __extends(t,e),t.prototype.onLoad=function(){this.isDied=!1,this.isShow=!1,this.data.currentHealth=20,this.data.maxHealth=20,this.data.attackPoint=1,this.anim=this.getComponent(cc.Animation),this.sprite=this.node.getChildByName("sprite"),this.sprite.opacity=0,this.shooter=this.getComponentInChildren(n.default)},t.prototype.isBossZone=function(t){return t.y>this.pos.y&&t.x>this.pos.x-3&&t.x<this.pos.x+3},t.prototype.updatePlayerPos=function(){this.node.x=64*this.pos.x+32,this.node.y=64*this.pos.y+70},t.prototype.transportPlayer=function(t,e){this.pos.x=t,this.pos.y=e,this.changeZIndex()},t.prototype.changeZIndex=function(){this.node.zIndex=1e3+100*(9-this.pos.y-1)+2,this.isShow&&!this.isDied&&(this.node.zIndex=3e3+100*(9-this.pos.y-1)+2)},t.prototype.attack=function(t,e){var o=this;if(!this.isDied){var i=0,a=0;switch(t){case 0:a+=32;break;case 1:a-=32;break;case 2:i-=32;break;case 3:i+=32}var n=cc.sequence(cc.moveBy(.1,i,a),cc.callFunc(function(){e&&e(o.data.attackPoint)}),cc.moveTo(.1,0,0));this.sprite.runAction(n)}},t.prototype.start=function(){for(var t=this.node.getComponentsInChildren(cc.Sprite),e=0;e<t.length;e++)t[e].spriteFrame&&t[e].spriteFrame.getTexture().setAliasTexParameters();this.changeZIndex(),this.healthBar.refreshHealth(this.data.currentHealth,this.data.maxHealth)},t.prototype.takeDamage=function(t,e){this.data.currentHealth-=t,this.data.currentHealth>this.data.maxHealth&&(this.data.currentHealth=this.data.maxHealth),this.anim.playAdditive("KrakenHit"),this.healthBar.refreshHealth(this.data.currentHealth,this.data.maxHealth),this.data.currentHealth<1&&this.killed(),e.x>this.pos.x?this.anim.playAdditive("KrakenSwingRight"):e.x<this.pos.x&&this.anim.playAdditive("KrakenSwingLeft")},t.prototype.killed=function(){this.isDied||(this.shooter&&(this.shooter.auto=!1),this.isDied=!0,this.changeZIndex(),this.anim.play("KrakenDie"))},t.prototype.BossShow=function(){this.isShow=!0;for(var t=0,e=this.getComponentsInChildren(r.default);t<e.length;t++){e[t].isShow=!0}this.anim.play("KrakenIdle"),this.shooter&&(this.shooter.auto=!0),this.changeZIndex()},t.prototype.BossHit=function(){},t.prototype.showBoss=function(){this.anim.play("KrakenShow")},t.prototype.update=function(t){if(this.timeDelay+=t,.016<this.timeDelay){this.timeDelay=0,this.updatePlayerPos();for(var e=this.node.getComponentsInChildren(cc.Sprite),o=0;o<e.length;o++)e[o].spriteFrame&&e[o].spriteFrame.getTexture().setAliasTexParameters()}this.label&&(this.label.string=""+this.node.zIndex),this.healthBar.node.active=!this.isDied,this.shooter&&(this.shooter.auto=this.isShow&&!this.isDied)},__decorate([l(cc.Vec2)],t.prototype,"pos",void 0),__decorate([l(cc.Label)],t.prototype,"label",void 0),__decorate([l(i.default)],t.prototype,"healthBar",void 0),t=__decorate([c],t)}(cc.Component);o.default=p,cc._RF.pop()},{"../Data/MonsterData":"MonsterData","../HealthBar":"HealthBar","../Shooter":"Shooter","./KrakenSwingHand":"KrakenSwingHand"}],Loading:[function(t,e,o){"use strict";cc._RF.push(e,"a2246gAT5JKc4YhD10URG7K","Loading"),Object.defineProperty(o,"__esModule",{value:!0});var r=t("./Logic"),i=cc._decorator,a=i.ccclass,n=i.property,s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.label=null,t.timeDelay=0,t.isEquipmentLoaded=!1,t.isLevelLoaded=!1,t.isSpriteFramesLoaded=!1,t}return __extends(t,e),t.prototype.start=function(){this.label.string="Level "+r.default.level,this.isLevelLoaded=!1,this.isEquipmentLoaded=!1,this.loadMap(),this.loadEquipment(),this.loadSpriteFrames()},t.prototype.loadMap=function(){r.default.mapManger.isloaded=!1,r.default.mapManger.loadMap()},t.prototype.loadEquipment=function(){var o=this;r.default.equipments?this.isEquipmentLoaded=!0:cc.loader.loadRes("Data/Equipment/equipment",function(t,e){t?cc.error(t):(r.default.equipments=e,o.isEquipmentLoaded=!0)})},t.prototype.loadSpriteFrames=function(){var n=this;r.default.spriteFrames?this.isSpriteFramesLoaded=!0:cc.loader.loadResDir("Texture",cc.SpriteFrame,function(t,e){r.default.spriteFrames={};for(var o=0,i=e;o<i.length;o++){var a=i[o];a.getTexture().setAliasTexParameters(),r.default.spriteFrames[a.name]=a}n.isSpriteFramesLoaded=!0})},t.prototype.update=function(t){this.timeDelay+=t,this.isLevelLoaded=r.default.mapManger.isloaded,.16<this.timeDelay&&this.isLevelLoaded&&this.isEquipmentLoaded&&this.isSpriteFramesLoaded&&(this.timeDelay=0,this.isLevelLoaded=!1,this.isEquipmentLoaded=!1,this.isSpriteFramesLoaded=!1,cc.director.loadScene("game"))},__decorate([n(cc.Label)],t.prototype,"label",void 0),t=__decorate([a],t)}(cc.Component);o.default=s,cc._RF.pop()},{"./Logic":"Logic"}],Logic:[function(t,e,o){"use strict";cc._RF.push(e,"2225fYJ0sRMTZjuD7WFmbVi","Logic"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("./Data/PlayerData"),a=t("./EventConstant"),n=t("./Data/InventoryData"),r=t("./Manager/MapManager"),s=t("./Dungeon"),c=cc._decorator,l=c.ccclass,p=(c.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),(o=e).prototype.onLoad=function(){var e=this;cc.director.setDisplayStats(!1),cc.game.addPersistRootNode(this.node),cc.director.getCollisionManager().enabled=!0,cc.director.getPhysicsManager().enabled=!0,cc.director.on(a.EventConstant.LOADINGNEXTLEVEL,function(t){e.loadingNextLevel()}),cc.director.on(a.EventConstant.LOADINGROOM,function(t){e.loadingNextRoom(t.detail.dir)})},e.prototype.start=function(){},e.resetData=function(){o.level=1,o.playerData=new i.default,o.inventoryData=new n.default,o.mapManger.reset(o.level)},e.prototype.loadingNextRoom=function(t){if(o.mapManger.loadingNextRoom(t)){switch(t){case 0:o.playerData.pos=cc.v2(Math.round(s.default.WIDTH_SIZE/2-1),0);break;case 1:o.playerData.pos=cc.v2(Math.round(s.default.WIDTH_SIZE/2-1),s.default.HEIGHT_SIZE-1);break;case 2:o.playerData.pos=cc.v2(s.default.WIDTH_SIZE-1,Math.round(s.default.HEIGHT_SIZE/2-1));break;case 3:o.playerData.pos=cc.v2(0,Math.round(s.default.HEIGHT_SIZE/2-1))}cc.director.loadScene("loading")}},e.prototype.loadingNextLevel=function(){o.level++,5<o.level?cc.director.loadScene("gamefinish"):(o.mapManger.reset(o.level),cc.director.loadScene("loading"))},e.getCurrentMapData=function(){return o.mapManger.getCurrentMapData()},e.isBossLevel=function(t){return t==o.BOSS_LEVEL_1},e.getRandomNum=function(t,e){return t+Math.round(Math.random()*(e-t))},e.getHalfChance=function(){return.5<Math.random()},e.setAlias=function(t){for(var e=t.getComponentsInChildren(cc.Sprite),o=0;o<e.length;o++)e[o].spriteFrame&&e[o].spriteFrame.getTexture().setAliasTexParameters()},e.BOSS_LEVEL_1=10,e.level=1,e.playerData=new i.default,e.inventoryData=new n.default,e.roomStrs=["startroom","endroom","traproom","lootroom","dangerroom","puzzleroom","merchantroom","bossroom"],e.mapManger=new r.default,e.chapterName="chapter01",e.equipments=null,e.spriteFrames=null,e.currentDir=0,e=o=__decorate([l],e);var o}(cc.Component));o.default=p,cc._RF.pop()},{"./Data/InventoryData":"InventoryData","./Data/PlayerData":"PlayerData","./Dungeon":"Dungeon","./EventConstant":"EventConstant","./Manager/MapManager":"MapManager"}],MapData:[function(t,e,o){"use strict";cc._RF.push(e,"9d7bcZhUYBIzJR0A6/ryRxj","MapData"),Object.defineProperty(o,"__esModule",{value:!0});var i=cc._decorator,a=i.ccclass,n=(i.property,function(){function t(t){this.map=new Array,this.init(t)}return t.prototype.init=function(t){var e=(t=t.substring(2,t.length-2)).split("\r\n");this.map=new Array;for(var o=0;o<e.length;o++)this.map[o]=new Array;for(o=0;o<e.length;o++)for(var i=e[e.length-1-o].split(""),a=0;a<i.length;a++)this.map[o][a]=i[a];var n=new Array;for(o=0;o<this.map[0].length;o++){n[o]=new Array;for(a=0;a<this.map.length;a++)n[o][a]=this.map[a][o]}this.map=n},t=__decorate([a],t)}());o.default=n,cc._RF.pop()},{}],MapManager:[function(t,e,o){"use strict";cc._RF.push(e,"3b0b2KGAWdGI6jcP8eIcPHE","MapManager"),Object.defineProperty(o,"__esModule",{value:!0});var h=t("../Data/MapData"),i=t("../Rect/RectDungeon"),n=t("../Logic"),a=cc._decorator,r=a.ccclass,s=(a.property,function(){function t(){this.allfileRooms={},this.roomStrs=["startroom","endroom","traproom","lootroom","dangerroom","puzzleroom","merchantroom","bossroom"],this.isloaded=!1,this.rectDungeon=new i.default(1),this.currentRectRoom=null,this.init()}return t.prototype.init=function(){this.isloaded=!1},t.prototype.reset=function(t){this.rectDungeon=new i.default(t),cc.log(this.rectDungeon.getDisPlay()),this.resetRooms(),this.currentRectRoom=this.rectDungeon.startRoom,this.changeRoomsIsFound(this.currentRectRoom.x,this.currentRectRoom.y)},t.prototype.loadingNextRoom=function(t){var e=this.rectDungeon.getNeighborRoomType(this.currentRectRoom.x,this.currentRectRoom.y,t);return e&&0!=e.roomType&&(this.currentRectRoom=e,this.changeRoomsIsFound(e.x,e.y)),e},t.prototype.changeRoomsIsFound=function(t,e){this.rectDungeon.changeRoomIsFound(t,e),this.rectDungeon.changeRoomIsFound(t+1,e),this.rectDungeon.changeRoomIsFound(t-1,e),this.rectDungeon.changeRoomIsFound(t,e+1),this.rectDungeon.changeRoomIsFound(t,e-1)},t.prototype.getCurrentMapData=function(){return this.currentRectRoom.map},t.prototype.loadMap=function(){var p=this;this.rectDungeon.startRoom.map?this.isloaded=!0:cc.loader.loadRes("Data/Rooms/rooms",function(t,e){if(t)cc.error(t);else{for(var o=e.split("room"),i=0,a=0;a<o.length;a++){var n=o[a],r=null;if(n&&(r=(n=n.substring(n.indexOf("=")+1,n.length-3)).split("$")),r){for(var s=new Array,c=0;c<r.length;c++){var l=r[c];s.push(new h.default(l))}p.allfileRooms[p.roomStrs[i]]=s,i++}}p.resetRooms(),p.isloaded=!0}})},t.prototype.resetRooms=function(){if(this.allfileRooms&&this.allfileRooms[this.roomStrs[0]])for(var t=0;t<this.rectDungeon.map.length;t++)for(var e=0;e<this.rectDungeon.map[0].length;e++){var o=this.rectDungeon.map[t][e],i=o.roomType-1;if(0<=i){var a=this.allfileRooms[this.roomStrs[i]];o.map=a[n.default.getRandomNum(0,a.length-1)]}}},t=__decorate([r],t)}());o.default=s,cc._RF.pop()},{"../Data/MapData":"MapData","../Logic":"Logic","../Rect/RectDungeon":"RectDungeon"}],MeleeWeapon:[function(t,e,o){"use strict";cc._RF.push(e,"8747dgi/6dFupzO0r46t7Ya","MeleeWeapon"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("./Player"),n=t("./Monster"),r=t("./Boss/Kraken"),a=t("./EventConstant"),s=cc._decorator,c=s.ccclass,l=s.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.playerNode=null,t.player=null,t.isReverse=!1,t.isAttacking=!1,t.hv=cc.v2(1,0),t.isStab=!0,t}return __extends(t,e),t.prototype.onLoad=function(){this.anim=this.getComponent(cc.Animation),this.player=this.playerNode.getComponent(i.default)},t.prototype.setHv=function(t){this.hv=t},t.prototype.getHv=function(){return this.hv},t.prototype.attack=function(){this.isAttacking||(this.isAttacking=!0,this.anim&&(this.isStab?this.anim.play("MeleeAttackStab"):this.isReverse?this.anim.play("MeleeAttackReverse"):this.anim.play("MeleeAttack")))},t.prototype.MeleeAttackFinish=function(t){this.isAttacking=!1,this.isReverse=!t},t.prototype.start=function(){},t.prototype.getRandomNum=function(t,e){return t+Math.round(Math.random()*(e-t))},t.prototype.update=function(t){if((0!=this.hv.x||0!=this.hv.y)&&!this.isAttacking){this.node.position=cc.v2(21,43);var e=cc.v2(this.node.position.x+this.hv.x,this.node.position.y+this.hv.y);this.rotateColliderManager(e)}},t.prototype.rotateColliderManager=function(t){var e=t.sub(this.node.position),o=360/(2*Math.PI),i=360-Math.atan2(e.x,e.y)*o;this.node.scaleX=this.node.parent.scaleX,i+=90,this.node.rotation=-1==this.node.scaleX?i:-i},t.prototype.onBeginContact=function(t,e,o){},t.prototype.onCollisionEnter=function(t,e){this.attacking(t)},t.prototype.beatBack=function(t){var e=t.getComponent(cc.RigidBody),o=this.getHv().clone();o.equals(cc.Vec2.ZERO)&&(o=cc.v2(1,0)),o=o.normalizeSelf().mul(640);cc.moveBy(.1,o.x,o.y);e.applyLinearImpulse(o,e.getLocalCenter(),!0),cc.director.emit(a.EventConstant.DUNGEON_SHAKEONCE)},t.prototype.attacking=function(t){if(t&&this.isAttacking){var e=0;this.player&&(e=this.player.inventoryData.getFinalAttackPoint(this.player.baseAttackPoint));var o=t.node.getComponent(n.default);if(o&&!o.isDied){o.takeDamage(e),this.beatBack(o.node);var i=this.player.inventoryData.getLifeDrain(this.player.baseAttackPoint);0<i&&this.player.takeDamage(-i)}var a=t.node.getComponent(r.default);a&&!a.isDied&&a.takeDamage(e,cc.v2(0,0))}},__decorate([l(cc.Node)],t.prototype,"playerNode",void 0),t=__decorate([c],t)}(cc.Component);o.default=p,cc._RF.pop()},{"./Boss/Kraken":"Kraken","./EventConstant":"EventConstant","./Monster":"Monster","./Player":"Player"}],MiniMap:[function(t,e,o){"use strict";cc._RF.push(e,"b8f7e0qah9Ot5qnGbL59sxK","MiniMap"),Object.defineProperty(o,"__esModule",{value:!0});var c=t("./Logic"),l=t("./Rect/RectDungeon"),p=t("./Rect/RectRoom"),n=t("./EventConstant"),i=cc._decorator,a=i.ccclass,r=i.property,s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.miniTile=null,t.size=0,t}return __extends(t,e),(s=t).prototype.onLoad=function(){var e=this;cc.director.on(n.EventConstant.CHANGE_MIMIMAP,function(t){e.changeMap(t.detail.x,t.detail.y)}),this.size=c.default.level+2;var t=l.default.LEVEL_5-c.default.level;t=Math.round(t/2),this.map=new Array;for(var o=0;o<this.size;o++){this.map[o]=new Array;for(var i=0;i<this.size;i++){var a=cc.instantiate(this.miniTile);this.map[o][i]=a,this.map[o][i].parent=this.node,this.map[o][i].position=cc.v2(o*a.width,i*a.height),this.map[o][i].color=cc.Color.BLACK,this.map[o][i].opacity=0}}},t.prototype.start=function(){},t.prototype.changeMap=function(t,e){if(this.map)for(var o=0;o<this.size;o++)for(var i=0;i<this.size;i++){var a=c.default.mapManger.rectDungeon.map[i][o].isFound,n=c.default.mapManger.rectDungeon.map[i][o].state,r=c.default.mapManger.rectDungeon.map[i][o].roomType;this.map[i][o].color=this.getColor(s.ColorLevel.HIDE),a&&(this.map[i][o].color=this.getColor(s.ColorLevel.NORMAL),this.map[i][o].opacity=255,n!=p.default.STATE_SLEEP&&n!=p.default.STATE_ACTIVE||(this.map[i][o].color=this.getColor(s.ColorLevel.NORMAL),r==l.default.BOSS_ROOM&&(this.map[i][o].color=this.getColor(s.ColorLevel.NORMAL_BOSS)),r==l.default.LOOT_ROOM&&(this.map[i][o].color=this.getColor(s.ColorLevel.NORMAL_LOOT))),n==p.default.STATE_CLEAR&&(this.map[i][o].color=this.getColor(s.ColorLevel.CLEAR),r==l.default.BOSS_ROOM&&(this.map[i][o].color=this.getColor(s.ColorLevel.CLAER_BOSS)),r==l.default.END_ROOM&&(this.map[i][o].color=this.getColor(s.ColorLevel.CLEAR_END)),r==l.default.MERCHANT_ROOM&&(this.map[i][o].color=this.getColor(s.ColorLevel.CLEAR_MERCHANT))),i==t&&o==e&&(this.map[t][e].color=this.getColor(s.ColorLevel.PLAYER)))}},t.prototype.getColor=function(t){var e=new cc.Color(0,0,0);switch(t){case s.ColorLevel.HIDE:e=new cc.Color(0,0,0);break;case s.ColorLevel.NORMAL:e=new cc.Color(128,128,128);break;case s.ColorLevel.CLEAR:e=new cc.Color(255,255,255);break;case s.ColorLevel.PLAYER:e=new cc.Color(0,255,0);break;case s.ColorLevel.NORMAL_BOSS:e=new cc.Color(128,0,128);break;case s.ColorLevel.NORMAL_LOOT:e=new cc.Color(255,215,0);break;case s.ColorLevel.CLAER_BOSS:e=new cc.Color(75,0,130);break;case s.ColorLevel.CLEAR_END:e=new cc.Color(176,196,222);break;case s.ColorLevel.CLEAR_MERCHANT:e=new cc.Color(139,69,19)}return e},t.ColorLevel={HIDE:0,NORMAL:1,PLAYER:2,CLEAR:3,NORMAL_BOSS:4,CLEAR_MERCHANT:5,CLEAR_END:6,CLAER_BOSS:7,NORMAL_LOOT:8},__decorate([r(cc.Prefab)],t.prototype,"miniTile",void 0),t=s=__decorate([a],t);var s}(cc.Component);o.default=s,cc._RF.pop()},{"./EventConstant":"EventConstant","./Logic":"Logic","./Rect/RectDungeon":"RectDungeon","./Rect/RectRoom":"RectRoom"}],MonsterData:[function(t,e,o){"use strict";cc._RF.push(e,"1f11a18691HqqKqLoB//q4B","MonsterData"),Object.defineProperty(o,"__esModule",{value:!0});var i=cc._decorator,a=i.ccclass,n=(i.property,function(){function t(){this.name="",this.currentHealth=0,this.maxHealth=0,this.attackPoint=0,this.pos=cc.v2(0,0),this.monsterType=0}return t.prototype.updateHAT=function(t,e,o,i){this.currentHealth=t,this.maxHealth=e,this.attackPoint=o,this.monsterType=i},t=__decorate([a],t)}());o.default=n,cc._RF.pop()},{}],MonsterManager:[function(t,e,o){"use strict";cc._RF.push(e,"441f6g4iH9M574s+sdv3n8E","MonsterManager"),Object.defineProperty(o,"__esModule",{value:!0});var r=t("../Monster"),s=t("../Data/MonsterData"),a=t("../Boss/Kraken"),i=cc._decorator,c=i.ccclass,l=i.property,n=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.monster=null,t.kraken=null,t}return __extends(t,e),(n=t).prototype.onLoad=function(){},t.prototype.getMonster=function(t,e){var o=null;(o=cc.instantiate(this.monster)).active=!1,o.parent=e;var i=o.getComponent(r.default),a=new s.default;switch(t){case n.MONSTER_SLIME:a.updateHAT(500,500,1,n.TYPE_DASH);break;case n.MONSTER_GOBLIN:a.updateHAT(1,1,1,n.TYPE_COMBAT);break;case n.MONSTER_MUMMY:a.updateHAT(2,2,2,n.TYPE_COMBAT);break;case n.MONSTER_ANUBIS:a.updateHAT(3,3,3,n.TYPE_COMBAT);break;case n.MONSTER_PIRATE:a.updateHAT(2,2,2,n.TYPE_COMBAT);break;case n.MONSTER_SAILOR:a.updateHAT(1,1,1,n.TYPE_COMBAT);break;case n.MONSTER_OCTOPUS:a.updateHAT(10,10,2,n.TYPE_REMOTE)}return i.changeBodyRes(t),i.data=a,i},t.prototype.getKraken=function(t){var e=null;(e=cc.instantiate(this.kraken)).active=!1,e.parent=t;var o=e.getComponent(a.default),i=new s.default;return i.updateHAT(20,20,2,n.TYPE_BOSS),o.data=i,o.transportPlayer(4,5),o.node.active=!0,o},t.prototype.start=function(){},t.TYPE_COMBAT=0,t.TYPE_REMOTE=1,t.TYPE_DASH=2,t.TYPE_BOSS=3,t.MONSTER_SLIME="monster000",t.MONSTER_GOBLIN="monster001",t.MONSTER_MUMMY="monster002",t.MONSTER_ANUBIS="monster003",t.MONSTER_PIRATE="monster004",t.MONSTER_SAILOR="monster005",t.MONSTER_OCTOPUS="monster006",t.BOSS_KRAKEN="BOSS_KRAKEN",__decorate([l(cc.Prefab)],t.prototype,"monster",void 0),__decorate([l(cc.Prefab)],t.prototype,"kraken",void 0),t=n=__decorate([c],t);var n}(cc.Component);o.default=n,cc._RF.pop()},{"../Boss/Kraken":"Kraken","../Data/MonsterData":"MonsterData","../Monster":"Monster"}],Monster:[function(t,e,o){"use strict";cc._RF.push(e,"b7513vXKLpHGrSf+utaohLs","Monster"),Object.defineProperty(o,"__esModule",{value:!0});var i=cc._decorator,a=i.ccclass,n=i.property,r=t("./HealthBar"),s=t("./Logic"),c=t("./Data/MonsterData"),l=t("./Dungeon"),p=t("./Manager/MonsterManager"),h=t("./Shooter"),d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.pos=cc.v2(0,0),t.label=null,t.healthBar=null,t.isFaceRight=!0,t.isMoving=!1,t.isAttacking=!1,t.isDied=!1,t.isFall=!1,t.timeDelay=0,t.data=new c.default,t.shooter=null,t.isHurt=!1,t}return __extends(t,e),t.prototype.onLoad=function(){this.isAttacking=!1,this.isDied=!1,this.anim=this.getComponent(cc.Animation),this.sprite=this.node.getChildByName("sprite"),this.rigidbody=this.getComponent(cc.RigidBody),this.shooter=this.node.getChildByName("Shooter").getComponent(h.default),this.updatePlayerPos()},t.prototype.changeBodyRes=function(t){this.sprite||(this.sprite=this.node.getChildByName("sprite"));var e=this.sprite.getChildByName("body"),o=s.default.spriteFrames[t];e.getComponent(cc.Sprite).spriteFrame=o,e.width=o.getRect().width,e.height=o.getRect().height},t.prototype.updatePlayerPos=function(){this.node.x=64*this.pos.x+32,this.node.y=64*this.pos.y+32},t.prototype.transportPlayer=function(t,e){this.sprite.rotation=0,this.sprite.scale=1,this.sprite.opacity=255,this.sprite.x=0,this.sprite.y=0,this.pos.x=t,this.pos.y=e,this.changeZIndex(),this.updatePlayerPos()},t.prototype.changeZIndex=function(){this.node.zIndex=3e3+100*(9-this.pos.y)+2},t.prototype.meleeAttack=function(t,e){var o=this;if(!this.isAttacking){this.isAttacking=!0,this.anim.pause(),t.equals(cc.Vec2.ZERO)&&(t=cc.v2(1,0)),t=t.normalizeSelf().mul(32);var i=cc.sequence(cc.moveBy(.1,-t.x/2,-t.y/2),cc.moveBy(.1,t.x,t.y),cc.callFunc(function(){o.isAttacking=!1,o.anim.resume(),e&&e(o.data.attackPoint)}),cc.moveTo(.1,0,0));this.sprite.runAction(i)}},t.prototype.getNearPlayerDistance=function(t){return cc.pDistance(this.node.position,t.position)},t.prototype.move=function(t,e,o){if(this.isDied||this.isFall||this.isHurt)this.isHurt=!1;else{this.isAttacking&&!e.equals(cc.Vec2.ZERO)&&(e=e.mul(.5)),e.equals(cc.Vec2.ZERO)||(this.pos=l.default.getIndexInMap(this.node.position));var i=e.x,a=e.y,n=Math.abs(i),r=Math.abs(a),s=r<n?n:r;s=0==s?1:s;var c=cc.v2(i,a);c=c.mul(o),this.rigidbody.linearVelocity=c,this.isMoving=0!=i||0!=a,this.isMoving&&(this.isFaceRight=0<i),this.isMoving?this.anim.getAnimationState("PlayerWalk").isPlaying||this.anim.playAdditive("PlayerWalk"):this.anim.getAnimationState("PlayerWalk").isPlaying&&this.anim.play("PlayerIdle"),(1==t||0==t)&&this.changeZIndex()}},t.prototype.start=function(){for(var t=this.node.getComponentsInChildren(cc.Sprite),e=0;e<t.length;e++)t[e].spriteFrame&&t[e].spriteFrame.getTexture().setAliasTexParameters();this.changeZIndex(),this.healthBar.refreshHealth(this.data.currentHealth,this.data.maxHealth),this.getComponent("cc.PhysicsCollider").sensor=!1},t.prototype.fall=function(){this.isFall||(this.isFall=!0,this.isDied=!0,this.getComponent("cc.PhysicsCollider").sensor=!0,this.anim.play("PlayerFall"))},t.prototype.takeDamage=function(t){this.isHurt=!0,this.data.currentHealth-=t,this.data.currentHealth>this.data.maxHealth&&(this.data.currentHealth=this.data.maxHealth),this.healthBar.refreshHealth(this.data.currentHealth,this.data.maxHealth),this.data.currentHealth<1&&this.killed()},t.prototype.killed=function(){this.isDied||(this.isDied=!0,this.anim.play("PlayerDie"),this.getComponent("cc.PhysicsCollider").sensor=!0)},t.prototype.monsterAction=function(e){if(!this.isDied){this.node.position=l.default.fixOuterMap(this.node.position),this.dungeon=e,this.pos=l.default.getIndexInMap(this.node.position),this.changeZIndex();var t=this.getMonsterBestDir(this.pos,e),o=cc.v2(this.pos.x,this.pos.y);switch(t){case 0:o.y+1<9&&o.y++;break;case 1:0<=o.y-1&&o.y--;break;case 2:0<=o.x-1&&o.x--;break;case 3:o.x+1<15&&o.x++}var i=this.getNearPlayerDistance(e.player.node);if(i<64&&!e.player.isDied){(a=e.player.node.position.sub(this.node.position)).equals(cc.Vec2.ZERO)||(a=a.normalizeSelf()),this.meleeAttack(a,function(t){e.player.takeDamage(t)})}else{var a=l.default.getPosInMap(o).sub(this.node.position),n=300;if(i<200&&(a=e.player.node.position.sub(this.node.position),this.data.monsterType==p.default.TYPE_DASH&&(n=600)),i<600&&this.data.monsterType==p.default.TYPE_REMOTE){var r=e.player.node.position.sub(this.node.position);this.shooter&&!r.equals(cc.Vec2.ZERO)&&(r=r.normalizeSelf(),this.shooter.setHv(r),this.shooter.dungeon=e,this.shooter.fireBullet())}a.equals(cc.Vec2.ZERO)||(a=a.normalizeSelf(),this.move(t,a,n))}}},t.prototype.getPosDir=function(t,e){var o=4;return e.x==t.x&&(o=e.y>t.y?0:1),e.y==t.y&&(o=e.x>t.x?3:2),e.equals(t)&&(o=4),o},t.prototype.getMonsterBestDir=function(t,e){var o=cc.v2(t.x,t.y),i=new Array;t.y+1<9&&i.push(cc.v2(t.x,t.y+1)),0<=t.y-1&&i.push(cc.v2(t.x,t.y-1)),0<=t.x-1&&i.push(cc.v2(t.x-1,t.y)),t.x+1<9&&i.push(cc.v2(t.x+1,t.y)),i.sort(function(){return.5-Math.random()});for(var a=new Array,n=0;n<i.length;n++){var r=i[n];if(!e.map[r.x][r.y].isBroken){for(var s=!1,c=0,l=e.monsters;c<l.length;c++){if(l[c].pos.equals(r)){s=!0;break}}var p=e.wallmap[r.x][r.y];p&&p.node.active&&(s=!0),s||a.push(r)}}for(n=0;n<a.length;n++){if((r=a[n]).equals(e.player.pos)){o=r;break}e.map[r.x][r.y].isBreakingNow||(o=r)}return this.getPosDir(t,o)},t.prototype.update=function(t){(this.timeDelay+=t,1<this.timeDelay&&(this.timeDelay=0),this.dungeon)&&(this.getNearPlayerDistance(this.dungeon.player.node)<64&&!this.isHurt&&(this.rigidbody.linearVelocity=cc.v2(0,0)));this.isDied&&(this.rigidbody.linearVelocity=cc.Vec2.ZERO),this.label&&(this.label.string=""+this.node.zIndex),this.healthBar.node.active=!this.isDied,this.data.currentHealth<1&&this.killed(),this.sprite.scaleX=this.isFaceRight?1:-1},__decorate([n(cc.Vec2)],t.prototype,"pos",void 0),__decorate([n(cc.Label)],t.prototype,"label",void 0),__decorate([n(r.default)],t.prototype,"healthBar",void 0),t=__decorate([a],t)}(cc.Component);o.default=d,cc._RF.pop()},{"./Data/MonsterData":"MonsterData","./Dungeon":"Dungeon","./HealthBar":"HealthBar","./Logic":"Logic","./Manager/MonsterManager":"MonsterManager","./Shooter":"Shooter"}],PlayerData:[function(t,e,o){"use strict";cc._RF.push(e,"802a53ZqslNorozVvKYFivM","PlayerData"),Object.defineProperty(o,"__esModule",{value:!0});var i=cc._decorator,a=i.ccclass,n=(i.property,function(){function t(){this.name="",this.basehealth=cc.v2(e.DEFAULT_HEALTH,e.DEFAULT_HEALTH),this.attackPoint=1,this.pos=cc.v2(4,4)}return(e=t).prototype.updateHA=function(t,e){return this.basehealth=t,this.attackPoint=e,this},t.DEFAULT_HEALTH=5,t=e=__decorate([a],t);var e}());o.default=n,cc._RF.pop()},{}],Player:[function(t,e,o){"use strict";cc._RF.push(e,"03570PUzDdNyIu4Asd1jFZT","Player"),Object.defineProperty(o,"__esModule",{value:!0});var i=cc._decorator,a=i.ccclass,n=i.property,r=t("./EventConstant"),s=t("./Shooter"),c=t("./HealthBar"),p=t("./Logic"),h=t("./Dungeon"),l=t("./Equipment/Equipment"),d=t("./Monster"),u=t("./Boss/Kraken"),m=t("./MeleeWeapon"),y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.pos=cc.v2(4,4),t.label=null,t.healthBar=null,t.meleeWeaponNode=null,t.meleeWeapon=null,t.shooterNode=null,t.shooter=null,t.hairSprite=null,t.weaponSprite=null,t.weaponLightSprite=null,t.weaponStabSprite=null,t.weaponStabLightSprite=null,t.helmetSprite=null,t.clothesSprite=null,t.trousersSprite=null,t.glovesSprite=null,t.shoesSprite=null,t.isMoving=!1,t.isAttacking=!1,t.isDied=!1,t.isFall=!1,t.health=cc.v2(1,1),t.baseAttackPoint=1,t.recoveryTimeDelay=0,t.isFaceRight=!0,t.defaultPos=cc.v2(0,0),t.remoteRate=0,t}return __extends(t,e),t.prototype.onLoad=function(){var e=this;this.isAttacking=!1,this.inventoryData=p.default.inventoryData,this.health=this.inventoryData.getHealth(p.default.playerData.basehealth,p.default.playerData.basehealth.y),this.pos=cc.v2(4,4),this.isDied=!1,this.anim=this.getComponent(cc.Animation),this.rigidbody=this.getComponent(cc.RigidBody),this.sprite=this.node.getChildByName("sprite"),this.playerItemSprite=this.sprite.getChildByName("righthand").getChildByName("item").getComponent(cc.Sprite),this.hairSprite=this.sprite.getChildByName("body").getChildByName("hair").getComponent(cc.Sprite),this.weaponSprite=this.node.getChildByName("MeleeWeapon").getChildByName("sprite").getChildByName("weapon").getComponent(cc.Sprite),this.weaponLightSprite=this.node.getChildByName("MeleeWeapon").getChildByName("sprite").getChildByName("meleelight").getComponent(cc.Sprite),this.weaponStabSprite=this.node.getChildByName("MeleeWeapon").getChildByName("sprite").getChildByName("stabweapon").getComponent(cc.Sprite),this.weaponStabLightSprite=this.node.getChildByName("MeleeWeapon").getChildByName("sprite").getChildByName("stablight").getComponent(cc.Sprite),this.helmetSprite=this.sprite.getChildByName("body").getChildByName("helmet").getComponent(cc.Sprite),this.clothesSprite=this.sprite.getChildByName("body").getChildByName("clothes").getComponent(cc.Sprite),this.trousersSprite=this.sprite.getChildByName("body").getChildByName("trousers").getComponent(cc.Sprite),this.glovesSprite=this.sprite.getChildByName("body").getChildByName("gloves").getComponent(cc.Sprite),this.shoesSprite=this.sprite.getChildByName("body").getChildByName("shoes").getComponent(cc.Sprite),cc.director.on(r.EventConstant.INVENTORY_CHANGEITEM,function(t){e.changeItem(t.detail.spriteFrame)}),cc.director.on(r.EventConstant.PLAYER_USEITEM,function(t){e.UseItem()}),cc.director.on(r.EventConstant.PLAYER_ATTACK,function(t){e.meleeAttack()}),cc.director.on(r.EventConstant.PLAYER_REMOTEATTACK,function(t){e.remoteAttack()}),cc.director.on(r.EventConstant.PLAYER_TAKEDAMAGE,function(t){e.takeDamage(t.detail.damage)}),this.pos=p.default.playerData.pos,this.defaultPos=p.default.playerData.pos.clone(),this.updatePlayerPos(),this.meleeWeapon=this.meleeWeaponNode.getComponent(m.default),this.shooter=this.shooterNode.getComponent(s.default)},t.prototype.changeItem=function(t){this.playerItemSprite.spriteFrame=t},t.prototype.changeEquipment=function(t,e){switch(t.equipmetType){case"weapon":this.meleeWeapon.isStab=1==t.stab,1==t.stab?(this.weaponSprite.spriteFrame=null,this.weaponStabSprite.spriteFrame=e,this.weaponStabLightSprite.spriteFrame=p.default.spriteFrames.stablight):(this.weaponSprite.spriteFrame=e,this.weaponStabSprite.spriteFrame=null);var o=cc.color(255,255,255).fromHEX(this.inventoryData.weapon.color);this.weaponSprite.node.color=o,this.weaponLightSprite.node.color=o,this.weaponStabSprite.node.color=o,this.weaponStabLightSprite.node.color=o;break;case"helmet":this.helmetSprite.spriteFrame=e,this.hairSprite.node.opacity=e?0:255;var i=cc.color(255,255,255).fromHEX(this.inventoryData.helmet.color);this.helmetSprite.node.color=i;break;case"clothes":this.clothesSprite.spriteFrame=e;var a=cc.color(255,255,255).fromHEX(this.inventoryData.clothes.color);this.clothesSprite.node.color=a;break;case"trousers":this.trousersSprite.spriteFrame=e;var n=cc.color(255,255,255).fromHEX(this.inventoryData.trousers.color);this.trousersSprite.node.color=n;break;case"gloves":this.glovesSprite.spriteFrame=e;var r=cc.color(255,255,255).fromHEX(this.inventoryData.gloves.color);this.glovesSprite.node.color=r;break;case"shoes":this.shoesSprite.spriteFrame=e;var s=cc.color(255,255,255).fromHEX(this.inventoryData.shoes.color);this.shoesSprite.node.color=s}this.health=this.inventoryData.getHealth(this.health,p.default.playerData.basehealth.y),this.healthBar.refreshHealth(this.health.x,this.health.y)},t.prototype.updatePlayerPos=function(){this.node.x=64*this.pos.x+32,this.node.y=64*this.pos.y+32},t.prototype.transportPlayer=function(t){this.sprite.rotation=0,this.sprite.scale=1,this.sprite.opacity=255,this.sprite.x=0,this.sprite.y=0,this.pos=t,this.changeZIndex(this.pos),this.updatePlayerPos()},t.prototype.changeZIndex=function(t){this.node.zIndex=3e3+100*(9-t.y)+2},t.prototype.meleeAttack=function(){var t=this;if(!this.isAttacking&&this.meleeWeapon){this.isAttacking=!0;var e=this.meleeWeapon.getHv().clone();e.equals(cc.Vec2.ZERO)&&(e=cc.v2(1,0)),e=e.normalizeSelf().mul(5);var o=this.inventoryData.getAttackSpeed(),i=cc.sequence(cc.moveBy(.1,e.x,e.y),cc.callFunc(function(){setTimeout(function(){t.isAttacking=!1},o)},this));this.node.runAction(i),this.meleeWeapon.attack()}},t.prototype.remoteAttack=function(){var t=Date.now();1e3<t-this.remoteRate&&(this.remoteRate=t,this.shooter&&this.shooter.fireBullet())},t.prototype.move=function(t,e,o){if(!this.isDied&&!this.isFall){this.isAttacking&&!e.equals(cc.Vec2.ZERO)&&(e=e.mul(.5)),this.shooter&&!e.equals(cc.Vec2.ZERO)&&(this.shooter.setHv(cc.v2(e.x,e.y)),this.pos=h.default.getIndexInMap(this.node.position)),this.meleeWeapon&&!e.equals(cc.Vec2.ZERO)&&this.meleeWeapon.setHv(cc.v2(e.x,e.y));var i=e.x,a=e.y,n=Math.abs(i),r=Math.abs(a),s=r<n?n:r;s=0==s?1:s;var c=cc.v2(i,a),l=this.inventoryData.getMoveSpeed(300);c=c.mul(l),this.rigidbody.linearVelocity=c,this.isMoving=0!=i||0!=a,this.isMoving&&(this.isFaceRight=0<i),this.isMoving?this.anim.getAnimationState("PlayerWalk").isPlaying||this.anim.playAdditive("PlayerWalk"):this.anim.getAnimationState("PlayerWalk").isPlaying&&(this.anim.play("PlayerIdle"),this.trousersSprite.spriteFrame=p.default.spriteFrames.trousers002),(1==t||0==t)&&this.changeZIndex(this.pos)}},t.prototype.start=function(){for(var t=this.node.getComponentsInChildren(cc.Sprite),e=0;e<t.length;e++)t[e].spriteFrame&&t[e].spriteFrame.getTexture().setAliasTexParameters();this.changeZIndex(this.pos),this.health=this.inventoryData.getHealth(this.health,p.default.playerData.basehealth.y),this.healthBar.refreshHealth(this.health.x,this.health.y)},t.prototype.fall=function(){var t=this;this.isFall||(this.isFall=!0,this.anim.play("PlayerFall"),this.isAttacking=!1,setTimeout(function(){t.transportPlayer(t.defaultPos),t.anim.play("PlayerIdle"),t.takeDamage(1),t.isFall=!1},2e3))},t.prototype.takeDamage=function(t){if(this.healthBar){var e=this.inventoryData.getDamage(t),o=this.inventoryData.getDodge(),i=Math.random()<=o;e=i?0:e,this.health=this.inventoryData.getHealth(this.health,p.default.playerData.basehealth.y),this.health.x-=e,this.health.x>this.health.y&&(this.health.x=this.health.y),this.healthBar.refreshHealth(this.health.x,this.health.y),p.default.playerData.basehealth.x=this.health.x,this.label&&(this.label.node.opacity=255,this.label.node.scaleX=this.node.scaleX,this.label.node.color=0<t?cc.color(255,0,0):cc.color(0,255,0),this.label.string=""+parseFloat((-t).toFixed(1)),i&&(this.label.node.color=cc.color(255,255,255),this.label.string="miss"),this.label.getComponent(cc.Animation).play("FontFloating")),0<t&&cc.director.emit(r.EventConstant.DUNGEON_SHAKEONCE),this.health.x<1&&this.killed()}},t.prototype.killed=function(){this.isDied||(this.isDied=!0,this.anim.play("PlayerDie"),setTimeout(function(){cc.director.loadScene("gameover")},1e3))},t.prototype.playerAction=function(t,e,o,i){this.move(t,e,o)},t.prototype.isRecoveryTimeDelay=function(t){return this.recoveryTimeDelay+=t,30<this.recoveryTimeDelay&&!(this.recoveryTimeDelay=0)},t.prototype.update=function(t){if(this.isRecoveryTimeDelay(t)){var e=this.inventoryData.getRecovery();0<e&&this.takeDamage(-e)}this.node.scaleX=this.isFaceRight?1:-1},t.prototype.UseItem=function(){this.touchedEquipment&&!this.touchedEquipment.isTaken&&(this.touchedEquipment.taken(),this.touchedEquipment=null)},t.prototype.AttackFinish=function(){this.isAttacking=!1},t.prototype.Attacking=function(){var t=this.inventoryData.getFinalAttackPoint(this.baseAttackPoint),e=this.inventoryData.getLifeDrain(this.baseAttackPoint);if(0<e&&this.takeDamage(-e),this.attackTarget){var o=this.attackTarget.node.getComponent(d.default);o&&!o.isDied&&o.takeDamage(t);var i=this.attackTarget.node.getComponent(u.default);i&&!i.isDied&&i.takeDamage(t,cc.v2(this.pos.x,this.pos.y+1))}},t.prototype.onBeginContact=function(t,e,o){var i=o.body.node.getComponent(l.default);i&&(this.touchedEquipment=i)},t.prototype.onEndContact=function(t,e,o){this.touchedEquipment=null},__decorate([n(cc.Vec2)],t.prototype,"pos",void 0),__decorate([n(cc.Label)],t.prototype,"label",void 0),__decorate([n(c.default)],t.prototype,"healthBar",void 0),__decorate([n(cc.Node)],t.prototype,"meleeWeaponNode",void 0),__decorate([n(cc.Node)],t.prototype,"shooterNode",void 0),t=__decorate([a],t)}(cc.Component);o.default=y,cc._RF.pop()},{"./Boss/Kraken":"Kraken","./Dungeon":"Dungeon","./Equipment/Equipment":"Equipment","./EventConstant":"EventConstant","./HealthBar":"HealthBar","./Logic":"Logic","./MeleeWeapon":"MeleeWeapon","./Monster":"Monster","./Shooter":"Shooter"}],Portal:[function(t,e,o){"use strict";cc._RF.push(e,"deb90P3hX5AB5svKZmVAO6Q","Portal"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("../Dungeon"),a=t("../EventConstant"),n=t("../Player"),r=cc._decorator,s=r.ccclass,c=(r.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.isOpen=!1,t.pos=cc.v2(4,4),t}return __extends(t,e),t.prototype.start=function(){this.anim=this.getComponent(cc.Animation),this.anim.play("PortalCloseIdle")},t.prototype.setPos=function(t){this.pos=t,this.node.position=i.default.getPosInMap(t),this.node.zIndex=1e3+100*(i.default.HEIGHT_SIZE-t.y)+1},t.prototype.AnimGateClose=function(){this.anim.play("PortalCloseIdle")},t.prototype.AnimGateOpen=function(){this.anim.play("PortalOpenIdle")},t.prototype.openGate=function(){this.isOpen||(this.isOpen=!0,this.anim.play("PortalOpen"))},t.prototype.closeGate=function(){this.isOpen&&(this.isOpen=!1,this.anim.play("PortalClose"))},t.prototype.transportPlayer=function(t){t.x==this.pos.x&&t.y==this.pos.y&&this.isOpen},t.prototype.onBeginContact=function(t,e,o){o.body.node.getComponent(n.default)&&this.isOpen&&(this.closeGate(),cc.director.emit(a.EventConstant.LOADINGNEXTLEVEL))},t=__decorate([s],t)}(cc.Component));o.default=c,cc._RF.pop()},{"../Dungeon":"Dungeon","../EventConstant":"EventConstant","../Player":"Player"}],RectDoor:[function(t,e,o){"use strict";cc._RF.push(e,"d41e5HipSBBVLDWw2G1WR/C","RectDoor"),Object.defineProperty(o,"__esModule",{value:!0});var i=cc._decorator,a=i.ccclass,n=(i.property,function(){function t(t,e,o){this.isLocked=!1,this.isDoor=!1,this.dir=t,this.isLocked=e,this.isDoor=o}return t=__decorate([a],t)}());o.default=n,cc._RF.pop()},{}],RectDungeon:[function(t,e,o){"use strict";cc._RF.push(e,"3b710jO571KQpPd9DCAmaJb","RectDungeon"),Object.defineProperty(o,"__esModule",{value:!0});var a=t("./RectRoom"),i=cc._decorator,n=i.ccclass,r=(i.property,function(){function t(t){this.level=1,this.level=t,this.size=t+2,this.primaryRooms=new Array,this.secondaryRooms=new Array,this.buildMap()}return(s=t).prototype.buildMap=function(){this.map=new Array;for(var t=0;t<this.size;t++){this.map[t]=new Array;for(var e=0;e<this.size;e++)this.map[t][e]=null,(1==t||t==this.level)&&1<=e&&e<=this.level||(1==e||e==this.level)&&1<=t&&t<=this.level?this.map[t][e]=new a.default(!0,0,t,e,s.EMPTY_ROOM):this.map[t][e]=new a.default(!1,0,t,e,s.EMPTY_ROOM)}this.addPrimaryRooms(),this.addSecondaryRooms(),this.buildPrimaryRoomsType(),this.buildSecondaryRoomsType(),this.addLootKeys(),this.addDoors()},t.prototype.addPrimaryRooms=function(){for(var t=1,e=1;e<=this.level;e++){var o=1;this.map[e][o].isPrimary&&(this.map[e][o].index=t,this.primaryRooms.push(this.map[e][o]),t++)}for(o=2;o<=this.level;o++){e=this.level;this.map[e][o].isPrimary&&(this.map[e][o].index=t,this.primaryRooms.push(this.map[e][o]),t++)}for(e=this.level-1;0<e;e--){o=this.level;this.map[e][o].isPrimary&&(this.map[e][o].index=t,this.primaryRooms.push(this.map[e][o]),t++)}for(o=this.level-1;1<o;o--){e=1;this.map[e][o].isPrimary&&(this.map[e][o].index=t,this.primaryRooms.push(this.map[e][o]),t++)}},t.prototype.addSecondaryRooms=function(){for(var t=1,e=0;e<this.size;e++)for(var o=0;o<this.size;o++)this.isSecondaryRoom(e,o)&&(this.map[e][o].index=t++,this.secondaryRooms.push(this.map[e][o]))},t.prototype.isSecondaryRoom=function(t,e){return!this.isPrimaryRoom(t,e)&&!!(this.isPrimaryRoom(t+1,e)||this.isPrimaryRoom(t,e+1)||this.isPrimaryRoom(t-1,e)||this.isPrimaryRoom(t,e-1))},t.prototype.isPrimaryRoom=function(t,e){return!!(t<this.size-1&&0<t&&e<this.size-1&&0<e&&this.map[t][e].isPrimary)},t.prototype.buildPrimaryRoomsType=function(){for(var t=[s.TRAP_ROOM,s.DANGER_ROOM],e=0,o=this.primaryRooms;e<o.length;e++){var i=o[e],a=t[this.getRandomNum(0,t.length-1)];i.roomType=a}var n=this.getRandomNum(0,this.primaryRooms.length-1),r=n-1;r<0&&(r=this.primaryRooms.length-1),this.primaryRooms[r].roomType=s.END_ROOM,this.endRoom=this.primaryRooms[r],this.endRoom.lockAllDoors(!0),this.primaryRooms[n].roomType=s.START_ROOM,this.startRoom=this.primaryRooms[n],this.startRoom.lockAllDoors(!1),this.startRoom.isFound=!0},t.prototype.buildSecondaryRoomsType=function(){for(var t=[s.TRAP_ROOM,s.DANGER_ROOM],e=0,o=this.secondaryRooms;e<o.length;e++){var i=o[e],a=t[this.getRandomNum(0,t.length-1)];this.level==s.LEVEL_1?i.roomType=a:this.getHalfChance()&&(i.roomType=a)}var n=this.getRandomNum(0,this.secondaryRooms.length-1);this.level==s.LEVEL_1&&(this.secondaryRooms[n].roomType=s.END_ROOM,this.endRoom=this.secondaryRooms[n],this.endRoom.lockAllDoors(!1)),this.level==s.LEVEL_3&&(this.map[2][2].roomType=s.MERCHANT_ROOM),this.level==s.LEVEL_5&&(this.map[3][3].roomType=s.BOSS_ROOM,this.map[3][4].roomType==s.EMPTY_ROOM&&this.map[3][2].roomType==s.EMPTY_ROOM&&this.map[2][3].roomType==s.EMPTY_ROOM&&this.map[4][3].roomType==s.EMPTY_ROOM&&(this.map[3][4].roomType=this.getHalfChance()?s.DANGER_ROOM:s.TRAP_ROOM),this.addLootRoom()),this.addPuzzleRoom(),this.addLootRoom(),this.addLootRoom()},t.prototype.addPuzzleRoom=function(){var t=this.getRandomNum(0,this.secondaryRooms.length-1);this.secondaryRooms[t].roomType==s.TRAP_ROOM||this.secondaryRooms[t].roomType==s.DANGER_ROOM||this.secondaryRooms[t].roomType==s.EMPTY_ROOM?this.secondaryRooms[t].roomType=s.PUZZLE_ROOM:this.addPuzzleRoom()},t.prototype.addLootRoom=function(){for(var t=0,e=new Array,o=0,i=this.secondaryRooms;o<i.length;o++){var a=i[o];a.roomType!=s.DANGER_ROOM&&a.roomType!=s.TRAP_ROOM&&a.roomType!=s.EMPTY_ROOM||e.push(a),a.roomType==s.LOOT_ROOM&&t++}if(1<e.length&&t<e.length+1){var n=this.getRandomNum(0,e.length-1);e[n].roomType=s.LOOT_ROOM,e[n].lockAllDoors(!0)}},t.prototype.addLootKeys=function(){for(var t=0,e=new Array,o=0,i=this.secondaryRooms;o<i.length;o++){var a=i[o];a.enemyCount!=s.DANGER_ROOM&&a.roomType!=s.TRAP_ROOM||e.push(a),a.roomType==s.LOOT_ROOM&&t++,a.roomType==s.PUZZLE_ROOM&&(a.hasKey=!0)}for(var n=0;n<t;n++)if(0<e.length){var r=this.getRandomNum(0,e.length-1);e[r].hasKey=!0,e.splice(r,1)}},t.prototype.addDoors=function(){for(var t=0;t<this.size;t++)for(var e=0;e<this.size;e++)this.map[t][e].roomType!=s.EMPTY_ROOM&&(this.changeDoor(t,e,a.default.TOPDOOR,!0),this.changeDoor(t,e,a.default.BOTTOMDOOR,!0),this.changeDoor(t,e,a.default.LEFTDOOR,!0),this.changeDoor(t,e,a.default.RIGHTDOOR,!0));for(t=0;t<this.size;t++)for(e=0;e<this.size;e++)this.map[t][e].roomType==s.EMPTY_ROOM&&(this.changeDoor(t,e,a.default.TOPDOOR,!1),this.changeDoor(t,e,a.default.BOTTOMDOOR,!1),this.changeDoor(t,e,a.default.LEFTDOOR,!1),this.changeDoor(t,e,a.default.RIGHTDOOR,!1))},t.prototype.changeDoor=function(t,e,o,i){switch(o){case a.default.TOPDOOR:this.map[t][e].doors[0].isDoor=i,e+1<this.size?this.map[t][e+1].doors[1].isDoor=i:this.map[t][e].doors[0].isDoor=!1;break;case a.default.BOTTOMDOOR:this.map[t][e].doors[1].isDoor=i,0<=e-1?this.map[t][e-1].doors[0].isDoor=i:this.map[t][e].doors[1].isDoor=!1;break;case a.default.LEFTDOOR:this.map[t][e].doors[2].isDoor=i,0<=t-1?this.map[t-1][e].doors[3].isDoor=i:this.map[t][e].doors[2].isDoor=!1;break;case a.default.RIGHTDOOR:this.map[t][e].doors[3].isDoor=i,t+1<this.size?this.map[t+1][e].doors[2].isDoor=i:this.map[t][e].doors[3].isDoor=!1}},t.prototype.getDisPlay=function(){for(var t="",e=this.size-1;0<=e;e--){for(var o=0;o<this.size;o++)t+=this.getTypeStringLog(this.map[o][e].roomType);t+="\n"}return t},t.prototype.getNeighborRoomType=function(t,e,o){var i=t,a=e;return 0==o&&(a+=1),1==o&&(a-=1),2==o&&(i-=1),3==o&&(i+=1),i>=this.size||i<0||a>=this.size||a<0||o<0||4<o?null:this.map[i][a]},t.prototype.changeRoomIsFound=function(t,e){t>=this.size||t<0||e>=this.size||e<0||this.map[t][e].roomType!=s.EMPTY_ROOM&&(this.map[t][e].isFound=!0)},t.isRoomEqual=function(t,e){return t.x==e.x&&t.y==e.y},t.getTypeString=function(t){return t!=s.EMPTY_ROOM?"Room":"RoomEmpty"},t.prototype.getTypeStringLog=function(t){switch(t){case s.EMPTY_ROOM:return"　";case s.START_ROOM:return"Ｓ";case s.END_ROOM:return"Ｅ";case s.TRAP_ROOM:return"Ｔ";case s.LOOT_ROOM:return"Ｌ";case s.DANGER_ROOM:return"Ｄ";case s.PUZZLE_ROOM:return"Ｐ";case s.MERCHANT_ROOM:return"Ｍ";case s.BOSS_ROOM:return"Ｂ"}return"　"},t.prototype.getRandomNum=function(t,e){return t+Math.round(Math.random()*(e-t))},t.prototype.getHalfChance=function(){return.5<Math.random()},t.LEVEL_1=1,t.LEVEL_2=2,t.LEVEL_3=3,t.LEVEL_4=4,t.LEVEL_5=5,t.PRIMARY=1e3,t.SECONDARY=2e3,t.EMPTY_ROOM=0,t.START_ROOM=1,t.END_ROOM=2,t.TRAP_ROOM=3,t.LOOT_ROOM=4,t.DANGER_ROOM=5,t.PUZZLE_ROOM=6,t.MERCHANT_ROOM=7,t.BOSS_ROOM=8,t=s=__decorate([n],t);var s}());o.default=r,cc._RF.pop()},{"./RectRoom":"RectRoom"}],RectRoom:[function(t,e,o){"use strict";cc._RF.push(e,"d55edjfV4pLuKPki2DqAONx","RectRoom"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("./RectDoor"),a=t("../Logic"),n=cc._decorator,r=n.ccclass,s=(n.property,function(){function t(t,e,o,i,a){this.isPrimary=!1,this.enemyCount=0,this.state=n.STATE_SLEEP,this.isFound=!1,this.isInit=!0,this.x=o,this.y=i,this.isPrimary=t,this.index=e,this.roomType=a,this.init()}return(n=t).prototype.init=function(){if(this.state=n.STATE_SLEEP,null==this.doors){this.doors=new Array(4);for(var t=0;t<4;t++)this.doors[t]=new i.default(t,!1,!1)}this.randomTiles=new Array;for(t=0;t<n.ROOM_WIDTH;t++){this.randomTiles=new Array(t);for(var e=0;e<n.ROOM_HEIGHT;e++)this.randomTiles.push(cc.v2(t,e))}},t.prototype.lockAllDoors=function(t){for(var e=0;e<4;e++)this.doors[e].isLocked=t},Object.defineProperty(t.prototype,"positionStr",{get:function(){return""+this.x+this.y},enumerable:!0,configurable:!0}),t.prototype.randomTile=function(){if(0<this.randomTiles.length){var t=a.default.getRandomNum(0,this.randomTiles.length-1),e=this.randomTiles[t];return this.randomTiles.splice(t,1),e}return null},t.STATE_SLEEP=0,t.STATE_ACTIVE=1,t.STATE_CLEAR=2,t.ROOM_WIDTH=15,t.ROOM_HEIGHT=9,t.TOPDOOR=0,t.BOTTOMDOOR=1,t.LEFTDOOR=2,t.RIGHTDOOR=3,t=n=__decorate([r],t);var n}());o.default=s,cc._RF.pop()},{"../Logic":"Logic","./RectDoor":"RectDoor"}],Shooter:[function(t,e,o){"use strict";cc._RF.push(e,"f9805u1Wn9OeouYmQSWcHcq","Shooter"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("./Dungeon"),a=t("./Player"),n=t("./Item/Bullet"),r=cc._decorator,s=r.ccclass,c=r.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.bullet=null,t.auto=!1,t.isAI=!1,t.frequency=1,t.dungeon=null,t.player=null,t.timeDelay=0,t.isAutoAim=!0,t.bulletName="",t.hv=cc.v2(1,0),t}return __extends(t,e),t.prototype.onLoad=function(){var e=this;this.anim=this.getComponent(cc.Animation),this.bulletPool=new cc.NodePool,cc.director.on("destorybullet",function(t){e.destroyBullet(t.detail.bulletNode)})},t.prototype.setHv=function(t){var e=this.hasNearEnemy();e.equals(cc.Vec2.ZERO)?this.hv=t:(this.rotateColliderManager(cc.v2(this.node.position.x+e.x,this.node.position.y+e.y)),this.hv=e)},t.prototype.fireBullet=function(){this.anim&&this.anim.play(),this.fire(this.bullet,this.bulletPool)},t.prototype.fire=function(t,e){if(this.dungeon){var o=null;0<e.size()&&(o=e.get()),o&&!o.active||(o=cc.instantiate(t)),o.parent=this.node;var i=this.node.convertToWorldSpace(cc.v2(30,0));i=this.dungeon.node.convertToNodeSpace(i),o.parent=this.dungeon.node,o.position=i,o.scale=1,o.active=!0;var a=o.getComponent(n.default);this.bulletName=a.name,a.node.rotation=-1==this.node.scaleX?-this.node.rotation:this.node.rotation,a.node.scaleY=this.node.scaleX,a.node.zIndex=4e3,a.isFromPlayer=!this.isAI,a.isFromPlayer&&a.isMelee&&this.player&&(a.damage=this.player.inventoryData.getFinalAttackPoint(this.player.baseAttackPoint)),a.showBullet(this.hv)}},t.prototype.destroyBullet=function(t){t.active=!1;var e=t.getComponent(n.default);this.bulletPool&&e.name==this.bulletName&&this.bulletPool.put(t)},t.prototype.start=function(){},t.prototype.getRandomNum=function(t,e){return t+Math.round(Math.random()*(e-t))},t.prototype.update=function(t){this.timeDelay+=t,this.timeDelay>this.frequency&&this.auto&&(this.timeDelay=0,this.fireBullet());var e=this.hasNearEnemy();if(e.equals(cc.Vec2.ZERO)){if(0!=this.hv.x||0!=this.hv.y){var o=cc.v2(this.node.position.x+this.hv.x,this.node.position.y+this.hv.y);this.rotateColliderManager(o)}}else this.rotateColliderManager(cc.v2(this.node.position.x+e.x,this.node.position.y+e.y)),this.hv=e},t.prototype.hasNearEnemy=function(){if(!this.isAutoAim)return cc.Vec2.ZERO;var t=1e3,e=cc.v2(0,0);if(this.isAI);else if(this.dungeon){for(var o=0,i=this.dungeon.monsters;o<i.length;o++){var a=i[o],n=cc.pDistance(this.node.parent.position,a.node.position);n<500&&n<t&&!a.isDied&&(t=n,e=a.node.position.sub(this.node.parent.position.add(this.node.position)))}1e3!=t&&(e=e.normalizeSelf())}return e},t.prototype.rotateColliderManager=function(t){var e=t.sub(this.node.position),o=360/(2*Math.PI),i=360-Math.atan2(e.x,e.y)*o;this.node.scaleX=this.node.parent.scaleX,i+=90,this.node.rotation=-1==this.node.scaleX?i:-i},__decorate([c(cc.Prefab)],t.prototype,"bullet",void 0),__decorate([c],t.prototype,"auto",void 0),__decorate([c],t.prototype,"isAI",void 0),__decorate([c],t.prototype,"frequency",void 0),__decorate([c(i.default)],t.prototype,"dungeon",void 0),__decorate([c(a.default)],t.prototype,"player",void 0),t=__decorate([s],t)}(cc.Component);o.default=l,cc._RF.pop()},{"./Dungeon":"Dungeon","./Item/Bullet":"Bullet","./Player":"Player"}],Start:[function(t,e,o){"use strict";cc._RF.push(e,"e1b90/rohdEk4SdmmEZANaD","Start"),Object.defineProperty(o,"__esModule",{value:!0});var i=cc._decorator,a=i.ccclass,n=i.property,r=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.label=null,t.text="hello",t}return __extends(t,e),t.prototype.start=function(){},t.prototype.startGame=function(){cc.director.loadScene("chapter")},__decorate([n(cc.Label)],t.prototype,"label",void 0),__decorate([n],t.prototype,"text",void 0),t=__decorate([a],t)}(cc.Component);o.default=r,cc._RF.pop()},{}],Tile:[function(t,e,o){"use strict";cc._RF.push(e,"f8047r9sJ5IqqTgIdjYi6dc","Tile"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("./Logic"),a=cc._decorator,n=a.ccclass,r=a.property,s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.label=null,t.isBroken=!1,t.isAutoShow=!0,t.timeDelay=0,t.isAnimPlaying=!1,t.isBreakingNow=!1,t}return __extends(t,e),t.prototype.onLoad=function(){this.isAutoShow=!0;for(var t=this.node.getComponentsInChildren(cc.Sprite),e=0;e<t.length;e++)t[e].spriteFrame.getTexture().setAliasTexParameters();this.anim=this.getComponent(cc.Animation),this.floor=this.node.getChildByName("sprite").getChildByName("floor").getComponent(cc.Sprite)},t.prototype.start=function(){switch(i.default.chapterName){case"chapter00":this.changeRes("tile000");break;case"chapter01":this.changeRes("tile001");break;case"chapter02":this.changeRes("tile002");break;case"chapter03":this.changeRes("tile003");break;case"chapter04":this.changeRes("tile004")}i.default.setAlias(this.node)},t.prototype.TileBreak=function(){},t.prototype.TileBreakFinish=function(){var t=this;this.isBroken=!0,this.isAnimPlaying=!1,this.isAutoShow&&setTimeout(function(){t.showTile()},2e3)},t.prototype.TileShow=function(){this.isAnimPlaying=!1},t.prototype.breakTile=function(){this.isAnimPlaying||(this.anim.play("TileBreak"),this.isBreakingNow=!0,this.isAnimPlaying=!0)},t.prototype.showTile=function(){!this.isAnimPlaying&&this.anim&&(this.anim.play("TileShow"),this.isBroken=!1,this.isBreakingNow=!1,this.isAnimPlaying=!0)},t.prototype.update=function(t){this.timeDelay+=t,1<this.timeDelay&&(this.timeDelay=0),this.label&&(this.label.string=""+this.node.zIndex)},t.prototype.changeRes=function(t){this.floor.spriteFrame=i.default.spriteFrames[t]},__decorate([r(cc.Label)],t.prototype,"label",void 0),t=__decorate([n],t)}(cc.Component);o.default=s,cc._RF.pop()},{"./Logic":"Logic"}],Trap:[function(t,e,o){"use strict";cc._RF.push(e,"67e3dv84GNOwbSynhs23bOv","Trap"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("../Dungeon"),a=t("../EventConstant"),n=t("../Player"),r=cc._decorator,s=r.ccclass,c=r.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.openSpriteFrame=null,t.closeSpriteFrame=null,t.isOpen=!1,t.pos=cc.v2(0,0),t.timeDelay=0,t.isPlayerIn=!1,t}return __extends(t,e),t.prototype.onLoad=function(){this.sprite=this.node.getChildByName("sprite")},t.prototype.start=function(){},t.prototype.setPos=function(t){this.pos=t,this.node.position=i.default.getPosInMap(t),this.node.zIndex=3e3+100*(i.default.HEIGHT_SIZE-t.y)+1},t.prototype.openTrap=function(){var t=this;this.isOpen||(this.isOpen=!0,this.openSpriteFrame.getTexture().setAliasTexParameters(),this.sprite.getComponent(cc.Sprite).spriteFrame=this.openSpriteFrame,setTimeout(function(){t.closeSpriteFrame&&(t.closeSpriteFrame.getTexture().setAliasTexParameters(),t.sprite.getComponent(cc.Sprite).spriteFrame=t.closeSpriteFrame,t.isOpen=!1)},500))},t.prototype.onCollisionStay=function(t,e){3==t.tag&&this.isOpen&&this.isPlayerIn&&(this.isOpen=!1,cc.director.emit(a.EventConstant.PLAYER_TAKEDAMAGE,{damage:1}))},t.prototype.onBeginContact=function(t,e,o){o.body.node.getComponent(n.default)&&(this.isPlayerIn=!0)},t.prototype.onEndContact=function(t,e,o){o.body.node.getComponent(n.default)&&(this.isPlayerIn=!1)},t.prototype.update=function(t){this.timeDelay+=t,2<this.timeDelay&&(this.openTrap(),this.timeDelay=0)},__decorate([c(cc.SpriteFrame)],t.prototype,"openSpriteFrame",void 0),__decorate([c(cc.SpriteFrame)],t.prototype,"closeSpriteFrame",void 0),t=__decorate([s],t)}(cc.Component);o.default=l,cc._RF.pop()},{"../Dungeon":"Dungeon","../EventConstant":"EventConstant","../Player":"Player"}],Wall:[function(t,e,o){"use strict";cc._RF.push(e,"e7c06zRjp9J+piF+ZsFdjSH","Wall"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("../Dungeon"),a=cc._decorator,n=a.ccclass,r=(a.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.half=!1,t}return __extends(t,e),t.prototype.onLoad=function(){for(var t=this.node.getComponentsInChildren(cc.Sprite),e=0;e<t.length;e++)t[e].spriteFrame&&t[e].spriteFrame.getTexture().setAliasTexParameters()},t.prototype.setPos=function(t){this.pos=t,this.node.position=i.default.getPosInMap(t)},t.prototype.start=function(){this.node.opacity=255},t.prototype.onCollisionEnter=function(t,e){this.node.opacity=255},t.prototype.onCollisionStay=function(t,e){3!=t.tag&&4!=t.tag||(this.node.opacity=128)},t.prototype.onCollisionExit=function(t,e){this.node.opacity=255},t=__decorate([n],t)}(cc.Component));o.default=r,cc._RF.pop()},{"../Dungeon":"Dungeon"}]},{},["Kraken","KrakenSwingHand","Chest","Door","Portal","Trap","Wall","CameraControl","Chapter","Controller","EquipmentData","EquipmentDescData","InventoryData","MapData","MonsterData","PlayerData","Dungeon","Equipment","EquipmentDialog","EventConstant","Game","GameFinish","GameOver","HealthBar","Inventory","Bullet","Item","Joystick","Loading","Logic","DungeonStyleManager","EquipmentManager","MapManager","MonsterManager","MeleeWeapon","MiniMap","Monster","Player","RectDoor","RectDungeon","RectRoom","Shooter","Start","Tile"]);